<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Warsaw Tycoon Mini</title>
    <style>
        :root {
            --primary: #2ebc4f; /* Telegram Green */
            --secondary: #0088cc; /* Telegram Blue */
            --bg: #f5f5f7;
            --card: #ffffff;
            --text: #000000;
            --gray: #8e8e93;
            --danger: #ff3b30;
            --nav-height: 60px;
            --header-height: 70px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            height: 100vh;
            width: 100vw;
            overflow: hidden; /* –ó–∞–ø—Ä–µ—Ç —Å–∫—Ä–æ–ª–ª–∞ –≤—Å–µ–≥–æ —Ç–µ–ª–∞ */
            display: flex;
            flex-direction: column;
        }

        /* --- HEADER (STATS) --- */
        .header {
            height: var(--header-height);
            background: var(--card);
            padding: 10px 15px;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            align-items: center;
            box-shadow: 0 1px 5px rgba(0,0,0,0.05);
            z-index: 10;
        }

        .stat-item { text-align: center; }
        .stat-val { font-weight: 800; font-size: 1.1em; display: block; }
        .stat-lbl { font-size: 0.75em; color: var(--gray); text-transform: uppercase; }
        .money-val { color: var(--primary); }
        .energy-val { color: var(--secondary); }

        /* --- MAIN CONTENT AREA --- */
        .content-area {
            flex: 1;
            position: relative;
            overflow: hidden;
            background: var(--bg);
        }

        .tab-view {
            display: none;
            height: 100%;
            padding: 15px;
            flex-direction: column;
            overflow-y: auto; /* –°–∫—Ä–æ–ª–ª —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ —Ç–∞–±–∞, –µ—Å–ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –º–Ω–æ–≥–æ */
        }
        .tab-view.active { display: flex; }

        /* --- TAB 1: WORK (MAIN) --- */
        .work-container {
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 20px;
            align-items: center;
        }

        .level-badge {
            background: #e1f5fe;
            color: var(--secondary);
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .main-btn {
            width: 80%;
            max-width: 300px;
            height: 160px; /* –ë–æ–ª—å—à–∞—è –∫–Ω–æ–ø–∫–∞ */
            border: none;
            border-radius: 25px;
            font-size: 1.5em;
            font-weight: 800;
            color: white;
            cursor: pointer;
            box-shadow: 0 10px 20px rgba(46, 188, 79, 0.3);
            transition: transform 0.1s, filter 0.1s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .btn-work { background: linear-gradient(145deg, #4ade80, #22c55e); }
        .btn-work:active { transform: scale(0.95); }
        .btn-work:disabled { background: #d1d5db; box-shadow: none; cursor: not-allowed; }

        .btn-sub { font-size: 0.6em; opacity: 0.9; font-weight: normal; }

        .btn-rest {
            background: white;
            color: var(--secondary);
            border: 2px solid var(--secondary);
            width: 60%;
            padding: 12px;
            border-radius: 15px;
            font-weight: 700;
            font-size: 1em;
        }

        /* --- TAB 2: SHOP --- */
        .shop-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            padding-bottom: 20px;
        }
        
        .shop-card {
            background: var(--card);
            padding: 12px;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .shop-icon { font-size: 2em; margin-bottom: 5px; }
        .shop-name { font-weight: 600; font-size: 0.9em; margin-bottom: 4px; line-height: 1.2; }
        .shop-desc { font-size: 0.7em; color: var(--gray); margin-bottom: 8px; flex-grow: 1; }
        .shop-price-btn {
            background: var(--text);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 0.85em;
            width: 100%;
        }
        .shop-price-btn.consumable { background: var(--secondary); }

        /* --- TAB 3: PROFILE --- */
        .profile-list { display: flex; flex-direction: column; gap: 10px; }
        .inv-row {
            background: white;
            padding: 12px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 500;
        }

        /* --- BOTTOM NAV --- */
        .bottom-nav {
            height: var(--nav-height);
            background: var(--card);
            border-top: 1px solid #eee;
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 20;
        }

        .nav-btn {
            background: none;
            border: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--gray);
            font-size: 0.7em;
            gap: 4px;
            padding: 5px;
            width: 60px;
        }
        .nav-btn.active { color: var(--primary); }
        .nav-icon { font-size: 1.5em; }

        /* Toast Notification */
        #toast {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            z-index: 100;
            width: max-content;
        }
    </style>
</head>
<body>

<div id="toast">–°–æ–æ–±—â–µ–Ω–∏–µ</div>

<header class="header">
    <div class="stat-item">
        <span class="stat-val money-val" id="money">0</span>
        <span class="stat-lbl">PLN</span>
    </div>
    <div class="stat-item">
        <span class="stat-val energy-val" id="energy">100</span>
        <span class="stat-lbl">–≠–Ω–µ—Ä–≥–∏—è</span>
    </div>
    <div class="stat-item">
        <span class="stat-val" id="level">1</span>
        <span class="stat-lbl">–£—Ä–æ–≤–µ–Ω—å</span>
    </div>
</header>

<div class="content-area">

    <div id="tab-home" class="tab-view active">
        <div class="work-container">
            <div class="level-badge" id="rank-name">–ù–æ–≤–∏—á–æ–∫</div>
            
            <button class="main-btn btn-work" id="btn-work" onclick="work()">
                <span style="font-size:2em">üî®</span>
                –†–ê–ë–û–¢–ê–¢–¨
                <span class="btn-sub">-2 –≠–Ω–µ—Ä–≥–∏–∏</span>
            </button>

            <div style="text-align:center; color: var(--gray); font-size:0.8em; margin: 5px 0;">
                –î–æ—Ö–æ–¥: <span id="click-val">10</span> PLN/–∫–ª–∏–∫<br>
                –ü–∞—Å—Å–∏–≤: <span id="passive-val">0</span> PLN/—Å–µ–∫
            </div>

            <button class="btn-rest" onclick="rest()">üí§ –û—Ç–¥–æ—Ö–Ω—É—Ç—å</button>
        </div>
    </div>

    <div id="tab-shop" class="tab-view">
        <h3 style="margin-top:0">–ú–∞–≥–∞–∑–∏–Ω</h3>
        <div class="shop-grid" id="shop-container">
            </div>
    </div>

    <div id="tab-profile" class="tab-view">
        <h3 style="margin-top:0">–ú–æ–π –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å</h3>
        <div class="profile-list" id="inv-container">
            </div>
        <button onclick="resetGame()" style="margin-top:20px; width:100%; padding:15px; border:none; color:red; background:white; border-radius:10px;">–°–±—Ä–æ—Å –∏–≥—Ä—ã</button>
    </div>

</div>

<nav class="bottom-nav">
    <button class="nav-btn active" onclick="switchTab('home', this)">
        <span class="nav-icon">üè†</span>
        <span>–ì–ª–∞–≤–Ω–∞—è</span>
    </button>
    <button class="nav-btn" onclick="switchTab('shop', this)">
        <span class="nav-icon">üõí</span>
        <span>–ú–∞–≥–∞–∑–∏–Ω</span>
    </button>
    <button class="nav-btn" onclick="switchTab('profile', this)">
        <span class="nav-icon">üéí</span>
        <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
    </button>
</nav>

<script>
    // --- KEY & CONFIG ---
    const GAME_KEY = 'WARSZAWA_FOREVER_MINI';
    const MAX_LEVEL = 150;
    
    // --- STATE ---
    let state = {
        money: 0,
        energy: 100,
        maxEnergy: 100,
        xp: 0,
        level: 1,
        clickPower: 10,
        passiveIncome: 0,
        inventory: {},
        lastSaveTime: Date.now()
    };

    // --- ITEMS ---
    const items = [
        { id: 'coffee', icon: '‚òï', name: '–ö–æ—Ñ–µ', type: 'cons', price: 50, eff: {en: 40}, desc: '+40 –°–∏–ª' },
        { id: 'course', icon: 'üìö', name: '–ö—É—Ä—Å—ã', type: 'upg', price: 500, eff: {cp: 5}, desc: '+5 –ö–ª–∏–∫' },
        { id: 'bike', icon: 'üö≤', name: '–í–µ–ª–∏–∫', type: 'pas', price: 1500, eff: {inc: 15}, desc: '+15/—Å–µ–∫' },
        { id: 'mac', icon: 'üíª', name: '–ú–∞–∫–±—É–∫', type: 'pas', price: 5000, eff: {inc: 60, maxEn: 20}, desc: '+60/—Å–µ–∫' },
        { id: 'ai', icon: 'ü§ñ', name: 'AI –ë–æ—Ç', type: 'upg', price: 10000, eff: {cp: 50}, desc: '+50 –ö–ª–∏–∫' },
        { id: 'firm', icon: 'üè¢', name: '–§–∏—Ä–º–∞', type: 'pas', price: 50000, eff: {inc: 500}, desc: '+500/—Å–µ–∫' }
    ];

    // --- LOGIC ---
    function init() {
        loadGame();
        renderShop();
        updateUI();
        switchTab('home', document.querySelector('.nav-btn')); // Set default

        setInterval(() => {
            if(state.passiveIncome > 0) addMoney(state.passiveIncome);
            if(state.energy < state.maxEnergy) {
                state.energy = Math.min(state.energy + 1, state.maxEnergy);
                updateHeader();
            }
        }, 1000);
        setInterval(saveGame, 10000);
    }

    function work() {
        if(state.energy >= 2) {
            state.energy -= 2;
            let earn = state.clickPower * (1 + (state.level * 0.1));
            addMoney(earn);
            addXp(10);
            updateUI();
            
            // Animation for button
            const btn = document.getElementById('btn-work');
            btn.style.transform = 'scale(0.95)';
            setTimeout(() => btn.style.transform = 'scale(1)', 100);
        } else {
            showToast("üõë –ù—É–∂–µ–Ω –æ—Ç–¥—ã—Ö!");
        }
    }

    function rest() {
        if(state.energy < state.maxEnergy) {
            state.energy = Math.min(state.energy + 15, state.maxEnergy);
            showToast("üí§ –°–∏–ª—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã");
            updateUI();
        }
    }

    function buy(id) {
        let item = items.find(i => i.id === id);
        if(state.money >= item.price) {
            state.money -= item.price;
            if(item.type === 'cons') {
                if(item.eff.en) state.energy = Math.min(state.energy + item.eff.en, state.maxEnergy);
                showToast(`–í—ã–ø–∏–ª: ${item.name}`);
            } else {
                state.inventory[id] = (state.inventory[id] || 0) + 1;
                if(item.eff.cp) state.clickPower += item.eff.cp;
                if(item.eff.inc) state.passiveIncome += item.eff.inc;
                if(item.eff.maxEn) state.maxEnergy += item.eff.maxEn;
                
                // Price increase
                item.price = Math.floor(item.price * 1.3);
                showToast(`–ö—É–ø–ª–µ–Ω–æ: ${item.name}`);
                renderShop();
                renderInv();
            }
            updateUI();
        } else {
            showToast("üí∏ –ú–∞–ª–æ –¥–µ–Ω–µ–≥!");
        }
    }

    function addMoney(val) { state.money += val; updateHeader(); }
    
    function addXp(val) {
        if(state.level >= MAX_LEVEL) return;
        state.xp += val;
        let req = Math.floor(100 * Math.pow(state.level, 1.5));
        if(state.xp >= req) {
            state.xp = 0;
            state.level++;
            state.maxEnergy += 5;
            state.energy = state.maxEnergy;
            showToast(`üéâ –£—Ä–æ–≤–µ–Ω—å ${state.level}!`);
        }
        updateHeader(); // Only stats needed usually
    }

    // --- UI ---
    function updateUI() {
        updateHeader();
        document.getElementById('click-val').innerText = Math.floor(state.clickPower * (1 + state.level*0.1));
        document.getElementById('passive-val').innerText = state.passiveIncome;
        
        let ranks = ["–ù–æ–≤–∏—á–æ–∫", "–ú–µ—Å—Ç–Ω—ã–π", "–î–µ–ª–µ—Ü", "–ú–∞–≥–Ω–∞—Ç", "–û–ª–∏–≥–∞—Ä—Ö"];
        let rIndex = Math.min(Math.floor(state.level / 20), 4);
        document.getElementById('rank-name').innerText = `${ranks[rIndex]} (Lvl ${state.level})`;

        document.getElementById('btn-work').disabled = state.energy < 2;
    }

    function updateHeader() {
        document.getElementById('money').innerText = nF(state.money);
        document.getElementById('energy').innerText = Math.floor(state.energy);
        document.getElementById('level').innerText = state.level;
    }

    function renderShop() {
        let html = '';
        items.forEach(i => {
            html += `
            <div class="shop-card">
                <div class="shop-icon">${i.icon}</div>
                <div class="shop-name">${i.name}</div>
                <div class="shop-desc">${i.desc}</div>
                <button class="shop-price-btn ${i.type==='cons'?'consumable':''}" onclick="buy('${i.id}')">
                    ${nF(i.price)} PLN
                </button>
            </div>`;
        });
        document.getElementById('shop-container').innerHTML = html;
    }

    function renderInv() {
        let html = '';
        let empty = true;
        for(let k in state.inventory) {
            if(state.inventory[k] > 0) {
                let it = items.find(i => i.id === k);
                html += `<div class="inv-row">
                    <span>${it.icon} ${it.name}</span>
                    <span style="font-weight:bold">x${state.inventory[k]}</span>
                </div>`;
                empty = false;
            }
        }
        if(empty) html = '<div style="text-align:center; color:#999; margin-top:20px;">–ü—É—Å—Ç–æ...</div>';
        document.getElementById('inv-container').innerHTML = html;
    }

    // --- NAVIGATION ---
    function switchTab(tabId, btn) {
        // Hide all tabs
        document.querySelectorAll('.tab-view').forEach(el => el.classList.remove('active'));
        // Show target
        document.getElementById('tab-' + tabId).classList.add('active');
        
        // Update nav buttons
        if(btn) {
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            btn.classList.add('active');
        }

        if(tabId === 'profile') renderInv();
    }

    function showToast(msg) {
        let t = document.getElementById('toast');
        t.innerText = msg;
        t.style.opacity = 1;
        setTimeout(() => t.style.opacity = 0, 2000);
    }

    function nF(num) {
        return Math.floor(num).toLocaleString();
    }

    // --- SAVE ---
    function saveGame() { localStorage.setItem(GAME_KEY, JSON.stringify(state)); }
    function loadGame() {
        let s = localStorage.getItem(GAME_KEY);
        if(s) {
            try { state = {...state, ...JSON.parse(s)}; } catch(e){}
        }
    }
    function resetGame() {
        if(confirm('–°–±—Ä–æ—Å–∏—Ç—å?')) { localStorage.removeItem(GAME_KEY); location.reload(); }
    }

    init();
</script>
</body>
</html>
