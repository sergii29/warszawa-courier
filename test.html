<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neon Courier V3</title>
    <style>
        :root {
            --bg-color: #050510;
            --primary: #00f3ff;
            --secondary: #ff00ff;
            --pickup: #ffff00;
            --danger: #ff3333;
            --gold: #ffd700;
            --panel-bg: rgba(10, 10, 30, 0.95);
            --grid-line: rgba(255, 255, 255, 0.03);
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: #fff;
            font-family: 'Courier New', Courier, monospace;
            overflow: hidden;
            touch-action: manipulation;
            display: flex;
            flex-direction: column;
            height: 100vh;
            width: 100vw;
        }

        /* --- –í–ï–†–•–ù–ï–ï –ú–ï–ù–Æ --- */
        .hud {
            display: flex;
            justify-content: space-between;
            padding: 12px 15px;
            background: rgba(0,0,0,0.8);
            border-bottom: 1px solid #333;
            z-index: 10;
            flex-shrink: 0; /* –ß—Ç–æ–±—ã –Ω–µ —Å–∂–∏–º–∞–ª–æ—Å—å */
        }

        .stat-group { text-align: center; min-width: 60px; }
        .stat-label { font-size: 9px; color: #888; text-transform: uppercase; margin-bottom: 2px; }
        .stat-val { font-size: 16px; font-weight: bold; text-shadow: 0 0 5px currentColor; }

        /* --- –ö–ê–†–¢–ê (–ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è) --- */
        #game-container {
            flex: 1; /* –ó–∞–Ω–∏–º–∞–µ—Ç –≤—Å–µ —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ */
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }

        #game-map {
            display: grid;
            /* –°–µ—Ç–∫–∞ –∑–∞–¥–∞–µ—Ç—Å—è –≤ JS */
            background: 
                linear-gradient(var(--grid-line) 1px, transparent 1px),
                linear-gradient(90deg, var(--grid-line) 1px, transparent 1px);
            background-size: 100% 100%; /* –†–∞—Å—Ç—è–≥–∏–≤–∞–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω */
            gap: 1px;
            padding: 2px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            border: 1px solid rgba(255,255,255,0.05);
            
            /* –†–∞–∑–º–µ—Ä—ã –∫–∞—Ä—Ç—ã: –¥–µ–ª–∞–µ–º –∫–≤–∞–¥—Ä–∞—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤–ª–µ–∑–∞–µ—Ç –≤ —ç–∫—Ä–∞–Ω */
            width: 90vmin;
            height: 90vmin;
            max-width: 500px;
            max-height: 500px;
        }

        .cell {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px; /* –ú–µ–Ω—å—à–µ –∏–∫–æ–Ω–∫–∏ */
            position: relative;
            border-radius: 2px;
        }
        
        /* –≠—Ñ—Ñ–µ–∫—Ç—ã */
        .player-glow { filter: drop-shadow(0 0 4px var(--primary)); z-index: 5; font-size: 18px; }
        .pickup-glow { filter: drop-shadow(0 0 6px var(--pickup)); animation: pulse 1s infinite; z-index: 4; }
        .delivery-glow { filter: drop-shadow(0 0 6px var(--secondary)); animation: pulse 1s infinite; z-index: 4; }
        .wall-glow { opacity: 0.5; filter: drop-shadow(0 0 2px var(--danger)); font-size: 14px; }

        /* --- –ü–õ–ê–í–ê–Æ–©–ï–ï –£–ü–†–ê–í–õ–ï–ù–ò–ï --- */
        .controls-wrapper {
            position: absolute;
            bottom: 40px; /* –°–ò–õ–¨–ù–û –ü–û–î–ù–Ø–õ –û–¢ –ù–ò–ó–ê */
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            width: 100%;
            display: flex;
            justify-content: center;
            pointer-events: none; /* –ß—Ç–æ–±—ã –∫–ª–∏–∫–∏ –ø—Ä–æ—Ö–æ–¥–∏–ª–∏ —Å–∫–≤–æ–∑—å –ø—É—Å—Ç—ã–µ –º–µ—Å—Ç–∞ */
        }

        .controls-pad {
            background: var(--panel-bg);
            padding: 15px;
            border-radius: 25px;
            border: 1px solid var(--primary);
            box-shadow: 0 5px 20px rgba(0,0,0,0.8), 0 0 15px rgba(0, 243, 255, 0.2);
            pointer-events: auto; /* –í–∫–ª—é—á–∞–µ–º –∫–ª–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
            
            display: grid;
            grid-template-columns: 60px 60px 60px;
            grid-template-rows: 50px 50px;
            gap: 8px;
        }

        .btn {
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            color: var(--primary);
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: 0.1s;
        }
        .btn:active { background: var(--primary); color: #000; transform: scale(0.95); }
        .btn-action { border-color: var(--gold); color: var(--gold); background: rgba(255, 215, 0, 0.1); }
        
        /* –°–æ–æ–±—â–µ–Ω–∏—è */
        #msg-log {
            position: absolute;
            top: 20%; left: 50%; /* –ß—É—Ç—å –≤—ã—à–µ —Ü–µ–Ω—Ç—Ä–∞ */
            transform: translate(-50%, -50%);
            font-size: 14px; font-weight: bold;
            background: rgba(0,0,0,0.85);
            padding: 8px 16px; border-radius: 15px;
            border: 1px solid #fff;
            pointer-events: none; opacity: 0; transition: opacity 0.3s; z-index: 200; text-align: center;
            white-space: nowrap;
        }

        @keyframes pulse { 0% {transform: scale(0.9);} 50% {transform: scale(1.2);} 100% {transform: scale(0.9);} }
    </style>
</head>
<body>

    <div class="hud">
        <div class="stat-group">
            <div class="stat-label">PLN</div>
            <div class="stat-val" style="color: var(--gold)" id="ui-balance">0.00</div>
        </div>
        <div class="stat-group">
            <div class="stat-label">–ó–∞—Ä—è–¥</div>
            <div class="stat-val" style="color: var(--primary)" id="ui-energy">100%</div>
        </div>
        <div class="stat-group">
            <div class="stat-label">–¶–µ–ª—å</div>
            <div class="stat-val" style="font-size: 12px" id="ui-status">–ü–æ–∏—Å–∫...</div>
        </div>
    </div>

    <div id="game-container">
        <div id="msg-log"></div>
        <div id="game-map"></div>
    </div>

    <div class="controls-wrapper">
        <div class="controls-pad">
            <div></div>
            <div class="btn" onclick="move(0, -1)">‚ñ≤</div>
            <div></div>
            
            <div class="btn" onclick="move(-1, 0)">‚óÄ</div>
            <div class="btn btn-action" onclick="actionBoost()">‚ö°</div>
            <div class="btn" onclick="move(1, 0)">‚ñ∂</div>
            
            <div></div>
            <div class="btn" onclick="move(0, 1)">‚ñº</div>
            <div></div>
        </div>
    </div>

    <script>
        // --- –ö–û–ù–§–ò–ì ---
        const GRID_SIZE = 13; // –ë–´–õ–û 9, –°–¢–ê–õ–û 13 (–ö–ª–µ—Ç–∫–∏ –º–µ–Ω—å—à–µ)
        
        let state = {
            x: 6, y: 6,        // –¶–µ–Ω—Ç—Ä –¥–ª—è 13x13
            objective: {x:0, y:0},
            hasPackage: false,
            walls: [],
            balance: 0,
            energy: 100
        };

        const mapEl = document.getElementById('game-map');

        function initGame() {
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CSS Grid
            mapEl.style.gridTemplateColumns = `repeat(${GRID_SIZE}, 1fr)`;
            mapEl.style.gridTemplateRows = `repeat(${GRID_SIZE}, 1fr)`;
            
            // –°–æ–∑–¥–∞–µ–º –∫–ª–µ—Ç–∫–∏
            mapEl.innerHTML = '';
            for(let i=0; i<GRID_SIZE*GRID_SIZE; i++) {
                let cell = document.createElement('div');
                cell.className = 'cell';
                cell.id = `c-${i}`;
                mapEl.appendChild(cell);
            }
            
            spawnObjective();
            generateWalls();
            draw();
            updateUI();
        }

        function getIdx(x, y) { return y * GRID_SIZE + x; }

        function generateWalls() {
            state.walls = [];
            // –ë–æ–ª—å—à–µ —Å—Ç–µ–Ω –¥–ª—è –±–æ–ª—å—à–æ–π –∫–∞—Ä—Ç—ã (–æ–∫–æ–ª–æ 30)
            for(let i=0; i<30; i++) {
                let wx, wy;
                do {
                    wx = Math.floor(Math.random() * GRID_SIZE);
                    wy = Math.floor(Math.random() * GRID_SIZE);
                } while ((wx === state.x && wy === state.y) || (wx === state.objective.x && wy === state.objective.y));
                
                state.walls.push(getIdx(wx, wy));
            }
        }

        function spawnObjective() {
            do {
                state.objective.x = Math.floor(Math.random() * GRID_SIZE);
                state.objective.y = Math.floor(Math.random() * GRID_SIZE);
            } while (state.objective.x === state.x && state.objective.y === state.y);
            
            if(state.hasPackage) generateWalls(); 
            draw();
            updateUI();
        }

        function move(dx, dy) {
            if (state.energy <= 0) { showMsg("ü™´ –°–ï–õ–ê –ë–ê–¢–ê–†–ï–Ø!", "red"); return; }

            let nx = state.x + dx;
            let ny = state.y + dy;

            if (nx < 0 || nx >= GRID_SIZE || ny < 0 || ny >= GRID_SIZE) return;

            let nIdx = getIdx(nx, ny);
            if (state.walls.includes(nIdx)) {
                showMsg("üöß –¢–£–ü–ò–ö!", "#ff9900");
                state.energy -= 2;
                updateUI();
                return;
            }

            state.x = nx;
            state.y = ny;
            state.energy -= 1;

            if (state.x === state.objective.x && state.y === state.objective.y) {
                if (!state.hasPackage) {
                    state.hasPackage = true;
                    showMsg("üéí –ó–ê–ë–†–ê–õ! –í–ï–ó–ò –ö–õ–ò–ï–ù–¢–£", "#ffff00");
                    spawnObjective();
                } else {
                    state.hasPackage = false;
                    let profit = 20 + Math.floor(Math.random() * 15);
                    state.balance += profit;
                    showMsg(`‚úÖ +${profit} PLN`, "#00f3ff");
                    generateWalls();
                    spawnObjective();
                }
            }
            draw();
            updateUI();
        }

        function actionBoost() {
            if (state.balance >= 15) {
                state.balance -= 15;
                state.energy = Math.min(100, state.energy + 50);
                showMsg("‚ö° –ó–ê–†–Ø–ñ–ï–ù–û! (-15)", "#00ff00");
                updateUI();
            } else { showMsg("‚ùå –ù–ï–¢ –î–ï–ù–ï–ì", "red"); }
        }

        function draw() {
            document.querySelectorAll('.cell').forEach(c => {
                c.className = 'cell';
                c.innerText = '';
            });

            state.walls.forEach(idx => {
                let c = document.getElementById(`c-${idx}`);
                c.innerText = 'üöß';
                c.classList.add('wall-glow');
            });

            let tIdx = getIdx(state.objective.x, state.objective.y);
            let tCell = document.getElementById(`c-${tIdx}`);
            if (!state.hasPackage) {
                tCell.innerText = 'üè™';
                tCell.classList.add('pickup-glow');
            } else {
                tCell.innerText = 'üè†';
                tCell.classList.add('delivery-glow');
            }

            let pIdx = getIdx(state.x, state.y);
            let pCell = document.getElementById(`c-${pIdx}`);
            pCell.innerText = 'üõµ';
            pCell.classList.add('player-glow');
        }

        function updateUI() {
            document.getElementById('ui-balance').innerText = state.balance.toFixed(0);
            let enEl = document.getElementById('ui-energy');
            enEl.innerText = Math.floor(state.energy) + '%';
            enEl.style.color = state.energy < 30 ? 'red' : 'var(--primary)';

            let statusEl = document.getElementById('ui-status');
            if(!state.hasPackage) {
                 statusEl.innerText = "–í –†–ï–°–¢–û–†–ê–ù";
                 statusEl.style.color = "var(--pickup)";
            } else {
                 statusEl.innerText = "–ö –ö–õ–ò–ï–ù–¢–£";
                 statusEl.style.color = "var(--secondary)";
            }
        }

        function showMsg(text, color) {
            let el = document.getElementById('msg-log');
            el.innerText = text;
            el.style.color = color;
            el.style.borderColor = color;
            el.style.opacity = 1;
            setTimeout(() => el.style.opacity = 0, 1500);
        }

        initGame();
    </script>
</body>
</html>
