<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Warsaw Royal Casino (Fixed)</title>
    <style>
        :root {
            --bg: #0f172a;
            --card: #1e293b;
            --primary: #fbbf24;
            --accent: #10b981;
            --text: #f8fafc;
            --nav-height: 70px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0; padding: 0;
            background: var(--bg);
            color: var(--text);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            height: 100vh; width: 100vw;
            display: flex; flex-direction: column;
            overflow: hidden;
        }

        /* --- UI Elements --- */
        .top-bar {
            height: 60px;
            background: rgba(30, 41, 59, 0.95);
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 15px;
            border-bottom: 1px solid #334155;
            flex-shrink: 0;
        }
        .balance { font-size: 1.2em; font-weight: 800; color: var(--accent); }
        .level { font-size: 0.9em; color: var(--primary); text-align: right; }

        .content { flex: 1; overflow-y: auto; position: relative; padding-bottom: 80px; }
        
        /* Views */
        .view { display: none; padding: 15px; animation: fadeIn 0.2s; }
        .view.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Grid */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .card {
            background: linear-gradient(145deg, #1e293b, #111827);
            border: 1px solid #334155;
            border-radius: 16px;
            padding: 20px 10px;
            text-align: center;
            display: flex; flex-direction: column; align-items: center; gap: 10px;
        }
        .card:active { transform: scale(0.96); background: #263346; }
        .icon { font-size: 2.5em; }
        .title { font-weight: bold; font-size: 0.9em; }
        .desc { font-size: 0.75em; color: #94a3b8; }

        /* Game Room */
        .game-room { text-align: center; height: 100%; display: flex; flex-direction: column; gap: 15px; }
        .screen {
            background: #000; border: 2px solid var(--primary); border-radius: 12px;
            height: 140px; display: flex; align-items: center; justify-content: center;
            font-size: 3em; color: white; position: relative;
        }
        .controls { background: var(--card); padding: 15px; border-radius: 12px; }
        
        button {
            border: none; outline: none; cursor: pointer; font-family: inherit;
        }
        .btn-main {
            width: 100%; padding: 15px; border-radius: 10px;
            background: var(--primary); color: #000; font-weight: 800; font-size: 1.1em;
            margin-top: 10px;
        }
        .btn-main:active { transform: scale(0.98); opacity: 0.9; }
        
        .btn-bank {
            width: 100%; padding: 40px; border-radius: 20px;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white; font-size: 1.5em; font-weight: bold;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
            margin-bottom: 20px;
        }
        .btn-bank:active { transform: scale(0.95); }

        .input-bet {
            width: 100%; padding: 12px; background: #0f172a; border: 1px solid #475569;
            color: white; border-radius: 8px; font-size: 1.2em; text-align: center;
        }

        /* Nav */
        .nav {
            height: var(--nav-height); background: var(--card);
            border-top: 1px solid #334155;
            position: absolute; bottom: 0; width: 100%;
            display: flex; justify-content: space-around; align-items: center;
            z-index: 100;
        }
        .nav-btn {
            background: none; color: #64748b; font-size: 0.7em;
            display: flex; flex-direction: column; align-items: center; gap: 5px;
            width: 60px;
        }
        .nav-btn.active { color: var(--primary); }
        .nav-icon { font-size: 1.5em; }

        /* Toast */
        #toast {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9); padding: 15px 20px; border-radius: 20px;
            color: #fff; opacity: 0; pointer-events: none; transition: 0.2s; z-index: 200;
            border: 1px solid var(--primary); font-weight: bold; text-align: center;
        }
    </style>
</head>
<body>

<div class="top-bar">
    <div>
        <div style="font-size:0.7em; color:#94a3b8">–ë–ê–õ–ê–ù–°</div>
        <div class="balance" id="ui-money">0 PLN</div>
    </div>
    <div class="level">
        <div id="ui-lvl">LVL 1</div>
        <div style="font-size:0.7em; opacity:0.8" id="ui-bet">Max: 100</div>
    </div>
</div>

<div class="content">
    
    <div id="view-lobby" class="view active">
        <h2 style="margin-top:0">–ò–≥—Ä—ã</h2>
        <div class="grid">
            <div class="card" onclick="app.openGame('slots')">
                <div class="icon">üé∞</div>
                <div class="title">–°–ª–æ—Ç—ã</div>
                <div class="desc">–£–¥–∞—á–∞ x5</div>
            </div>
            <div class="card" onclick="app.openGame('roulette')">
                <div class="icon">üî¥</div>
                <div class="title">–†—É–ª–µ—Ç–∫–∞</div>
                <div class="desc">–ö—Ä–∞—Å–Ω–æ–µ/–ß–µ—Ä–Ω–æ–µ</div>
            </div>
            <div class="card" onclick="app.openGame('dice')">
                <div class="icon">üé≤</div>
                <div class="title">–ö–æ—Å—Ç–∏</div>
                <div class="desc">–ë–æ–ª—å—à–µ/–ú–µ–Ω—å—à–µ</div>
            </div>
            <div class="card" onclick="app.openGame('coin')">
                <div class="icon">ü™ô</div>
                <div class="title">–ú–æ–Ω–µ—Ç–∫–∞</div>
                <div class="desc">–û—Ä–µ–ª/–†–µ—à–∫–∞</div>
            </div>
            <div class="card" onclick="app.openGame('crash')">
                <div class="icon">üöÄ</div>
                <div class="title">Crash</div>
                <div class="desc">–†–∏—Å–∫–Ω–∏ –≤—Å–µ–º</div>
            </div>
             <div class="card" onclick="app.openGame('lottery')">
                <div class="icon">üé´</div>
                <div class="title">–õ–æ—Ç–µ—Ä–µ—è</div>
                <div class="desc">–ë–∏–ª–µ—Ç –∑–∞ 50</div>
            </div>
        </div>
        <p style="text-align:center; color:#475569; font-size:0.8em; margin-top:20px;">
            –ï—Å–ª–∏ –±–∞–ª–∞–Ω—Å 0 ‚Äî –∏–¥–∏ –≤ –ë–∞–Ω–∫ üëá
        </p>
    </div>

    <div id="view-bank" class="view">
        <h2 style="margin-top:0">–†–∞–±–æ—Ç–∞</h2>
        <button class="btn-bank" id="btn-work" onclick="app.work()">
            üî® –†–ê–ë–û–¢–ê–¢–¨<br>
            <span style="font-size:0.6em; font-weight:normal">+10 PLN –∑–∞ –∫–ª–∏–∫</span>
        </button>
        <div style="background:var(--card); padding:15px; border-radius:15px;">
            <h3>–ú–∞–≥–∞–∑–∏–Ω</h3>
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <span>–ö—É—Ä—Å—ã (+5 –∫ –∫–ª–∏–∫—É)</span>
                <button onclick="app.upgrade()" style="background:var(--primary); padding:8px; border-radius:6px;">250 PLN</button>
            </div>
        </div>
    </div>

    <div id="view-game" class="view">
        <button onclick="app.goHome()" style="background:none; color:#cbd5e1; padding:10px 0;">‚Üê –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é</button>
        <div id="game-container" class="game-room">
            </div>
    </div>

</div>

<div class="nav">
    <button class="nav-btn active" onclick="app.tab('lobby', this)">
        <span class="nav-icon">üè∞</span>
        <span>–õ–æ–±–±–∏</span>
    </button>
    <button class="nav-btn" onclick="app.tab('bank', this)">
        <span class="nav-icon">üè¶</span>
        <span>–ë–∞–Ω–∫</span>
    </button>
</div>

<div id="toast"></div>

<script>
// Incapsulate to avoid global scope issues
const app = (() => {
    const KEY = 'WARSZAWA_CASINO_FIXED';
    
    // Default State
    let state = {
        money: 0,
        level: 1,
        xp: 0,
        click: 10,
        maxBet: 100
    };

    let currentGame = null;

    // --- SAFELY LOAD DATA ---
    function init() {
        try {
            const saved = localStorage.getItem(KEY);
            if (saved) {
                state = { ...state, ...JSON.parse(saved) };
            }
        } catch (e) {
            console.warn("Storage is blocked. Progress will not be saved after close.");
        }
        updateUI();
    }

    function save() {
        try {
            localStorage.setItem(KEY, JSON.stringify(state));
        } catch (e) {
            // Ignore storage errors in restricted modes
        }
    }

    // --- CORE LOGIC ---
    function addMoney(amt) {
        state.money += amt;
        updateUI();
        save();
    }

    function work() {
        addMoney(state.click);
        // Visual feedback
        const btn = document.getElementById('btn-work');
        btn.style.transform = 'scale(0.95)';
        setTimeout(() => btn.style.transform = 'scale(1)', 100);
    }

    function upgrade() {
        if(state.money >= 250) {
            addMoney(-250);
            state.click += 5;
            toast("–£–ª—É—á—à–µ–Ω–æ!");
        } else {
            toast("–ù—É–∂–Ω–æ 250 PLN");
        }
    }

    function updateUI() {
        document.getElementById('ui-money').innerText = Math.floor(state.money) + ' PLN';
        document.getElementById('ui-lvl').innerText = 'LVL ' + state.level;
        document.getElementById('ui-bet').innerText = 'Max: ' + state.maxBet;
    }

    function toast(msg, color='white') {
        const t = document.getElementById('toast');
        t.innerText = msg;
        t.style.color = color;
        t.style.opacity = 1;
        setTimeout(() => t.style.opacity = 0, 1500);
    }

    // --- NAVIGATION ---
    function tab(id, btn) {
        // Hide all views
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        // Show target
        document.getElementById('view-' + id).classList.add('active');
        
        // Update nav
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        if(btn) btn.classList.add('active');
    }

    function goHome() {
        currentGame = null;
        tab('lobby', document.querySelector('.nav-btn')); // Activate first tab
    }

    // --- GAMES ENGINE ---
    const games = {
        slots: {
            render: () => `
                <div class="screen" id="g-screen">üçí 7Ô∏è‚É£ üçí</div>
                <div class="controls">
                    <input type="number" id="bet" class="input-bet" value="10">
                    <button class="btn-main" onclick="app.playSlots()">–ö–†–£–¢–ò–¢–¨ (x5)</button>
                </div>`,
            play: () => {
                let bet = getBet(); if(!bet) return;
                addMoney(-bet);
                
                let s = document.getElementById('g-screen');
                let chars = ['üçí','üçã','üçá','üíé','7Ô∏è‚É£'];
                
                let i = setInterval(() => {
                    s.innerText = chars[rn(5)] + ' ' + chars[rn(5)] + ' ' + chars[rn(5)];
                }, 50);

                setTimeout(() => {
                    clearInterval(i);
                    let r1 = chars[rn(5)], r2 = chars[rn(5)], r3 = chars[rn(5)];
                    
                    // Rig slightly for fun
                    if(Math.random() < 0.2) r1=r2=r3;

                    s.innerText = r1 + ' ' + r2 + ' ' + r3;
                    
                    if(r1===r2 && r2===r3) {
                        addMoney(bet*5); toast("–î–ñ–ï–ö–ü–û–¢!", "#4ade80");
                    } else if(r1===r2 || r2===r3 || r1===r3) {
                        addMoney(Math.floor(bet*1.5)); toast("–ü–∞—Ä–∞! x1.5", "#fbbf24");
                    } else {
                        toast("–ü—É—Å—Ç–æ", "#ef4444");
                    }
                    checkLvl(bet);
                }, 1000);
            }
        },
        roulette: {
            render: () => `
                <div class="screen" id="g-screen" style="font-size:4em">üé°</div>
                <div class="controls">
                    <input type="number" id="bet" class="input-bet" value="10" style="margin-bottom:10px">
                    <div style="display:flex; gap:5px">
                        <button class="btn-main" style="background:#ef4444" onclick="app.playRoulette('r')">üî¥</button>
                        <button class="btn-main" style="background:#22c55e" onclick="app.playRoulette('g')">0</button>
                        <button class="btn-main" style="background:#1e293b; color:white; border:1px solid #fff" onclick="app.playRoulette('b')">‚ö´</button>
                    </div>
                </div>`,
            play: (c) => {
                let bet = getBet(); if(!bet) return;
                addMoney(-bet);
                document.getElementById('g-screen').innerText = "üé≤...";
                setTimeout(() => {
                    let n = rn(37);
                    let col = n===0 ? 'g' : (n%2===0 ? 'b' : 'r');
                    let colorCode = col==='r'?'#ef4444':(col==='b'?'#fff':'#22c55e');
                    document.getElementById('g-screen').innerHTML = `<span style="color:${colorCode}">${n}</span>`;
                    
                    if(c === col) {
                        let m = c==='g' ? 14 : 2;
                        addMoney(bet*m); toast("–ü–û–ë–ï–î–ê!", "#4ade80");
                    } else toast("–ú–∏–º–æ", "#ef4444");
                    checkLvl(bet);
                }, 500);
            }
        },
        dice: {
            render: () => `
                <div class="screen" id="g-screen">üé≤</div>
                <div class="controls">
                    <input type="number" id="bet" class="input-bet" value="10" style="margin-bottom:10px">
                    <div style="display:flex; gap:10px">
                        <button class="btn-main" onclick="app.playDice('lo')">1-3</button>
                        <button class="btn-main" onclick="app.playDice('hi')">4-6</button>
                    </div>
                </div>`,
            play: (pick) => {
                let bet = getBet(); if(!bet) return;
                addMoney(-bet);
                let n = rn(6) + 1;
                document.getElementById('g-screen').innerText = n;
                let win = (pick==='lo' && n<=3) || (pick==='hi' && n>=4);
                if(win) { addMoney(bet*2); toast("–£–≥–∞–¥–∞–ª!", "#4ade80"); }
                else toast("–ù–µ—Ç", "#ef4444");
                checkLvl(bet);
            }
        },
        coin: {
            render: () => `
                <div class="screen" id="g-screen" style="font-size:4em">ü™ô</div>
                <div class="controls">
                    <input type="number" id="bet" class="input-bet" value="10" style="margin-bottom:10px">
                    <div style="display:flex; gap:10px">
                        <button class="btn-main" style="background:#fbbf24" onclick="app.playCoin(0)">–û—Ä–µ–ª</button>
                        <button class="btn-main" style="background:#94a3b8" onclick="app.playCoin(1)">–†–µ—à–∫–∞</button>
                    </div>
                </div>`,
            play: (p) => {
                let bet = getBet(); if(!bet) return;
                addMoney(-bet);
                let r = Math.random()<0.5 ? 0 : 1;
                document.getElementById('g-screen').innerText = r===0 ? "ü¶Ö" : "üåï";
                if(p===r) { addMoney(bet*2); toast("WIN!", "#4ade80"); }
                else toast("Lose", "#ef4444");
                checkLvl(bet);
            }
        },
        crash: {
            render: () => `
                <div class="screen" id="c-screen" style="font-family:monospace">1.00x</div>
                <div class="controls">
                    <input type="number" id="bet" class="input-bet" value="10" style="margin-bottom:10px">
                    <button id="c-btn" class="btn-main" onclick="app.playCrash()">–ó–ê–ü–£–°–ö</button>
                </div>`,
            active: false,
            play: () => {
                if(app.crashActive) { // STOP
                    app.crashActive = false;
                    return;
                }
                // START
                let bet = getBet(); if(!bet) return;
                addMoney(-bet);
                
                app.crashActive = true;
                let btn = document.getElementById('c-btn');
                btn.innerText = "–°–¢–û–ü"; btn.style.background = "#ef4444";
                
                let m = 1.00;
                let crashAt = (Math.random()*5) + 1;
                if(Math.random()<0.3) crashAt = 1.05; // Instant crash chance

                let timer = setInterval(() => {
                    if(!app.crashActive) { // Player clicked STOP
                        clearInterval(timer);
                        let win = Math.floor(bet * m);
                        addMoney(win);
                        toast(`–ó–∞–±—Ä–∞–ª: ${win}`, "#4ade80");
                        resetCrashBtn();
                        checkLvl(bet);
                        return;
                    }
                    m += 0.05;
                    document.getElementById('c-screen').innerText = m.toFixed(2)+'x';
                    
                    if(m >= crashAt) { // CRASHED
                        clearInterval(timer);
                        app.crashActive = false;
                        document.getElementById('c-screen').innerText = "üí• BAM";
                        document.getElementById('c-screen').style.color = "red";
                        toast("–í–∑–æ—Ä–≤–∞–ª—Å—è...", "#ef4444");
                        resetCrashBtn();
                        checkLvl(bet);
                    }
                }, 80);
            }
        },
        lottery: {
            render: () => `
                <div class="screen" style="flex-direction:column; font-size:1.5em">
                    <div>üé´</div>
                    <div id="loto-res" style="font-size:0.6em">–ë–∏–ª–µ—Ç: 50 PLN</div>
                </div>
                <div class="controls">
                    <button class="btn-main" onclick="app.playLoto()">–ö–£–ü–ò–¢–¨ (50)</button>
                </div>`,
            play: () => {
                if(state.money < 50) { toast("–ú–∞–ª–æ –¥–µ–Ω–µ–≥"); return; }
                addMoney(-50);
                let r = Math.random();
                let w = 0; let t = "–ü—É—Å—Ç–æ";
                if(r<0.1) { w=500; t="–°–£–ü–ï–†!"; }
                else if(r<0.3) { w=100; t="–ü—Ä–∏–∑!"; }
                else if(r<0.5) { w=50; t="–í–æ–∑–≤—Ä–∞—Ç"; }
                
                document.getElementById('loto-res').innerText = `${t} (+${w})`;
                if(w>0) addMoney(w);
                checkLvl(50);
            }
        }
    };

    function resetCrashBtn() {
        let btn = document.getElementById('c-btn');
        btn.innerText = "–ó–ê–ü–£–°–ö";
        btn.style.background = "#fbbf24";
        setTimeout(() => document.getElementById('c-screen').style.color = "white", 1000);
    }

    // --- UTILS ---
    function openGame(id) {
        if(!games[id]) return;
        document.getElementById('game-container').innerHTML = games[id].render();
        tab('game');
    }

    function getBet() {
        let el = document.getElementById('bet');
        let v = parseInt(el.value);
        if(isNaN(v) || v<=0) { toast("–ù–µ–≤–µ—Ä–Ω–∞—è —Å—Ç–∞–≤–∫–∞"); return null; }
        if(v > state.money) { toast("–ù–µ—Ç –¥–µ–Ω–µ–≥!"); return null; }
        if(v > state.maxBet) { toast("–õ–∏–º–∏—Ç —É—Ä–æ–≤–Ω—è: "+state.maxBet); return null; }
        return v;
    }

    function checkLvl(bet) {
        state.xp += bet;
        if(state.xp > state.level * 500) {
            state.level++;
            state.xp = 0;
            state.maxBet = Math.floor(100 * Math.pow(1.5, state.level));
            toast(`–£–†–û–í–ï–ù–¨ ${state.level}!`, "#fbbf24");
            updateUI();
        }
    }
    
    function rn(max) { return Math.floor(Math.random() * max); }

    // Public API
    return { 
        init, work, upgrade, tab, openGame, goHome,
        playSlots: games.slots.play,
        playRoulette: games.roulette.play,
        playDice: games.dice.play,
        playCoin: games.coin.play,
        playCrash: games.crash.play,
        playLoto: games.lottery.play,
        crashActive: false
    };
})();

// Start
window.onload = app.init;

</script>
</body>
</html>
