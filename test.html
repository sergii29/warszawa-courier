<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Warszawa Courier RPG</title>
    <style>
        :root {
            --bg: #111827;
            --panel: #1f2937;
            --accent: #3b82f6; /* Blue Wolt-ish */
            --accent-green: #10b981; /* Uber Green */
            --accent-orange: #f59e0b; /* Glovo Orange */
            --danger: #ef4444;
            --text: #f3f4f6;
            --road: #374151;
        }

        body {
            background-color: var(--bg); color: var(--text);
            font-family: 'Segoe UI', sans-serif;
            margin: 0; padding: 0;
            height: 100vh; display: flex; flex-direction: column;
            user-select: none; overflow: hidden;
        }

        /* --- –í–ï–†–•–ù–Ø–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê (RPG HUD) --- */
        .hud {
            padding: 10px 15px; background: var(--panel);
            border-bottom: 1px solid #333;
            display: flex; justify-content: space-between; align-items: center;
            z-index: 100;
        }
        .stat-group { display: flex; flex-direction: column; }
        .money-display { font-size: 20px; font-weight: 800; color: var(--accent-green); }
        .lvl-display { font-size: 10px; color: #9ca3af; }

        .energy-bar-cont { width: 100px; height: 6px; background: #333; border-radius: 3px; margin-top: 5px; overflow: hidden;}
        .energy-fill { height: 100%; background: var(--accent); width: 100%; transition: width 0.2s; }

        /* --- –ò–ì–†–û–í–û–ï –ü–û–õ–ï (–£–õ–ò–¶–ê) --- */
        .game-world {
            flex: 1; position: relative;
            background: linear-gradient(180deg, #0f172a 0%, #1e293b 100%);
            display: flex; flex-direction: column; justify-content: center;
            overflow: hidden;
        }

        /* –î–æ—Ä–æ–≥–∞ */
        .road-container {
            position: relative; width: 100%; height: 120px;
            background: var(--road);
            border-top: 4px solid #4b5563;
            border-bottom: 4px solid #4b5563;
            display: flex; align-items: center;
            overflow: hidden;
        }
        
        /* –†–∞–∑–º–µ—Ç–∫–∞ –¥–æ—Ä–æ–≥–∏ (–∞–Ω–∏–º–∞—Ü–∏—è –¥–≤–∏–∂–µ–Ω–∏—è) */
        .road-lines {
            position: absolute; width: 200%; height: 4px;
            background: repeating-linear-gradient(90deg, #fff 0, #fff 40px, transparent 40px, transparent 80px);
            top: 50%; transform: translateY(-50%);
            opacity: 0.5;
        }
        .moving .road-lines { animation: drive 1s linear infinite; }
        @keyframes drive { 0% { transform: translate(0, -50%); } 100% { transform: translate(-80px, -50%); } }

        /* –ò–≥—Ä–æ–∫ (–ö—É—Ä—å–µ—Ä) */
        .courier-bike {
            position: absolute; left: 20px; bottom: 30px;
            font-size: 50px; z-index: 10;
            transition: transform 0.2s;
        }
        .moving .courier-bike { animation: bounce 0.5s infinite alternate; }
        @keyframes bounce { 0% { bottom: 30px; } 100% { bottom: 32px; } }

        /* –¢–æ—á–∫–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è (–†–µ—Å—Ç–æ—Ä–∞–Ω / –î–æ–º) */
        .destination {
            position: absolute; right: -100px; bottom: 30px;
            font-size: 50px; transition: right 0.5s linear;
        }
        
        /* –ò–Ω—Ñ–æ –æ —Ç–µ–∫—É—â–µ–º –∑–∞–∫–∞–∑–µ */
        .order-status-card {
            position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.8); padding: 10px 20px; border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.1);
            text-align: center; width: 80%; display: none;
        }
        .temp-meter {
            width: 100%; height: 4px; background: #333; margin-top: 5px; border-radius: 2px;
        }
        .temp-fill { height: 100%; width: 100%; background: linear-gradient(90deg, #3b82f6, #ef4444); transition: width 1s linear; }

        /* --- –¢–ï–õ–ï–§–û–ù (–ú–ï–ù–Æ –ó–ê–ö–ê–ó–û–í) --- */
        .phone-overlay {
            position: absolute; bottom: 0; width: 100%; height: 60%;
            background: #111; border-top-left-radius: 20px; border-top-right-radius: 20px;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.5);
            transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex; flex-direction: column; padding: 20px; box-sizing: border-box;
            z-index: 50;
        }
        .phone-overlay.active { transform: translateY(0); }

        .order-card {
            background: #222; border: 1px solid #333; padding: 15px; border-radius: 12px;
            margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center;
        }
        .btn-accept { background: var(--accent-green); color: black; border: none; padding: 8px 15px; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .btn-reject { background: #333; color: #aaa; border: none; padding: 8px 15px; border-radius: 8px; font-weight: bold; }

        /* --- –£–ü–†–ê–í–õ–ï–ù–ò–ï (–í–ù–ò–ó–£) --- */
        .controls-area {
            height: 140px; background: var(--panel); border-top: 1px solid #333;
            display: flex; justify-content: space-around; align-items: center; padding: 0 10px;
            position: relative; z-index: 60;
        }

        .action-btn {
            width: 80px; height: 80px; border-radius: 50%; border: none;
            font-weight: 900; font-size: 12px; text-transform: uppercase;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3); cursor: pointer;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        
        #btn-main { background: var(--accent); color: white; width: 100px; height: 100px; font-size: 14px; }
        #btn-main:active { transform: scale(0.95); }
        #btn-main.disabled { background: #444; color: #888; pointer-events: none; }

        .sub-btn { background: #374151; color: #fff; }

        /* –ú–æ–¥–∞–ª–∫–∞ –ø—Ä–æ–∫–∞—á–∫–∏ */
        .modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 200;
            display: none; flex-direction: column; padding: 20px;
        }
        .skill-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding: 10px; background: #222; border-radius: 10px; }
        
        /* –°–æ–±—ã—Ç–∏—è */
        .event-popup {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(239, 68, 68, 0.9); padding: 20px; border-radius: 12px;
            color: white; font-weight: bold; text-align: center; display: none; z-index: 150;
            animation: popIn 0.3s;
        }
        @keyframes popIn { from { transform: translate(-50%, -50%) scale(0.5); } to { transform: translate(-50%, -50%) scale(1); } }

    </style>
</head>
<body>

    <div class="hud">
        <div class="stat-group">
            <div class="money-display" id="money-ui">0.00 PLN</div>
            <div class="lvl-display" id="xp-ui">LVL 1 (0/100 XP)</div>
        </div>
        <div class="stat-group" style="align-items: flex-end;">
            <div style="font-size: 10px; color: #aaa;">–≠–ù–ï–†–ì–ò–Ø</div>
            <div class="energy-bar-cont"><div class="energy-fill" id="energy-bar"></div></div>
        </div>
    </div>

    <div class="game-world" id="world-bg">
        <div class="order-status-card" id="status-card">
            <div id="order-msg" style="font-weight:bold; color:var(--accent);">–î–æ—Å—Ç–∞–≤–∫–∞ Kebab King</div>
            <div style="font-size: 10px; color:#aaa; margin-top:2px;">
                –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –µ–¥—ã: <span id="temp-val">100%</span>
            </div>
            <div class="temp-meter"><div class="temp-fill" id="temp-bar"></div></div>
            <div style="font-size: 10px; margin-top: 5px; color: var(--accent-orange);" id="dist-ui">–û—Å—Ç–∞–ª–æ—Å—å: 2.0 –∫–º</div>
        </div>

        <div class="event-popup" id="event-ui">
            <div style="font-size: 40px;">üõë</div>
            <div id="event-text">–ö–†–ê–°–ù–´–ô –°–í–ï–¢!</div>
            <div style="font-size: 10px; margin-top: 5px;">–ñ–¥–∏...</div>
        </div>

        <div class="road-container" id="road">
            <div class="road-lines"></div>
            <div class="courier-bike">üö¥</div>
            <div class="destination" id="dest-icon">üè¢</div>
        </div>

        <div class="phone-overlay" id="phone">
            <h3 style="color:white; margin-top:0;">üì± –ù–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã</h3>
            <div id="orders-list"></div>
        </div>
    </div>

    <div class="controls-area">
        <button class="action-btn sub-btn" onclick="toggleProfile()">
            üë§<br>–ü—Ä–æ—Ñ–∏–ª—å
        </button>
        
        <button class="action-btn" id="btn-main" onmousedown="startDrive()" onmouseup="stopDrive()" ontouchstart="startDrive()" ontouchend="stopDrive()">
            –ñ–ú–ò<br>–ï–•–ê–¢–¨
        </button>

        <button class="action-btn sub-btn" onclick="togglePhone()">
            üì±<br>–ó–∞–∫–∞–∑—ã
        </button>
    </div>

    <div class="modal" id="profile-modal">
        <h2 style="color:white;">–¢–≤–æ–∏ –ù–∞–≤—ã–∫–∏</h2>
        <div style="color:#aaa; margin-bottom: 20px;">–û—á–∫–∏ –Ω–∞–≤—ã–∫–æ–≤: <b id="sp-ui" style="color:var(--accent);">0</b></div>
        
        <div class="skill-row">
            <div>
                <b>üö¥ –°–∫–æ—Ä–æ—Å—Ç—å</b><br>
                <small style="color:#777;">–ï–¥–µ—à—å –±—ã—Å—Ç—Ä–µ–µ, –µ–¥–∞ –Ω–µ —Å—Ç—ã–Ω–µ—Ç</small>
            </div>
            <button class="btn-accept" onclick="upgrade('speed')">+</button>
        </div>
        <div class="skill-row">
            <div>
                <b>üîã –í—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å</b><br>
                <small style="color:#777;">–ë–æ–ª—å—à–µ —ç–Ω–µ—Ä–≥–∏–∏, –º–µ–Ω—å—à–µ –æ—Ç–¥—ã—Ö–∞</small>
            </div>
            <button class="btn-accept" onclick="upgrade('stamina')">+</button>
        </div>
        <div class="skill-row">
            <div>
                <b>üòé –û–±–∞—è–Ω–∏–µ</b><br>
                <small style="color:#777;">–®–∞–Ω—Å —á–∞–µ–≤—ã—Ö –∏ –ø—Ä–æ—â–µ–Ω–∏—è –æ—à–∏–±–æ–∫</small>
            </div>
            <button class="btn-accept" onclick="upgrade('charm')">+</button>
        </div>
        <div class="skill-row">
            <div>
                <b>üéí –¢–µ—Ä–º–æ-—Å—É–º–∫–∞</b><br>
                <small style="color:#777;">–ï–¥–∞ –æ—Å—Ç—ã–≤–∞–µ—Ç –º–µ–¥–ª–µ–Ω–Ω–µ–µ</small>
            </div>
            <button class="btn-accept" onclick="upgrade('bag')">+</button>
        </div>

        <button class="btn-reject" style="width:100%; margin-top:auto;" onclick="toggleProfile()">–ó–ê–ö–†–´–¢–¨</button>
    </div>

<script>
    // === –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ò –ü–ï–†–ï–ú–ï–ù–ù–´–ï ===
    const SAVE_KEY = "WARSZAWA_RPG_V1";

    // –°–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
    const STATE = {
        IDLE: 0,      // –ñ–¥–µ—Ç –∑–∞–∫–∞–∑
        TO_REST: 1,   // –ï–¥–µ—Ç –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω
        PICKUP: 2,    // –ó–∞–±–∏—Ä–∞–µ—Ç –∑–∞–∫–∞–∑
        TO_CLIENT: 3, // –ï–¥–µ—Ç –∫ –∫–ª–∏–µ–Ω—Ç—É
        PROBLEM: 4    // –ü—Ä–æ–±–ª–µ–º–∞ (–≤–æ–∑–≤—Ä–∞—Ç, –æ–∂–∏–¥–∞–Ω–∏–µ)
    };

    let G = {
        money: 0,
        xp: 0,
        lvl: 1,
        sp: 0, // Skill Points
        
        // –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
        stats: {
            speed: 1,     // –ú–Ω–æ–∂–∏—Ç–µ–ª—å —Å–∫–æ—Ä–æ—Å—Ç–∏
            stamina: 100, // –ú–∞–∫—Å —ç–Ω–µ—Ä–≥–∏—è
            charm: 1,     // –®–∞–Ω—Å —á–∞–µ–≤—ã—Ö
            bag: 1        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–ø–ª–∞
        },
        
        energy: 100
    };

    let Current = {
        state: STATE.IDLE,
        order: null,      // –¢–µ–∫—É—â–∏–π –∞–∫—Ç–∏–≤–Ω—ã–π –∑–∞–∫–∞–∑
        distance: 0,      // –°–∫–æ–ª—å–∫–æ –æ—Å—Ç–∞–ª–æ—Å—å –µ—Ö–∞—Ç—å (–∫–º)
        foodTemp: 100,    // –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –µ–¥—ã %
        driving: false,   // –ó–∞–∂–∞—Ç–∞ –ª–∏ –∫–Ω–æ–ø–∫–∞
        event: null       // –ê–∫—Ç–∏–≤–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ (—Å–≤–µ—Ç–æ—Ñ–æ—Ä –∏ —Ç–¥)
    };

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–∫–∞–∑–æ–≤
    const RESTAURANTS = [
        { name: "Kebab King", type: "food", basePay: 12 },
        { name: "McDonalds", type: "food", basePay: 10 },
        { name: "Pasibus", type: "food", basePay: 14 },
        { name: "≈ªabka (–ó–∞–∫—É–ø)", type: "shop", basePay: 18 },
        { name: "Apteka", type: "med", basePay: 15 }
    ];

    let availableOrders = [];

    // === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ===
    function init() {
        loadGame();
        updateHUD();
        generateOrders();
        setInterval(gameLoop, 100); // –§–∏–∑–∏–∫–∞ (10 FPS –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã)
        setInterval(orderGenerator, 5000); // –ù–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã
        setInterval(regenEnergy, 1000); // –†–µ–≥–µ–Ω —ç–Ω–µ—Ä–≥–∏–∏
    }

    // === –ì–õ–ê–í–ù–´–ô –¶–ò–ö–õ (PHYSICS) ===
    function gameLoop() {
        // 1. –î–≤–∏–∂–µ–Ω–∏–µ
        if (Current.driving && G.energy > 0 && !Current.event) {
            if (Current.state === STATE.TO_REST || Current.state === STATE.TO_CLIENT) {
                // –†–∞—Å—Ö–æ–¥ —ç–Ω–µ—Ä–≥–∏–∏
                G.energy -= 0.2;
                
                // –°–∫–æ—Ä–æ—Å—Ç—å (–ë–∞–∑–∞ 0.01 –∫–º/—Ç–∏–∫ * —Å—Ç–∞—Ç)
                let speed = 0.015 * (1 + G.stats.speed * 0.1);
                Current.distance -= speed;

                // –í–∏–∑—É–∞–ª –¥–æ—Ä–æ–≥–∏
                document.getElementById('road').classList.add('moving');
                
                // –ü—Ä–∏–±—ã—Ç–∏–µ
                if (Current.distance <= 0) {
                    arrive();
                }
            }
        } else {
            document.getElementById('road').classList.remove('moving');
        }

        // 2. –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –µ–¥—ã (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤–µ–∑–µ–º –∫–ª–∏–µ–Ω—Ç—É)
        if (Current.state === STATE.TO_CLIENT && Current.order) {
            // –ï–¥–∞ —Å—Ç—ã–Ω–µ—Ç. –°—É–º–∫–∞ –ø–æ–º–æ–≥–∞–µ—Ç.
            let coolRate = 0.15 / (1 + G.stats.bag * 0.2); 
            Current.foodTemp -= coolRate;
            if (Current.foodTemp < 0) Current.foodTemp = 0;
            updateStatusCard();
        }

        // 3. –°–ª—É—á–∞–π–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –≤ –¥–æ—Ä–æ–≥–µ
        if (Current.driving && Math.random() < 0.005 && !Current.event && Current.distance > 0.5) {
            triggerEvent();
        }

        updateHUD();
    }

    // === –õ–û–ì–ò–ö–ê –ó–ê–ö–ê–ó–û–í ===

    function orderGenerator() {
        if (availableOrders.length < 5) {
            let r = RESTAURANTS[Math.floor(Math.random() * RESTAURANTS.length)];
            let dist = (1.5 + Math.random() * 4).toFixed(1); // 1.5 - 5.5 km
            let pay = (r.basePay + (dist * 1.5)).toFixed(0);
            
            availableOrders.push({
                id: Date.now(),
                rest: r.name,
                dist: dist,
                pay: pay,
                type: r.type
            });
            renderPhone();
            
            // –ï—Å–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω –∑–∞–∫—Ä—ã—Ç, –ø–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–∞ –∫–Ω–æ–ø–∫–µ
            if (!document.getElementById('phone').classList.contains('active')) {
                // –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫—Ä–∞—Å–Ω—É—é —Ç–æ—á–∫—É
            }
        }
    }

    function acceptOrder(id) {
        let order = availableOrders.find(o => o.id === id);
        if (!order) return;

        Current.order = order;
        Current.state = STATE.TO_REST;
        Current.distance = 1.0; // –î–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ –≤—Å–µ–≥–¥–∞ 1 –∫–º —É—Å–ª–æ–≤–Ω–æ (–¥–ª—è —Å—Ç–∞—Ä—Ç–∞)
        Current.foodTemp = 100;
        
        availableOrders = availableOrders.filter(o => o.id !== id); // –£–¥–∞–ª–∏—Ç—å –∏–∑ —Å–ø–∏—Å–∫–∞
        
        togglePhone(); // –ó–∞–∫—Ä—ã—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω
        uiSetState("–ï–¥–µ–º –≤ " + order.rest, "dist");
    }

    // === –ú–ï–•–ê–ù–ò–ö–ê –ü–û–ï–ó–î–ö–ò ===

    function startDrive() { Current.driving = true; }
    function stopDrive() { Current.driving = false; }

    function arrive() {
        Current.driving = false;
        
        if (Current.state === STATE.TO_REST) {
            // –ü—Ä–∏–µ—Ö–∞–ª–∏ –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω
            alert(`üç± –ü—Ä–∏–±—ã–ª–∏ –≤ ${Current.order.rest}. –ó–∞–±–∏—Ä–∞–µ–º –∑–∞–∫–∞–∑...`);
            Current.state = STATE.TO_CLIENT;
            Current.distance = parseFloat(Current.order.dist);
            
            // –í–∏–∑—É–∞–ª
            document.getElementById('dest-icon').innerText = "üè†"; // –ò–∫–æ–Ω–∫–∞ –¥–æ–º–∞
            document.getElementById('dest-icon').style.right = "-100px"; // –°–±—Ä–æ—Å –∞–Ω–∏–º–∞—Ü–∏–∏
            
            uiSetState("–í–µ–∑—É –∫–ª–∏–µ–Ω—Ç—É!", "temp");

        } else if (Current.state === STATE.TO_CLIENT) {
            // –ü—Ä–∏–µ—Ö–∞–ª–∏ –∫ –∫–ª–∏–µ–Ω—Ç—É. –†–ê–°–ß–ï–¢ –†–ï–ó–£–õ–¨–¢–ê–¢–ê
            finishDelivery();
        }
    }

    function finishDelivery() {
        let order = Current.order;
        let basePay = parseInt(order.pay);
        let tip = 0;
        let msg = "";

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
        if (Current.foodTemp > 80) {
            // –ì–æ—Ä—è—á–µ–µ! –ß–∞–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω—ã
            if (Math.random() < (0.3 + G.stats.charm * 0.05)) {
                tip = Math.floor(basePay * 0.3);
                msg = "üî• –ì–æ—Ä—è—á–æ! –ö–ª–∏–µ–Ω—Ç –¥–æ–≤–æ–ª–µ–Ω.";
            } else {
                msg = "‚úÖ –î–æ—Å—Ç–∞–≤–∫–∞ —É—Å–ø–µ—à–Ω–∞.";
            }
        } else if (Current.foodTemp < 40) {
            // –•–æ–ª–æ–¥–Ω–æ–µ. –®—Ç—Ä–∞—Ñ –∏–ª–∏ –Ω–µ—Ç –æ–ø–ª–∞—Ç—ã?
            basePay = Math.floor(basePay * 0.7);
            msg = "ü•∂ –ï–¥–∞ –ª–µ–¥—è–Ω–∞—è! –ö–ª–∏–µ–Ω—Ç –∂–∞–ª—É–µ—Ç—Å—è (-30% –æ–ø–ª–∞—Ç—ã).";
        } else {
            msg = "üòê –ù–æ—Ä–º –¥–æ—Å—Ç–∞–≤–∫–∞.";
        }
        
        // –°–ª–æ–∂–Ω–∞—è —Å–∏—Ç—É–∞—Ü–∏—è: –ö–ª–∏–µ–Ω—Ç –Ω–µ –±–µ—Ä–µ—Ç —Ç—Ä—É–±–∫—É?
        // –®–∞–Ω—Å 10%
        if (Math.random() < 0.1) {
            if (confirm("üìû –ö–ª–∏–µ–Ω—Ç –Ω–µ –±–µ—Ä–µ—Ç —Ç—Ä—É–±–∫—É! –ñ–¥–∞—Ç—å 5 —Å–µ–∫ –∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å —É –¥–≤–µ—Ä–∏? (–û–∫ - –ñ–¥–∞—Ç—å, –û—Ç–º–µ–Ω–∞ - –û—Å—Ç–∞–≤–∏—Ç—å)")) {
                // –ñ–¥–µ–º (—Å–∏–º—É–ª—è—Ü–∏—è)
                setTimeout(() => payout(basePay, tip, msg + " (–î–æ–∂–¥–∞–ª—Å—è)"), 2000);
            } else {
                // –†–∏—Å–∫
                if (Math.random() < 0.5) {
                    payout(basePay, tip, msg + " (–û—Å—Ç–∞–≤–∏–ª —É –¥–≤–µ—Ä–∏)");
                } else {
                    alert("ü§¨ –£ —Ç–µ–±—è —É–∫—Ä–∞–ª–∏ –µ–¥—É! –®—Ç—Ä–∞—Ñ!");
                    basePay = 0; tip = 0;
                    payout(0, 0, "–ó–∞–∫–∞–∑ —É–∫—Ä–∞–¥–µ–Ω.");
                }
            }
        } else {
            payout(basePay, tip, msg);
        }
    }

    function payout(pay, tip, text) {
        let total = pay + tip;
        G.money += total;
        
        // XP
        let xpGain = 10 + (total * 0.5);
        G.xp += xpGain;
        if (G.xp >= G.lvl * 100) {
            G.lvl++;
            G.xp = 0;
            G.sp++; // –î–∞–µ–º –æ—á–∫–æ –Ω–∞–≤—ã–∫–∞
            alert("üÜô –ù–û–í–´–ô –£–†–û–í–ï–ù–¨! –ü–æ–ª—É—á–µ–Ω–æ –æ—á–∫–æ –Ω–∞–≤—ã–∫–æ–≤!");
        }

        alert(`üí∞ –ò–¢–û–ì –ó–ê–ö–ê–ó–ê:\n–û–ø–ª–∞—Ç–∞: ${pay} PLN\n–ß–∞–µ–≤—ã–µ: ${tip} PLN\n\n${text}`);
        
        // –°–±—Ä–æ—Å
        Current.state = STATE.IDLE;
        Current.order = null;
        updateHUD();
        uiReset();
        saveGame();
    }

    function triggerEvent() {
        Current.event = true;
        Current.driving = false; // –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–∞—à–∏–Ω—É
        
        let events = [
            { t: "üö¶ –ö–†–ê–°–ù–´–ô –°–í–ï–¢", wait: 2000 },
            { t: "üëµ –ü–†–û–ü–£–°–¢–ò –ë–ê–ë–£–®–ö–£", wait: 1500 },
            { t: "üöì –ü–û–õ–ò–¶–ò–Ø (–ü–†–û–í–ï–†–ö–ê)", wait: 3000 },
            { t: "üëû –†–ê–ó–í–Ø–ó–ê–õ–°–Ø –®–ù–£–†–û–ö", wait: 1000 }
        ];
        let ev = events[Math.floor(Math.random() * events.length)];

        let ui = document.getElementById('event-ui');
        document.getElementById('event-text').innerText = ev.t;
        ui.style.display = 'block';

        setTimeout(() => {
            ui.style.display = 'none';
            Current.event = null;
        }, ev.wait);
    }

    function regenEnergy() {
        if (!Current.driving && G.energy < G.stats.stamina) {
            G.energy += 1 + (G.stats.stamina * 0.05); // –†–µ–≥–µ–Ω
            if (G.energy > G.stats.stamina) G.energy = G.stats.stamina;
            updateHUD();
        }
    }

    // === UI –§–£–ù–ö–¶–ò–ò ===

    function uiSetState(msg, type) {
        let card = document.getElementById('status-card');
        card.style.display = 'block';
        document.getElementById('order-msg').innerText = msg;
        
        if (type === 'dist') {
            document.querySelector('.temp-meter').style.display = 'none';
        } else {
            document.querySelector('.temp-meter').style.display = 'block';
        }
        
        // –ö–Ω–æ–ø–∫–∞
        let btn = document.getElementById('btn-main');
        btn.innerHTML = "–ñ–ú–ò<br>–ì–ê–ó";
        btn.classList.remove('disabled');
    }

    function uiReset() {
        document.getElementById('status-card').style.display = 'none';
        let btn = document.getElementById('btn-main');
        btn.innerHTML = "–ñ–î–ò<br>–ó–ê–ö–ê–ó";
        btn.classList.add('disabled');
        document.getElementById('dest-icon').innerText = "üè¢";
        document.getElementById('dest-icon').style.right = "-100px";
    }

    function updateStatusCard() {
        document.getElementById('dist-ui').innerText = `–û—Å—Ç–∞–ª–æ—Å—å: ${Current.distance.toFixed(2)} –∫–º`;
        
        if (Current.state === STATE.TO_CLIENT) {
            document.getElementById('temp-val').innerText = Math.floor(Current.foodTemp) + "%";
            document.getElementById('temp-bar').style.width = Current.foodTemp + "%";
            
            // –¶–≤–µ—Ç
            let bar = document.getElementById('temp-bar');
            if(Current.foodTemp > 70) bar.style.background = "#10b981";
            else if(Current.foodTemp > 40) bar.style.background = "#f59e0b";
            else bar.style.background = "#ef4444";
        }
    }

    function updateHUD() {
        document.getElementById('money-ui').innerText = G.money.toFixed(0) + " PLN";
        document.getElementById('xp-ui').innerText = `LVL ${G.lvl} (${Math.floor(G.xp)}/${G.lvl*100} XP)`;
        
        let epct = (G.energy / G.stats.stamina) * 100;
        document.getElementById('energy-bar').style.width = epct + "%";
        document.getElementById('sp-ui').innerText = G.sp;
    }

    function renderPhone() {
        let html = "";
        availableOrders.forEach(o => {
            html += `
            <div class="order-card">
                <div>
                    <b style="color:var(--accent)">${o.rest}</b><br>
                    <small>${o.dist} –∫–º ‚Ä¢ ${o.type === 'food' ? 'üçî –ï–¥–∞' : 'üíä –ê–ø—Ç–µ–∫–∞'}</small>
                </div>
                <div>
                    <b style="color:var(--accent-green); font-size:16px;">${o.pay} PLN</b><br>
                    <button class="btn-accept" onclick="acceptOrder(${o.id})">–í–ó–Ø–¢–¨</button>
                </div>
            </div>`;
        });
        document.getElementById('orders-list').innerHTML = html;
    }

    function togglePhone() {
        document.getElementById('phone').classList.toggle('active');
        document.getElementById('profile-modal').style.display = 'none';
    }

    function toggleProfile() {
        let m = document.getElementById('profile-modal');
        m.style.display = (m.style.display === 'flex') ? 'none' : 'flex';
        document.getElementById('phone').classList.remove('active');
        updateHUD();
    }

    function upgrade(stat) {
        if (G.sp > 0) {
            G.sp--;
            G.stats[stat]++;
            updateHUD();
            alert("–ù–∞–≤—ã–∫ —É–ª—É—á—à–µ–Ω!");
        } else {
            alert("–ù–µ—Ç –æ—á–∫–æ–≤ –Ω–∞–≤—ã–∫–æ–≤! –ö–∞—á–∞–π —É—Ä–æ–≤–µ–Ω—å.");
        }
    }

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
    function saveGame() { localStorage.setItem(SAVE_KEY, JSON.stringify(G)); }
    function loadGame() {
        let d = localStorage.getItem(SAVE_KEY);
        if(d) {
            try { G = {...G, ...JSON.parse(d)}; } catch(e){}
        }
        uiReset();
    }

    window.onload = init;

</script>
</body>
</html>
