<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Wolt Courier Simulator</title>
    <style>
        :root {
            --wolt-blue: #00c2e8;
            --wolt-dark: #202125;
            --bg-gray: #f3f3f5;
            --white: #ffffff;
            --text-main: #202125;
            --text-sec: #999999;
            --success: #4cd964;
            --danger: #ff3b30;
        }

        body {
            background-color: var(--bg-gray);
            color: var(--text-main);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0; padding: 0;
            height: 100vh; display: flex; flex-direction: column;
            overflow: hidden; user-select: none;
        }

        /* --- HEADER (EARNINGS) --- */
        .app-header {
            background: var(--white);
            padding: 15px 20px;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            z-index: 20;
        }
        .earn-title { font-size: 12px; color: var(--text-sec); font-weight: 600; text-transform: uppercase; }
        .earn-val { font-size: 24px; font-weight: 800; color: var(--text-main); }
        
        .status-badge {
            padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: bold;
            background: #eee; color: #777; transition: 0.3s;
        }
        .status-badge.online { background: rgba(0, 194, 232, 0.1); color: var(--wolt-blue); }

        /* --- MAP AREA --- */
        .map-view {
            flex: 1; position: relative;
            background-color: #e5e9ec;
            background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
            background-size: 20px 20px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            overflow: hidden;
        }

        /* Radar Effect */
        .radar-pulse {
            position: absolute; width: 100px; height: 100px;
            border-radius: 50%; background: var(--wolt-blue);
            opacity: 0; transform: scale(0);
        }
        .searching .radar-pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 
            0% { transform: scale(0.5); opacity: 0.3; } 
            100% { transform: scale(3); opacity: 0; } 
        }

        /* Player Icon */
        .courier-marker {
            width: 50px; height: 50px; background: var(--white);
            border-radius: 50%; border: 3px solid var(--white);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 10; display: flex; justify-content: center; align-items: center;
            font-size: 24px; position: relative;
            transition: transform 0.3s;
        }
        
        /* Map Markers */
        .map-pin {
            position: absolute; font-size: 30px; 
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            opacity: 0; transform: scale(0);
        }
        .map-pin.visible { opacity: 1; transform: scale(1); }

        /* Progress Line */
        .route-line {
            position: absolute; height: 4px; background: #cbd5e1;
            width: 0; transform-origin: left; transition: width 0.1s linear;
            top: 50%; left: 50%; z-index: 5; display: none;
        }

        /* --- BOTTOM SHEET (CONTROLS) --- */
        .bottom-sheet {
            background: var(--white);
            border-top-left-radius: 20px; border-top-right-radius: 20px;
            box-shadow: 0 -5px 30px rgba(0,0,0,0.1);
            padding: 20px; z-index: 30;
            transition: transform 0.3s ease;
            min-height: 180px;
        }

        /* Online Switch */
        .slider-container {
            width: 100%; height: 60px; background: #f0f0f0;
            border-radius: 30px; position: relative;
            display: flex; align-items: center; padding: 5px; box-sizing: border-box;
            cursor: pointer; overflow: hidden;
        }
        .slider-knob {
            width: 50px; height: 50px; background: var(--white);
            border-radius: 50%; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            position: absolute; left: 5px; transition: left 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: flex; justify-content: center; align-items: center; font-weight: bold; color: var(--text-sec);
        }
        .slider-text {
            width: 100%; text-align: center; font-weight: 700; color: var(--text-main);
            position: absolute; pointer-events: none; z-index: 1; transition: opacity 0.2s;
        }
        
        /* State: Online */
        .online-mode .slider-container { background: rgba(0, 194, 232, 0.1); }
        .online-mode .slider-knob { left: calc(100% - 55px); color: var(--wolt-blue); }
        
        /* Order Card */
        .order-panel { display: none; flex-direction: column; gap: 10px; }
        .rest-info { display: flex; justify-content: space-between; align-items: flex-start; }
        .rest-name { font-size: 18px; font-weight: 800; }
        .rest-meta { font-size: 12px; color: var(--text-sec); margin-top: 4px; }
        .order-pay { font-size: 20px; color: var(--wolt-blue); font-weight: 800; }

        .btn-main {
            width: 100%; padding: 16px; border-radius: 12px; border: none;
            font-size: 16px; font-weight: 700; color: white; cursor: pointer;
            background: var(--wolt-blue); transition: transform 0.1s;
        }
        .btn-main:active { transform: scale(0.98); }
        .btn-secondary {
            background: #f0f0f0; color: var(--text-main); margin-top: 10px;
        }

        /* Active Delivery UI */
        .delivery-ui { display: none; }
        .info-row { display: flex; justify-content: space-between; font-size: 12px; color: var(--text-sec); margin-bottom: 5px; }
        .progress-bar { width: 100%; height: 6px; background: #eee; border-radius: 3px; overflow: hidden; margin-bottom: 15px; }
        .progress-fill { height: 100%; background: var(--wolt-blue); width: 0%; }
        
        .temp-bar-fill { height: 100%; background: linear-gradient(90deg, #4cd964, #ffcc00, #ff3b30); width: 100%; }

        /* Notification */
        .notification {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-100px);
            background: var(--dark); color: white; padding: 10px 20px; border-radius: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3); z-index: 100; font-weight: 600;
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            background: #202125;
        }
        .notification.show { transform: translateX(-50%) translateY(0); }

        /* Menu/Shop */
        .menu-btn {
            position: absolute; top: 15px; right: 15px; width: 40px; height: 40px;
            background: white; border-radius: 50%; box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex; justify-content: center; align-items: center; cursor: pointer; z-index: 25;
        }

        .modal {
            position: fixed; inset: 0; background: #f3f3f5; z-index: 200;
            padding: 20px; transform: translateY(100%); transition: transform 0.3s;
            overflow-y: auto;
        }
        .modal.open { transform: translateY(0); }
        .shop-item {
            background: white; padding: 15px; border-radius: 12px; margin-bottom: 10px;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

    </style>
</head>
<body>

    <div class="notification" id="notif">–ù–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</div>

    <div class="menu-btn" onclick="toggleShop()">üçî</div>

    <div class="app-header">
        <div>
            <div class="earn-title">–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ —Å–µ–≥–æ–¥–Ω—è</div>
            <div class="earn-val" id="money-ui">0.00 PLN</div>
        </div>
        <div class="status-badge" id="status-badge">OFFLINE</div>
    </div>

    <div class="map-view" id="map-bg">
        <div class="radar-pulse"></div>
        
        <div class="courier-marker" id="player-icon">üö≤</div>
        
        <div class="map-pin" id="pin-rest">üè™</div>
        <div class="map-pin" id="pin-client">üë§</div>
        <div class="route-line" id="route-line"></div>
    </div>

    <div class="bottom-sheet">
        
        <div id="panel-start">
            <div class="slider-container" onclick="toggleOnline()">
                <div class="slider-text" id="slider-text">SWIPE TO ONLINE</div>
                <div class="slider-knob">‚ûú</div>
            </div>
            <div style="text-align:center; margin-top:15px; font-size:12px; color:#999;">
                <span id="vehicle-name">–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç: –í–µ–ª–æ—Å–∏–ø–µ–¥</span> ‚Ä¢ LVL <span id="lvl-ui">1</span>
            </div>
        </div>

        <div id="panel-offer" class="order-panel">
            <div class="rest-info">
                <div>
                    <div class="rest-name" id="offer-rest">McDonalds</div>
                    <div class="rest-meta" id="offer-meta">2.5 km ‚Ä¢ –ï–¥–∞</div>
                </div>
                <div class="order-pay" id="offer-pay">14.50</div>
            </div>
            <div style="font-size:12px; color:#777; margin-bottom:10px;">
                –í–∫–ª—é—á–∞–µ—Ç –±–æ–Ω—É—Å –∑–∞ —Å–ø—Ä–æ—Å +1.50 PLN
            </div>
            <button class="btn-main" onclick="acceptOrder()">–ü–†–ò–ù–Ø–¢–¨ –ó–ê–ö–ê–ó</button>
            <button class="btn-main btn-secondary" style="color:var(--danger)" onclick="rejectOrder()">–û–¢–ö–õ–û–ù–ò–¢–¨</button>
        </div>

        <div id="panel-active" class="delivery-ui">
            <h3 style="margin:0 0 10px 0; font-size:16px;" id="task-title">–ï–¥–µ–º –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω...</h3>
            
            <div class="info-row">
                <span>–ü—Ä–æ–≥—Ä–µ—Å—Å</span>
                <span id="dist-ui">1.2 km</span>
            </div>
            <div class="progress-bar"><div class="progress-fill" id="prog-bar"></div></div>

            <div id="temp-container">
                <div class="info-row">
                    <span>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –µ–¥—ã</span>
                    <span id="temp-ui">100%</span>
                </div>
                <div class="progress-bar"><div class="temp-bar-fill" id="temp-bar"></div></div>
            </div>

            <button class="btn-main" id="action-btn" onmousedown="holdGas()" onmouseup="releaseGas()" ontouchstart="holdGas()" ontouchend="releaseGas()">–ñ–ú–ò –ì–ê–ó (HOLD)</button>
        </div>

    </div>

    <div class="modal" id="shop-modal">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h2 style="margin:0;">–ú–∞–≥–∞–∑–∏–Ω & –ü—Ä–æ—Ñ–∏–ª—å</h2>
            <button style="border:none; background:transparent; font-size:24px;" onclick="toggleShop()">‚úï</button>
        </div>
        
        <div style="background:white; padding:15px; border-radius:12px; margin-bottom:20px;">
            <div style="color:#999; font-size:12px;">–¢–≤–æ–π —É—Ä–æ–≤–µ–Ω—å</div>
            <div style="font-size:24px; font-weight:800; color:var(--wolt-blue);">LVL <span id="shop-lvl">1</span></div>
            <div style="font-size:12px; margin-top:5px;">XP: <span id="shop-xp">0</span> / <span id="shop-next">100</span></div>
        </div>

        <h3 style="margin-bottom:10px;">–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</h3>
        <div id="shop-vehicles"></div>

        <h3 style="margin-bottom:10px;">–≠–∫–∏–ø–∏—Ä–æ–≤–∫–∞</h3>
        <div id="shop-gear"></div>
    </div>

<script>
    // === CONFIG & DATA ===
    const CONFIG = {
        saveKey: 'WOLT_SIM_V1',
        vehicles: [
            { id: 'bike', name: '–í–µ–ª–æ—Å–∏–ø–µ–¥', speed: 1.0, price: 0 },
            { id: 'ebike', name: 'E-Bike (City)', speed: 1.5, price: 500 },
            { id: 'scooter', name: '–°–∫—É—Ç–µ—Ä 50cc', speed: 2.2, price: 1500 },
            { id: 'prius', name: 'Toyota Prius', speed: 3.5, price: 5000 }
        ],
        gear: [
            { id: 'basic_bag', name: '–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Å—É–º–∫–∞', insulation: 1.0, price: 0 },
            { id: 'pro_bag', name: 'Wolt Pro Bag', insulation: 2.0, price: 300 },
            { id: 'heater', name: '–ü–æ–¥–æ–≥—Ä–µ–≤ —Å–∏–¥–µ–Ω—å—è', insulation: 3.0, price: 800 }
        ],
        rests: [
            { n: 'McDonalds', pay: 10, dist: 2 },
            { n: 'Kebab King', pay: 14, dist: 3 },
            { n: 'Sushi Master', pay: 20, dist: 5 },
            { n: 'North Fish', pay: 12, dist: 2.5 },
            { n: 'Pizza Hut', pay: 16, dist: 4 }
        ]
    };

    // === GAME STATE ===
    let G = {
        money: 0,
        xp: 0,
        lvl: 1,
        vehicleId: 'bike',
        gearId: 'basic_bag',
        stats: { completed: 0 }
    };

    let State = {
        isOnline: false,
        phase: 'IDLE', // IDLE, SEARCH, OFFER, TO_REST, WAITING, TO_CLIENT
        offer: null,
        progress: 0,
        temp: 100,
        isMoving: false,
        timer: null
    };

    // === INIT ===
    function init() {
        loadGame();
        updateHeader();
        renderShop();
        
        // Loop physics
        setInterval(gameLoop, 100);
        
        // Loop search
        setInterval(() => {
            if (State.isOnline && State.phase === 'SEARCH') {
                if (Math.random() < 0.3) foundOffer();
            }
        }, 2000);
    }

    // === CORE LOGIC ===

    function toggleOnline() {
        if (State.phase !== 'IDLE' && State.phase !== 'SEARCH') return; // Can't go offline during order

        State.isOnline = !State.isOnline;
        document.body.classList.toggle('online-mode', State.isOnline);
        
        const badge = document.getElementById('status-badge');
        const sliderText = document.getElementById('slider-text');
        const map = document.getElementById('map-bg');
        
        if (State.isOnline) {
            badge.innerText = "ONLINE";
            badge.classList.add('online');
            sliderText.innerText = "SWIPE TO OFFLINE";
            map.classList.add('searching');
            State.phase = 'SEARCH';
            showNotif("–í—ã –Ω–∞ –ª–∏–Ω–∏–∏! –ò—â–µ–º –∑–∞–∫–∞–∑—ã...");
        } else {
            badge.innerText = "OFFLINE";
            badge.classList.remove('online');
            sliderText.innerText = "SWIPE TO ONLINE";
            map.classList.remove('searching');
            State.phase = 'IDLE';
        }
    }

    function foundOffer() {
        State.phase = 'OFFER';
        document.getElementById('map-bg').classList.remove('searching');
        
        // Generate Order
        let r = CONFIG.rests[Math.floor(Math.random() * CONFIG.rests.length)];
        let dist = (r.dist + Math.random()).toFixed(1);
        let surge = Math.random() < 0.3 ? (Math.random() * 5).toFixed(1) : 0;
        let totalPay = (r.pay + (dist * 1.5) + parseFloat(surge)).toFixed(2);
        
        State.offer = { name: r.n, dist: dist, pay: totalPay, surge: surge };
        
        // UI
        document.getElementById('offer-rest').innerText = r.n;
        document.getElementById('offer-meta').innerText = `${dist} km ‚Ä¢ –†–µ—Å—Ç–æ—Ä–∞–Ω`;
        document.getElementById('offer-pay').innerText = totalPay + " PLN";
        
        switchPanel('offer');
        playSound('ping');
    }

    function acceptOrder() {
        State.phase = 'TO_REST';
        State.progress = 0;
        State.temp = 100;
        
        // Visuals
        document.getElementById('pin-rest').classList.add('visible');
        document.getElementById('pin-rest').style.left = '20%';
        document.getElementById('pin-rest').style.top = '20%';
        
        document.getElementById('task-title').innerText = "–ï–¥–µ–º –≤ " + State.offer.name;
        document.getElementById('temp-container').style.display = 'none'; // No food yet
        document.getElementById('action-btn').innerText = "–ñ–ú–ò –ì–ê–ó (–ï–•–ê–¢–¨)";
        
        switchPanel('active');
    }

    function rejectOrder() {
        State.phase = 'SEARCH';
        State.offer = null;
        switchPanel('start');
        document.getElementById('map-bg').classList.add('searching');
    }

    function gameLoop() {
        if (!State.isOnline) return;

        // Driving Logic
        if (State.isMoving && (State.phase === 'TO_REST' || State.phase === 'TO_CLIENT')) {
            let veh = CONFIG.vehicles.find(v => v.id === G.vehicleId);
            let speed = 0.5 * veh.speed;
            
            State.progress += speed;
            if (State.progress >= 100) {
                State.progress = 100;
                State.isMoving = false;
                nextStage();
            }
            updateProgressUI();
        }

        // Temperature Logic
        if (State.phase === 'TO_CLIENT') {
            let gear = CONFIG.gear.find(g => g.id === G.gearId);
            let decay = 0.2 / gear.insulation;
            State.temp -= decay;
            if (State.temp < 0) State.temp = 0;
            updateTempUI();
        }
    }

    function nextStage() {
        if (State.phase === 'TO_REST') {
            // Arrived at restaurant
            State.phase = 'WAITING';
            document.getElementById('action-btn').disabled = true;
            document.getElementById('action-btn').innerText = "–ì–æ—Ç–æ–≤–∏–º –µ–¥—É...";
            document.getElementById('task-title').innerText = "–û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞...";
            
            setTimeout(() => {
                // Food ready
                State.phase = 'TO_CLIENT';
                State.progress = 0;
                document.getElementById('action-btn').disabled = false;
                document.getElementById('action-btn').innerText = "–í–ï–ó–¢–ò –ö–õ–ò–ï–ù–¢–£";
                document.getElementById('task-title').innerText = "–î–æ—Å—Ç–∞–≤–∫–∞ –∫–ª–∏–µ–Ω—Ç—É";
                document.getElementById('temp-container').style.display = 'block';
                
                // Map update
                document.getElementById('pin-rest').classList.remove('visible');
                document.getElementById('pin-client').classList.add('visible');
                document.getElementById('pin-client').style.left = '80%';
                document.getElementById('pin-client').style.top = '70%';
                
            }, 2000); // 2 sec cooking time
        } else if (State.phase === 'TO_CLIENT') {
            // Finished
            finishOrder();
        }
    }

    function finishOrder() {
        let pay = parseFloat(State.offer.pay);
        let tip = 0;
        
        // Temperature penalty/bonus
        if (State.temp > 80) {
            tip = Math.floor(pay * 0.2); // 20% tip
            showNotif(`üî• –ì–æ—Ä—è—á–∞—è –µ–¥–∞! –ß–∞–µ–≤—ã–µ +${tip} PLN`);
        } else if (State.temp < 30) {
            pay = pay * 0.8; // Penalty
            showNotif("üßä –ï–¥–∞ —Ö–æ–ª–æ–¥–Ω–∞—è! –®—Ç—Ä–∞—Ñ.");
        }

        let total = pay + tip;
        G.money += total;
        G.xp += 20;
        G.stats.completed++;
        
        checkLevelUp();
        saveGame();
        updateHeader();
        
        // Reset
        document.getElementById('pin-client').classList.remove('visible');
        State.phase = 'SEARCH';
        State.offer = null;
        switchPanel('start');
        document.getElementById('map-bg').classList.add('searching');
        playSound('ching');
    }

    // === UI HELPERS ===

    function switchPanel(id) {
        document.getElementById('panel-start').style.display = 'none';
        document.getElementById('panel-offer').style.display = 'none';
        document.getElementById('panel-active').style.display = 'none';
        
        if (id === 'start') document.getElementById('panel-start').style.display = 'block';
        if (id === 'offer') document.getElementById('panel-offer').style.display = 'flex';
        if (id === 'active') document.getElementById('panel-active').style.display = 'block';
    }

    function holdGas() { State.isMoving = true; }
    function releaseGas() { State.isMoving = false; }

    function updateProgressUI() {
        document.getElementById('prog-bar').style.width = State.progress + "%";
        let kmLeft = (parseFloat(State.offer.dist) * (1 - State.progress/100)).toFixed(1);
        document.getElementById('dist-ui').innerText = kmLeft + " km";
    }

    function updateTempUI() {
        let bar = document.getElementById('temp-bar');
        bar.style.width = State.temp + "%";
        document.getElementById('temp-ui').innerText = Math.floor(State.temp) + "%";
        
        if (State.temp < 40) bar.style.background = "#ff3b30";
        else if (State.temp < 70) bar.style.background = "#ffcc00";
        else bar.style.background = "#4cd964";
    }

    function updateHeader() {
        document.getElementById('money-ui').innerText = G.money.toFixed(2) + " PLN";
        let vehName = CONFIG.vehicles.find(v => v.id === G.vehicleId).name;
        document.getElementById('vehicle-name').innerText = "–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç: " + vehName;
        document.getElementById('lvl-ui').innerText = G.lvl;
    }

    function showNotif(msg) {
        const n = document.getElementById('notif');
        n.innerText = msg;
        n.classList.add('show');
        setTimeout(() => n.classList.remove('show'), 3000);
    }

    function playSound(type) {
        // Placeholder for sound
    }

    // === SHOP & RPG ===
    function toggleShop() {
        let m = document.getElementById('shop-modal');
        m.classList.toggle('open');
        if (m.classList.contains('open')) renderShopItems();
    }

    function renderShopItems() {
        document.getElementById('shop-lvl').innerText = G.lvl;
        document.getElementById('shop-xp').innerText = Math.floor(G.xp);
        document.getElementById('shop-next').innerText = G.lvl * 100;

        // Vehicles
        let vHtml = "";
        CONFIG.vehicles.forEach(v => {
            let owned = G.vehicleId === v.id;
            let canBuy = G.money >= v.price;
            let btnTxt = owned ? "–í–´–ë–†–ê–ù" : (canBuy ? "–ö–£–ü–ò–¢–¨" : "üîí");
            let btnClass = owned ? "background:#eee; color:#333" : "background:var(--wolt-blue); color:white";
            
            vHtml += `
            <div class="shop-item" style="${owned ? 'border:2px solid var(--wolt-blue)' : ''}">
                <div>
                    <b>${v.name}</b><br>
                    <small style="color:#777">–°–∫–æ—Ä–æ—Å—Ç—å: x${v.speed}</small>
                </div>
                <button style="border:none; padding:8px 12px; border-radius:15px; font-weight:bold; cursor:pointer; ${btnClass}" 
                onclick="buyVehicle('${v.id}')">${owned ? '‚úÖ' : v.price + ' PLN'}</button>
            </div>`;
        });
        document.getElementById('shop-vehicles').innerHTML = vHtml;

        // Gear
        let gHtml = "";
        CONFIG.gear.forEach(g => {
            let owned = G.gearId === g.id;
            let canBuy = G.money >= g.price;
            let btnClass = owned ? "background:#eee; color:#333" : "background:var(--wolt-blue); color:white";

            gHtml += `
            <div class="shop-item" style="${owned ? 'border:2px solid var(--wolt-blue)' : ''}">
                <div>
                    <b>${g.name}</b><br>
                    <small style="color:#777">–¢–µ—Ä–º–æ–∑–∞—â–∏—Ç–∞: x${g.insulation}</small>
                </div>
                <button style="border:none; padding:8px 12px; border-radius:15px; font-weight:bold; cursor:pointer; ${btnClass}"
                onclick="buyGear('${g.id}')">${owned ? '‚úÖ' : g.price + ' PLN'}</button>
            </div>`;
        });
        document.getElementById('shop-gear').innerHTML = gHtml;
    }

    function buyVehicle(id) {
        let v = CONFIG.vehicles.find(x => x.id === id);
        if (v.price <= G.money) {
            if (v.price > 0 && G.vehicleId !== id) G.money -= v.price;
            G.vehicleId = id;
            saveGame(); renderShopItems(); updateHeader();
        }
    }

    function buyGear(id) {
        let g = CONFIG.gear.find(x => x.id === id);
        if (g.price <= G.money) {
            if (g.price > 0 && G.gearId !== id) G.money -= g.price;
            G.gearId = id;
            saveGame(); renderShopItems();
        }
    }

    function checkLevelUp() {
        if (G.xp >= G.lvl * 100) {
            G.lvl++;
            G.xp = 0;
            showNotif("üÜô LEVEL UP! –ù–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å!");
        }
    }

    // === SAVE SYSTEM ===
    function saveGame() { localStorage.setItem(CONFIG.saveKey, JSON.stringify(G)); }
    function loadGame() {
        let d = localStorage.getItem(CONFIG.saveKey);
        if (d) { try { G = {...G, ...JSON.parse(d)}; } catch(e){} }
    }

    window.onload = init;

</script>
</body>
</html>

