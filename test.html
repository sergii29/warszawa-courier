<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neon Courier Test V2</title>
    <style>
        :root {
            --bg-color: #050510;
            --primary: #00f3ff; /* –ù–µ–æ–Ω –≥–æ–ª—É–±–æ–π */
            --secondary: #ff00ff; /* –ù–µ–æ–Ω —Ä–æ–∑–æ–≤—ã–π (–î–æ—Å—Ç–∞–≤–∫–∞) */
            --pickup: #ffff00; /* –ù–µ–æ–Ω –∂–µ–ª—Ç—ã–π (–ó–∞–±–æ—Ä) */
            --danger: #ff3333; /* –ù–µ–æ–Ω –∫—Ä–∞—Å–Ω—ã–π */
            --gold: #ffd700;
            --panel-bg: rgba(20, 20, 40, 0.98);
            --grid-line: rgba(255, 255, 255, 0.04);
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: #fff;
            font-family: 'Courier New', Courier, monospace;
            overflow: hidden;
            touch-action: manipulation;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* --- HUD --- */
        .hud {
            display: flex;
            justify-content: space-between;
            padding: 10px 15px;
            background: linear-gradient(180deg, rgba(0,0,0,1) 0%, rgba(0,0,0,0.5) 100%);
            border-bottom: 1px solid #333;
            z-index: 10;
        }

        .stat-group { text-align: center; }
        .stat-label { font-size: 9px; color: #888; text-transform: uppercase; }
        .stat-val { font-size: 18px; font-weight: bold; text-shadow: 0 0 8px currentColor; }

        /* --- –ö–ê–†–¢–ê --- */
        #game-map {
            flex: 1;
            position: relative;
            display: grid;
            background: 
                linear-gradient(var(--grid-line) 1px, transparent 1px),
                linear-gradient(90deg, var(--grid-line) 1px, transparent 1px);
            background-size: 11.1% 11.1%; /* –î–ª—è —Å–µ—Ç–∫–∏ 9x9 */
            align-content: center;
            justify-content: center;
            gap: 1px;
            padding: 5px;
        }

        .cell {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px; /* –†–∞–∑–º–µ—Ä —Å–º–∞–π–ª–∏–∫–æ–≤ */
            position: relative;
            transition: all 0.1s ease;
        }
        
        /* –≠—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è –æ–±—ä–µ–∫—Ç–æ–≤ */
        .player-glow {
            filter: drop-shadow(0 0 5px var(--primary));
            z-index: 3;
        }

        .pickup-glow {
            filter: drop-shadow(0 0 8px var(--pickup));
            animation: pulse-yellow 1.2s infinite;
            z-index: 2;
        }

        .delivery-glow {
            filter: drop-shadow(0 0 8px var(--secondary));
            animation: pulse-pink 1.2s infinite;
            z-index: 2;
        }

        .wall-glow {
            opacity: 0.6;
            filter: drop-shadow(0 0 2px var(--danger));
            font-size: 20px;
        }

        /* --- –£–ü–†–ê–í–õ–ï–ù–ò–ï --- */
        .controls-container {
             background: var(--panel-bg);
             border-top: 2px solid var(--primary);
             padding: 15px 20px 35px 20px; /* –î–æ–±–∞–≤–∏–ª –æ—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É (35px) */
             box-shadow: 0 -5px 25px rgba(0, 243, 255, 0.15);
        }

        .controls-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            grid-template-rows: 55px 55px;
            gap: 8px;
            max-width: 400px;
            margin: 0 auto;
        }

        .btn {
            background: rgba(255,255,255,0.07);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 10px;
            color: var(--primary);
            font-size: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            user-select: none;
        }
        .btn:active { background: var(--primary); color: #000; }
        .btn-action { border-color: var(--gold); color: var(--gold); background: rgba(255, 215, 0, 0.1); }
        
        /* –°–æ–æ–±—â–µ–Ω–∏—è */
        #msg-log {
            position: absolute;
            top: 40%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 16px; font-weight: bold;
            background: rgba(0,0,0,0.8);
            padding: 10px 20px; border-radius: 20px;
            border: 1px solid #fff;
            pointer-events: none; opacity: 0; transition: opacity 0.3s; z-index: 20; text-align: center;
        }

        @keyframes pulse-yellow { 0% {transform: scale(0.9);} 50% {transform: scale(1.1);} 100% {transform: scale(0.9);} }
        @keyframes pulse-pink { 0% {transform: scale(0.9);} 50% {transform: scale(1.1);} 100% {transform: scale(0.9);} }
    </style>
</head>
<body>

    <div class="hud">
        <div class="stat-group">
            <div class="stat-label">–ë–∞–ª–∞–Ω—Å PLN</div>
            <div class="stat-val" style="color: var(--gold)" id="ui-balance">0.00</div>
        </div>
        <div class="stat-group">
            <div class="stat-label">–ó–∞—Ä—è–¥</div>
            <div class="stat-val" style="color: var(--primary)" id="ui-energy">100%</div>
        </div>
        <div class="stat-group">
            <div class="stat-label">–°—Ç–∞—Ç—É—Å</div>
            <div class="stat-val" style="font-size: 14px" id="ui-status">–ü–æ–∏—Å–∫...</div>
        </div>
    </div>

    <div id="msg-log"></div>

    <div id="game-map">
        </div>

    <div class="controls-container">
        <div class="controls-grid">
            <div></div>
            <div class="btn" onclick="move(0, -1)">‚ñ≤</div>
            <div></div>
            
            <div class="btn" onclick="move(-1, 0)">‚óÄ</div>
            <div class="btn btn-action" onclick="actionBoost()">‚ö°</div>
            <div class="btn" onclick="move(1, 0)">‚ñ∂</div>
            
            <div></div>
            <div class="btn" onclick="move(0, 1)">‚ñº</div>
            <div></div>
        </div>
    </div>

    <script>
        const GRID_SIZE = 9; 
        
        let state = {
            x: 4, y: 4,        // –ò–≥—Ä–æ–∫
            objective: {x:0, y:0}, // –¶–µ–ª—å
            hasPackage: false, // –í–µ–∑–µ–º –ª–∏ –º—ã –ø–∞–∫–µ—Ç —Å–µ–π—á–∞—Å?
            walls: [],         // –ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
            balance: 0,
            energy: 100,
            rating: 5.0
        };

        const mapEl = document.getElementById('game-map');

        function initGame() {
            mapEl.style.gridTemplateColumns = `repeat(${GRID_SIZE}, 1fr)`;
            mapEl.style.gridTemplateRows = `repeat(${GRID_SIZE}, 1fr)`;
            
            mapEl.innerHTML = '';
            for(let i=0; i<GRID_SIZE*GRID_SIZE; i++) {
                let cell = document.createElement('div');
                cell.className = 'cell';
                cell.id = `c-${i}`;
                mapEl.appendChild(cell);
            }
            
            spawnObjective(); // –°–ø–∞–≤–Ω–∏–º –ø–µ—Ä–≤—É—é —Ü–µ–ª—å (–†–µ—Å—Ç–æ—Ä–∞–Ω)
            generateWalls();  // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ–±–∫–∏
            draw();
            updateUI();
        }

        function getIdx(x, y) { return y * GRID_SIZE + x; }

        function generateWalls() {
            state.walls = [];
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º 14 –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π –¥–ª—è –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏
            for(let i=0; i<14; i++) {
                let wx, wy;
                do {
                    wx = Math.floor(Math.random() * GRID_SIZE);
                    wy = Math.floor(Math.random() * GRID_SIZE);
                // –ù–µ —Å—Ç–∞–≤–∏–º —Å—Ç–µ–Ω—ã –Ω–∞ –∏–≥—Ä–æ–∫–∞ –∏–ª–∏ —Ü–µ–ª—å
                } while ((wx === state.x && wy === state.y) || (wx === state.objective.x && wy === state.objective.y));
                
                state.walls.push(getIdx(wx, wy));
            }
        }

        function spawnObjective() {
            do {
                state.objective.x = Math.floor(Math.random() * GRID_SIZE);
                state.objective.y = Math.floor(Math.random() * GRID_SIZE);
            } while (state.objective.x === state.x && state.objective.y === state.y);
            
            // –ï—Å–ª–∏ –∑–∞–±—Ä–∞–ª–∏ –ø–∞–∫–µ—Ç, –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å—Ç–µ–Ω—ã –¥–ª—è –Ω–æ–≤–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞
            if(state.hasPackage) generateWalls(); 
            draw();
            updateUI();
        }

        function move(dx, dy) {
            if (state.energy <= 0) { showMsg("ü™´ –ë–ê–¢–ê–†–ï–Ø –°–ï–õ–ê! –ù—É–∂–Ω–∞ –∑–∞—Ä—è–¥–∫–∞!", "red"); return; }

            let nx = state.x + dx;
            let ny = state.y + dy;

            if (nx < 0 || nx >= GRID_SIZE || ny < 0 || ny >= GRID_SIZE) return;

            let nIdx = getIdx(nx, ny);
            if (state.walls.includes(nIdx)) {
                showMsg("üöß –ü—Ä–æ–±–∫–∞! –û–±—ä–µ–∑–∂–∞–π!", "#ff9900");
                state.energy -= 3;
                updateUI();
                return;
            }

            // –î–≤–∏–∂–µ–Ω–∏–µ
            state.x = nx;
            state.y = ny;
            state.energy -= 1.5;

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–∏
            if (state.x === state.objective.x && state.y === state.objective.y) {
                if (!state.hasPackage) {
                    // –≠–¢–ê–ü 1: –ó–∞–±—Ä–∞–ª–∏ –∏–∑ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞
                    state.hasPackage = true;
                    showMsg("üéí –ó–ê–ö–ê–ó –£ –¢–ï–ë–Ø! –í–µ–∑–∏ –∫–ª–∏–µ–Ω—Ç—É (üè†)!", "#ffff00");
                    spawnObjective(); // –¢–µ–ø–µ—Ä—å —Å–ø–∞–≤–Ω–∏–º –ö–ª–∏–µ–Ω—Ç–∞
                } else {
                    // –≠–¢–ê–ü 2: –û—Ç–¥–∞–ª–∏ –∫–ª–∏–µ–Ω—Ç—É
                    state.hasPackage = false;
                    let profit = 20 + Math.floor(Math.random() * 15);
                    state.balance += profit;
                    showMsg(`‚úÖ –î–û–°–¢–ê–í–õ–ï–ù–û! +${profit} PLN`, "#00f3ff");
                    generateWalls(); // –ù–æ–≤—ã–µ –ø—Ä–æ–±–∫–∏ –¥–ª—è –Ω–æ–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞
                    spawnObjective(); // –¢–µ–ø–µ—Ä—å —Å–ø–∞–≤–Ω–∏–º –†–µ—Å—Ç–æ—Ä–∞–Ω
                }
            }
            draw();
            updateUI();
        }

        function actionBoost() {
            if (state.balance >= 15) {
                state.balance -= 15;
                state.energy = Math.min(100, state.energy + 40);
                showMsg("‚ö° –ë—ã—Å—Ç—Ä–∞—è –∑–∞—Ä—è–¥–∫–∞! (-15 PLN)", "#00ff00");
                updateUI();
            } else { showMsg("‚ùå –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–µ–Ω–µ–≥ (15 PLN)", "red"); }
        }

        function draw() {
            // –û—á–∏—Å—Ç–∫–∞
            document.querySelectorAll('.cell').forEach(c => {
                c.className = 'cell';
                c.innerText = '';
            });

            // –°—Ç–µ–Ω—ã üöß
            state.walls.forEach(idx => {
                let c = document.getElementById(`c-${idx}`);
                c.innerText = 'üöß';
                c.classList.add('wall-glow');
            });

            // –¶–µ–ª—å (–†–µ—Å—Ç–æ—Ä–∞–Ω üè™ –∏–ª–∏ –ö–ª–∏–µ–Ω—Ç üè†)
            let tIdx = getIdx(state.objective.x, state.objective.y);
            let tCell = document.getElementById(`c-${tIdx}`);
            if (!state.hasPackage) {
                tCell.innerText = 'üè™'; // –ï–¥–µ–º –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω
                tCell.classList.add('pickup-glow');
            } else {
                tCell.innerText = 'üè†'; // –ï–¥–µ–º –∫ –∫–ª–∏–µ–Ω—Ç—É
                tCell.classList.add('delivery-glow');
            }

            // –ò–≥—Ä–æ–∫ üõµ
            let pIdx = getIdx(state.x, state.y);
            let pCell = document.getElementById(`c-${pIdx}`);
            pCell.innerText = 'üõµ';
            pCell.classList.add('player-glow');
        }

        function updateUI() {
            document.getElementById('ui-balance').innerText = state.balance.toFixed(2);
            
            let enEl = document.getElementById('ui-energy');
            enEl.innerText = Math.floor(state.energy) + '%';
            enEl.style.color = state.energy < 30 ? 'red' : 'var(--primary)';

            let statusEl = document.getElementById('ui-status');
            if(!state.hasPackage) {
                 statusEl.innerText = "–ï–¥—É –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω üè™";
                 statusEl.style.color = "var(--pickup)";
            } else {
                 statusEl.innerText = "–í–µ–∑—É –∫–ª–∏–µ–Ω—Ç—É üè†";
                 statusEl.style.color = "var(--secondary)";
            }
        }

        function showMsg(text, color) {
            let el = document.getElementById('msg-log');
            el.innerText = text;
            el.style.color = color;
            el.style.borderColor = color;
            el.style.opacity = 1;
            setTimeout(() => el.style.opacity = 0, 2000);
        }

        initGame();
    </script>
</body>
</html>
