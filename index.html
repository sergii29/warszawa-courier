<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Warsaw Night Courier</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0a0a0a; color: #fff; overflow: hidden; height: 100vh; }
        
        #map { height: 100%; width: 100%; position: absolute; top: 0; left: 0; z-index: 1; }
        .leaflet-tile { filter: brightness(0.4) saturate(0.8) contrast(1.2) !important; }
        
        .ui-layer { position: absolute; z-index: 100; pointer-events: none; width: 100%; height: 100%; }
        .ui-layer > * { pointer-events: auto; }
        
        .top-bar { position: absolute; top: 0; left: 0; right: 0; padding: 15px; background: linear-gradient(to bottom, rgba(0,0,0,0.9), transparent); display: flex; justify-content: space-between; align-items: center; }
        
        .balance-box { background: rgba(0,0,0,0.8); padding: 10px 20px; border-radius: 20px; border: 1px solid #333; }
        .balance-amount { font-size: 20px; font-weight: bold; color: #00e676; }
        .balance-label { font-size: 10px; color: #888; text-transform: uppercase; }
        
        .stats-row { position: absolute; top: 80px; left: 10px; right: 10px; display: flex; gap: 8px; justify-content: center; }
        .stat-pill { background: rgba(0,0,0,0.8); padding: 8px 12px; border-radius: 15px; font-size: 11px; display: flex; align-items: center; gap: 5px; border: 1px solid #333; }
        .stat-pill.energy { border-color: #ffcc00; color: #ffcc00; }
        .stat-pill.water { border-color: #00ccff; color: #00ccff; }
        .stat-pill.mood { border-color: #d500f9; color: #d500f9; }
        
        .bottom-panel { position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(to top, rgba(0,0,0,0.95), transparent); padding: 20px; }
        
        .order-card { background: rgba(20,20,20,0.95); border-radius: 20px; padding: 20px; margin-bottom: 15px; border: 1px solid #333; display: none; }
        .order-card.active { display: block; animation: slideUp 0.3s ease; }
        
        @keyframes slideUp { from { transform: translateY(100px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .restaurant-name { font-size: 18px; font-weight: bold; margin-bottom: 5px; }
        .order-info { color: #888; font-size: 13px; margin-bottom: 15px; }
        .order-price { font-size: 24px; color: #00e676; font-weight: bold; }
        
        .btn { width: 100%; padding: 18px; border: none; border-radius: 15px; font-size: 16px; font-weight: bold; cursor: pointer; transition: all 0.2s; text-transform: uppercase; }
        .btn-primary { background: #00e676; color: #000; }
        .btn-primary:active { transform: scale(0.98); }
        .btn-danger { background: #ff3d00; color: #fff; margin-top: 10px; }
        
        .action-panel { text-align: center; }
        .action-text { color: #888; margin-bottom: 15px; font-size: 14px; }
        
        .toast { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.9); padding: 20px 30px; border-radius: 15px; border: 1px solid #00e676; color: #00e676; font-weight: bold; opacity: 0; pointer-events: none; transition: opacity 0.3s; z-index: 200; }
        .toast.show { opacity: 1; }
        
        .marker-courier { background: #00e676; width: 20px; height: 20px; border-radius: 50%; border: 3px solid #fff; box-shadow: 0 0 20px #00e676; }
        .marker-dest { background: #ff3d00; width: 25px; height: 25px; border-radius: 50%; border: 3px solid #fff; box-shadow: 0 0 20px #ff3d00; animation: pulse 1.5s infinite; }
        
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }
    </style>
</head>
<body>
    <div id="map"></div>
    
    <div class="ui-layer">
        <div class="top-bar">
            <div class="balance-box">
                <div class="balance-amount" id="balance">0 PLN</div>
                <div class="balance-label">–ë–∞–ª–∞–Ω—Å</div>
            </div>
        </div>
        
        <div class="stats-row">
            <div class="stat-pill energy">‚ö° <span id="energy-val">100</span>%</div>
            <div class="stat-pill water">üíß <span id="water-val">100</span>%</div>
            <div class="stat-pill mood">üòé <span id="mood-val">100</span>%</div>
        </div>
        
        <div class="bottom-panel">
            <div class="order-card" id="order-panel">
                <div class="restaurant-name" id="rest-name">McDonald's</div>
                <div class="order-info" id="order-dist">2.5 –∫–º ‚Ä¢ 15 –º–∏–Ω</div>
                <div class="order-price" id="order-price">25 PLN</div>
                <button class="btn btn-primary" id="accept-btn" onclick="acceptOrder()">–ü—Ä–∏–Ω—è—Ç—å –∑–∞–∫–∞–∑</button>
                <button class="btn btn-danger" id="deliver-btn" onclick="completeDelivery()" style="display:none">–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ!</button>
            </div>
            
            <div class="action-panel" id="wait-panel">
                <div class="action-text">–°–≤–∞–π–ø–Ω–∏—Ç–µ –∫–∞—Ä—Ç—É –∏–ª–∏ –∂–¥–∏—Ç–µ –∑–∞–∫–∞–∑...</div>
                <button class="btn btn-primary" onclick="findOrder()">üîç –ò—Å–∫–∞—Ç—å –∑–∞–∫–∞–∑</button>
            </div>
        </div>
    </div>
    
    <div class="toast" id="toast">–ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç!</div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // –¢–í–û–Ø –ë–ê–ó–ê (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞)
        const firebaseConfig = {
          apiKey: "AIzaSyChrQMyO2soPgoEHq_f3aYs5Cs19q3sWEk", 
          authDomain: "warszawa-courier.firebaseapp.com",
          databaseURL: "https://warszawa-courier-default-rtdb.europe-west1.firebasedatabase.app",
          projectId: "warszawa-courier",
          storageBucket: "warszawa-courier.firebasestorage.app",
          messagingSenderId: "295860613508",
          appId: "1:295860613508:web:86fe8364377d6875612dd1",
          measurementId: "G-TGSCHBVLX2"
        };

        // –¶–µ–Ω—Ç—Ä –í–∞—Ä—à–∞–≤—ã
        const WARSAW_CENTER = [52.2297, 21.0122];
        
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        let state = {
            balance: 0,
            energy: 100,
            water: 100,
            mood: 100,
            currentOrder: null,
            isDelivering: false
        };

        // –ö–∞—Ä—Ç–∞
        let map;
        let courierMarker = null;
        let destMarker = null;
        let routeLine = null;

        // –†–µ—Å—Ç–æ—Ä–∞–Ω—ã
        const restaurants = [
            { name: "McDonald's", icon: "üçî" },
            { name: "KFC", icon: "üçó" },
            { name: "Pizza Hut", icon: "üçï" },
            { name: "Sushi Master", icon: "üç£" },
            { name: "Kebab King", icon: "üåØ" }
        ];

        function init() {
            // –¢—ë–º–Ω–∞—è –∫–∞—Ä—Ç–∞ –í–∞—Ä—à–∞–≤—ã
            map = L.map('map', { zoomControl: false, attributionControl: false }).setView(WARSAW_CENTER, 13);
            
            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                maxZoom: 19
            }).addTo(map);

            // –ö—É—Ä—å–µ—Ä
            const courierIcon = L.divIcon({
                html: '<div class="marker-courier"></div>',
                className: 'custom-marker',
                iconSize: [20, 20]
            });
            courierMarker = L.marker(WARSAW_CENTER, { icon: courierIcon }).addTo(map);

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
            updateUI();
            setInterval(updateStats, 1000);
        }

        function updateUI() {
            document.getElementById('balance').textContent = Math.floor(state.balance) + ' PLN';
            document.getElementById('energy-val').textContent = Math.floor(state.energy);
            document.getElementById('water-val').textContent = Math.floor(state.water);
            document.getElementById('mood-val').textContent = Math.floor(state.mood);
        }

        function updateStats() {
            if (state.isDelivering) {
                state.energy -= 0.5;
                state.water -= 0.3;
                state.mood -= 0.2;
                
                if (state.energy < 0) state.energy = 0;
                if (state.water < 0) state.water = 0;
                if (state.mood < 0) state.mood = 0;
                
                updateUI();
            }
        }

        function findOrder() {
            if (state.isDelivering) return;
            
            const rest = restaurants[Math.floor(Math.random() * restaurants.length)];
            const dist = (1 + Math.random() * 4).toFixed(1);
            const price = Math.floor(15 + Math.random() * 30);
            
            state.currentOrder = {
                restaurant: rest,
                distance: dist,
                price: price,
                destLat: WARSAW_CENTER[0] + (Math.random() - 0.5) * 0.05,
                destLng: WARSAW_CENTER[1] + (Math.random() - 0.5) * 0.08
            };
            
            document.getElementById('rest-name').textContent = rest.name + ' ' + rest.icon;
            document.getElementById('order-dist').textContent = dist + ' –∫–º ‚Ä¢ ~' + Math.floor(dist * 3) + ' –º–∏–Ω';
            document.getElementById('order-price').textContent = price + ' PLN';
            
            document.getElementById('wait-panel').style.display = 'none';
            document.getElementById('order-panel').classList.add('active');
        }

        function acceptOrder() {
            if (!state.currentOrder) return;
            
            state.isDelivering = true;
            
            // –ú–∞—Ä—à—Ä—É—Ç
            const dest = [state.currentOrder.destLat, state.currentOrder.destLng];
            
            const destIcon = L.divIcon({
                html: '<div class="marker-dest"></div>',
                className: 'custom-marker',
                iconSize: [25, 25]
            });
            destMarker = L.marker(dest, { icon: destIcon }).addTo(map);
            
            routeLine = L.polyline([WARSAW_CENTER, dest], {
                color: '#00e676',
                weight: 4,
                opacity: 0.8,
                dashArray: '10, 10'
            }).addTo(map);
            
            map.fitBounds([WARSAW_CENTER, dest], { padding: [50, 50] });
            
            // UI
            document.getElementById('accept-btn').style.display = 'none';
            document.getElementById('deliver-btn').style.display = 'block';
            document.getElementById('order-dist').textContent = '–í –ø—É—Ç–∏...';
            
            showToast('–ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç! –ï–¥–µ–º –∫ –∫–ª–∏–µ–Ω—Ç—É...');
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –¥–≤–∏–∂–µ–Ω–∏—è
            animateDelivery();
        }

        function animateDelivery() {
            let progress = 0;
            const interval = setInterval(() => {
                progress += 2;
                
                // –î–≤–∏–≥–∞–µ–º –∫—É—Ä—å–µ—Ä–∞
                const start = WARSAW_CENTER;
                const end = [state.currentOrder.destLat, state.currentOrder.destLng];
                const lat = start[0] + (end[0] - start[0]) * (progress / 100);
                const lng = start[1] + (end[1] - start[1]) * (progress / 100);
                courierMarker.setLatLng([lat, lng]);
                
                if (progress >= 100) {
                    clearInterval(interval);
                    showToast('–ü—Ä–∏–±—ã–ª–∏! –ù–∞–∂–º–∏—Ç–µ "–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ"');
                }
            }, 100);
        }

        function completeDelivery() {
            if (!state.isDelivering) return;
            
            // –ù–∞—á–∏—Å–ª—è–µ–º –¥–µ–Ω—å–≥–∏
            let earned = state.currentOrder.price;
            
            // –ë–æ–Ω—É—Å –∑–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ
            if (state.mood > 80) earned += 5;
            
            // –®—Ç—Ä–∞—Ñ –∑–∞ –Ω–∏–∑–∫—É—é —ç–Ω–µ—Ä–≥–∏—é
            if (state.energy < 20) earned -= 3;
            
            state.balance += earned;
            
            // –°–±—Ä–æ—Å
            state.isDelivering = false;
            state.currentOrder = null;
            
            // –û—á–∏—Å—Ç–∫–∞ –∫–∞—Ä—Ç—ã
            if (destMarker) map.removeLayer(destMarker);
            if (routeLine) map.removeLayer(routeLine);
            courierMarker.setLatLng(WARSAW_CENTER);
            map.setView(WARSAW_CENTER, 13);
            
            // UI
            document.getElementById('order-panel').classList.remove('active');
            document.getElementById('wait-panel').style.display = 'block';
            document.getElementById('accept-btn').style.display = 'block';
            document.getElementById('deliver-btn').style.display = 'none';
            
            showToast('+' + earned + ' PLN! –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!');
            updateUI();
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.textContent = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 2000);
        }

        // –°—Ç–∞—Ä—Ç
        init();
    </script>
</body>
</html>

