<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Courier Simulator: Warszawa</title>
    <style>
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --accent-color: #4caf50; /* Green balance */
            --primary-color: #2196f3; /* Blue buttons */
            --warning-color: #ff9800;
            --danger-color: #f44336;
            --lvl-color: #9c27b0;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
            padding-bottom: 80px; /* Space for nav */
        }

        /* --- Header --- */
        .header {
            background-color: var(--card-bg);
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-title {
            font-size: 1.2rem;
            font-weight: bold;
        }

        .header-icons span {
            margin-left: 15px;
            font-size: 1.2rem;
            cursor: pointer;
        }

        /* --- Stats Bar --- */
        .stats-bar {
            background-color: var(--card-bg);
            padding: 15px;
            margin-bottom: 10px;
        }

        .balance-row {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 5px;
        }

        .balance {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--accent-color);
        }

        .level-info {
            font-size: 0.9rem;
            color: var(--text-color);
            opacity: 0.8;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .home-icon {
             font-size: 1rem;
             color: #ff9800; /* Orange house */
        }

        .stats-details {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            margin-top: 10px;
            align-items: center;
        }

        .energy-bar-container, .water-bar-container {
            flex: 1;
            margin-right: 10px;
        }
        
        .water-bar-container {
            margin-right: 0;
            margin-left: 10px;
            text-align: right;
        }

        .progress-bg {
            background-color: #333;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 4px;
        }

        .progress-fill {
            height: 100%;
            background-color: #ffeb3b; /* Energy Yellow */
            width: 100%;
            transition: width 0.3s;
        }
        
        .water-fill {
            background-color: #03a9f4; /* Water Blue */
        }

        .stat-text {
            font-size: 0.85rem;
            color: #ccc;
        }
        
        .timers-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            color: #888;
            margin-top: 8px;
            padding-top: 5px;
            border-top: 1px solid #333;
        }

        /* --- Tabs --- */
        .tab-content {
            display: none;
            padding: 10px 15px;
            animation: fadeIn 0.3s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* --- Cards --- */
        .card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .card h3 {
            margin: 0 0 10px 0;
            font-size: 1.1rem;
        }
        
        .card p {
            margin: 5px 0;
            font-size: 0.9rem;
            color: #bbb;
        }

        /* Rank Card */
        .rank-card {
            background: linear-gradient(135deg, #1a237e, #283593);
            border: 1px solid #3949ab;
        }
        
        .rank-icon {
            font-size: 3rem;
            margin-bottom: 10px;
            display: block;
        }

        /* Quest Card */
        .quest-item {
            background-color: #2c2c2c;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            text-align: left;
        }

        .quest-header {
            display: flex;
            justify-content: space-between;
            font-size: 0.95rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .quest-progress-bg {
            background-color: #444;
            height: 6px;
            border-radius: 3px;
        }

        .quest-progress-fill {
            background-color: var(--primary-color);
            height: 100%;
            border-radius: 3px;
            width: 0%;
            transition: width 0.3s;
        }

        /* District Card */
        .district-card {
            text-align: left;
            border: 1px solid #333;
            margin-bottom: 15px;
        }
        
        .district-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .district-name {
            font-size: 1.1rem;
            font-weight: bold;
        }
        
        .district-badge {
            font-size: 0.75rem;
            padding: 2px 6px;
            border-radius: 4px;
            background: #444;
        }
        
        .district-stats {
            font-size: 0.85rem;
            color: #aaa;
            margin: 8px 0;
        }

        /* Shop Items */
        .shop-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #2c2c2c;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .shop-info {
            text-align: left;
        }
        
        .shop-name {
            font-weight: bold;
            display: block;
        }
        
        .shop-desc {
            font-size: 0.8rem;
            color: #888;
        }

        /* Buttons */
        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            transition: opacity 0.2s;
        }

        .btn:active {
            opacity: 0.8;
            transform: scale(0.98);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
        }

        .btn-disabled {
            background-color: #555;
            cursor: not-allowed;
            color: #888;
        }
        
        .btn-buy {
            background-color: var(--warning-color);
            color: #000;
        }

        /* Navigation */
        .nav-bar {
            position: fixed;
            bottom: 0;
            width: 100%;
            background-color: var(--card-bg);
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            box-shadow: 0 -2px 5px rgba(0,0,0,0.5);
            z-index: 100;
        }

        .nav-item {
            color: #888;
            font-size: 0.8rem;
            text-align: center;
            cursor: pointer;
            flex: 1;
        }

        .nav-item.active {
            color: var(--primary-color);
        }
        
        .nav-icon {
            display: block;
            font-size: 1.2rem;
            margin-bottom: 3px;
        }

        /* --- Click Area --- */
        .click-area {
            height: 200px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            margin: 20px 0;
        }

        .main-button {
            width: 160px;
            height: 160px;
            border-radius: 50%;
            background: radial-gradient(circle, #2196f3, #1976d2);
            border: 4px solid #64b5f6;
            box-shadow: 0 0 20px rgba(33, 150, 243, 0.4);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
            cursor: pointer;
            user-select: none;
            transition: transform 0.1s;
        }

        .main-button:active {
            transform: scale(0.95);
        }

        /* Admin Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 200;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            width: 80%;
            max-width: 300px;
        }

        /* Floating Text Animation */
        .floating-text {
            position: absolute;
            color: #4caf50;
            font-weight: bold;
            font-size: 1.2rem;
            pointer-events: none;
            animation: floatUp 1s forwards;
        }

        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-50px); }
        }

        /* Invest styles */
        .invest-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #333;
        }
    </style>
</head>
<body>

    <div class="header">
        <div class="header-title">Courier Simulator</div>
        <div class="header-icons">
            <span onclick="toggleAdmin()">‚öôÔ∏è</span>
        </div>
    </div>

    <div class="stats-bar">
        <div class="balance-row">
            <div class="balance" id="balanceDisplay">0.00 PLN</div>
            <div class="level-info">
                LVL <span id="levelDisplay">1.000000</span>
                <span class="home-icon" id="homeIndicator">üè†</span>
            </div>
        </div>
        
        <div class="stats-details">
            <span id="transportName">üëü Bazuka</span>
            <span id="transportTimer" style="display:none; color: #2196f3; border: 1px solid #2196f3; padding: 2px 5px; border-radius: 4px; font-size: 0.7rem;">14:59</span>
        </div>
        <div class="progress-bg" style="margin-bottom: 10px; background-color: #444;">
             <div class="progress-fill" style="width: 100%; background-color: #9c27b0;"></div>
        </div>

        <div class="stats-details">
            <div class="energy-bar-container">
                <div class="stat-text">‚ö° <span id="energyDisplay">2000/2000</span></div>
                <div class="progress-bg"><div class="progress-fill" id="energyFill"></div></div>
            </div>
            <div class="water-bar-container">
                <div class="stat-text">üíß <span id="waterDisplay">500 –º–ª</span></div>
                <div class="progress-bg"><div class="progress-fill water-fill" id="waterFill" style="width: 50%;"></div></div>
            </div>
        </div>
        
        <div class="timers-row">
            <span id="taxTimer">–ù–∞–ª–æ–≥ (FREE): 5:00</span>
            <span id="rentTimer" style="color: #f44336;">–ê—Ä–µ–Ω–¥–∞ (5%): 5:00</span>
        </div>
    </div>

    <div id="tab-city" class="tab-content active">
        <div class="card rank-card">
            <span class="rank-icon" id="rankIcon">üë∂</span>
            <h3 id="rankName">–ù–æ–≤–∏—á–æ–∫</h3>
            <p id="rankNext">–î–æ —Ä–∞–Ω–≥–∞ –ë—ã–≤–∞–ª—ã–π: 50 –∑–∞–∫–∞–∑–æ–≤</p>
            <div class="progress-bg" style="background: rgba(0,0,0,0.3);">
                <div class="progress-fill" id="rankProgress" style="width: 0%; background: #fff;"></div>
            </div>
            <p style="margin-top: 10px; color: #ffeb3b; font-weight: bold;" id="rankBonus">–ë–æ–Ω—É—Å —Ä–∞–Ω–≥–∞: +0%</p>
        </div>

        <h3 style="margin-left: 5px;">üìÖ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è <span style="font-size:0.8rem; float:right; color:#888; font-weight:normal;">–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 23—á 49–º</span></h3>
        <div id="dailyQuestsContainer">
            </div>

        <h3 style="margin-left: 5px;">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
        <div class="card" style="text-align: left;">
            <p>üì¶ –í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤: <span id="totalOrders">0</span></p>
            <p>üí∞ –í—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: <span id="totalEarned">0.00</span> PLN</p>
            <p>‚ò†Ô∏è –°–º–µ—Ä—Ç–µ–π –æ—Ç –∂–∞–∂–¥—ã: <span id="deaths">0</span></p>
        </div>
    </div>

    <div id="tab-career" class="tab-content">
        <div class="click-area">
            <div class="main-button" id="clickBtn" onclick="doWork(event)">üì¶</div>
            <p style="margin-top: 15px; color: #888;">–ù–∞–∂–º–∏, —á—Ç–æ–±—ã –¥–æ—Å—Ç–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑</p>
        </div>
        
        <div class="card">
             <h3>–ê–∫—Ç–∏–≤–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã</h3>
             <p id="activeEffectsText">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤</p>
        </div>

         <div class="card">
            <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ–Ω—É—Å–∞—Ö</h3>
            <p style="text-align: left; font-size: 0.85rem; color: #aaa;">
                üëü <b>–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç:</b> –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –¥–æ—Ö–æ–¥ –∑–∞ –∫–ª–∏–∫.<br>
                ‚ö° <b>–≠–Ω–µ—Ä–≥–∏—è:</b> –¢—Ä–∞—Ç–∏—Ç—Å—è –Ω–∞ —Ä–∞–±–æ—Ç—É. –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –µ–¥–æ–π.<br>
                üíß <b>–í–æ–¥–∞:</b> –¢—Ä–∞—Ç–∏—Ç—Å—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ. –ù—É–∂–Ω–∞ –¥–ª—è –∂–∏–∑–Ω–∏.<br>
                üîã <b>–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫:</b> –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ä–∞—Å—Ö–æ–¥ —ç–Ω–µ—Ä–≥–∏–∏ –Ω–∞ –≤—Ä–µ–º—è, –Ω–æ –≤–æ–¥–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ç—Ä–∞—Ç–∏—Ç—å—Å—è!
            </p>
        </div>
    </div>

    <div id="tab-shop" class="tab-content">
        <h3>üè™ –ú–∞–≥–∞–∑–∏–Ω</h3>
        
        <div class="card">
            <h4>–ï–¥–∞ –∏ –ù–∞–ø–∏—Ç–∫–∏</h4>
            <div id="shopConsumables"></div>
        </div>

        <div class="card">
            <h4>–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç (–ê—Ä–µ–Ω–¥–∞ 15 –º–∏–Ω)</h4>
            <div id="shopTransport"></div>
        </div>
    </div>
    
    <div id="tab-city-map" class="tab-content">
        <h3>üó∫Ô∏è –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å & –†–∞–π–æ–Ω—ã</h3>
        <p style="font-size: 0.8rem; color: #aaa; margin-bottom: 15px;">–ü–µ—Ä–µ–µ–∑–∂–∞–π –≤ —Ä–∞–π–æ–Ω—ã –ø–æ–¥–æ—Ä–æ–∂–µ, —á—Ç–æ–±—ã –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –±–æ–ª—å—à–µ. –ö—É–ø–∏ –∫–≤–∞—Ä—Ç–∏—Ä—É, —á—Ç–æ–±—ã –Ω–µ –ø–ª–∞—Ç–∏—Ç—å –≥—Ä–∞–±–∏—Ç–µ–ª—å—Å–∫—É—é –∞—Ä–µ–Ω–¥—É!</p>
        <div id="districtsContainer"></div>
    </div>

    <div id="tab-invest" class="tab-content">
        <h3>üìà –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</h3>
        <div class="card">
            <p>–ë–∞–Ω–∫–æ–≤—Å–∫–∏–π –¥–µ–ø–æ–∑–∏—Ç (1% –≤ –¥–µ–Ω—å)</p>
            <input type="number" id="bankInput" placeholder="–°—É–º–º–∞" style="width: 80%; padding: 8px; margin-bottom: 10px; background: #333; border: 1px solid #555; color: white; border-radius: 5px;">
            <div style="display: flex; gap: 10px;">
                <button class="btn" onclick="bankDeposit()">–í–ª–æ–∂–∏—Ç—å</button>
                <button class="btn btn-outline" onclick="bankWithdraw()">–°–Ω—è—Ç—å</button>
            </div>
            <p style="margin-top: 10px;">–ù–∞ —Å—á–µ—Ç—É: <span id="bankBalance">0.00</span> PLN</p>
        </div>
    </div>

    <div id="tab-bank" class="tab-content">
         <h3>üè¶ –ë–∞–Ω–∫</h3>
         <div class="card">
             <p>–ö—Ä–µ–¥–∏—Ç—ã –∏ –û–±–º–µ–Ω –≤–∞–ª—é—Ç (–°–∫–æ—Ä–æ)</p>
         </div>
    </div>

    <div class="nav-bar">
        <div class="nav-item" onclick="switchTab('tab-city-map')">
            <span class="nav-icon">üèôÔ∏è</span>–ì–æ—Ä–æ–¥
        </div>
        <div class="nav-item active" onclick="switchTab('tab-city')">
            <span class="nav-icon">üë§</span>–ü—Ä–æ—Ñ–∏–ª—å
        </div>
        <div class="nav-item" onclick="switchTab('tab-career')">
            <span class="nav-icon">üíº</span>–ö–∞—Ä—å–µ—Ä–∞
        </div>
        <div class="nav-item" onclick="switchTab('tab-shop')">
            <span class="nav-icon">üõí</span>–ú–∞–≥–∞–∑–∏–Ω
        </div>
        <div class="nav-item" onclick="switchTab('tab-invest')">
            <span class="nav-icon">üìà</span>–ò–Ω–≤–µ—Å—Ç
        </div>
    </div>

    <div id="adminModal" class="modal">
        <div class="modal-content">
            <h3>Admin Panel</h3>
            <button class="btn" onclick="addMoney(100)">+100 PLN</button>
            <button class="btn" onclick="addLevel(0.5)">+0.5 LVL (Blind Mode)</button>
            <button class="btn btn-buy" onclick="resetProfile()" style="margin-top: 20px;">–°–ë–†–û–° –ü–†–û–ì–†–ï–°–°–ê</button>
            <button class="btn btn-outline" onclick="toggleAdmin()">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <script>
        // --- GAME STATE & CONFIG ---
        const SAVE_KEY = 'WARSZAWA_FOREVER';
        
        // Default State
        const initialState = {
            balance: 0,
            bankBalance: 0,
            level: 1.0,
            energy: 2000,
            maxEnergy: 2000,
            water: 500, // ml
            maxWater: 1000,
            totalOrders: 0,
            totalEarned: 0,
            deaths: 0,
            currentTransport: 'feet', // feet, bike, scooter, car
            transportExpiry: 0, // timestamp
            location: 'praga', // current district ID
            lastLogin: Date.now(),
            blindModeUntil: 0 // Timestamp for blind mode
        };

        let gameState = { ...initialState };

        // Constants
        const RANGES = [
            { name: "–ù–æ–≤–∏—á–æ–∫", orders: 0, bonus: 0, icon: "üë∂" },
            { name: "–ë—ã–≤–∞–ª—ã–π", orders: 50, bonus: 0.05, icon: "üë¶" },
            { name: "–ü—Ä–æ—Ñ–∏", orders: 200, bonus: 0.10, icon: "üòé" },
            { name: "–õ–µ–≥–µ–Ω–¥–∞", orders: 1000, bonus: 0.20, icon: "üëë" }
        ];

        const TRANSPORTS = {
            feet: { name: "–ü–µ—à–∫–æ–º", mult: 1, cost: 0 },
            bazuka: { name: "Bazuka", mult: 1.2, cost: 50, duration: 900000 }, // 15 min
            bike: { name: "–í–µ–ª–æ—Å–∏–ø–µ–¥", mult: 1.5, cost: 150, duration: 900000 },
            scooter: { name: "–≠–ª–µ–∫—Ç—Ä–æ—Å–∞–º–æ–∫–∞—Ç", mult: 2.0, cost: 300, duration: 900000 }
        };

        const CONSUMABLES = [
            { id: 'water_small', name: '–í–æ–¥–∞ 0.5–ª', cost: 2, type: 'water', val: 500 },
            { id: 'hotdog', name: '–•–æ—Ç-–¥–æ–≥', cost: 5, type: 'energy', val: 300 },
            { id: 'kebab', name: '–ö–µ–±–∞–±', cost: 12, type: 'energy', val: 800 },
            { id: 'monster', name: '–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫', cost: 15, type: 'buff', buffType: 'no_energy_drain', duration: 300000, desc: "–≠–Ω–µ—Ä–≥–∏—è –Ω–µ —Ç—Ä–∞—Ç–∏—Ç—Å—è 5 –º–∏–Ω (–≤–æ–¥–∞ —Ç—Ä–∞—Ç–∏—Ç—Å—è!)" } 
        ];

        // Districts
        let districts = [
            { id: 'praga', name: 'Praga', rent: 25.01, buyPrice: 0, incomeMult: 1.0, isOwned: true, minLvl: 1 },
            { id: 'mokotow', name: 'Mokotow', rentPercent: 0.10, buyPrice: 850000, incomeMult: 1.5, isOwned: false, minLvl: 2.5 },
            { id: 'srodmiescie', name: '≈ör√≥dmie≈õcie', rentPercent: 0.15, buyPrice: 2500000, incomeMult: 2.0, isOwned: false, minLvl: 5.0 }
        ];

        // Quests
        let dailyQuests = [
            { id: 'clicks', text: "–°–¥–µ–ª–∞–π 429 –∫–ª–∏–∫–æ–≤", target: 429, progress: 0, reward: 10, isCompleted: false },
            { id: 'orders', text: "–í—ã–ø–æ–ª–Ω–∏ 6 –∑–∞–∫–∞–∑–æ–≤", target: 6, progress: 0, reward: 25, isCompleted: false },
            { id: 'earn', text: "–ó–∞—Ä–∞–±–æ—Ç–∞–π 115 PLN", target: 115, progress: 0, reward: 50, isCompleted: false }
        ];

        // System Variables
        let activeBuffs = {
            no_energy_drain: 0 // timestamp expiry
        };
        let taxTimer = 300; // seconds
        let rentTimer = 300; // seconds

        // --- CORE FUNCTIONS ---

        function init() {
            loadGame();
            
            // Loop for timers
            setInterval(() => {
                gameLoop();
            }, 1000);

            // Auto-save
            setInterval(() => {
                saveGame();
            }, 30000);

            renderAll();
        }

        function gameLoop() {
            const now = Date.now();
            
            // 1. Water Drain (Always drains, even with energy drink)
            if (gameState.water > 0) {
                gameState.water -= 1; // 1ml per second
            } else {
                // Thirst damage
                gameState.deaths++;
                gameState.water = 500;
                gameState.energy = Math.max(0, gameState.energy - 500);
                showFloatText("–û–±–µ–∑–≤–æ–∂–∏–≤–∞–Ω–∏–µ! –†–µ—Å–ø–∞—É–Ω...", document.body, true);
            }

            // 2. Timers
            taxTimer--;
            rentTimer--;

            if (taxTimer <= 0) {
                taxTimer = 300; // Reset
                // Tax logic here (currently free)
            }

            if (rentTimer <= 0) {
                rentTimer = 300;
                payRent();
            }

            // 3. Transport Expiry
            if (gameState.currentTransport !== 'feet' && now > gameState.transportExpiry) {
                gameState.currentTransport = 'feet';
                showFloatText("–ê—Ä–µ–Ω–¥–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ –∏—Å—Ç–µ–∫–ª–∞!", document.body, true);
            }
            
            renderAll();
        }

        function doWork(e) {
            const now = Date.now();
            
            // Blind Mode Check
            const isBlind = now < gameState.blindModeUntil;

            // Energy Cost
            const energyCost = 10;
            const energyFree = now < activeBuffs.no_energy_drain;
            
            if (!energyFree && gameState.energy < energyCost) {
                if (!isBlind) alert("–ù–µ—Ç —ç–Ω–µ—Ä–≥–∏–∏! –°—ä–µ—à—å —á—Ç–æ-–Ω–∏–±—É–¥—å.");
                return;
            }

            if (!energyFree) {
                gameState.energy -= energyCost;
            }

            // Calculate Reward
            // Base: 0.5 PLN * Location Mult * Transport Mult * Rank Bonus
            let currentDistrict = districts.find(d => d.id === gameState.location);
            let transport = TRANSPORTS[gameState.currentTransport];
            let rank = RANGES.find((r, i) => {
                 let next = RANGES[i+1];
                 return gameState.totalOrders >= r.orders && (!next || gameState.totalOrders < next.orders);
            });

            let basePay = 0.50;
            
            // BLIND MODE EFFECT: Randomize outcome if blind
            let actualPay = 0;
            
            if (isBlind) {
                // Random multiplier between 0.5x and 2.0x purely for internal calculation
                // But usually user gets standard logic but doesn't see it. 
                // However, the memory says "x2 or -50% ... I will only find out when over".
                // Let's implement a random fluctuation factor stored hiddenly? 
                // For simplicity: We calculate normal pay, but maybe apply a hidden modifier.
                // Let's stick to standard pay but hidden UI for now to be safe, or small randomization.
                let luck = Math.random() > 0.5 ? 2.0 : 0.5;
                 actualPay = basePay * currentDistrict.incomeMult * transport.mult * (1 + rank.bonus) * luck;
            } else {
                 actualPay = basePay * currentDistrict.incomeMult * transport.mult * (1 + rank.bonus);
            }

            gameState.balance += actualPay;
            gameState.totalEarned += actualPay;
            gameState.totalOrders++;
            gameState.level += 0.000005; // Tiny xp

            // Update Quests
            updateQuest('clicks', 1);
            updateQuest('orders', 1);
            updateQuest('earn', actualPay);

            // UI Feedback
            if (!isBlind) {
                showFloatText(`+${actualPay.toFixed(2)}`, e.target);
            } else {
                 showFloatText(`???`, e.target);
            }
            
            renderAll();
        }

        function updateQuest(type, amount) {
            let q = dailyQuests.find(q => q.id === type);
            if (q && !q.isCompleted) {
                q.progress += amount;
                if (q.progress >= q.target) {
                    q.progress = q.target;
                    q.isCompleted = true;
                    gameState.balance += q.reward;
                    alert(`–ó–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ! –ù–∞–≥—Ä–∞–¥–∞: ${q.reward} PLN`);
                }
            }
        }

        function payRent() {
            let currentDistrict = districts.find(d => d.id === gameState.location);
            if (currentDistrict.isOwned) return; // No rent if owned

            let cost = 0;
            if (currentDistrict.rentPercent) {
                cost = gameState.balance * currentDistrict.rentPercent;
            } else {
                cost = currentDistrict.rent;
            }
            
            if (cost > 0) {
                if (gameState.balance >= cost) {
                    gameState.balance -= cost;
                    showFloatText(`-–ê—Ä–µ–Ω–¥–∞ ${cost.toFixed(2)}`, document.body, true);
                } else {
                    // Debt logic or forced move could go here
                    // For now just take what is left
                    gameState.balance = 0; 
                }
            }
        }

        // --- SHOP & ACTIONS ---
        function buyConsumable(id) {
            let item = CONSUMABLES.find(i => i.id === id);
            if (gameState.balance >= item.cost) {
                gameState.balance -= item.cost;
                
                if (item.type === 'water') {
                    gameState.water = Math.min(gameState.maxWater, gameState.water + item.val);
                } else if (item.type === 'energy') {
                    gameState.energy = Math.min(gameState.maxEnergy, gameState.energy + item.val);
                } else if (item.type === 'buff') {
                    if (item.buffType === 'no_energy_drain') {
                        activeBuffs.no_energy_drain = Date.now() + item.duration;
                    }
                }
                renderAll();
            } else {
                alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥!");
            }
        }

        function rentTransport(key) {
            let t = TRANSPORTS[key];
            if (gameState.balance >= t.cost) {
                gameState.balance -= t.cost;
                gameState.currentTransport = key;
                gameState.transportExpiry = Date.now() + t.duration;
                renderAll();
            } else {
                 alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥!");
            }
        }

        function moveDistrict(id) {
            let d = districts.find(x => x.id === id);
            if (gameState.level < d.minLvl) {
                alert(`–ù—É–∂–µ–Ω —É—Ä–æ–≤–µ–Ω—å ${d.minLvl}!`);
                return;
            }
            
            // Move cost fixed 150 logic from screenshot
            let moveCost = 150;
            // First district move is usually free or handled differently? 
            // Screenshot says "PEREEEHAT (150 PLN)".
            
            if (gameState.balance >= moveCost) {
                gameState.balance -= moveCost;
                gameState.location = id;
                renderAll();
            } else {
                alert("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç 150 PLN –Ω–∞ –ø–µ—Ä–µ–µ–∑–¥!");
            }
        }
        
        function buyRealEstate(id) {
            let d = districts.find(x => x.id === id);
            if (gameState.balance >= d.buyPrice) {
                gameState.balance -= d.buyPrice;
                d.isOwned = true;
                saveGame();
                renderAll();
            } else {
                alert("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç —Å—Ä–µ–¥—Å—Ç–≤!");
            }
        }

        // --- ADMIN ---
        function toggleAdmin() {
            let modal = document.getElementById('adminModal');
            modal.style.display = modal.style.display === 'flex' ? 'none' : 'flex';
        }

        function addMoney(amount) {
            gameState.balance += amount;
            renderAll();
        }

        function addLevel(amount) {
            gameState.level += amount;
            // Trigger Blind Mode
            gameState.blindModeUntil = Date.now() + (10 * 60 * 1000); // 10 mins
            alert("–ü–æ–ª—É—á–µ–Ω –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥! –ë–∞–ª–∞–Ω—Å —Å–∫—Ä—ã—Ç –Ω–∞ 10 –º–∏–Ω—É—Ç.");
            renderAll();
        }

        function resetProfile() {
            if(!confirm("–¢–æ—á–Ω–æ —Å–±—Ä–æ—Å–∏—Ç—å –≤–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å?")) return;
            
            // 1. Reset Game State
            gameState = { ...initialState };
            
            // 2. Reset Districts (Fix requested by user)
            districts.forEach(d => {
                if(d.id === 'praga') {
                    d.isOwned = true; // Starter home
                } else {
                    d.isOwned = false; // Reset purchase
                }
            });

            // 3. Reset Quests (Fix requested by user)
            dailyQuests.forEach(q => {
                q.progress = 0;
                q.isCompleted = false;
            });

            saveGame();
            location.reload();
        }

        // --- RENDER ---
        function renderAll() {
            const isBlind = Date.now() < gameState.blindModeUntil;
            
            // Balance & Level
            if (isBlind) {
                document.getElementById('balanceDisplay').innerText = "??? PLN";
                document.getElementById('balanceDisplay').style.color = "#888";
            } else {
                document.getElementById('balanceDisplay').innerText = gameState.balance.toFixed(2) + " PLN";
                document.getElementById('balanceDisplay').style.color = "var(--accent-color)";
            }
            
            document.getElementById('levelDisplay').innerText = gameState.level.toFixed(6);

            // Home Icon color logic
            let currentD = districts.find(d => d.id === gameState.location);
            let homeIcon = document.getElementById('homeIndicator');
            homeIcon.style.color = currentD.isOwned ? "#4caf50" : "#ff9800"; // Green if owned

            // Transport
            let trans = TRANSPORTS[gameState.currentTransport];
            let timerEl = document.getElementById('transportTimer');
            document.getElementById('transportName').innerText = (gameState.currentTransport === 'feet') ? "üëü " + trans.name : "üö¥ " + trans.name;
            
            if (gameState.currentTransport !== 'feet') {
                let left = Math.max(0, Math.ceil((gameState.transportExpiry - Date.now()) / 1000));
                let min = Math.floor(left / 60);
                let sec = left % 60;
                timerEl.innerText = `${min}:${sec < 10 ? '0'+sec : sec}`;
                timerEl.style.display = 'inline-block';
            } else {
                timerEl.style.display = 'none';
            }

            // Energy & Water
            document.getElementById('energyDisplay').innerText = `${Math.floor(gameState.energy)}/${gameState.maxEnergy}`;
            document.getElementById('energyFill').style.width = (gameState.energy / gameState.maxEnergy * 100) + "%";
            
            document.getElementById('waterDisplay').innerText = `${Math.floor(gameState.water)} –º–ª`;
            document.getElementById('waterFill').style.width = (gameState.water / gameState.maxWater * 100) + "%";

            // Timers
            let tMin = Math.floor(taxTimer / 60);
            let tSec = taxTimer % 60;
            document.getElementById('taxTimer').innerText = `–ù–∞–ª–æ–≥ (FREE): ${tMin}:${tSec<10?'0'+tSec:tSec}`;
            
            let rMin = Math.floor(rentTimer / 60);
            let rSec = rentTimer % 60;
            let rText = currentD.isOwned ? "–í–ª–∞–¥–µ–ª–µ—Ü" : `–ê—Ä–µ–Ω–¥–∞ (${currentD.rentPercent ? (currentD.rentPercent*100)+'%' : currentD.rent}): ${rMin}:${rSec<10?'0'+rSec:rSec}`;
            document.getElementById('rentTimer').innerText = rText;
            document.getElementById('rentTimer').style.color = currentD.isOwned ? "#4caf50" : "#f44336";

            // Rank
            let currentRank = RANGES.find((r, i) => {
                 let next = RANGES[i+1];
                 return gameState.totalOrders >= r.orders && (!next || gameState.totalOrders < next.orders);
            });
            let nextRank = RANGES[RANGES.indexOf(currentRank) + 1];
            
            document.getElementById('rankIcon').innerText = currentRank.icon;
            document.getElementById('rankName').innerText = currentRank.name;
            document.getElementById('rankBonus').innerText = `–ë–æ–Ω—É—Å —Ä–∞–Ω–≥–∞: +${(currentRank.bonus*100).toFixed(0)}%`;
            
            if (nextRank) {
                document.getElementById('rankNext').innerText = `–î–æ —Ä–∞–Ω–≥–∞ ${nextRank.name}: ${nextRank.orders - gameState.totalOrders} –∑–∞–∫–∞–∑–æ–≤`;
                let progress = ((gameState.totalOrders - currentRank.orders) / (nextRank.orders - currentRank.orders)) * 100;
                document.getElementById('rankProgress').style.width = progress + "%";
            } else {
                document.getElementById('rankNext').innerText = "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–Ω–≥";
                document.getElementById('rankProgress').style.width = "100%";
            }

            // Stats
            document.getElementById('totalOrders').innerText = gameState.totalOrders;
            document.getElementById('totalEarned').innerText = gameState.totalEarned.toFixed(2);
            document.getElementById('deaths').innerText = gameState.deaths;

            // Quests Render
            renderQuests();
            
            // Shops Render (Only if tab active to save perf, but simplified here)
            renderShops(isBlind);
            
            // Districts Render
            renderDistricts();

            // Active Effects
            let effText = "";
            if (Date.now() < activeBuffs.no_energy_drain) {
                effText += "‚ö° –≠–Ω–µ—Ä–≥–µ—Ç–∏–∫ (No Energy Drain)\n";
            }
            document.getElementById('activeEffectsText').innerText = effText || "–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤";
        }

        function renderQuests() {
            let container = document.getElementById('dailyQuestsContainer');
            container.innerHTML = "";
            dailyQuests.forEach(q => {
                let pct = Math.min(100, (q.progress / q.target) * 100);
                let color = q.isCompleted ? "#4caf50" : "#2196f3";
                
                let html = `
                <div class="quest-item">
                    <div class="quest-header">
                        <span>${q.text}</span>
                        <span>${Math.floor(q.progress)}/${q.target}</span>
                    </div>
                    <div class="quest-progress-bg">
                        <div class="quest-progress-fill" style="width: ${pct}%; background-color: ${color};"></div>
                    </div>
                </div>
                `;
                container.innerHTML += html;
            });
        }

        function renderShops(isBlind) {
            let consContainer = document.getElementById('shopConsumables');
            consContainer.innerHTML = "";
            CONSUMABLES.forEach(item => {
                let priceDisplay = isBlind ? "???" : item.cost + " PLN";
                consContainer.innerHTML += `
                <div class="shop-item">
                    <div class="shop-info">
                        <span class="shop-name">${item.name}</span>
                        <span class="shop-desc">${item.desc ? item.desc : (item.type === 'water' ? '+Water' : '+Energy')}</span>
                    </div>
                    <button class="btn" style="width:auto; margin:0;" onclick="buyConsumable('${item.id}')">${priceDisplay}</button>
                </div>`;
            });

            let transContainer = document.getElementById('shopTransport');
            transContainer.innerHTML = "";
            for (let key in TRANSPORTS) {
                if(key === 'feet') continue;
                let t = TRANSPORTS[key];
                let priceDisplay = isBlind ? "???" : t.cost + " PLN";
                transContainer.innerHTML += `
                <div class="shop-item">
                    <div class="shop-info">
                        <span class="shop-name">${t.name} (x${t.mult})</span>
                    </div>
                    <button class="btn" style="width:auto; margin:0;" onclick="rentTransport('${key}')">${priceDisplay}</button>
                </div>`;
            }
        }

        function renderDistricts() {
            let container = document.getElementById('districtsContainer');
            container.innerHTML = "";
            
            districts.forEach(d => {
                let isCurrent = (gameState.location === d.id);
                let isLocked = gameState.level < d.minLvl;
                
                let statusBadge = "";
                if(isCurrent) statusBadge = "<span class='district-badge' style='background:#4caf50;'>–í–´ –ó–î–ï–°–¨</span>";
                
                let ownershipBadge = "";
                if(d.isOwned) ownershipBadge = "<span class='district-badge' style='background:#ff9800;'>üè† –í–´ –í–õ–ê–î–ï–õ–ï–¶</span>";

                let actionBtn = "";
                if(isCurrent) {
                     actionBtn = `<button class="btn btn-disabled">–í–´ –ó–î–ï–°–¨</button>`;
                } else if (isLocked) {
                     actionBtn = `<button class="btn btn-disabled">–ù—É–∂–µ–Ω LVL ${d.minLvl}</button>`;
                } else {
                     actionBtn = `<button class="btn" onclick="moveDistrict('${d.id}')">–ü–ï–†–ï–ï–•–ê–¢–¨ (150 PLN)</button>`;
                }

                let buyBtn = "";
                if(d.isOwned) {
                    buyBtn = `<button class="btn btn-disabled" style="border: 1px solid #ff9800; color: #ff9800; background:transparent;">–í–õ–ê–î–ï–õ–ï–¶</button>`;
                } else if (d.buyPrice > 0) {
                     buyBtn = `<button class="btn btn-outline" style="color: #ffc107; border-color: #ffc107;" onclick="buyRealEstate('${d.id}')">–ö–£–ü–ò–¢–¨ –ñ–ò–õ–¨–ï (${d.buyPrice/1000}K PLN)</button>`;
                }

                container.innerHTML += `
                <div class="card district-card ${isCurrent ? 'active-district' : ''}">
                    <div class="district-header">
                        <span class="district-name">${d.name} ${d.minLvl > 1 ? '<span style="font-size:0.7rem; color:#f44336;">(LVL '+d.minLvl+'+)</span>' : ''}</span>
                        <div>${statusBadge}</div>
                    </div>
                    <div class="district-stats">
                        ${d.isOwned ? '<span style="color:#4caf50">–ö–≤–∞—Ä—Ç–ø–ª–∞—Ç–∞ (Czynsz): '+d.rent+' PLN</span>' : '–ê—Ä–µ–Ω–¥–∞: '+(d.rentPercent ? (d.rentPercent*100)+'% –æ—Ç –±–∞–ª–∞–Ω—Å–∞' : d.rent + ' PLN')} <br>
                        –î–æ—Ö–æ–¥: x${d.incomeMult}
                    </div>
                    <div style="margin-top:5px;">${ownershipBadge}</div>
                    <div style="margin-top:10px;">
                        ${actionBtn}
                        ${buyBtn}
                    </div>
                </div>
                `;
            });
        }

        // --- UTILS ---
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            // Simple logic to highlight nav icon based on tab index matches would be better but explicit here:
            // ... omitting for brevity, clicking works.
            renderAll();
        }

        function showFloatText(text, target, isFixed = false) {
            let el = document.createElement('div');
            el.className = 'floating-text';
            el.innerText = text;
            
            if (isFixed) {
                el.style.top = '50%';
                el.style.left = '50%';
                el.style.transform = 'translate(-50%, -50%)';
                el.style.color = 'red';
            } else {
                let rect = target.getBoundingClientRect();
                el.style.left = (rect.left + rect.width / 2) + 'px';
                el.style.top = (rect.top) + 'px';
            }
            
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 1000);
        }

        // --- SAVE SYSTEM ---
        function saveGame() {
            let data = {
                gameState: gameState,
                districts: districts,
                dailyQuests: dailyQuests,
                activeBuffs: activeBuffs
            };
            localStorage.setItem(SAVE_KEY, JSON.stringify(data));
        }

        function loadGame() {
            let raw = localStorage.getItem(SAVE_KEY);
            if (raw) {
                try {
                    let data = JSON.parse(raw);
                    // Merge saved state with defaults to prevent crash on new fields
                    gameState = { ...initialState, ...data.gameState };
                    if(data.districts) districts = data.districts;
                    if(data.dailyQuests) dailyQuests = data.dailyQuests;
                    if(data.activeBuffs) activeBuffs = data.activeBuffs;
                } catch (e) {
                    console.error("Save load error", e);
                }
            }
        }

        // Start
        init();

    </script>
</body>
</html>
