<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Courier Simulator Warsaw</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
body{margin:0;font-family:system-ui;background:#fff;overflow:hidden}
#map{height:72vh}
.topbar{
  position:absolute;top:0;left:0;right:0;height:50px;
  background:#fff;display:flex;align-items:center;
  justify-content:space-between;padding:0 12px;
  box-shadow:0 2px 8px rgba(0,0,0,.15);z-index:1000
}
.menuBtn{font-size:22px}
.balance{font-weight:600}
.rep{font-size:13px;color:#555}

#panel{
  position:absolute;bottom:0;left:0;right:0;height:28vh;
  background:#fff;padding:10px;
  box-shadow:0 -6px 20px rgba(0,0,0,.2)
}
button{
  width:100%;padding:14px;font-size:16px;
  border:none;border-radius:12px;
  background:#00aaff;color:#fff;margin-top:6px;font-weight:600
}
.gray{background:#e4eef4;color:#333}

.statline{font-size:13px;margin:4px 0}
.orderBox{background:#f3f8fb;padding:8px;border-radius:10px;margin-top:6px;font-size:14px}

#menu{
  position:absolute;top:0;left:-260px;width:260px;height:100%;
  background:#fff;z-index:2000;
  box-shadow:4px 0 20px rgba(0,0,0,.25);
  transition:.3s;padding:10px
}
#menu.open{left:0}
.menuItem{padding:12px;border-bottom:1px solid #eee;font-size:15px}

.rain{
  position:absolute;top:0;left:0;width:100%;height:100%;
  pointer-events:none;
  background-image:linear-gradient(
    rgba(0,0,255,.2) 1px, transparent 1px);
  background-size:2px 8px;
  animation:rain 0.3s linear infinite;
}
@keyframes rain{to{background-position:0 8px}}
</style>
</head>

<body>

<div id="menu">
  <div class="menuItem"><b>üë§ –ö—É—Ä—å–µ—Ä</b></div>
  <div class="menuItem">üõí –ú–∞–≥–∞–∑–∏–Ω</div>
  <div class="menuItem">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
  <div class="menuItem">üí∞ –§–∏–Ω–∞–Ω—Å—ã</div>
  <div class="menuItem">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
</div>

<div class="topbar">
  <div class="menuBtn" onclick="toggleMenu()">‚ò∞</div>
  <div>
    <div class="balance">üí∞ <span id="money">500</span> PLN</div>
    <div class="rep">‚≠ê –†–µ–ø—É—Ç–∞—Ü–∏—è: <span id="rep">50</span></div>
  </div>
</div>

<div id="map"></div>

<div id="panel">
  <div id="status">üîò –û—Ñ–ª–∞–π–Ω</div>
  <div class="statline">
    üçî –ì–æ–ª–æ–¥: <span id="food">60</span>% |
    üôÇ –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ: <span id="mood">70</span>% |
    ‚ö° –ë–æ–¥—Ä–æ—Å—Ç—å: <span id="energy">100</span>%
  </div>

  <div id="orderBox"></div>

  <button onclick="mainAction()" id="mainBtn">üü¢ –í—ã–π—Ç–∏ –æ–Ω–ª–∞–π–Ω</button>
</div>

<script>
/* ===== –°–û–°–¢–û–Ø–ù–ò–ï ===== */
let s = JSON.parse(localStorage.getItem("courier_full")) || {
  phase:"offline",
  money:500,
  rep:50,
  food:60,
  mood:70,
  energy:100,
  order:null,
  rain:false,
  step:0
};

/* ===== –ö–ê–†–¢–ê ===== */
const map=L.map('map').setView([52.2297,21.0122],13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
let pos=[52.2297,21.0122];
const courier=L.marker(pos).addTo(map);
let route=null;

/* ===== UI ===== */
function updateUI(){
  money.innerText=s.money;
  rep.innerText=s.rep;
  food.innerText=s.food;
  mood.innerText=s.mood;
  energy.innerText=s.energy;
}
function save(){localStorage.setItem("courier_full",JSON.stringify(s));}

/* ===== –ú–ï–ù–Æ ===== */
function toggleMenu(){
  document.getElementById("menu").classList.toggle("open");
}

/* ===== –ó–ê–ö–ê–ó ===== */
function spawnOrder(){
  const dist=(Math.random()*6+2);
  const base=7+dist*2.5;
  const repMod=1+(s.rep/100);
  const rainMod=s.rain?1.2:1;
  const pay=Math.floor(base*repMod*rainMod);

  s.order={
    dist,
    time:Math.floor(dist*4),
    pay
  };

  orderBox.innerHTML=`
    <div class="orderBox">
      üìç –î–∏—Å—Ç–∞–Ω—Ü–∏—è: ${dist.toFixed(1)} –∫–º<br>
      ‚è± –í—Ä–µ–º—è: ${s.order.time} –º–∏–Ω<br>
      üí∞ –û–ø–ª–∞—Ç–∞: ${pay} PLN
    </div>`;
}

/* ===== –û–°–ù–û–í–ù–ê–Ø –õ–û–ì–ò–ö–ê ===== */
function mainAction(){
  if(s.phase==="offline"){
    s.phase="online";
    status.innerText="üü¢ –û–Ω–ª–∞–π–Ω. –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞‚Ä¶";
    mainBtn.innerText="üîî –ñ–¥–∞—Ç—å –∑–∞–∫–∞–∑";
    weatherRoll();
  }
  else if(s.phase==="online"){
    spawnOrder();
    s.phase="delivering";
    status.innerText="üö¥ –î–æ—Å—Ç–∞–≤–∫–∞ –Ω–∞—á–∞–ª–∞—Å—å";
    mainBtn.innerText="üö¥ –ï—Ö–∞—Ç—å";
  }
  else if(s.phase==="delivering"){
    move();
  }
  save();updateUI();
}

/* ===== –î–í–ò–ñ–ï–ù–ò–ï ===== */
function move(){
  s.energy-=3;
  s.food-=2;
  s.mood-=1;

  s.step++;
  if(s.step>=s.order.time){
    finishOrder();
  }
}

/* ===== –§–ò–ù–ò–® ===== */
function finishOrder(){
  if(s.energy<=0){
    s.money-=20;
    s.rep-=5;
    status.innerText="‚ùå –ó–∞–∫–∞–∑ —Å–æ—Ä–≤–∞–Ω. –®—Ç—Ä–∞—Ñ!";
  }else{
    s.money+=s.order.pay;
    s.rep+=2;
    status.innerText="‚úÖ –ó–∞–∫–∞–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω";
  }
  s.phase="online";
  s.step=0;
  orderBox.innerHTML="";
  mainBtn.innerText="üîî –ñ–¥–∞—Ç—å –∑–∞–∫–∞–∑";
}

/* ===== –ü–û–ì–û–î–ê ===== */
function weatherRoll(){
  s.rain=Math.random()<0.3;
  if(s.rain){
    const rain=document.createElement("div");
    rain.className="rain";
    document.body.appendChild(rain);
    setTimeout(()=>rain.remove(),6000);
  }
}

/* INIT */
updateUI();
</script>

</body>
</html>
