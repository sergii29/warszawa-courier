<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Courier Simulator</title>
    <style>
        :root {
            --bg-color: #121212;
            --text-color: #e0e0e0;
            --accent-color: #bb86fc;
            --secondary-bg: #1e1e1e;
            --success-color: #03dac6;
            --danger-color: #cf6679;
            --warning-color: #ffb74d;
            --font-main: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: var(--font-main);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
            user-select: none;
        }

        /* --- HEADER (ORIGINAL) --- */
        header {
            background-color: var(--secondary-bg);
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
            z-index: 10;
        }

        .status-bar {
            display: flex;
            flex-direction: column;
            gap: 2px;
            font-size: 0.9rem;
        }

        .status-row {
            display: flex;
            gap: 15px;
        }

        .money { color: var(--success-color); font-weight: bold; }
        .level { color: var(--accent-color); }
        .time { color: var(--warning-color); font-size: 0.8rem; }

        .settings-btn {
            background: none;
            border: 1px solid var(--text-color);
            color: var(--text-color);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* --- CONTENT --- */
        #game-area {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            position: relative;
        }

        .tab-content { display: none; animation: fadeIn 0.3s ease; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* --- STATS --- */
        .stats-container {
            background-color: var(--secondary-bg);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .stat-item { margin-bottom: 10px; }
        .stat-label { display: flex; justify-content: space-between; font-size: 0.85rem; margin-bottom: 3px; }
        .progress-bar-bg { background-color: #333; height: 10px; border-radius: 5px; overflow: hidden; }
        .progress-bar-fill { height: 100%; transition: width 0.5s ease; }

        /* --- CARDS & ACTIONS --- */
        .action-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        .card {
            background-color: var(--secondary-bg);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #333;
            transition: transform 0.1s;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100px;
        }
        .card:active { transform: scale(0.98); }
        .card.disabled { opacity: 0.5; pointer-events: none; border-color: #444; }
        .card h3 { margin: 0 0 5px 0; font-size: 1rem; }
        .card p { margin: 0; font-size: 0.8rem; color: #aaa; }
        .card .cost { color: var(--warning-color); font-size: 0.8rem; margin-top: 5px; }

        /* --- SHOP LIST --- */
        .shop-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #252525;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 8px;
        }
        .shop-item-info { display: flex; flex-direction: column; }
        .shop-item-name { font-weight: bold; font-size: 0.95rem; }
        .shop-item-desc { font-size: 0.75rem; color: #aaa; }
        .shop-btn {
            background: var(--accent-color);
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            color: #000;
            font-weight: bold;
            font-size: 0.8rem;
            min-width: 70px;
            cursor: pointer;
        }
        .shop-btn:disabled { background: #444; color: #888; cursor: not-allowed; }

        /* --- BOTTLES --- */
        #bottle-area { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; overflow: hidden; }
        .bottle {
            position: absolute;
            font-size: 24px;
            cursor: pointer;
            pointer-events: auto;
            animation: float 3s infinite ease-in-out;
            padding: 15px;
        }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        /* --- NAVIGATION --- */
        nav {
            background-color: var(--secondary-bg);
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            border-top: 1px solid #333;
        }
        .nav-btn {
            background: none;
            border: none;
            color: #777;
            font-size: 0.7rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
        }
        .nav-btn.active { color: var(--accent-color); }
        .nav-btn span { font-size: 1.2rem; margin-bottom: 2px; }

        /* --- MODAL (ADMIN) --- */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: var(--secondary-bg);
            padding: 20px;
            border-radius: 10px;
            width: 85%;
            max-width: 320px;
            text-align: center;
            border: 1px solid var(--accent-color);
            max-height: 85vh;
            overflow-y: auto;
        }
        .modal input {
            width: 90%;
            padding: 8px;
            margin: 5px 0;
            background: #333;
            border: 1px solid #555;
            color: white;
            border-radius: 5px;
        }
        .modal label {
            display: block;
            text-align: left;
            margin-top: 10px;
            font-size: 0.8rem;
            color: #aaa;
        }
        .modal button {
            background: var(--accent-color);
            border: none;
            padding: 8px;
            border-radius: 5px;
            color: black;
            font-weight: bold;
            cursor: pointer;
            margin: 10px 0 0 0;
            width: 100%;
        }

        /* --- PENALTY OVERLAY --- */
        #penalty-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 9999;
            color: red;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
        }
        .job-status { font-size: 0.8rem; color: var(--success-color); margin-top: 5px; }
        .bonus-desc { font-size: 0.7rem; color: #888; margin-top: 2px; font-style: italic; }
    </style>
</head>
<body>

    <div id="penalty-overlay">
        <h1>–°–ò–°–¢–ï–ú–ê –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù–ê</h1>
        <p>–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å.</p>
        <p id="penalty-timer">10:00</p>
    </div>

    <header>
        <div class="status-bar">
            <div class="status-row">
                <span class="money" id="money-display">0 PLN</span>
                <span class="level" id="level-display">LVL 1</span>
            </div>
            <div class="time" id="game-time">–î–µ–Ω—å 1, 08:00</div>
        </div>
        <button class="settings-btn" onclick="openAdmin()">‚öôÔ∏è</button>
    </header>

    <div id="game-area">
        <div id="tab-home" class="tab-content active">
            <div class="stats-container">
                <div class="stat-item">
                    <div class="stat-label"><span>–ó–¥–æ—Ä–æ–≤—å–µ</span><span id="health-val">100%</span></div>
                    <div class="progress-bar-bg"><div class="progress-bar-fill" id="health-bar" style="width: 100%; background: #cf6679;"></div></div>
                </div>
                <div class="stat-item">
                    <div class="stat-label"><span>–≠–Ω–µ—Ä–≥–∏—è</span><span id="energy-val">100%</span></div>
                    <div class="progress-bar-bg"><div class="progress-bar-fill" id="energy-bar" style="width: 100%; background: #ffb74d;"></div></div>
                </div>
                <div class="stat-item">
                    <div class="stat-label"><span>–°—ã—Ç–æ—Å—Ç—å</span><span id="hunger-val">100%</span></div>
                    <div class="progress-bar-bg"><div class="progress-bar-fill" id="hunger-bar" style="width: 100%; background: #03dac6;"></div></div>
                </div>
                <div class="stat-item">
                    <div class="stat-label"><span>–í–æ–¥–∞</span><span id="thirst-val">100%</span></div>
                    <div class="progress-bar-bg"><div class="progress-bar-fill" id="thirst-bar" style="width: 100%; background: #2196f3;"></div></div>
                </div>
                <div class="stat-item">
                    <div class="stat-label"><span>–°—á–∞—Å—Ç—å–µ</span><span id="happiness-val">50%</span></div>
                    <div class="progress-bar-bg"><div class="progress-bar-fill" id="happiness-bar" style="width: 50%; background: #e040fb;"></div></div>
                </div>
            </div>

            <h3>–î–µ–π—Å—Ç–≤–∏—è</h3>
            <div class="action-grid">
                <div class="card" onclick="collectBottlesMode()">
                    <h3>üçæ –°–æ–±–∏—Ä–∞—Ç—å –±—É—Ç—ã–ª–∫–∏</h3>
                    <p>–ò—Å–∫–∞—Ç—å —Ç–∞—Ä—É –Ω–∞ —É–ª–∏—Ü–µ</p>
                    <p class="cost">+ –≠–Ω–µ—Ä–≥–∏—è —Ç—Ä–∞—Ç–∏—Ç—Å—è</p>
                </div>
                <div class="card" onclick="begMoney()">
                    <h3>ü§≤ –ü–æ–ø—Ä–æ—à–∞–π–Ω–∏—á–∞—Ç—å</h3>
                    <p>–ü—Ä–æ—Å–∏—Ç—å –º–µ–ª–æ—á—å —É –ø—Ä–æ—Ö–æ–∂–∏—Ö</p>
                    <p class="cost">-5 –°—á–∞—Å—Ç—å—è</p>
                </div>
                <div class="card" onclick="sleep()">
                    <h3>üí§ –°–ø–∞—Ç—å</h3>
                    <p>–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —ç–Ω–µ—Ä–≥–∏—é</p>
                    <p class="cost">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</p>
                </div>
            </div>
            
            <div style="margin-top: 20px;">
                <h3>–í–∞—à–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ</h3>
                <p id="current-housing">–ñ–∏–ª—å–µ: –£–ª–∏—Ü–∞</p>
                <p id="current-transport">–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç: –ü–µ—à–∫–æ–º</p>
            </div>
        </div>

        <div id="tab-career" class="tab-content">
            <h3>–†–∞–±–æ—Ç–∞</h3>
            <div class="action-grid" id="jobs-container"></div>
        </div>

        <div id="tab-shop" class="tab-content">
            <h3>–ú–∞–≥–∞–∑–∏–Ω</h3>
            <div id="shop-container"></div>
        </div>
    </div>

    <div id="bottle-overlay" style="display:none; position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:50;">
        <div id="bottle-area"></div>
        <button onclick="stopCollecting()" style="position:absolute; bottom:80px; left:50%; transform:translateX(-50%); padding:10px 20px; background:var(--danger-color); border:none; color:white; border-radius:5px; pointer-events:auto;">–ó–∞–∫–æ–Ω—á–∏—Ç—å —Å–±–æ—Ä</button>
        <div style="position:absolute; top:20px; width:100%; text-align:center; color:white; pointer-events:none;">–ù–∞–∂–∏–º–∞–π –Ω–∞ –±—É—Ç—ã–ª–∫–∏!</div>
    </div>

    <nav>
        <button class="nav-btn active" onclick="switchTab('home')"><span>üè†</span>–ì–ª–∞–≤–Ω–∞—è</button>
        <button class="nav-btn" onclick="switchTab('career')"><span>üíº</span>–ö–∞—Ä—å–µ—Ä–∞</button>
        <button class="nav-btn" onclick="switchTab('shop')"><span>üõí</span>–ú–∞–≥–∞–∑–∏–Ω</button>
    </nav>

    <div id="admin-modal" class="modal">
        <div class="modal-content">
            <h3>–ê–¥–º–∏–Ω–∫–∞</h3>
            <input type="password" id="admin-pass" placeholder="–ü–∞—Ä–æ–ª—å (WARSZAWA)">
            
            <div id="admin-controls" style="display:none; text-align: left;">
                <label>–ú–Ω–æ–∂–∏—Ç–µ–ª—å –ó–ü (x): <input type="number" id="setting-salary" step="0.1"></label>
                <label>–ú–Ω–æ–∂–∏—Ç–µ–ª—å –ù–∞–ª–æ–≥–∞ (x): <input type="number" id="setting-rent" step="0.1"></label>
                <label>–ú–Ω–æ–∂–∏—Ç–µ–ª—å –¶–µ–Ω (x): <input type="number" id="setting-shop" step="0.1"></label>
                <label>–ë—É—Ç—ã–ª–∫–∏ (–ú–∏–Ω-–ú–∞–∫—Å):</label>
                <div style="display:flex; gap:5px;">
                    <input type="number" id="setting-bottle-min" step="0.1">
                    <input type="number" id="setting-bottle-max" step="0.1">
                </div>
                <button onclick="saveAdminSettings()" style="background: var(--success-color);">–ü—Ä–∏–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                <div style="margin-top:10px; border-top:1px solid #444; padding-top:10px;">
                    <button onclick="adminAddMoney()">+1000 PLN</button>
                    <button onclick="adminAddLevel()">+1 –£—Ä–æ–≤–µ–Ω—å</button>
                    <button onclick="adminReset()" style="background: var(--danger-color);">–°–±—Ä–æ—Å –∏–≥—Ä—ã</button>
                </div>
                <button onclick="closeAdmin()" style="background: #444;">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
            
            <button id="admin-login-btn" onclick="checkAdmin()">–í–æ–π—Ç–∏</button>
            <button id="admin-close-btn" onclick="closeAdmin()">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <script>
        const SAVE_KEY = 'WARSZAWA_FOREVER';
        
        // Data
        const BASE_HOUSING = {
            'street': { name: "–£–ª–∏—Ü–∞", recovery: 1, price: 0 },
            'hostel': { name: "–•–æ—Å—Ç–µ–ª", recovery: 2, price: 50 }, 
            'apartment': { name: "–ö–≤–∞—Ä—Ç–∏—Ä–∞", recovery: 4, price: 150 }
        };
        const BASE_JOBS = [
            { id: 'courier', name: "–ö—É—Ä—å–µ—Ä Glovo", reqLvl: 2, salary: 25, energyCost: 10, waterCost: 15, type: 'manual', desc: "–î–æ—Å—Ç–∞–≤–∫–∞ –µ–¥—ã. –¢—Ä–∞—Ç–∏—Ç –≤–æ–¥—É –∏ —ç–Ω–µ—Ä–≥–∏—é!" },
            { id: 'uber', name: "–¢–∞–∫—Å–∏ Uber", reqLvl: 5, salary: 60, energyCost: 15, waterCost: 10, type: 'manual', reqTransport: 'car', desc: "–ù—É–∂–Ω–∞ –º–∞—à–∏–Ω–∞." },
            { id: 'office', name: "–û—Ñ–∏—Å –ü–ª–∞–Ω–∫—Ç–æ–Ω", reqLvl: 10, salary: 150, energyCost: 20, waterCost: 5, type: 'shift', desc: "–°—Ç–∞–±–∏–ª—å–Ω–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞." }
        ];
        const BASE_SHOP = [
            { id: 'water', name: "–í–æ–¥–∞ 0.5–ª", price: 3, type: 'consumable', effect: { thirst: 30 }, desc: "–£—Ç–æ–ª—è–µ—Ç –∂–∞–∂–¥—É" },
            { id: 'bread', name: "–ë—É–ª–∫–∞", price: 5, type: 'consumable', effect: { hunger: 20 }, desc: "–î–µ—à–µ–≤–∞—è –µ–¥–∞" },
            { id: 'kebab', name: "–ö–µ–±–∞–±", price: 25, type: 'consumable', effect: { hunger: 60, happiness: 5 }, desc: "–í–∫—É—Å–Ω–æ –∏ —Å—ã—Ç–Ω–æ" },
            { id: 'energy_drink', name: "–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫", price: 15, type: 'consumable', effect: { energy: 40, thirst: -10 }, special: 'stop_energy_drain', desc: "–≠–Ω–µ—Ä–≥–∏—è –Ω–µ —Ç—Ä–∞—Ç–∏—Ç—Å—è" },
            { id: 'medkit', name: "–ê–ø—Ç–µ—á–∫–∞", price: 50, type: 'consumable', effect: { health: 30 }, desc: "–õ–µ—á–∏—Ç —Ä–∞–Ω—ã" },
            { id: 'scooter', name: "–ö—É–ø–∏—Ç—å –°–∞–º–æ–∫–∞—Ç", price: 500, type: 'transport', itemKey: 'scooter', desc: "–î–≤–∏–∂–µ–Ω–∏–µ x1.5" },
            { id: 'car', name: "–ö—É–ø–∏—Ç—å –ê–≤—Ç–æ", price: 5000, type: 'transport', itemKey: 'car', desc: "–î–≤–∏–∂–µ–Ω–∏–µ x3" },
            { id: 'rent_hostel', name: "–°–Ω—è—Ç—å –•–æ—Å—Ç–µ–ª (—Å—É—Ç–∫–∏)", price: 50, type: 'housing', itemKey: 'hostel', desc: "–õ—É—á—à–∏–π —Å–æ–Ω" },
            { id: 'rent_apt', name: "–°–Ω—è—Ç—å –ö–≤–∞—Ä—Ç–∏—Ä—É (—Å—É—Ç–∫–∏)", price: 150, type: 'housing', itemKey: 'apartment', desc: "–ú–∞–∫—Å. –∫–æ–º—Ñ–æ—Ä—Ç" }
        ];

        let state = {
            money: 0, level: 1, xp: 0, xpToNext: 100,
            time: { day: 1, hour: 8, minute: 0 },
            stats: { health: 100, energy: 100, hunger: 100, thirst: 100, happiness: 50 },
            housing: 'street', transport: 'feet',
            energyDrinkActive: false, energyDrinkTimer: 0,
            penaltyMode: false, penaltyEndTime: 0,
            settings: { salaryMult: 1, rentMult: 1, shopPriceMult: 1, bottleMin: 0.5, bottleMax: 2.5 },
            initialStateSnapshot: null
        };

        let bottleInterval, penaltyTimer, gameLoop;

        function init() {
            loadGame();
            renderJobs();
            setupShop();
            updateUI();
            gameLoop = setInterval(gameTick, 2000);
            setInterval(saveGame, 10000);
        }

        function saveGame() { localStorage.setItem(SAVE_KEY, JSON.stringify(state)); }
        function loadGame() {
            const s = localStorage.getItem(SAVE_KEY);
            if(s) {
                const p = JSON.parse(s);
                state = { ...state, ...p, settings: { ...state.settings, ...(p.settings || {}) } };
                if(state.penaltyMode) activatePenalty(true);
            } else {
                state.initialStateSnapshot = JSON.parse(JSON.stringify(state));
            }
        }
        function resetGame() { localStorage.removeItem(SAVE_KEY); location.reload(); }

        // --- CALCS ---
        function getSalary(v) { return Math.floor(v * state.settings.salaryMult); }
        function getRent(v) { return Math.floor(v * state.settings.rentMult); }
        function getPrice(v) { return Math.floor(v * state.settings.shopPriceMult); }

        function gameTick() {
            state.time.minute += 10;
            if(state.time.minute >= 60) {
                state.time.minute = 0; state.time.hour++;
                if(state.time.hour >= 24) { state.time.hour = 0; state.time.day++; dailyReset(); }
            }
            changeStat('hunger', -1); changeStat('thirst', -1.5);
            if(state.energyDrinkTimer > 0) {
                state.energyDrinkTimer -= 10;
                if(state.energyDrinkTimer <= 0) { state.energyDrinkActive = false; notify("–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫ –∫–æ–Ω—á–∏–ª—Å—è"); }
            }
            if(state.stats.health <= 0) { alert("Game Over"); resetGame(); }
            updateUI();
        }

        function dailyReset() {
            const h = BASE_HOUSING[state.housing];
            if(h.price > 0) {
                const cost = getRent(h.price);
                if(state.money >= cost) { state.money -= cost; notify(`–ù–∞–ª–æ–≥ –∑–∞ –∂–∏–ª—å–µ: -${cost}`); }
                else { state.housing = 'street'; notify("–í—ã—Å–µ–ª–µ–Ω–∏–µ!"); }
            }
        }

        function changeStat(key, val) {
            if(key === 'energy' && val < 0 && state.energyDrinkActive) return;
            state.stats[key] = Math.max(0, Math.min(100, state.stats[key] + val));
        }

        function addMoney(v) {
            if(state.penaltyMode) v = (Math.random()>0.5 ? v*2 : v*0.5);
            state.money += v;
            addXP(v*0.1);
            if(!state.penaltyMode) showText(`+${v.toFixed(1)}`, event?.clientX||200, event?.clientY||200);
        }
        function addXP(v) {
            state.xp += v;
            if(state.xp >= state.xpToNext) { state.level++; state.xp=0; state.xpToNext*=1.5; notify("Level Up!"); renderJobs(); }
        }

        // --- ACTIONS ---
        function collectBottlesMode() { document.getElementById('bottle-overlay').style.display = 'block'; spawnBottle(); bottleInterval = setInterval(() => { if(Math.random()>0.3) spawnBottle(); }, 800); }
        function stopCollecting() { document.getElementById('bottle-overlay').style.display = 'none'; clearInterval(bottleInterval); document.getElementById('bottle-area').innerHTML=''; }
        function spawnBottle() {
            const b = document.createElement('div'); b.className = 'bottle'; b.textContent = 'üçæ';
            b.style.left = Math.random()*80+10+'%'; b.style.top = Math.random()*80+10+'%';
            const pick = (e) => {
                e.preventDefault(); e.stopPropagation(); b.remove();
                changeStat('energy', -1); changeStat('thirst', -1);
                addMoney(Math.random()*(state.settings.bottleMax - state.settings.bottleMin) + state.settings.bottleMin);
            };
            b.onmousedown = pick; b.ontouchstart = pick;
            document.getElementById('bottle-area').appendChild(b);
            setTimeout(()=>b.remove(), 4000);
        }
        
        function begMoney() { changeStat('happiness', -5); changeStat('energy', -2); Math.random()>0.6 ? addMoney(Math.random()*5) : notify("–ù–µ—Ç –¥–µ–Ω–µ–≥..."); updateUI(); }
        function sleep() { 
            changeStat('energy', 20 * BASE_HOUSING[state.housing].recovery); 
            changeStat('hunger', -10); state.time.hour += 2; notify("–°–æ–Ω..."); updateUI(); 
        }

        function renderJobs() {
            const c = document.getElementById('jobs-container'); c.innerHTML = '';
            BASE_JOBS.forEach(j => {
                const locked = state.level < j.reqLvl;
                const d = document.createElement('div'); d.className = `card ${locked?'disabled':''}`;
                d.innerHTML = `<h3>${j.name}</h3><p>${j.desc}</p><p class="job-status">${locked?`LVL ${j.reqLvl}`:`–ó–ü: ${getSalary(j.salary)}`}</p>`;
                if(!locked) d.onclick = () => {
                    if(state.stats.energy < j.energyCost || state.stats.thirst < j.waterCost) { notify("–£—Å—Ç–∞–ª–æ—Å—Ç—å/–ñ–∞–∂–¥–∞"); return; }
                    if(j.reqTransport && state.transport !== j.reqTransport && state.transport !== 'car') { notify("–ù—É–∂–µ–Ω "+j.reqTransport); return; }
                    changeStat('energy', -j.energyCost); changeStat('thirst', -j.waterCost);
                    state.time.minute += 30; addMoney(getSalary(j.salary)); updateUI();
                };
                c.appendChild(d);
            });
        }

        function setupShop() {
            const c = document.getElementById('shop-container'); c.innerHTML = '';
            BASE_SHOP.forEach(i => {
                const d = document.createElement('div'); d.className = 'shop-item'; d.id = `shop-${i.id}`;
                d.innerHTML = `<div class="shop-item-info"><span class="shop-item-name">${i.name}</span><span class="shop-item-desc">${i.desc}</span><span class="shop-item-desc price"></span></div><button class="shop-btn" onclick="buy('${i.id}')">–ö—É–ø–∏—Ç—å</button>`;
                c.appendChild(d);
            });
        }
        function updateShop() {
            BASE_SHOP.forEach(i => {
                const p = getPrice(i.price);
                const r = document.getElementById(`shop-${i.id}`);
                if(r) {
                    r.querySelector('.price').textContent = `${p} PLN`;
                    const b = r.querySelector('button');
                    b.disabled = state.money < p;
                    b.textContent = state.money < p ? "..." : "–ö—É–ø–∏—Ç—å";
                }
            });
        }
        function buy(id) {
            const i = BASE_SHOP.find(x => x.id === id); const p = getPrice(i.price);
            if(state.money >= p) {
                state.money -= p;
                if(i.type === 'consumable') {
                    if(i.effect) for(let k in i.effect) changeStat(k, i.effect[k]);
                    if(i.special === 'stop_energy_drain') { state.energyDrinkActive = true; state.energyDrinkTimer = 60; }
                }
                else if(i.type === 'transport') state.transport = i.itemKey;
                else if(i.type === 'housing') state.housing = i.itemKey;
                updateUI();
            }
        }

        function switchTab(t) {
            document.querySelectorAll('.tab-content').forEach(e => e.classList.remove('active'));
            document.getElementById(`tab-${t}`).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            // simple nav highlight logic
            if(t==='home') document.querySelectorAll('.nav-btn')[0].classList.add('active');
            if(t==='career') { renderJobs(); document.querySelectorAll('.nav-btn')[1].classList.add('active'); }
            if(t==='shop') { updateShop(); document.querySelectorAll('.nav-btn')[2].classList.add('active'); }
        }

        function updateUI() {
            document.getElementById('money-display').textContent = state.penaltyMode ? '???' : Math.floor(state.money) + ' PLN';
            document.getElementById('level-display').textContent = 'LVL ' + state.level;
            document.getElementById('game-time').textContent = `–î ${state.time.day}, ${String(state.time.hour).padStart(2,'0')}:${String(state.time.minute).padStart(2,'0')}`;
            
            ['health','energy','hunger','thirst','happiness'].forEach(k => {
                document.getElementById(`${k}-val`).textContent = Math.floor(state.stats[k]) + '%';
                document.getElementById(`${k}-bar`).style.width = state.stats[k] + '%';
            });
            document.getElementById('current-housing').textContent = `–ñ–∏–ª—å–µ: ${BASE_HOUSING[state.housing].name}`;
            document.getElementById('current-transport').textContent = `–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç: ${state.transport === 'feet' ? '–ü–µ—à–∫–æ–º' : (state.transport === 'scooter' ? '–°–∞–º–æ–∫–∞—Ç' : '–ê–≤—Ç–æ')}`;
            if(document.getElementById('tab-shop').classList.contains('active')) updateShop();
        }

        // --- ADMIN ---
        function openAdmin() { 
            document.getElementById('admin-modal').style.display = 'flex'; 
            document.getElementById('setting-salary').value = state.settings.salaryMult;
            document.getElementById('setting-rent').value = state.settings.rentMult;
            document.getElementById('setting-shop').value = state.settings.shopPriceMult;
            document.getElementById('setting-bottle-min').value = state.settings.bottleMin;
            document.getElementById('setting-bottle-max').value = state.settings.bottleMax;
        }
        function closeAdmin() { 
            document.getElementById('admin-modal').style.display = 'none'; 
            document.getElementById('admin-controls').style.display='none';
            document.getElementById('admin-login-btn').style.display='inline-block';
            document.getElementById('admin-pass').value = '';
        }
        function checkAdmin() {
            if(document.getElementById('admin-pass').value === 'WARSZAWA') {
                document.getElementById('admin-controls').style.display='block';
                document.getElementById('admin-login-btn').style.display='none';
            } else alert("–û—à–∏–±–∫–∞");
        }
        function saveAdminSettings() {
            state.settings.salaryMult = parseFloat(document.getElementById('setting-salary').value)||1;
            state.settings.rentMult = parseFloat(document.getElementById('setting-rent').value)||1;
            state.settings.shopPriceMult = parseFloat(document.getElementById('setting-shop').value)||1;
            state.settings.bottleMin = parseFloat(document.getElementById('setting-bottle-min').value)||0.5;
            state.settings.bottleMax = parseFloat(document.getElementById('setting-bottle-max').value)||2.5;
            saveGame(); updateUI(); renderJobs(); alert("OK");
        }
        function adminAddMoney() { addMoney(1000); updateUI(); }
        function adminAddLevel() { if(confirm("–õ–µ–≥–∞–ª—å–Ω–æ? –ù–µ—Ç=–ß–∏—Ç")) { state.level++; renderJobs(); updateUI(); } else { activatePenalty(); closeAdmin(); } }
        
        function activatePenalty(resume=false) {
            state.penaltyMode = true;
            document.getElementById('penalty-overlay').style.display = 'flex';
            if(!resume) state.penaltyEndTime = Date.now() + 600000;
            penaltyTimer = setInterval(() => {
                let left = state.penaltyEndTime - Date.now();
                if(left <= 0) {
                    state.penaltyMode = false; clearInterval(penaltyTimer);
                    document.getElementById('penalty-overlay').style.display = 'none';
                    alert("–®—Ç—Ä–∞—Ñ –æ–∫–æ–Ω—á–µ–Ω"); saveGame(); location.reload();
                } else {
                    document.getElementById('penalty-timer').textContent = Math.floor(left/60000) + ":" + String(Math.floor((left%60000)/1000)).padStart(2,'0');
                }
            }, 1000);
        }

        function notify(t) { showText(t, window.innerWidth/2, window.innerHeight-100); }
        function showText(t, x, y) {
            const e = document.createElement('div'); e.textContent = t;
            e.style.cssText = `position:fixed;left:${x}px;top:${y}px;color:#fff;background:rgba(0,0,0,0.7);padding:5px;border-radius:5px;pointer-events:none;transition:1s;z-index:1000;`;
            document.body.appendChild(e);
            setTimeout(() => { e.style.top = (y-50)+'px'; e.style.opacity=0; }, 50);
            setTimeout(() => e.remove(), 1000);
        }

        window.onload = init;
    </script>
</body>
</html>
