<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Warsaw Courier: Stable</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <style>
        :root {
            --bg: #f4f4dc; --grid: #dcdcc0; --lime: #ccff00; --dark: #121212; --danger: #ff3b3b;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; user-select: none; font-family: 'Courier New', monospace; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: var(--bg); }

        /* –ò–ì–†–û–í–û–ï –ü–û–õ–ï (–°—Ç—Ä–æ–≥–∞—è –ø–æ–∑–∏—Ü–∏—è) */
        #game-area {
            position: absolute; top: 140px; left: 0; right: 0; bottom: 260px;
            background-image: linear-gradient(var(--grid) 1px, transparent 1px), linear-gradient(90deg, var(--grid) 1px, transparent 1px);
            background-size: 30px 30px; 
            z-index: 1;
            overflow: hidden; /* –û–±—Ä–µ–∑–∞–µ–º –≤—Å–µ —á—Ç–æ –≤—ã–ª–µ—Ç–∞–µ—Ç */
            border-top: 2px solid #ccc; border-bottom: 2px solid #ccc;
        }

        /* –°–£–©–ù–û–°–¢–ò */
        .entity { 
            position: absolute; width: 30px; height: 30px; 
            display: flex; align-items: center; justify-content: center; 
            font-size: 20px; transition: all 0.15s linear; 
        }
        #player { 
            z-index: 100; /* –ò–≥—Ä–æ–∫ –≤—Å–µ–≥–¥–∞ –≤—ã—à–µ –≤—Å–µ—Ö */
            font-size: 24px; 
            background: rgba(200, 255, 0, 0.3); /* –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å */
            border-radius: 50%;
            border: 2px solid var(--dark);
        }
        .police { z-index: 50; transition: top 0.8s linear, left 0.8s linear; }
        .obs { z-index: 10; opacity: 0.7; }

        /* –í–ï–†–•–ù–ò–ô UI */
        #top-ui {
            position: absolute; top: 0; left: 0; width: 100%; height: 140px;
            background: white; z-index: 200; padding: 10px; display: flex; flex-direction: column; align-items: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .wallet { font-size: 22px; font-weight: 900; color: var(--dark); border-bottom: 2px dashed #ccc; width: 100%; text-align: center; padding-bottom: 5px; margin-bottom: 5px;}
        
        .bars { width: 100%; max-width: 300px; display: flex; flex-direction: column; gap: 4px; font-size: 10px; font-weight: bold; }
        .bar-row { display: flex; align-items: center; justify-content: space-between; }
        .bar-track { flex-grow: 1; height: 8px; background: #eee; margin-left: 5px; border: 1px solid #999; border-radius: 4px; overflow: hidden; }
        .bar-val { height: 100%; transition: width 0.3s; }

        /* –ù–ò–ñ–ù–ò–ô UI */
        #bot-ui {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 260px;
            background: white; z-index: 200; border-top: 2px solid var(--dark);
            display: flex; flex-direction: column; align-items: center; padding-top: 10px;
        }

        /* –£–ü–†–ê–í–õ–ï–ù–ò–ï */
        .joy-pad { display: grid; grid-template-columns: 70px 70px 70px; grid-template-rows: 60px 60px; gap: 8px; margin-top: 10px;}
        .j-btn { background: #f0f0f0; border: 1px solid #bbb; border-radius: 12px; font-size: 24px; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 4px 0 #ccc; }
        .j-btn:active { background: #e0e0e0; box-shadow: 0 2px 0 #ccc; transform: translateY(2px); }
        .u { grid-column: 2; grid-row: 1; } .l { grid-column: 1; grid-row: 2; } 
        .d { grid-column: 2; grid-row: 2; } .r { grid-column: 3; grid-row: 2; }

        .btn-main { background: var(--lime); color: black; border: 2px solid black; padding: 15px 40px; font-weight: bold; border-radius: 8px; margin-top: 40px; cursor: pointer; }

        /* MODALS */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; display: none; align-items: center; justify-content: center; }
        .popup { background: white; padding: 20px; border-radius: 10px; text-align: center; width: 80%; max-width: 320px; border: 3px solid var(--lime); }
        
        #toast { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: black; color: white; padding: 10px 20px; border-radius: 20px; z-index: 5000; display: none; }

        /* Side Menu */
        #menu-btn { position: absolute; top: 10px; left: 10px; width: 40px; height: 40px; background: #333; z-index: 201; cursor: pointer; display: flex; flex-direction: column; justify-content: center; align-items: center; gap:4px; border-radius:6px; }
        .ml { width: 24px; height: 2px; background: white; }
        
        #sidebar { position: fixed; top:0; left:-300px; width:280px; height:100%; background:white; z-index:2001; transition:0.3s; border-right:2px solid black; padding:20px; overflow-y:auto; }
        #sidebar.open { left:0; }
        .shop-row { display:flex; justify-content:space-between; padding:10px 0; border-bottom:1px solid #eee; align-items: center; font-size: 12px;}
        .buy-btn { background:var(--dark); color:white; border:none; padding:5px 10px; border-radius:4px; cursor:pointer;}

        /* Debug button */
        .rescue-btn { position: absolute; top: 50px; right: 10px; font-size: 10px; background: red; color: white; padding: 5px; border-radius: 5px; z-index: 5000; opacity: 0.7; cursor: pointer; }
    </style>
</head>
<body>

<div id="top-ui">
    <div class="wallet">üíµ <span id="cash">0.00</span> | üè¶ <span id="bank">0.00</span></div>
    <div style="font-size: 10px; margin-bottom: 5px;">LVL: <span id="lvl">1</span> (–ò–Ω—Ñ–ª—è—Ü–∏—è: <span id="inf">0</span>%)</div>
    
    <div class="bars">
        <div class="bar-row">‚ö° <div class="bar-track"><div id="b-en" class="bar-val" style="width:100%; background:orange"></div></div></div>
        <div class="bar-row">üíß <div class="bar-track"><div id="b-wat" class="bar-val" style="width:100%; background:#00aaff"></div></div></div>
        <div class="bar-row">üö≤ <div class="bar-track"><div id="b-hp" class="bar-val" style="width:100%; background:#555"></div></div></div>
    </div>
</div>

<div id="menu-btn" onclick="toggleMenu()"><div class="ml"></div><div class="ml"></div><div class="ml"></div></div>

<div class="rescue-btn" onclick="forceRescue()">üÜò –ó–ê–°–¢–†–Ø–õ? –ñ–ú–ò</div>

<div id="game-area">
    <div id="player" class="entity">üö≤</div>
    <div id="target" class="entity" style="display:none">üçï</div>
</div>

<div id="bot-ui">
    <div id="status" style="font-weight:bold; margin-bottom:5px; height:20px; color:#555">–°–º–µ–Ω–∞ –Ω–µ –Ω–∞—á–∞—Ç–∞</div>
    <div id="timer" style="color:red; font-weight:900; display:none; margin-bottom:5px">00:00</div>
    
    <button id="btn-start" class="btn-main" onclick="startShift()">–ù–ê–ß–ê–¢–¨ –†–ê–ë–û–¢–£</button>
    <button id="btn-stop" style="display:none; color:red; background:none; border:none; font-weight:bold; margin-top:5px;" onclick="endShift()">–ó–∞–∫–æ–Ω—á–∏—Ç—å —Å–º–µ–Ω—É</button>

    <div id="joy" class="joy-pad" style="display:none">
        <div class="j-btn u" onclick="move(0, -1)">‚Üë</div>
        <div class="j-btn l" onclick="move(-1, 0)">‚Üê</div>
        <div class="j-btn d" onclick="move(0, 1)">‚Üì</div>
        <div class="j-btn r" onclick="move(1, 0)">‚Üí</div>
    </div>
</div>

<div id="sidebar">
    <h3>–ú–ï–ù–Æ</h3>
    <p>–ù–∞–∂–º–∏ —Å–±–æ–∫—É —á—Ç–æ–±—ã –∑–∞–∫—Ä—ã—Ç—å</p>
    <hr>
    <h4>–ú–∞–≥–∞–∑–∏–Ω</h4>
    <div id="shop-list"></div>
    <hr>
    <h4>–ë–∞–Ω–∫</h4>
    <div style="text-align:center">
        <h1>üè¶</h1>
        <button class="buy-btn" onclick="bankAll()">–ü–æ–ª–æ–∂–∏—Ç—å –≤—Å—ë</button>
        <button class="buy-btn" style="background:red" onclick="withdrawAll()">–°–Ω—è—Ç—å –≤—Å—ë</button>
    </div>
    <hr>
    <h4>–ì–∞—Ä–∞–∂</h4>
    <div class="shop-row">
        <span>–ü–æ—á–∏–Ω–∏—Ç—å –±–∞–π–∫</span>
        <button class="buy-btn" onclick="repairBike()">REPAIR</button>
    </div>
    <div style="font-size:10px; color:gray; margin-top:10px">ID: <span id="uid">...</span></div>
</div>
<div id="side-overlay" onclick="toggleMenu()" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:2000; display:none"></div>

<div id="job-modal" class="modal">
    <div class="popup">
        <h2 id="j-name">Pizzeria</h2>
        <p>–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: <span id="j-dist">0</span> –∫–º</p>
        <p style="font-size:18px; color:green; font-weight:bold">–û–ø–ª–∞—Ç–∞: <span id="j-pay">0.00</span> PLN</p>
        <div style="display:flex; gap:10px; justify-content:center; margin-top:15px">
            <button class="buy-btn" style="background:#ccc; color:black" onclick="ansJob(false)">–û—Ç–∫–∞–∑</button>
            <button class="buy-btn" style="background:var(--lime); color:black; font-weight:bold" onclick="ansJob(true)">–í–ó–Ø–¢–¨</button>
        </div>
    </div>
</div>

<div id="toast">Msg</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyChrQMyO2soPgoEHq_f3aYs5Cs19q3sWEk",
        authDomain: "warszawa-courier.firebaseapp.com",
        databaseURL: "https://warszawa-courier-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "warszawa-courier",
        storageBucket: "warszawa-courier.firebasestorage.app",
        messagingSenderId: "295860613508",
        appId: "1:295860613508:web:86fe8364377d6875612dd1"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    
    const tg = window.Telegram.WebApp; tg.expand();
    const userId = tg.initDataUnsafe?.user?.id || 'browser_test_user_v4';
    document.getElementById('uid').innerText = userId;

    // --- CONFIG ---
    const DB_VER = 4; // –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è —Å–±—Ä–æ—Å–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
    const STEP = 30;
    
    let st = {
        bal: 0.00, bank: 0.00, lvl: 1,
        en: 100, wat: 100, hp: 100,
        x: 30, y: 30
    };

    let isShift = false;
    let police = [];
    let obs = [];
    let loops = {};
    let target = { active: false, x:0, y:0, type:0, offer:null };

    // --- INIT ---
    function init() {
        db.ref('users/' + userId).once('value', s => {
            const d = s.val();
            if(d && d.ver === DB_VER) {
                st = {...st, ...d};
            } else {
                // –ï—Å–ª–∏ –≤–µ—Ä—Å–∏—è —Å—Ç–∞—Ä–∞—è - —Å–æ—Ö—Ä–∞–Ω—è–µ–º –¥–µ–Ω—å–≥–∏, –Ω–æ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é
                if(d) {
                    st.bal = d.bal || 0;
                    st.bank = d.bank || 0;
                    st.lvl = d.lvl || 1;
                }
                forceRescue(); // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Å–±—Ä–æ—Å –Ω–∞ —Å—Ç–∞—Ä—Ç
                save();
            }
            render();
            // –ó–∞–ø—É—Å–∫ "–∑–∞—â–∏—Ç–Ω–∏–∫–∞ –≥—Ä–∞–Ω–∏—Ü"
            setInterval(ensureBounds, 2000);
        });
    }

    function save() {
        db.ref('users/' + userId).set({ver: DB_VER, ...st, last: Date.now()});
    }

    // --- CORE MECHANICS ---
    function getInflation() { return 1 + (st.lvl - 1) * 0.1; }
    function price(base) { return Math.ceil(base * getInflation()); }

    function ensureBounds() {
        // –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–µ —É–ª–µ—Ç–µ–ª –ª–∏ –∏–≥—Ä–æ–∫
        const box = document.getElementById('game-area');
        const maxX = box.offsetWidth - 30;
        const maxY = box.offsetHeight - 30;

        let fixed = false;
        if(st.x < 0) { st.x = 0; fixed = true; }
        if(st.y < 0) { st.y = 0; fixed = true; }
        if(st.x > maxX) { st.x = maxX - (maxX%STEP); fixed = true; }
        if(st.y > maxY) { st.y = maxY - (maxY%STEP); fixed = true; }
        
        if(fixed) {
            console.log("Player rescued from void");
            renderPlayer();
            save();
        }
    }

    function forceRescue() {
        st.x = 30; st.y = 30;
        st.en = 100;
        renderPlayer();
        save();
        showToast("–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Å–±—Ä–æ—à–µ–Ω—ã!");
    }

    // --- GAME LOOP ---
    function startShift() {
        if(st.en < 5) return showToast("–ì–æ–ª–æ–¥–µ–Ω!");
        if(st.hp <= 0) return showToast("–í–µ–ª–∏–∫ —Å–ª–æ–º–∞–Ω!");
        
        isShift = true;
        document.getElementById('btn-start').style.display = 'none';
        document.getElementById('joy').style.display = 'grid';
        document.getElementById('btn-stop').style.display = 'block';
        document.getElementById('status').innerText = "–ü–æ–∏—Å–∫...";
        
        spawnWorld();
        newJobPhase(1);
        
        if(loops.pol) clearInterval(loops.pol);
        loops.pol = setInterval(movePolice, 800);
    }

    function endShift() {
        isShift = false;
        clearInterval(loops.timer);
        clearInterval(loops.pol);
        document.getElementById('btn-start').style.display = 'block';
        document.getElementById('joy').style.display = 'none';
        document.getElementById('btn-stop').style.display = 'none';
        document.getElementById('target').style.display = 'none';
        document.getElementById('status').innerText = "–û—Ç–¥—ã—Ö";
        
        obs.forEach(o => o.el.remove()); obs = [];
        police.forEach(p => p.el.remove()); police = [];
        document.getElementById('timer').style.display = 'none';
    }

    function move(dx, dy) {
        if(!isShift) return;
        
        const box = document.getElementById('game-area');
        const maxW = box.offsetWidth;
        const maxH = box.offsetHeight;
        
        let nx = st.x + (dx * STEP);
        let ny = st.y + (dy * STEP);
        
        // –°–¢–†–û–ì–ê–Ø –ü–†–û–í–ï–†–ö–ê –ì–†–ê–ù–ò–¶
        if(nx < 0 || ny < 0 || nx > maxW - 30 || ny > maxH - 30) {
            showToast("–ì—Ä–∞–Ω–∏—Ü–∞!"); return;
        }
        
        if(obs.some(o => Math.abs(o.x - nx) < 10 && Math.abs(o.y - ny) < 10)) {
            showToast("–°—Ç–µ–Ω–∞!"); return;
        }
        
        if(police.some(p => Math.abs(p.x - nx) < 10 && Math.abs(p.y - ny) < 10)) {
            gotCaught(); return;
        }

        st.x = nx; st.y = ny;
        st.en -= 0.5; st.wat -= 0.2; st.hp -= 0.1;
        
        renderPlayer();
        checkJob();
        save();
    }

    // --- POLICE AI ---
    function spawnWorld() {
        const box = document.getElementById('game-area');
        const cols = Math.floor(box.offsetWidth/STEP);
        const rows = Math.floor(box.offsetHeight/STEP);
        
        // Walls
        for(let i=0; i<10; i++) {
            let p = getPos(cols, rows);
            let el = mkEnt('obs', 'üöß', p.x, p.y);
            obs.push({x:p.x, y:p.y, el:el});
        }
        // Police
        for(let i=0; i<6; i++) {
            let p = getPos(cols, rows);
            let el = mkEnt('police', 'üöì', p.x, p.y);
            police.push({x:p.x, y:p.y, el:el});
        }
    }
    
    function movePolice() {
        if(!isShift) return;
        const box = document.getElementById('game-area');
        const maxW = box.offsetWidth;
        const maxH = box.offsetHeight;

        police.forEach(p => {
            let dirs = [{x:0,y:-STEP}, {x:0,y:STEP}, {x:-STEP,y:0}, {x:STEP,y:0}];
            let m = dirs[Math.floor(Math.random()*4)];
            let nx = p.x + m.x; let ny = p.y + m.y;
            
            // AI Bounds Check
            if(nx >= 0 && ny >= 0 && nx <= maxW - 30 && ny <= maxH - 30) {
                p.x = nx; p.y = ny;
                p.el.style.left = nx+'px'; p.el.style.top = ny+'px';
            }
            
            if(Math.abs(p.x - st.x) < 15 && Math.abs(p.y - st.y) < 15) {
                gotCaught();
            }
        });
    }

    function gotCaught() {
        showToast("–ü–û–õ–ò–¶–ò–Ø! -50 PLN");
        st.bal -= 50;
        forceRescue();
    }

    // --- JOBS ---
    function newJobPhase(ph) {
        const box = document.getElementById('game-area');
        const cols = Math.floor(box.offsetWidth/STEP);
        const rows = Math.floor(box.offsetHeight/STEP);
        
        target.type = ph;
        let p = getPos(cols, rows);
        target.x = p.x; target.y = p.y; target.active = true;
        
        const el = document.getElementById('target');
        el.style.display = 'flex';
        el.style.left = p.x+'px'; el.style.top = p.y+'px';
        
        if(ph===1) {
            el.innerText = 'üçï';
            document.getElementById('status').innerText = "–ó–∞–±–µ—Ä–∏ –ø–∏—Ü—Ü—É";
            startTimer(40);
        } else {
            el.innerText = 'üë§';
            document.getElementById('status').innerText = "–í–µ–∑–∏ –∫–ª–∏–µ–Ω—Ç—É!";
            startTimer(20);
        }
    }
    
    function checkJob() {
        if(!target.active) return;
        if(Math.abs(st.x - target.x) < 15 && Math.abs(st.y - target.y) < 15) {
            if(target.type === 1) {
                // –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ
                clearInterval(loops.timer);
                target.active = false;
                let dist = Math.floor(Math.random()*15)+5;
                let pay = (dist * 1.5 * getInflation()).toFixed(2);
                
                target.offer = {dist, pay: parseFloat(pay)};
                
                document.getElementById('j-name').innerText = "Pizza " + Math.floor(Math.random()*100);
                document.getElementById('j-dist').innerText = dist;
                document.getElementById('j-pay').innerText = pay;
                document.getElementById('job-modal').style.display = 'flex';
            } else {
                // –§–∏–Ω–∏—à
                finish(true);
            }
        }
    }
    
    function ansJob(yes) {
        document.getElementById('job-modal').style.display = 'none';
        if(yes) {
            showToast("–í–µ–∑–µ–º!");
            newJobPhase(2);
        } else {
            showToast("–û—Ç–∫–∞–∑ -2 PLN");
            st.bal -= 2; render();
            newJobPhase(1);
        }
    }
    
    function finish(ok) {
        clearInterval(loops.timer);
        target.active = false;
        document.getElementById('target').style.display = 'none';
        document.getElementById('timer').style.display = 'none';
        
        if(ok) {
            let add = target.offer.pay;
            st.bal += add;
            showToast(`+${add} PLN`);
        } else {
            showToast("–í—Ä–µ–º—è –≤—ã—à–ª–æ! -5 PLN");
            st.bal -= 5;
        }
        render(); save();
        setTimeout(() => { if(isShift) newJobPhase(1); }, 1500);
    }

    function startTimer(sec) {
        clearInterval(loops.timer);
        let t = sec;
        document.getElementById('timer').style.display = 'block';
        loops.timer = setInterval(()=>{
            t--;
            document.getElementById('timer').innerText = t + " —Å–µ–∫";
            if(t<=0) finish(false);
        }, 1000);
    }

    // --- UTILS ---
    function mkEnt(cls, ico, x, y) {
        let d = document.createElement('div');
        d.className = 'entity '+cls; d.innerText = ico;
        d.style.left=x+'px'; d.style.top=y+'px';
        document.getElementById('game-area').appendChild(d);
        return d;
    }

    function getPos(c, r) {
        let x, y, ok=false;
        while(!ok) {
            x = Math.floor(Math.random()*(c-1))*STEP;
            y = Math.floor(Math.random()*(r-1))*STEP;
            ok = (Math.abs(x-st.x)>60);
        }
        return {x,y};
    }

    function render() {
        document.getElementById('cash').innerText = st.bal.toFixed(2);
        document.getElementById('bank').innerText = st.bank.toFixed(2);
        document.getElementById('lvl').innerText = st.lvl;
        document.getElementById('inf').innerText = Math.round((getInflation()-1)*100);
        
        document.getElementById('b-en').style.width = st.en + '%';
        document.getElementById('b-wat').style.width = st.wat + '%';
        document.getElementById('b-hp').style.width = st.hp + '%';
        
        renderPlayer();
        updateShop();
    }
    
    function renderPlayer() {
        const p = document.getElementById('player');
        p.style.left = st.x + 'px'; p.style.top = st.y + 'px';
    }

    // --- SHOP & MENU ---
    function toggleMenu() {
        const s = document.getElementById('sidebar');
        const o = document.getElementById('side-overlay');
        if(s.classList.contains('open')) {
            s.classList.remove('open'); o.style.display='none';
        } else {
            s.classList.add('open'); o.style.display='block';
            updateShop();
        }
    }

    function updateShop() {
        const c = document.getElementById('shop-list');
        c.innerHTML = `
            <div class="shop-row"><div>üå≠ –•–æ—Ç-–¥–æ–≥</div> <button class="buy-btn" onclick="buy('en', 20, ${price(8)})">${price(8)}</button></div>
            <div class="shop-row"><div>ü•§ –í–æ–¥–∞</div> <button class="buy-btn" onclick="buy('wat', 30, ${price(5)})">${price(5)}</button></div>
            <div class="shop-row"><div>‚ö° Red Bull</div> <button class="buy-btn" onclick="buy('bull', 50, ${price(15)})">${price(15)}</button></div>
        `;
    }

    function buy(t, v, c) {
        if(st.bal >= c) {
            st.bal -= c;
            if(t==='en' || t==='bull') st.en = Math.min(100, st.en+v);
            if(t==='wat') st.wat = Math.min(100, st.wat+v);
            showToast("–ö—É–ø–ª–µ–Ω–æ"); render(); save();
        } else showToast("–ù–µ—Ç –¥–µ–Ω–µ–≥");
    }

    function repairBike() {
        let c = price(20);
        if(st.bal >= c) {
            st.bal -= c; st.hp = 100; st.lvl++;
            showToast("–ü–æ—á–∏–Ω–∏–ª! LVL UP!"); render(); save();
        } else showToast("–ù–µ—Ç –¥–µ–Ω–µ–≥");
    }

    function bankAll() {
        if(st.bal > 0) { st.bank += st.bal; st.bal = 0; showToast("–í–∫–ª–∞–¥ —Å–¥–µ–ª–∞–Ω"); render(); save(); }
    }
    function withdrawAll() {
        if(st.bank > 0) { st.bal += st.bank; st.bank = 0; showToast("–î–µ–Ω—å–≥–∏ —Å–Ω—è—Ç—ã"); render(); save(); }
    }

    function showToast(m) {
        const t = document.getElementById('toast');
        t.innerText = m; t.style.display = 'block';
        setTimeout(()=>t.style.display='none', 1500);
    }
    
    init();
</script>
</body>
</html>
