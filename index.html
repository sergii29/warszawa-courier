<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Warszawa Courier Simulator</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        :root {
            --bg: #f9f9e8;
            --grid: #e2e2ca;
            --lime: #c8ff00;
            --police: #0055ff;
        }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: var(--bg); font-family: 'Helvetica', sans-serif; }

        /* –ö–∞—Ä—Ç–∞ —Å –º–µ–ª–∫–æ–π —Å–µ—Ç–∫–æ–π */
        #game-board {
            position: relative; width: 100%; height: 65vh;
            background-image: linear-gradient(var(--grid) 1px, transparent 1px), linear-gradient(90deg, var(--grid) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å */
        #header {
            position: absolute; top: 15px; width: 100%; display: flex; flex-direction: column; align-items: center; z-index: 100;
        }
        .city-label { font-size: 10px; font-weight: 900; letter-spacing: 2px; color: #aaa; margin-bottom: 5px; }
        .balance-box { background: white; padding: 10px 25px; border-radius: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); font-weight: bold; font-size: 1.2rem; }

        /* –ú–µ–Ω—é (–¢—Ä–∏ –ø–æ–ª–æ—Å–∫–∏) */
        .burger { position: absolute; left: 20px; top: 20px; font-size: 28px; cursor: pointer; z-index: 1001; }
        #side-menu {
            position: fixed; top: 0; left: -100%; width: 100%; height: 100%; 
            background: rgba(255,255,255,0.95); transition: 0.4s; z-index: 1000; padding-top: 80px;
        }
        #side-menu.open { left: 0; }
        .menu-link { display: block; padding: 20px; font-size: 20px; font-weight: bold; text-align: center; color: #333; text-decoration: none; border-bottom: 1px solid #eee; }

        /* –û–±—ä–µ–∫—Ç—ã */
        .entity { position: absolute; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; z-index: 10; transition: 0.1s; }
        #player { background: var(--lime); border-radius: 50%; border: 2px solid #000; font-size: 12px; }
        .obstacle { font-size: 14px; opacity: 0.5; }

        /* –ü–æ–ª–∏—Ü–∏—è (–í—Å–ø–ª—ã–≤–∞—é—â–µ–µ —Å–æ–±—ã—Ç–∏–µ) */
        #police-alert {
            position: fixed; top: 20%; left: 10%; right: 10%; background: var(--police); color: white;
            padding: 20px; border-radius: 15px; text-align: center; display: none; z-index: 2000; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        /* –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ */
        #controls-area { height: 35vh; background: white; display: flex; flex-direction: column; align-items: center; padding: 10px; border-top: 1px solid #ddd; }
        .joystick { display: grid; grid-template-columns: repeat(3, 70px); gap: 10px; }
        .j-btn { height: 60px; background: #f0f0f0; border: none; border-radius: 15px; font-size: 24px; color: #333; }
        .j-btn:active { background: var(--lime); }
        
        #status-msg { margin: 10px; font-size: 13px; font-weight: bold; color: #666; height: 20px; }

        .resource-bar { display: flex; gap: 10px; margin-bottom: 10px; }
        .res-item { font-size: 12px; background: #eee; padding: 4px 10px; border-radius: 10px; }
    </style>
</head>
<body>

<div class="burger" onclick="toggleMenu()">‚ò∞</div>

<div id="side-menu">
    <a href="#" class="menu-link" onclick="openShop('food')">üè™ –ú–∞–≥–∞–∑–∏–Ω –ø—Ä–æ–¥—É–∫—Ç–æ–≤</a>
    <a href="#" class="menu-link" onclick="openShop('tech')">üö≤ –ú–∞–≥–∞–∑–∏–Ω —Ç–µ—Ö–Ω–∏–∫–∏</a>
    <a href="#" class="menu-link">üõ† –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å / –†–µ–º–æ–Ω—Ç</a>
    <a href="#" class="menu-link">üè¶ –ë–∞–Ω–∫</a>
    <div style="text-align: center; margin-top: 50px;" onclick="toggleMenu()">‚Üê –ù–ê–ó–ê–î</div>
</div>

<div id="header">
    <div class="city-label">WARSAW DISTRICT</div>
    <div class="balance-box"><span id="cash">0.00</span> PLN</div>
</div>

<div id="police-alert">
    <h2>üöì –ü–û–õ–ò–¶–ò–Ø!</h2>
    <p>–í–∞—Å –æ—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏.</p>
    <button onclick="handlePolice('bribe')" style="padding: 10px; background: gold; border: none; margin-bottom: 5px; width: 100%;">–î–∞—Ç—å –≤–∑—è—Ç–∫—É (20 PLN)</button>
    <button onclick="handlePolice('wait')" style="padding: 10px; background: white; border: none; width: 100%;">–ñ–¥–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ (10 —Å–µ–∫)</button>
</div>

<div id="game-board">
    <div id="player" class="entity">üö≤</div>
    <div id="target" class="entity" style="display:none"></div>
</div>

<div id="controls-area">
    <div class="resource-bar">
        <div class="res-item">‚ö° <span id="energy">100</span>%</div>
        <div class="res-item">üòä <span id="mood">100</span>%</div>
    </div>
    <div id="status-msg">–ù–∞–∂–º–∏ "–û–ù–õ–ê–ô–ù", —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Å–º–µ–Ω—É</div>
    
    <div class="joystick">
        <div id="online-btn" onclick="startShift()" style="grid-column: 1/4; background: var(--lime); padding: 15px; border-radius: 12px; text-align: center; font-weight: bold; cursor: pointer; margin-bottom: 5px;">–í–´–ô–¢–ò –í –û–ù–õ–ê–ô–ù</div>
        
        <button class="j-btn" style="grid-column: 2" onclick="move(0, -20)">‚Üë</button>
        <button class="j-btn" style="grid-column: 1; grid-row: 3" onclick="move(-20, 0)">‚Üê</button>
        <button class="j-btn" style="grid-column: 2; grid-row: 3" onclick="move(0, 20)">‚Üì</button>
        <button class="j-btn" style="grid-column: 3; grid-row: 3" onclick="move(20, 0)">‚Üí</button>
    </div>
</div>

<script>
    let stats = { cash: 0.00, energy: 100, mood: 100, speed: 1 };
    let playerPos = { x: 160, y: 160 };
    let targetPos = { x: 0, y: 0 };
    let isWorking = false;
    let jobStep = 'NONE'; // RESTAURANT, CLIENT

    function toggleMenu() { document.getElementById('side-menu').classList.toggle('open'); }

    function startShift() {
        isWorking = true;
        document.getElementById('online-btn').style.display = 'none';
        spawnObstacles();
        newOrder();
    }

    function spawnObstacles() {
        document.querySelectorAll('.obstacle').forEach(e => e.remove());
        for(let i=0; i<20; i++) {
            let ox = Math.floor(Math.random() * (window.innerWidth/20 - 2)) * 20;
            let oy = Math.floor(Math.random() * (60/20 * 100)) * 20;
            let div = document.createElement('div');
            div.className = 'entity obstacle';
            div.style.left = ox + 'px';
            div.style.top = oy + 'px';
            div.innerText = 'üöß';
            document.getElementById('game-board').appendChild(div);
        }
    }

    function move(dx, dy) {
        if(!isWorking) return;
        if(stats.energy <= 0) return alert("–ù–µ—Ç —Å–∏–ª! –ù—É–∂–µ–Ω Red Bull.");

        // –®–∞–Ω—Å –ø–æ–ª–∏—Ü–∏–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º —à–∞–≥–µ (2%)
        if(Math.random() < 0.02) {
            triggerPolice();
            return;
        }

        let nx = playerPos.x + dx;
        let ny = playerPos.y + dy;

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä–∞–Ω–∏—Ü –∏ –ø—Ä–µ–≥—Ä–∞–¥
        let hitObstacle = false;
        document.querySelectorAll('.obstacle').forEach(o => {
            if(parseInt(o.style.left) === nx && parseInt(o.style.top) === ny) hitObstacle = true;
        });

        if(hitObstacle) {
            document.getElementById('status-msg').innerText = "üöß –¢–£–ü–ò–ö! –û–ë–™–ï–ó–ñ–ê–ô!";
            return;
        }

        playerPos.x = nx; playerPos.y = ny;
        stats.energy -= 0.5;
        updateView();
        checkTarget();
    }

    function newOrder() {
        jobStep = 'RESTAURANT';
        targetPos = { x: Math.floor(Math.random()*10+2)*20, y: Math.floor(Math.random()*10+2)*20 };
        let t = document.getElementById('target');
        t.style.display = 'flex';
        t.style.left = targetPos.x + 'px';
        t.style.top = targetPos.y + 'px';
        t.innerHTML = 'üçï';
        document.getElementById('status-msg').innerText = "–ó–∞–∫–∞–∑ –∏–∑ Barn Burger. –ï–¥—å –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω!";
    }

    function checkTarget() {
        let d = Math.hypot(playerPos.x - targetPos.x, playerPos.y - targetPos.y);
        if(d < 10) {
            if(jobStep === 'RESTAURANT') {
                jobStep = 'WAIT';
                document.getElementById('status-msg').innerText = "–ó–∞–∫–∞–∑ –≥–æ—Ç–æ–≤–∏—Ç—Å—è...";
                setTimeout(() => {
                    jobStep = 'CLIENT';
                    targetPos = { x: Math.floor(Math.random()*10+2)*20, y: Math.floor(Math.random()*10+2)*20 };
                    let t = document.getElementById('target');
                    t.style.left = targetPos.x + 'px';
                    t.style.top = targetPos.y + 'px';
                    t.innerHTML = 'üìç';
                    document.getElementById('status-msg').innerText = "–í–µ–∑–∏ –∫–ª–∏–µ–Ω—Ç—É –Ω–∞ —É–ª. Chmielna";
                }, 2000);
            } else if(jobStep === 'CLIENT') {
                stats.cash += 15.50;
                newOrder();
            }
        }
    }

    function triggerPolice() {
        document.getElementById('police-alert').style.display = 'block';
    }

    function handlePolice(action) {
        if(action === 'bribe') {
            stats.cash -= 20;
            document.getElementById('police-alert').style.display = 'none';
        } else {
            document.getElementById('status-msg').innerText = "–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (10—Å)...";
            document.getElementById('police-alert').style.display = 'none';
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –¥–∂–æ–π—Å—Ç–∏–∫–∞ –Ω–∞ 10 —Å–µ–∫
        }
        updateView();
    }

    function updateView() {
        document.getElementById('player').style.left = playerPos.x + 'px';
        document.getElementById('player').style.top = playerPos.y + 'px';
        document.getElementById('cash').innerText = stats.cash.toFixed(2);
        document.getElementById('energy').innerText = Math.floor(stats.energy);
    }

    updateView();
</script>
</body>
</html>
