<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Courier Simulator</title>
    <style>
        :root {
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --text-color: #e2e8f0;
            --accent-color: #3b82f6;
            --success-color: #22c55e;
            --warning-color: #eab308;
            --danger-color: #ef4444;
            --neon-glow: 0 0 10px rgba(59, 130, 246, 0.5);
        }

        * {
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- Header --- */
        header {
            background-color: var(--card-bg);
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
            z-index: 10;
        }

        .logo {
            font-size: 1.2rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header-controls {
            display: flex;
            gap: 15px;
        }

        /* --- Main Stats Area --- */
        .stats-container {
            padding: 15px;
            background: linear-gradient(180deg, var(--card-bg) 0%, var(--bg-color) 100%);
        }

        .balance-block {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            margin-bottom: 10px;
        }

        .balance-amount {
            font-size: 2rem;
            font-weight: 800;
            color: var(--success-color);
            text-shadow: 0 0 15px rgba(34, 197, 94, 0.3);
        }
        
        /* –°–∫—Ä—ã—Ç—ã–π –±–∞–ª–∞–Ω—Å (–¥–ª—è 10-–º–∏–Ω—É—Ç–Ω–æ–≥–æ –±–æ–Ω—É—Å–∞) */
        .balance-hidden {
            filter: blur(8px);
            pointer-events: none;
        }

        .level-info {
            text-align: right;
            font-size: 0.9rem;
            color: #94a3b8;
        }

        /* Progress Bars */
        .bars-container {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .bar-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.8rem;
        }

        .progress-bg {
            flex-grow: 1;
            height: 8px;
            background-color: #334155;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            transition: width 0.3s ease;
        }

        .energy-fill { background-color: var(--warning-color); box-shadow: 0 0 10px var(--warning-color); }
        .water-fill { background-color: #0ea5e9; box-shadow: 0 0 10px #0ea5e9; }
        .lvl-fill { background-color: #a855f7; }

        .stat-icon { width: 20px; text-align: center; }

        /* Status Text (Rent/Tax) */
        .status-tickers {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            margin-top: 8px;
            color: #64748b;
        }

        /* --- Game Area (Scrollable) --- */
        #game-area {
            flex-grow: 1;
            overflow-y: auto;
            padding: 15px;
            padding-bottom: 80px; /* Space for nav */
        }

        /* Sections */
        .section {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        .section.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #334155;
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--accent-color);
        }

        /* Buttons */
        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.1s, opacity 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
        }
        .btn:active { transform: scale(0.98); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }

        .btn-primary { background-color: var(--accent-color); color: white; box-shadow: var(--neon-glow); }
        .btn-success { background-color: var(--success-color); color: #000; }
        .btn-outline { background-color: transparent; border: 1px solid #475569; color: #94a3b8; }
        .btn-danger { background-color: var(--danger-color); color: white; }

        /* Clicker Zone */
        .click-zone {
            height: 200px;
            background: radial-gradient(circle at center, #334155 0%, var(--card-bg) 70%);
            border-radius: 16px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin-bottom: 15px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            border: 2px dashed #475569;
        }
        
        .click-zone:active {
            border-color: var(--accent-color);
            background: radial-gradient(circle at center, #475569 0%, var(--card-bg) 70%);
        }

        .click-icon { font-size: 4rem; margin-bottom: 10px; transition: transform 0.1s; }
        .click-zone:active .click-icon { transform: scale(0.9); }

        /* Floating Text */
        .floating-text {
            position: absolute;
            font-weight: bold;
            font-size: 1.2rem;
            pointer-events: none;
            animation: floatUp 1s forwards;
            color: var(--success-color);
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-50px) scale(1.2); }
        }

        /* Courier Mode Toggle */
        .mode-toggle {
            display: flex;
            background: #0f172a;
            padding: 4px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        .mode-btn {
            flex: 1;
            padding: 8px;
            text-align: center;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            color: #64748b;
        }
        .mode-btn.active {
            background-color: var(--card-bg);
            color: var(--text-color);
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        /* Locations List */
        .location-card {
            background: #1e293b;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border: 1px solid #334155;
            position: relative;
        }
        .location-card.current {
            border-color: var(--accent-color);
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.2);
        }
        .location-card.locked { opacity: 0.6; filter: grayscale(0.8); }

        .loc-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .loc-name { font-weight: bold; font-size: 1.1rem; }
        .loc-star { color: var(--warning-color); }
        .loc-stats { font-size: 0.85rem; color: #94a3b8; margin-bottom: 12px; line-height: 1.4; }
        .loc-badge { 
            position: absolute; top: -8px; right: -8px; 
            background: var(--success-color); color: black; 
            font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; font-weight: bold;
        }

        /* Upgrades & Inventory */
        .item-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #334155;
        }
        .item-row:last-child { border-bottom: none; }
        .item-info h4 { margin: 0 0 4px 0; font-size: 0.95rem; }
        .item-desc { font-size: 0.8rem; color: #94a3b8; }
        .item-btn { padding: 6px 12px; font-size: 0.85rem; width: auto; }

        /* --- Navigation --- */
        nav {
            position: fixed;
            bottom: 0;
            width: 100%;
            background-color: var(--card-bg);
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            border-top: 1px solid #334155;
            z-index: 20;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 0.75rem;
            color: #64748b;
            cursor: pointer;
            gap: 4px;
            width: 20%;
        }

        .nav-item.active { color: var(--accent-color); }
        .nav-icon { font-size: 1.2rem; }

        /* Bank Styles */
        .bank-card {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border: 1px solid #475569;
        }
        .deposit-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }
        .bank-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 100;
            display: none;
            justify-content: center;
            align-items: center;
        }
        .modal {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            width: 85%;
            max-width: 320px;
            text-align: center;
            border: 1px solid var(--accent-color);
        }
        .modal h3 { margin-top: 0; }

        /* Notifications */
        .notification {
            position: fixed;
            top: 70px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--card-bg);
            border: 1px solid var(--accent-color);
            padding: 10px 20px;
            border-radius: 20px;
            z-index: 99;
            font-size: 0.9rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            white-space: nowrap;
        }
        .notification.show { opacity: 1; }

    </style>
</head>
<body>

    <header>
        <div class="logo">üö¥ Courier Sim</div>
        <div class="header-controls">
            <span id="time-display">12:00</span>
        </div>
    </header>

    <div class="stats-container">
        <div class="balance-block">
            <div>
                <div style="font-size: 0.8rem; color: #94a3b8;">–ë–∞–ª–∞–Ω—Å</div>
                <div class="balance-amount" id="balance">0.00 PLN</div>
            </div>
            <div class="level-info">
                LVL <span id="lvl-display">1.0</span> <span id="home-icon">‚õ∫</span>
            </div>
        </div>

        <div class="bars-container">
            <div class="bar-wrapper">
                <span class="stat-icon">‚≠ê</span>
                <div class="progress-bg">
                    <div class="progress-fill lvl-fill" id="lvl-bar" style="width: 0%"></div>
                </div>
            </div>
            <div class="bar-wrapper">
                <span class="stat-icon">‚ö°</span>
                <div class="progress-bg">
                    <div class="progress-fill energy-fill" id="energy-bar" style="width: 100%"></div>
                </div>
                <span id="energy-text">2000/2000</span>
            </div>
            <div class="bar-wrapper">
                <span class="stat-icon">üíß</span>
                <div class="progress-bg">
                    <div class="progress-fill water-fill" id="water-bar" style="width: 100%"></div>
                </div>
                <span id="water-text">100%</span>
            </div>
        </div>

        <div class="status-tickers">
            <span id="tax-timer">–ù–∞–ª–æ–≥ (FREE): --:--</span>
            <span id="rent-timer">–ö–≤–∞—Ä—Ç–ø–ª–∞—Ç–∞ (0 PLN): --:--</span>
        </div>
    </div>

    <div id="notification" class="notification">–°–æ–æ–±—â–µ–Ω–∏–µ</div>

    <div id="game-area">
        
        <div id="section-city" class="section active">
            <div class="mode-toggle">
                <div class="mode-btn active" onclick="setWorkMode('manual')">–†—É—á–Ω–æ–π</div>
                <div class="mode-btn" onclick="setWorkMode('auto')">–ê–≤—Ç–æ-–∑–∞–∫–∞–∑—ã</div>
            </div>

            <div id="manual-mode">
                <div class="click-zone" id="click-zone">
                    <div class="click-icon">üì¶</div>
                    <div style="color: #94a3b8;">–ù–∞–∂–º–∏, —á—Ç–æ–±—ã –¥–æ—Å—Ç–∞–≤–∏—Ç—å</div>
                </div>
            </div>

            <div id="auto-mode" style="display: none;">
                <div class="card">
                    <div class="card-title">ü§ñ –ê–≤—Ç–æ-–∫—É—Ä—å–µ—Ä</div>
                    <p style="font-size: 0.9rem; color: #94a3b8; margin-top: 0;">
                        –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤. –¢—Ä–∞—Ç–∏—Ç –≤–æ–¥—É –∏ —ç–Ω–µ—Ä–≥–∏—é. <br>
                        –î–æ—Ö–æ–¥: <span style="color: var(--success-color);">+<span id="auto-rate">0</span> PLN/—Å–µ–∫</span>
                    </p>
                    <div id="hired-couriers-list">
                        <div style="text-align: center; padding: 20px; color: #64748b; font-style: italic;">
                            –£ –≤–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∞–≤—Ç–æ-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤. –ó–∞–π–¥–∏—Ç–µ –≤ "–ö–∞—Ä—å–µ—Ä—É".
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">üéí –ü—Ä–∏–ø–∞—Å—ã</div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <button class="btn btn-outline" onclick="buyWater()">
                        üíß –í–æ–¥–∞ (5 PLN)
                    </button>
                    <button class="btn btn-outline" onclick="buyEnergyDrink()">
                        ‚ö° –≠–Ω–µ—Ä–≥–µ—Ç–∏–∫ (15 PLN)
                    </button>
                </div>
                <div style="margin-top: 8px; font-size: 0.75rem; color: #64748b; text-align: center;">
                    * –≠–Ω–µ—Ä–≥–µ—Ç–∏–∫ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ä–∞—Å—Ö–æ–¥ —ç–Ω–µ—Ä–≥–∏–∏, –Ω–æ –≤–æ–¥–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ç—Ä–∞—Ç–∏—Ç—å—Å—è.
                </div>
            </div>
        </div>

        <div id="section-career" class="section">
            <div class="card">
                <div class="card-title">üìà –ù–∞–≤—ã–∫–∏ –∏ –°–Ω–∞—Ä—è–∂–µ–Ω–∏–µ</div>
                <div id="upgrades-list">
                    </div>
            </div>
            
            <div class="card">
                <div class="card-title">ü§ù –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã (–ê–≤—Ç–æ)</div>
                <div id="auto-upgrades-list">
                    </div>
            </div>
        </div>

        <div id="section-shop" class="section">
            <div class="card">
                <div class="card-title">üö≤ –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</div>
                <p style="font-size: 0.8rem; color: #94a3b8;">–õ—É—á—à–∏–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç —ç–∫–æ–Ω–æ–º–∏—Ç —ç–Ω–µ—Ä–≥–∏—é –∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –¥–æ—Ö–æ–¥.</p>
                <div id="transport-list">
                    </div>
            </div>

            <div class="card">
                <div class="card-title">üó∫Ô∏è –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å & –†–∞–π–æ–Ω—ã</div>
                <p style="font-size: 0.8rem; color: #94a3b8;">
                    –ü–µ—Ä–µ–µ–∑–∂–∞–π –≤ —Ä–∞–π–æ–Ω—ã –ø–æ–¥–æ—Ä–æ–∂–µ, —á—Ç–æ–±—ã –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –±–æ–ª—å—à–µ. –ö—É–ø–∏ –∫–≤–∞—Ä—Ç–∏—Ä—É, —á—Ç–æ–±—ã –Ω–µ –ø–ª–∞—Ç–∏—Ç—å –≥—Ä–∞–±–∏—Ç–µ–ª—å—Å–∫—É—é –∞—Ä–µ–Ω–¥—É!
                </p>
                <div id="locations-list">
                    </div>
            </div>
        </div>

        <div id="section-invest" class="section">
            <div class="card">
                <div class="card-title">üíº –ë–∏—Ä–∂–∞ (WIP)</div>
                <p>–†–∞–∑–¥–µ–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ. –°–∫–æ—Ä–æ –∑–¥–µ—Å—å –º–æ–∂–Ω–æ –±—É–¥–µ—Ç —Ç–æ—Ä–≥–æ–≤–∞—Ç—å –∞–∫—Ü–∏—è–º–∏ Pyszne –∏ Glovo.</p>
            </div>
            <div class="card" style="border-color: var(--danger-color);">
                <div class="card-title" style="color: var(--danger-color);">‚ö†Ô∏è –û–ø–∞—Å–Ω–∞—è –∑–æ–Ω–∞</div>
                <button class="btn btn-danger" onclick="resetProgress()">–°–±—Ä–æ—Å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</button>
            </div>
        </div>

        <div id="section-bank" class="section">
             <div class="card bank-card">
                <div class="card-title">üè¶ –ë–∞–Ω–∫ –í–∞—Ä—à–∞–≤—ã</div>
                <p style="color: #94a3b8; font-size: 0.85rem; margin-top:0;">
                    –•—Ä–∞–Ω–∏—Ç–µ –¥–µ–Ω—å–≥–∏ –≤ –±–∞–Ω–∫–µ –ø–æ–¥ 5% –≤ –¥–µ–Ω—å. –î–µ–ø–æ–∑–∏—Ç –∑–∞—â–∏—â–µ–Ω –æ—Ç –Ω–∞–ª–æ–≥–æ–≤.
                </p>
                
                <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; text-align: center; margin: 15px 0;">
                    <div style="font-size: 0.9rem; color: #94a3b8;">–°—á–µ—Ç –≤ –±–∞–Ω–∫–µ</div>
                    <div style="font-size: 1.8rem; color: #60a5fa; font-weight: bold;" id="bank-balance">0.00 PLN</div>
                </div>

                <div class="bank-actions">
                    <button class="btn btn-success" onclick="bankDepositAll()">‚¨áÔ∏è –í—Å—ë –≤ –±–∞–Ω–∫</button>
                    <button class="btn btn-outline" onclick="bankWithdrawAll()">‚¨ÜÔ∏è –°–Ω—è—Ç—å –≤—Å—ë</button>
                </div>
                
                <div style="margin-top: 15px; border-top: 1px solid #475569; padding-top: 10px;">
                    <div class="deposit-info">
                        <span>–°—Ç–∞–≤–∫–∞:</span>
                        <span style="color: var(--success-color);">5% / –¥–µ–Ω—å</span>
                    </div>
                    <div class="deposit-info">
                        <span>–ù–∞—á–∏—Å–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑:</span>
                        <span id="bank-timer">24:00</span>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <nav>
        <div class="nav-item active" onclick="switchSection('city', this)">
            <span class="nav-icon">üèôÔ∏è</span>
            <span>–ì–æ—Ä–æ–¥</span>
        </div>
        <div class="nav-item" onclick="switchSection('career', this)">
            <span class="nav-icon">üéì</span>
            <span>–ö–∞—Ä—å–µ—Ä–∞</span>
        </div>
        <div class="nav-item" onclick="switchSection('shop', this)">
            <span class="nav-icon">üõí</span>
            <span>–ú–∞–≥–∞–∑–∏–Ω</span>
        </div>
        <div class="nav-item" onclick="switchSection('invest', this)">
            <span class="nav-icon">üìà</span>
            <span>–ò–Ω–≤–µ—Å—Ç</span>
        </div>
        <div class="nav-item" onclick="switchSection('bank', this)">
            <span class="nav-icon">üè¶</span>
            <span>–ë–∞–Ω–∫</span>
        </div>
    </nav>

    <div id="modal-overlay" class="modal-overlay">
        <div class="modal">
            <h3 id="modal-title">–°–æ–±—ã—Ç–∏–µ!</h3>
            <p id="modal-text">–¢–µ–∫—Å—Ç —Å–æ–±—ã—Ç–∏—è...</p>
            <button class="btn btn-primary" onclick="closeModal()">OK</button>
        </div>
    </div>

<script>
/**
 * COURIER SIMULATOR - WARSZAWA_FOREVER
 * Core Logic:
 * 1. Balance, Energy (Watts), Water (Hydration), Leveling system.
 * 2. Locations with Rent (Czynsz) vs Ownership.
 * 3. Dynamic Income (Manual + Auto).
 * 4. Bank system (Deposit/Withdraw/Interest).
 * 5. Special Mode: Free Rating (Hidden UI for 10 mins).
 */

/* --- STATE MANAGEMENT --- */
const SAVE_KEY = 'WARSZAWA_FOREVER';

let gameState = {
    balance: 0,
    bankBalance: 0,
    level: 1,
    xp: 0,
    energy: 2000,
    maxEnergy: 2000,
    water: 100, // percentage 0-100
    
    // Timers
    lastSaveTime: Date.now(),
    bankInterestTimer: 86400, // Seconds in a day
    rentTimer: 300, // 5 minutes for rent cycle
    taxTimer: 600, // 10 minutes for tax cycle
    
    // Status
    currentLocationIndex: 0,
    currentTransportIndex: 0,
    
    // Inventory/Upgrades
    upgrades: {
        shoes: 1, // Base click multiplier
        bag: 1,   // Max energy multiplier
        charm: 0  // Tips chance
    },
    
    // Auto Contracts (counts)
    contracts: {
        student: 0,
        scooter: 0,
        drone: 0
    },

    // Special Boosts
    energyDrinkActive: false,
    energyDrinkTimer: 0,

    // Free Rating Logic
    isFreeRatingMode: false,
    freeRatingTimer: 0,
    freeRatingOriginalLvl: 1, // backup to revert if cheated
    freeRatingBonus: 0, // +0.5, +1, etc.
    freeRatingStartTime: 0,
    realEarningsAccumulated: 0 // To track what they actually earned blindly
};

/* --- CONFIGURATION --- */
const LOCATIONS = [
    { name: 'Praga', baseIncome: 1.0, rent: 25, buyPrice: 850000, minLvl: 1, owned: false, desc: '–î–µ—à–µ–≤–æ –∏ —Å–µ—Ä–¥–∏—Ç–æ. –û–ø–∞—Å–Ω–æ –Ω–æ—á—å—é.' },
    { name: 'Mokot√≥w', baseIncome: 1.5, rent: 150, buyPrice: 1200000, minLvl: 2.5, owned: false, desc: '–°–ø–∞–ª—å–Ω—ã–π —Ä–∞–π–æ–Ω –¥–ª—è —Å—Ä–µ–¥–Ω–µ–≥–æ –∫–ª–∞—Å—Å–∞. –ê—Ä–µ–Ω–¥–∞ 10% –æ—Ç –±–∞–ª–∞–Ω—Å–∞ (–º–∏–Ω 150).' },
    { name: '≈ör√≥dmie≈õcie', baseIncome: 2.5, rent: 500, buyPrice: 2500000, minLvl: 5, owned: false, desc: '–¶–µ–Ω—Ç—Ä. –í—ã—Å–æ–∫–∏–π –¥–æ—Ö–æ–¥, –≤—ã—Å–æ–∫–∏–µ —Ä–∏—Å–∫–∏. –ê—Ä–µ–Ω–¥–∞ 15%.' },
    { name: 'Wilan√≥w', baseIncome: 4.0, rent: 1200, buyPrice: 5000000, minLvl: 10, owned: false, desc: '–≠–ª–∏—Ç–∞. –î–æ—Ö–æ–¥ x4.' }
];

const TRANSPORT = [
    { name: '–ù–æ–≥–∏', energyCons: 10, speed: 1.0, price: 0 },
    { name: '–°—Ç–∞—Ä—ã–π –≤–µ–ª–∏–∫', energyCons: 8, speed: 1.2, price: 250 },
    { name: '–≠–ª–µ–∫—Ç—Ä–æ-—Å–∞–º–æ–∫–∞—Ç', energyCons: 5, speed: 1.5, price: 1500 },
    { name: '–°–∫—É—Ç–µ—Ä', energyCons: 3, speed: 2.0, price: 5000 },
    { name: '–¢–µ—Å–ª–∞ (–ö—Ä–µ–¥–∏—Ç–Ω–∞—è)', energyCons: 1, speed: 5.0, price: 50000 }
];

// –ö–∞—Ä—å–µ—Ä–∞ (Upgrades manual)
const UPGRADES_INFO = [
    { id: 'shoes', name: '–£–¥–æ–±–Ω—ã–µ –∫—Ä–æ—Å—Å—ã', type: 'manual', basePrice: 100, multiplier: 1.5, desc: '–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –¥–æ—Ö–æ–¥ –∑–∞ –∫–ª–∏–∫ (–ë–∞–∑–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞).' },
    { id: 'bag', name: '–¢–µ—Ä–º–æ-—Å—É–º–∫–∞', type: 'energy', basePrice: 200, multiplier: 1.2, desc: '–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∑–∞–ø–∞—Å —ç–Ω–µ—Ä–≥–∏–∏ (+20%).' },
    { id: 'charm', name: '–£–ª—ã–±–∫–∞', type: 'luck', basePrice: 500, multiplier: 1.1, desc: '–®–∞–Ω—Å –ø–æ–ª—É—á–∏—Ç—å —á–∞–µ–≤—ã–µ.' }
];

// –ö–∞—Ä—å–µ—Ä–∞ (Auto Contracts)
const CONTRACTS_INFO = [
    { id: 'student', name: '–ù–∞–Ω—è—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–∞', basePrice: 500, income: 1, desc: '+1 PLN/—Å–µ–∫. –ü—å–µ—Ç –º–Ω–æ–≥–æ –≤–æ–¥—ã.' },
    { id: 'scooter', name: '–ê—Ä–µ–Ω–¥–∞ –∫—É—Ä—å–µ—Ä–∞ –Ω–∞ –º–æ–ø–µ–¥–µ', basePrice: 2000, income: 5, desc: '+5 PLN/—Å–µ–∫. –ë—ã—Å—Ç—Ä—ã–π.' },
    { id: 'drone', name: '–î—Ä–æ–Ω-–¥–æ—Å—Ç–∞–≤—â–∏–∫', basePrice: 10000, income: 25, desc: '+25 PLN/—Å–µ–∫. –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –±—É–¥—É—â–µ–≥–æ.' }
];

/* --- INITIALIZATION --- */
function initGame() {
    loadGame();
    setupUI();
    
    // Game Loops
    setInterval(gameLoop, 1000); // 1 sec tick
    setInterval(saveGame, 10000); // Auto save 10s
    
    // Restore UI state
    updateLocationUI();
    updateTransportUI();
    updateUpgradesUI();
    renderStats();
}

/* --- SAVE/LOAD --- */
function saveGame() {
    // Save owned status inside locations
    gameState.locationOwnership = LOCATIONS.map(l => l.owned);
    localStorage.setItem(SAVE_KEY, JSON.stringify(gameState));
}

function loadGame() {
    const saved = localStorage.getItem(SAVE_KEY);
    if (saved) {
        try {
            const parsed = JSON.parse(saved);
            gameState = { ...gameState, ...parsed };
            
            // Restore location ownership
            if (gameState.locationOwnership) {
                gameState.locationOwnership.forEach((owned, idx) => {
                    if (LOCATIONS[idx]) LOCATIONS[idx].owned = owned;
                });
            }

            // Check if Free Rating mode expired while offline
            if (gameState.isFreeRatingMode) {
                const now = Date.now();
                const elapsed = now - gameState.freeRatingStartTime;
                if (elapsed >= 10 * 60 * 1000) {
                    endFreeRatingMode(true); // Success
                } else {
                    // Resume timer logic in loop
                }
            }

        } catch (e) {
            console.error("Save corrupted", e);
        }
    }
}

function resetProgress() {
    if(!confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã? –≠—Ç–æ —Å–æ—Ç—Ä–µ—Ç –≤–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å, –≤–∫–ª—é—á–∞—è –ø–æ–∫—É–ø–∫–∏ –∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å!")) return;
    
    localStorage.removeItem(SAVE_KEY);
    
    // Hard Reset variables
    gameState.balance = 0;
    gameState.bankBalance = 0;
    gameState.level = 1;
    gameState.xp = 0;
    gameState.energy = 2000;
    gameState.water = 100;
    gameState.currentLocationIndex = 0;
    gameState.currentTransportIndex = 0;
    gameState.upgrades = { shoes: 1, bag: 1, charm: 0 };
    gameState.contracts = { student: 0, scooter: 0, drone: 0 };
    
    // !–í–ê–ñ–ù–û: –°–±—Ä–æ—Å –ø—Ä–∞–≤ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
    LOCATIONS.forEach(loc => {
        loc.owned = false;
    });

    saveGame();
    location.reload();
}

/* --- CORE GAME LOGIC --- */

// 1. Clicker
document.getElementById('click-zone').addEventListener('click', (e) => {
    if (gameState.energy < TRANSPORT[gameState.currentTransportIndex].energyCons) {
        showNotification("–ù–µ—Ç —ç–Ω–µ—Ä–≥–∏–∏! –í—ã–ø–µ–π —ç–Ω–µ—Ä–≥–µ—Ç–∏–∫ –∏–ª–∏ –æ—Ç–¥–æ—Ö–Ω–∏.");
        return;
    }

    // Cost
    if (!gameState.energyDrinkActive) {
        gameState.energy -= TRANSPORT[gameState.currentTransportIndex].energyCons;
    }
    gameState.water -= 0.5; // Water always drains on work
    if (gameState.water < 0) gameState.water = 0;

    // Calc Income
    let locationMult = LOCATIONS[gameState.currentLocationIndex].baseIncome;
    let transportMult = TRANSPORT[gameState.currentTransportIndex].speed;
    let upgradeMult = 1 + (gameState.upgrades.shoes * 0.1); // +10% per level
    
    // Blind mode RNG
    let rngFactor = 1.0;
    if (gameState.isFreeRatingMode) {
        // x2 or -50% chance
        rngFactor = Math.random() > 0.5 ? 2.0 : 0.5;
    }

    let basePay = 1.5 * locationMult * transportMult * upgradeMult * rngFactor;
    
    // Tips
    if (Math.random() < (gameState.upgrades.charm * 0.05)) {
        basePay *= 3;
        createFloatingText(e.clientX, e.clientY, "–ß–ê–ï–í–´–ï! üí∞");
    }

    addMoney(basePay);
    addXP(1);
    
    createFloatingText(e.clientX, e.clientY, `+${formatMoney(basePay)}`);
    renderStats();
});

// 2. Helper Functions
function addMoney(amount) {
    if (gameState.isFreeRatingMode) {
        gameState.realEarningsAccumulated += amount;
    } else {
        gameState.balance += amount;
    }
}

function addXP(amount) {
    gameState.xp += amount;
    // Simple level formula: Level = 1 + sqrt(xp / 100)
    let newLvl = 1 + Math.floor(Math.sqrt(gameState.xp / 50));
    
    if (gameState.isFreeRatingMode) {
        // Level doesn't visually update instantly in this mode to preserve the "fake" level
    } else {
        if (newLvl > gameState.level) {
            gameState.level = newLvl;
            showNotification(`–£—Ä–æ–≤–µ–Ω—å –ø–æ–≤—ã—à–µ–Ω! LVL ${gameState.level}`);
            updateLocationUI(); // Unlock new areas
        }
    }
}

function formatMoney(amount) {
    return amount.toFixed(2) + ' PLN';
}

function showNotification(msg) {
    const el = document.getElementById('notification');
    el.innerText = msg;
    el.classList.add('show');
    setTimeout(() => el.classList.remove('show'), 2000);
}

function createFloatingText(x, y, text) {
    const el = document.createElement('div');
    el.className = 'floating-text';
    el.innerText = text;
    if (gameState.isFreeRatingMode) {
        el.innerText = "???"; // Hidden in blind mode
    }
    el.style.left = x + 'px';
    el.style.top = y + 'px';
    document.body.appendChild(el);
    setTimeout(() => el.remove(), 1000);
}

// 3. Game Loop (1 sec)
function gameLoop() {
    // Energy Regen
    if (gameState.energy < gameState.maxEnergy) {
        gameState.energy += 5; // Passive regen
        if (gameState.energy > gameState.maxEnergy) gameState.energy = gameState.maxEnergy;
    }

    // Auto Income
    let autoIncome = 0;
    autoIncome += gameState.contracts.student * CONTRACTS_INFO[0].income;
    autoIncome += gameState.contracts.scooter * CONTRACTS_INFO[1].income;
    autoIncome += gameState.contracts.drone * CONTRACTS_INFO[2].income;

    if (autoIncome > 0) {
        // Auto consumption
        let waterCost = (gameState.contracts.student * 0.2) + (gameState.contracts.scooter * 0.1);
        let energyCost = (gameState.contracts.scooter * 2) + (gameState.contracts.drone * 5);

        if (gameState.water > waterCost && (gameState.energy > energyCost || gameState.energyDrinkActive)) {
            gameState.water -= waterCost;
            if (!gameState.energyDrinkActive) {
                 gameState.energy -= energyCost;
            }
            // Add Income
            let locMult = LOCATIONS[gameState.currentLocationIndex].baseIncome;
            let finalAuto = autoIncome * locMult;
            
            // Blind Mode logic for Auto
            if (gameState.isFreeRatingMode) {
                let rng = Math.random() > 0.5 ? 2.0 : 0.5;
                gameState.realEarningsAccumulated += (finalAuto * rng);
            } else {
                gameState.balance += finalAuto;
            }
        }
    }

    // Timers
    handleTimers();
    handleFreeRatingMode();
    handleEnergyDrink();

    renderStats();
}

function handleTimers() {
    // Rent
    if (gameState.rentTimer > 0) {
        gameState.rentTimer--;
    } else {
        payRent();
        gameState.rentTimer = 300; // Reset 5 min
    }

    // Bank Interest
    if (gameState.bankInterestTimer > 0) {
        gameState.bankInterestTimer--;
    } else {
        payBankInterest();
        gameState.bankInterestTimer = 86400;
    }
}

function handleEnergyDrink() {
    if (gameState.energyDrinkActive) {
        gameState.energyDrinkTimer--;
        if (gameState.energyDrinkTimer <= 0) {
            gameState.energyDrinkActive = false;
            showNotification("–î–µ–π—Å—Ç–≤–∏–µ —ç–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞ –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å");
        }
    }
}

/* --- LOGIC: RENT & LOCATIONS --- */
function payRent() {
    let loc = LOCATIONS[gameState.currentLocationIndex];
    if (loc.owned) {
        showNotification(`–í—ã –≤–ª–∞–¥–µ–ª–µ—Ü ${loc.name}. –ö–≤–∞—Ä—Ç–ø–ª–∞—Ç–∞ 0 PLN!`);
        return;
    }

    let rentAmount = loc.rent;
    // Dynamic rent for higher zones
    if (gameState.currentLocationIndex === 1) rentAmount = Math.max(150, gameState.balance * 0.10);
    if (gameState.currentLocationIndex === 2) rentAmount = Math.max(500, gameState.balance * 0.15);
    
    if (gameState.balance >= rentAmount) {
        gameState.balance -= rentAmount;
        showNotification(`–°–ø–∏—Å–∞–Ω–∞ –∫–≤–∞—Ä—Ç–ø–ª–∞—Ç–∞: -${formatMoney(rentAmount)}`);
    } else {
        // Debt or downgrade? For now simple logic
        gameState.balance -= rentAmount; // Go negative
        showNotification(`–î–û–õ–ì –ó–ê –ö–í–ê–†–¢–ò–†–£! -${formatMoney(rentAmount)}`);
    }
}

function buyLocation(index) {
    let loc = LOCATIONS[index];
    if (gameState.balance >= loc.buyPrice) {
        gameState.balance -= loc.buyPrice;
        loc.owned = true;
        saveGame();
        updateLocationUI();
        showNotification(`–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –∫—É–ø–∏–ª–∏ –∂–∏–ª—å–µ –≤ ${loc.name}!`);
    } else {
        showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!");
    }
}

function moveLocation(index) {
    let loc = LOCATIONS[index];
    
    // Check Level req
    // Special: If Free Rating Mode gives +Bonus, we check (Base + Bonus)
    let effectiveLvl = gameState.level;
    if (gameState.isFreeRatingMode) effectiveLvl += gameState.freeRatingBonus;

    if (effectiveLvl < loc.minLvl) {
        showNotification(`–ù—É–∂–µ–Ω —É—Ä–æ–≤–µ–Ω—å ${loc.minLvl}!`);
        return;
    }

    // Moving Cost (Fixed or small)
    let moveCost = 150; 
    if (index === 0) moveCost = 0; // Back to Praga is free usually or cheap
    if (gameState.currentLocationIndex === index) return;

    if (gameState.balance >= moveCost) {
        gameState.balance -= moveCost;
        gameState.currentLocationIndex = index;
        updateLocationUI();
        showNotification(`–í—ã –ø–µ—Ä–µ–µ—Ö–∞–ª–∏ –≤ ${loc.name}`);
    } else {
        showNotification("–ù–µ—Ç –¥–µ–Ω–µ–≥ –Ω–∞ –ø–µ—Ä–µ–µ–∑–¥ (150 PLN)");
    }
}

/* --- LOGIC: BANK --- */
function bankDepositAll() {
    if (gameState.balance > 0) {
        gameState.bankBalance += gameState.balance;
        gameState.balance = 0;
        showNotification("–°—Ä–µ–¥—Å—Ç–≤–∞ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω—ã –≤ –±–∞–Ω–∫");
        renderStats();
    }
}

function bankWithdrawAll() {
    if (gameState.bankBalance > 0) {
        gameState.balance += gameState.bankBalance;
        gameState.bankBalance = 0;
        showNotification("–°—Ä–µ–¥—Å—Ç–≤–∞ –≤—ã–≤–µ–¥–µ–Ω—ã –∏–∑ –±–∞–Ω–∫–∞");
        renderStats();
    }
}

function payBankInterest() {
    if (gameState.bankBalance > 0) {
        let interest = gameState.bankBalance * 0.05;
        gameState.bankBalance += interest;
        showNotification(`–ë–∞–Ω–∫: –Ω–∞—á–∏—Å–ª–µ–Ω—ã –ø—Ä–æ—Ü–µ–Ω—Ç—ã +${formatMoney(interest)}`);
    }
}

/* --- LOGIC: SHOP & SUPPLIES --- */
function buyWater() {
    if (gameState.balance >= 5) {
        gameState.balance -= 5;
        gameState.water = 100;
        showNotification("–í–æ–¥–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞");
        renderStats();
    }
}

function buyEnergyDrink() {
    if (gameState.balance >= 15) {
        gameState.balance -= 15;
        gameState.energy = gameState.maxEnergy;
        gameState.energyDrinkActive = true;
        gameState.energyDrinkTimer = 60; // 60 seconds of infinite energy
        showNotification("–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫! –≠–Ω–µ—Ä–≥–∏—è –Ω–µ —Ç—Ä–∞—Ç–∏—Ç—Å—è 60 —Å–µ–∫.");
        renderStats();
    }
}

/* --- LOGIC: FREE RATING MODE --- */
// Simulating the "Ad for bonus" or "Trick the system"
// For this demo, let's assume a function triggerFreeRating(bonusAmount) is called from a hypothetical ad callback
// Or we can add a button in 'Career' or 'Invest' to simulate getting this offer.
// Let's add a "Cheat/Boost" button in Career for demo purposes.

function startFreeRatingMode(bonus) {
    if (gameState.isFreeRatingMode) return;

    gameState.isFreeRatingMode = true;
    gameState.freeRatingBonus = bonus;
    gameState.freeRatingStartTime = Date.now();
    gameState.realEarningsAccumulated = 0;
    
    // Save state before start (snapshot balance is maintained, but new earnings are hidden)
    saveGame();
    
    renderStats();
    showNotification(`–†–µ–∂–∏–º "Blind Work" –Ω–∞ 10 –º–∏–Ω! LVL +${bonus}`);
}

function handleFreeRatingMode() {
    if (!gameState.isFreeRatingMode) return;

    const duration = 10 * 60 * 1000; // 10 mins
    if (Date.now() - gameState.freeRatingStartTime > duration) {
        endFreeRatingMode(true); // Natural finish
    }
}

function endFreeRatingMode(success) {
    gameState.isFreeRatingMode = false;
    
    if (success) {
        // User worked 10 mins. Reveal earnings.
        gameState.balance += gameState.realEarningsAccumulated;
        showNotification(`–ë–æ–Ω—É—Å –æ–∫–æ–Ω—á–µ–Ω! –í—ã –∑–∞—Ä–∞–±–æ—Ç–∞–ª–∏: ${formatMoney(gameState.realEarningsAccumulated)}`);
    } else {
        // User cancelled or "tricked" system (inactive) - logic implies if they didn't work, they get nothing.
        // If "wait for 10 minutes without working", realEarningsAccumulated will be 0 anyway.
        // The prompt says: "if I want to... wait... then this free rating is not taken into account and everything returns to initial state."
        // Our logic handles this: balance wasn't added to, simply returns to normal.
    }
    
    gameState.realEarningsAccumulated = 0;
    gameState.freeRatingBonus = 0;
    renderStats();
}

/* --- UI UPDATERS --- */
function renderStats() {
    // Balance
    const balEl = document.getElementById('balance');
    const lvlEl = document.getElementById('lvl-display');
    const lvlBar = document.getElementById('lvl-bar');
    const homeIcon = document.getElementById('home-icon');
    
    if (gameState.isFreeRatingMode) {
        balEl.innerText = "??? PLN";
        balEl.classList.add('balance-hidden');
        // Fake Level
        lvlEl.innerText = (gameState.level + gameState.freeRatingBonus).toFixed(1);
        lvlBar.style.width = '100%'; // Hide progress
    } else {
        balEl.innerText = formatMoney(gameState.balance);
        balEl.classList.remove('balance-hidden');
        lvlEl.innerText = gameState.level.toFixed(1); // Real Level (simplified)
        // XP progress calc (approx)
        let progress = (gameState.xp % 50) / 50 * 100;
        lvlBar.style.width = `${progress}%`;
    }

    // Icon for home
    if (LOCATIONS[gameState.currentLocationIndex].owned) {
        homeIcon.style.display = 'inline';
        homeIcon.title = "–°–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ –∂–∏–ª—å–µ";
    } else {
        homeIcon.style.display = 'none';
    }

    // Energy
    document.getElementById('energy-bar').style.width = (gameState.energy / gameState.maxEnergy * 100) + '%';
    document.getElementById('energy-text').innerText = `${Math.floor(gameState.energy)}/${gameState.maxEnergy}`;
    
    if (gameState.energyDrinkActive) {
        document.getElementById('energy-bar').style.backgroundColor = '#ec4899'; // Pink when boosted
    } else {
        document.getElementById('energy-bar').style.backgroundColor = ''; // Default class style
    }

    // Water
    document.getElementById('water-bar').style.width = gameState.water + '%';
    document.getElementById('water-text').innerText = Math.floor(gameState.water) + '%';

    // Bank
    document.getElementById('bank-balance').innerText = formatMoney(gameState.bankBalance);

    // Timers
    let rentTimeStr = new Date(gameState.rentTimer * 1000).toISOString().substr(14, 5);
    let taxTimeStr = new Date(gameState.taxTimer * 1000).toISOString().substr(14, 5);
    
    let currentRent = LOCATIONS[gameState.currentLocationIndex].owned ? 0 : LOCATIONS[gameState.currentLocationIndex].rent;
    // Calc dynamic rent for display
    if (!LOCATIONS[gameState.currentLocationIndex].owned) {
        if (gameState.currentLocationIndex === 1) currentRent = Math.max(150, (gameState.balance * 0.10).toFixed(0));
        if (gameState.currentLocationIndex === 2) currentRent = Math.max(500, (gameState.balance * 0.15).toFixed(0));
    }

    document.getElementById('rent-timer').innerText = `–ö–≤–∞—Ä—Ç–ø–ª–∞—Ç–∞ (${currentRent} PLN): ${rentTimeStr}`;
    document.getElementById('tax-timer').innerText = `–ù–∞–ª–æ–≥: ${taxTimeStr}`;
    
    // Bank Timer
    let bankTimeStr = new Date(gameState.bankInterestTimer * 1000).toISOString().substr(11, 8);
    document.getElementById('bank-timer').innerText = bankTimeStr;
    
    // Auto Rate display
    let autoTotal = (gameState.contracts.student * 1) + (gameState.contracts.scooter * 5) + (gameState.contracts.drone * 25);
    document.getElementById('auto-rate').innerText = autoTotal * LOCATIONS[gameState.currentLocationIndex].baseIncome;
}

function updateLocationUI() {
    const list = document.getElementById('locations-list');
    list.innerHTML = '';

    LOCATIONS.forEach((loc, index) => {
        let isCurrent = (index === gameState.currentLocationIndex);
        let isOwned = loc.owned;
        let isLocked = (gameState.level < loc.minLvl && !gameState.isFreeRatingMode); 
        // Note: In FreeRatingMode, we might show them as unlocked visually, but move logic checks bonus

        let div = document.createElement('div');
        div.className = `location-card ${isCurrent ? 'current' : ''} ${isLocked ? 'locked' : ''}`;
        
        let actionBtn = '';
        if (isCurrent) {
            actionBtn = `<button class="btn btn-primary" disabled>–í–´ –ó–î–ï–°–¨</button>`;
        } else {
            actionBtn = `<button class="btn btn-primary" onclick="moveLocation(${index})">–ü–ï–†–ï–ï–•–ê–¢–¨ (150 PLN)</button>`;
        }

        let buyBtn = '';
        if (isOwned) {
            buyBtn = `<button class="btn btn-success" disabled>üè† –í–´ –í–õ–ê–î–ï–õ–ï–¶</button>`;
        } else {
            buyBtn = `<button class="btn btn-outline" style="border-color: #eab308; color: #eab308;" onclick="buyLocation(${index})">–ö–£–ü–ò–¢–¨ –ñ–ò–õ–¨–ï (${loc.buyPrice/1000}K PLN)</button>`;
        }

        div.innerHTML = `
            ${isOwned ? '<span class="loc-badge">–í–õ–ê–î–ï–õ–ï–¶</span>' : ''}
            <div class="loc-header">
                <span class="loc-name">${loc.name} ${isLocked ? `(LVL ${loc.minLvl}+)` : ''}</span>
                ${index === 0 ? '' : '<span class="loc-star">‚≠ê</span>'}
            </div>
            <div class="loc-stats">
                –ö–≤–∞—Ä—Ç–ø–ª–∞—Ç–∞: ${isOwned ? '0 PLN' : loc.rent + ' PLN'} <br>
                –î–æ—Ö–æ–¥: x${loc.baseIncome}<br>
                <i>${loc.desc}</i>
            </div>
            <div style="display:grid; gap:8px;">
                ${actionBtn}
                ${buyBtn}
            </div>
        `;
        list.appendChild(div);
    });
}

function updateTransportUI() {
    const list = document.getElementById('transport-list');
    list.innerHTML = '';
    
    TRANSPORT.forEach((tr, index) => {
        let isCurrent = (index === gameState.currentTransportIndex);
        let row = document.createElement('div');
        row.className = 'item-row';
        row.innerHTML = `
            <div class="item-info">
                <h4>${tr.name}</h4>
                <div class="item-desc">–≠–Ω–µ—Ä–≥–∏—è: -${tr.energyCons} | –°–∫–æ—Ä–æ—Å—Ç—å: x${tr.speed}</div>
            </div>
            <div>
                ${isCurrent 
                  ? '<button class="item-btn btn btn-success" disabled>–ò—Å–ø.</button>' 
                  : `<button class="item-btn btn btn-outline" onclick="buyTransport(${index})">${tr.price === 0 ? '–ë–µ—Å–ø–ª.' : tr.price + ' PLN'}</button>`
                }
            </div>
        `;
        list.appendChild(row);
    });
}

function buyTransport(index) {
    let tr = TRANSPORT[index];
    if (gameState.balance >= tr.price) {
        if (tr.price > 0) gameState.balance -= tr.price;
        gameState.currentTransportIndex = index;
        updateTransportUI();
        showNotification(`–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç: ${tr.name}`);
    } else {
        showNotification("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–µ–Ω–µ–≥");
    }
}

function updateUpgradesUI() {
    // Manual Upgrades
    const manualList = document.getElementById('upgrades-list');
    manualList.innerHTML = '';
    
    UPGRADES_INFO.forEach(up => {
        let currentLvl = gameState.upgrades[up.id];
        let cost = Math.floor(up.basePrice * Math.pow(1.5, currentLvl));
        
        let row = document.createElement('div');
        row.className = 'item-row';
        row.innerHTML = `
            <div class="item-info">
                <h4>${up.name} (–£—Ä. ${currentLvl})</h4>
                <div class="item-desc">${up.desc}</div>
            </div>
            <button class="item-btn btn btn-primary" onclick="buyUpgrade('${up.id}')">
                ${cost} PLN
            </button>
        `;
        manualList.appendChild(row);
    });

    // Auto Contracts
    const autoList = document.getElementById('auto-upgrades-list');
    autoList.innerHTML = '';

    CONTRACTS_INFO.forEach(c => {
        let count = gameState.contracts[c.id];
        let cost = Math.floor(c.basePrice * Math.pow(1.2, count));

        let row = document.createElement('div');
        row.className = 'item-row';
        row.innerHTML = `
            <div class="item-info">
                <h4>${c.name} (x${count})</h4>
                <div class="item-desc">${c.desc}</div>
            </div>
            <button class="item-btn btn btn-primary" onclick="hireContract('${c.id}')">
                ${cost} PLN
            </button>
        `;
        autoList.appendChild(row);
    });

    // Temp: Add Free Rating Button in Upgrades for Testing
    let promoRow = document.createElement('div');
    promoRow.className = 'item-row';
    promoRow.style.background = 'rgba(59, 130, 246, 0.1)';
    promoRow.innerHTML = `
        <div class="item-info">
            <h4>üéÅ –†–µ–∫–ª–∞–º–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç</h4>
            <div class="item-desc">–°–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∫–ª–∞–º—É (10 –º–∏–Ω) —Ä–∞–¥–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞ +1.5 LVL. –î–æ—Ö–æ–¥—ã —Å–∫—Ä—ã—Ç—ã.</div>
        </div>
        <button class="item-btn btn btn-warning" onclick="startFreeRatingMode(1.5)">
            Start
        </button>
    `;
    manualList.appendChild(promoRow);
}

function buyUpgrade(id) {
    let up = UPGRADES_INFO.find(u => u.id === id);
    let currentLvl = gameState.upgrades[id];
    let cost = Math.floor(up.basePrice * Math.pow(1.5, currentLvl));

    if (gameState.balance >= cost) {
        gameState.balance -= cost;
        gameState.upgrades[id]++;
        updateUpgradesUI();
        showNotification(`${up.name} —É–ª—É—á—à–µ–Ω–æ!`);
    } else {
        showNotification("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–µ–Ω–µ–≥");
    }
}

function hireContract(id) {
    let c = CONTRACTS_INFO.find(x => x.id === id);
    let count = gameState.contracts[id];
    let cost = Math.floor(c.basePrice * Math.pow(1.2, count));

    if (gameState.balance >= cost) {
        gameState.balance -= cost;
        gameState.contracts[id]++;
        updateUpgradesUI();
        updateAutoModeUI();
        showNotification(`${c.name} –Ω–∞–Ω—è—Ç!`);
    } else {
        showNotification("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–µ–Ω–µ–≥");
    }
}

function updateAutoModeUI() {
    const container = document.getElementById('hired-couriers-list');
    let html = '';
    let hasAny = false;
    
    if (gameState.contracts.student > 0) { html += `<div>üë®‚Äçüéì –°—Ç—É–¥–µ–Ω—Ç—ã: ${gameState.contracts.student}</div>`; hasAny = true; }
    if (gameState.contracts.scooter > 0) { html += `<div>üõµ –ú–æ–ø–µ–¥—ã: ${gameState.contracts.scooter}</div>`; hasAny = true; }
    if (gameState.contracts.drone > 0) { html += `<div>üöÅ –î—Ä–æ–Ω—ã: ${gameState.contracts.drone}</div>`; hasAny = true; }

    if (!hasAny) {
        container.innerHTML = `<div style="text-align: center; padding: 20px; color: #64748b; font-style: italic;">–£ –≤–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∞–≤—Ç–æ-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤. –ó–∞–π–¥–∏—Ç–µ –≤ "–ö–∞—Ä—å–µ—Ä—É".</div>`;
    } else {
        container.innerHTML = html;
    }
}

/* --- SECTION SWITCHING --- */
function switchSection(sectionId, navEl) {
    document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
    document.getElementById(`section-${sectionId}`).classList.add('active');
    
    document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
    navEl.classList.add('active');
}

function setWorkMode(mode) {
    document.querySelectorAll('.mode-btn').forEach(el => el.classList.remove('active'));
    if (mode === 'manual') {
        document.getElementById('manual-mode').style.display = 'block';
        document.getElementById('auto-mode').style.display = 'none';
        document.querySelectorAll('.mode-btn')[0].classList.add('active');
    } else {
        document.getElementById('manual-mode').style.display = 'none';
        document.getElementById('auto-mode').style.display = 'block';
        document.querySelectorAll('.mode-btn')[1].classList.add('active');
        updateAutoModeUI();
    }
}

// Modal
function closeModal() {
    document.getElementById('modal-overlay').style.display = 'none';
}

// Init
window.onload = initGame;

</script>
</body>
</html>
