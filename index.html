<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Warszawa Courier Simulator</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: #0a0a0c; --card: rgba(30, 30, 35, 0.95); --accent: #007aff;
            --success: #34c759; --danger: #ff3b30; --gold: #ffcc00; --neon-blue: #00f2ff;
        }
        body {
            background-image: url('https://images.unsplash.com/photo-1519125323398-675f0ddb6308?q=80&w=2070&auto=format&fit=crop');
            background-size: cover; background-position: center; background-attachment: fixed;
            color: white; font-family: -apple-system, sans-serif; margin: 0; padding: 0; min-height: 100vh; overflow: hidden;
            touch-action: manipulation;
        }
        body::before { content: ''; position: absolute; inset: 0; background: rgba(0,0,0,0.85); z-index: -1; }
        .header-container { position: sticky; top: 0; z-index: 500; background: rgba(10, 10, 12, 0.9); padding: 12px 15px; border-bottom: 1px solid rgba(255,255,255,0.1); backdrop-filter: blur(15px); }
        .top-nav { display: flex; justify-content: space-between; align-items: flex-start; }
        .energy-track { height: 10px; background: #222; border-radius: 5px; overflow: hidden; margin-top: 8px; border: 1px solid #444; }
        .energy-fill { height: 100%; width: 0%; background: linear-gradient(90deg, var(--accent), #5ac8fa); transition: width 0.1s linear; }
        .content { padding: 15px; height: calc(100vh - 240px); overflow-y: auto; padding-bottom: 110px; }
        .view { display: none; flex-direction: column; gap: 12px; }
        .view.active { display: flex; }
        .card { background: var(--card); border-radius: 12px; padding: 15px; border: 1px solid rgba(255,255,255,0.1); }
        .btn-action { background: var(--accent); color: white; border: none; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; width: 100%; transition: opacity 0.2s; font-size: 14px; }
        #work-sphere { width: 140px; height: 140px; border-radius: 50%; background: radial-gradient(circle, #007aff, #004080); display: flex; flex-direction: column; align-items: center; justify-content: center; margin: 15px auto 10px auto; box-shadow: 0 0 30px rgba(0,122,255,0.5); user-select: none; touch-action: none; transition: all 0.2s ease; }
        #work-sphere:active { transform: scale(0.92); }
        #game-log { background: rgba(0,0,0,0.7); height: 75px; overflow-y: hidden; font-size: 10px; padding: 5px 12px; border-top: 1px solid #444; color: #eee; display: flex; flex-direction: column-reverse; backdrop-filter: blur(5px); }
        .log-entry { margin-bottom: 2px; border-bottom: 1px solid #222; padding-bottom: 2px; }
        #quest-bar { display: none; position: fixed; bottom: 85px; left: 10px; right: 10px; background: rgba(20, 20, 25, 0.98); border: 2px solid var(--accent); border-radius: 12px; padding: 15px; z-index: 2000; box-shadow: 0 -10px 40px rgba(0,0,0,0.9); backdrop-filter: blur(15px); }
        .tab-bar { background: rgba(10, 10, 12, 0.98); position: fixed; bottom: 0; width: 100%; display: grid; grid-template-columns: repeat(5, 1fr); border-top: 1px solid rgba(255,255,255,0.1); }
        .tab-item { padding: 15px 0; text-align: center; color: #666; font-size: 10px; cursor: pointer; }
        .tab-item.active { color: var(--accent); border-top: 2px solid var(--accent); background: rgba(0,122,255,0.05); }
        #inventory-display { display: flex; flex-wrap: wrap; gap: 5px; margin-top: 8px; justify-content: flex-end; }
        .inv-item { background: rgba(255,255,255,0.1); padding: 2px 5px; border-radius: 4px; font-size: 9px; color: #ccc; border: 1px solid rgba(255,255,255,0.05); }
        .status-badge { padding: 2px 6px; border-radius: 4px; font-size: 9px; font-weight: bold; display: none; margin-bottom: 2px; text-align:center; }
        #auto-status-ui { background: var(--gold); color: black; }
        #bike-status-ui { background: var(--neon-blue); color: black; }
        #buff-status-ui { background: var(--success); color: white; }
        .weather-badge { font-size: 9px; padding: 2px 8px; border-radius: 10px; background: #333; font-weight: bold; }
        .career-progress { height: 6px; background: #222; border-radius: 3px; margin: 8px 0; overflow: hidden; }
        .career-fill { height: 100%; background: var(--gold); transition: width 0.4s; }
    </style>
</head>
<body>

<div id="quest-bar">
    <div style="display:flex; justify-content:space-between; align-items:flex-start;">
        <div><b id="quest-title" style="color:var(--gold); font-size: 14px;">üì¶ –ù–û–í–´–ô –ó–ê–ö–ê–ó</b><br><small>–û–ø–ª–∞—Ç–∞:</small> <b style="color:var(--success);" id="quest-pay">0.00</b> PLN</div>
        <div id="quest-timer-ui" style="color:var(--danger); font-weight:bold; font-size: 20px;">0:00</div>
    </div>
    <div id="quest-actions-choice" style="margin-top:12px; display: flex; gap: 8px;">
        <button class="btn-action" style="background:var(--success); flex: 2;" onclick="acceptOrder()">–ü–†–ò–ù–Ø–¢–¨</button>
        <button class="btn-action" style="background:var(--gold); color: black; flex: 1.5; font-size: 8px;" onclick="activateAutopilot()">–ê–í–¢–û–ü–ò–õ–û–¢<br><small>45 PLN / -0.15 LVL</small></button>
    </div>
    <div id="quest-active-ui" style="display:none; margin-top:10px;">
        <div id="order-status-text" style="font-size: 11px; margin-bottom: 5px; color: var(--accent);">–î–æ—Å—Ç–∞–≤–∫–∞ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ...</div>
        <div class="energy-track" style="height:8px;"><div id="quest-progress-bar" style="height:100%; width:0%; background:var(--success);"></div></div>
    </div>
</div>

<div class="header-container">
    <div class="top-nav">
        <div><small style="color:#aaa;">–ë–∞–ª–∞–Ω—Å</small><br><b id="money-val" style="font-size: 20px;">0.00 PLN</b></div>
        <div style="text-align: right; display: flex; flex-direction: column; align-items: flex-end;">
            <b id="lvl-val" style="color:var(--gold); font-size: 13px;">LVL 1.000000</b>
            <div id="inventory-display"></div>
            <div id="bike-status-ui" class="status-badge">üö≤ 00:00</div>
            <div id="auto-status-ui" class="status-badge">–ê–í–¢–û 00:00</div>
            <div id="buff-status-ui" class="status-badge">‚ö° BOOST 00:00</div>
            <span id="weather-ui" class="weather-badge">‚òÄÔ∏è –Ø—Å–Ω–æ</span>
        </div>
    </div>
    <div style="font-size: 11px; margin-top: 10px; display: flex; justify-content: space-between;">
        <span>‚ö° <b id="en-text">0/2000</b></span>
        <span>üß¥ –í–æ–¥–∞: <b id="water-val" style="color:var(--accent)">0</b> –º–ª</span>
    </div>
    <div class="energy-track"><div id="en-fill" class="energy-fill"></div></div>
    <div style="display: flex; justify-content: space-between; font-size: 9px; margin-top: 5px; opacity: 0.8;">
        <span id="tax-timer">–ù–∞–ª–æ–≥ —á–µ—Ä–µ–∑: 05:00</span>
        <span id="rent-timer" style="color:var(--danger)">–ê—Ä–µ–Ω–¥–∞ —á–µ—Ä–µ–∑: 10:00</span>
    </div>
</div>

<div class="content">
    <div id="view-main" class="view active">
        <div style="text-align: center; font-size: 12px; color: var(--gold); font-weight: bold;" id="district-ui">–†–∞–π–æ–Ω: Praga</div>
        <div id="work-sphere">
            <b style="font-size: 16px;">–†–ê–ë–û–¢–ê–¢–¨</b>
            <div id="click-rate-ui" style="font-size: 10px; opacity: 0.8; margin-top: 5px;">0.10 PLN</div>
        </div>
        <button class="btn-action" style="background:#444;" onclick="collectBottles()">üß¥ –°–û–ë–†–ê–¢–¨ –ë–£–¢–´–õ–ö–ò (+0.02 PLN)</button>
        <button class="btn-action" style="background:#222; border: 1px solid var(--gold); color: var(--gold); margin-top: 5px;" onclick="switchTab('districts', this)">üèôÔ∏è –°–ú–ï–ù–ò–¢–¨ –†–ê–ô–û–ù</button>
    </div>

    <div id="view-districts" class="view">
        <h3 style="margin:0; color:var(--gold)">üèôÔ∏è –í—ã–±–æ—Ä —Ä–∞–π–æ–Ω–∞</h3>
        <div class="card"><b>Praga</b><br><small>–ê—Ä–µ–Ω–¥–∞: 50 PLN. –°—Ç–∞—Ä—Ç–æ–≤—ã–π –¥–æ—Ö–æ–¥.</small><br><button class="btn-action" style="margin-top:5px; background:var(--success);" onclick="moveDistrict(0)">–¢–ï–ö–£–©–ò–ô</button></div>
        <div class="card"><b>Mokot√≥w (LVL 2.5)</b><br><small>–ê—Ä–µ–Ω–¥–∞: 120 PLN. –î–æ—Ö–æ–¥: +50%.</small><br><button id="dist-btn-1" class="btn-action" style="margin-top:5px;" onclick="moveDistrict(1)">–ü–ï–†–ï–ï–•–ê–¢–¨ (150 PLN)</button></div>
        <div class="card"><b>≈ör√≥dmie≈õcie (LVL 5.0)</b><br><small>–ê—Ä–µ–Ω–¥–∞: 300 PLN. –î–æ—Ö–æ–¥: x2.5.</small><br><button id="dist-btn-2" class="btn-action" style="margin-top:5px;" onclick="moveDistrict(2)">–ü–ï–†–ï–ï–•–ê–¢–¨ (500 PLN)</button></div>
    </div>

    <div id="view-quests" class="view">
        <h3 style="margin:0; color:var(--gold)">üèÜ –ö–∞—Ä—å–µ—Ä–Ω—ã–µ —Ü–µ–ª–∏</h3>
        <div id="milestones-list"></div>
    </div>

    <div id="view-shop" class="view">
        <div class="card"><b>üß¥ –í–æ–¥–∞ (1.5–ª)</b><br><small>–í–æ—Å–ø–æ–ª–Ω—è–µ—Ç —ç–Ω–µ—Ä–≥–∏—é –ø—Ä–∏ –∫–ª–∏–∫–∞—Ö. 1500 –º–ª.</small><button class="btn-action" style="margin-top:8px;" onclick="buyWater()">1.50 PLN</button></div>
        <div class="card" style="border:1px solid #ffcc00"><b>‚òï –ö–æ—Ñ–µ</b><br><small>–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç +300 —ç–Ω–µ—Ä–≥–∏–∏.</small><button class="btn-action" style="background:#6f4e37; margin-top:8px;" onclick="buyDrink('coffee', 5)">5.00 PLN</button></div>
        <div class="card" style="border:1px solid #34c759"><b>üîã –≠–Ω–µ—Ä–≥–µ—Ç–∏–∫ (2 –º–∏–Ω)</b><br><small>–ó–∞–º–æ—Ä–∞–∂–∏–≤–∞–µ—Ç —Ä–∞—Å—Ö–æ–¥ —ç–Ω–µ—Ä–≥–∏–∏. –í–æ–¥–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ç—Ä–∞—Ç–∏—Ç—å—Å—è.</small><button class="btn-action" style="background:#34c759; margin-top:8px;" onclick="buyDrink('energy', 12)">12.00 PLN</button></div>
    </div>

    <div id="view-invest" class="view">
        <h3 style="margin:0; color:var(--accent);">–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –∏ –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</h3>
        <div class="card" style="border: 1px solid #5ac8fa;"><b>üö≤ –ê—Ä–µ–Ω–¥–∞ –≠–ª–µ–∫—Ç—Ä–æ–≤–µ–ª–æ—Å–∏–ø–µ–¥–∞</b><br><small>–°–∫–æ—Ä–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤ x2. 30 PLN –∑–∞ 10 –º–∏–Ω—É—Ç.</small><button id="buy-bike-rent" class="btn-action" style="margin-top:8px; background:#5ac8fa; color:black;" onclick="rentBike()">–ê–†–ï–ù–î–û–í–ê–¢–¨ (30 PLN)</button></div>
        <div id="upgrade-items"></div>
    </div>

    <div id="view-bank" class="view">
        <div id="bank-actions-ui"></div>
        <h3 style="margin:10px 0 5px 0; color:var(--gold)">–ë–∏—Ä–∂–∞ –†–µ–ø—É—Ç–∞—Ü–∏–∏</h3>
        <button class="btn-action" style="background:none; border:1px solid var(--gold); color:var(--gold); margin:10px 0;" onclick="exchangeLvl(0.05, 10)">–û–ë–ú–ï–ù -0.05 LVL ‚Æï 10 PLN</button>
        <button class="btn-action" style="background:none; border:1px solid var(--gold); color:var(--gold);" onclick="exchangeLvl(1.00, 300)">–û–ë–ú–ï–ù -1.00 LVL ‚Æï 300 PLN</button>
    </div>
</div>
<div id="game-log"></div>
<div class="tab-bar">
    <div class="tab-item active" onclick="switchTab('main', this)">–ì–æ—Ä–æ–¥</div>
    <div class="tab-item" onclick="switchTab('quests', this)">–ö–∞—Ä—å–µ—Ä–∞</div>
    <div class="tab-item" onclick="switchTab('shop', this)">–ú–∞–≥–∞–∑–∏–Ω</div>
    <div class="tab-item" onclick="switchTab('invest', this)">–ò–Ω–≤–µ—Å—Ç</div>
    <div class="tab-item" onclick="switchTab('bank', this)">–ë–∞–Ω–∫</div>
</div>

<script>
    const tg = window.Telegram.WebApp; tg.expand(); tg.ready();
    const SAVE_KEY = "WARSZAWA_FOREVER";
    let G = { money: 10, debt: 0, lvl: 1.0, en: 2000, maxEn: 2000, tax: 300, rent: 600, waterStock: 0, totalOrders: 0, totalClicks: 0, totalBottles: 0, autoTime: 0, scooter: false, bag: false, phone: false, district: 0, bikeRentTime: 0, buffTime: 0, activeMilestones: [{ id: 1, name: "üì¶ –ü–µ—Ä–≤—ã–µ —à–∞–≥–∏", goal: 10, type: 'orders', reward: 30 }, { id: 2, name: "üß¥ –≠–∫–æ-–∞–∫—Ç–∏–≤–∏—Å—Ç", goal: 50, type: 'bottles', reward: 20 }, { id: 3, name: "‚ö° –≠–Ω–µ—Ä–¥–∂–∞–π–∑–µ—Ä", goal: 1000, type: 'clicks', reward: 40 }] };
    let order = { visible: false, active: false, steps: 0, target: 100, time: 0, reward: 0, offerTimer: 0, isCriminal: false };
    let curView = 'main', weather = "–Ø—Å–Ω–æ", isBroken = false;
    const DISTRICTS = [{ name: "Praga", minLvl: 0, rent: 50, mult: 1, price: 0 }, { name: "Mokot√≥w", minLvl: 2.5, rent: 120, mult: 1.5, price: 150 }, { name: "≈ör√≥dmie≈õcie", minLvl: 5.0, rent: 300, mult: 2.5, price: 500 }];
    const UPGRADES = [{ id: 'bag', name: '–¢–µ—Ä–º–æ—Å—É–º–∫–∞', icon: 'üéí', desc: '+15% –∫ –≤—ã–ø–ª–∞—Ç–∞–º –∑–∞ –∫–∞–∂–¥—ã–π –∑–∞–∫–∞–∑.', price: 350, bonus: '+15% PLN' }, { id: 'phone', name: '–°–º–∞—Ä—Ç—Ñ–æ–Ω Pro', icon: 'üì±', desc: '–ó–∞–∫–∞–∑—ã –ø—Ä–∏–ª–µ—Ç–∞—é—Ç –Ω–∞ 40% —á–∞—â–µ.', price: 1200, bonus: '–ó–∞–∫–∞–∑—ã x1.4' }, { id: 'scooter', name: '–≠–ª–µ–∫—Ç—Ä–æ—Å–∞–º–æ–∫–∞—Ç', icon: 'üõ¥', desc: '–°–Ω–∏–∂–∞–µ—Ç —Ä–∞—Å—Ö–æ–¥ —ç–Ω–µ—Ä–≥–∏–∏ –Ω–∞ 30% –Ω–∞–≤—Å–µ–≥–¥–∞.', price: 500, bonus: '‚ö° -30%' }];

    const sphere = document.getElementById('work-sphere');
    sphere.addEventListener('touchstart', (e) => { e.preventDefault(); tg.HapticFeedback.impactOccurred('medium'); doWork(); }, {passive: false});
    sphere.addEventListener('mousedown', (e) => { if (!('ontouchstart' in window)) doWork(); });

    function log(msg, color = "#eee") { const logEl = document.getElementById('game-log'); const entry = document.createElement('div'); entry.className = "log-entry"; entry.style.color = color; entry.innerText = `[${new Date().toLocaleTimeString().split(' ')[0]}] ${msg}`; logEl.appendChild(entry); if (logEl.childNodes.length > 5) logEl.removeChild(logEl.firstChild); }
    function save() { localStorage.setItem(SAVE_KEY, JSON.stringify(G)); }
    function load() { let d = localStorage.getItem(SAVE_KEY); if(d) { G = {...G, ...JSON.parse(d)}; } G.maxEn = 2000; updateUI(); }

    function updateUI() {
        document.getElementById('money-val').innerText = G.money.toFixed(2) + " PLN";
        document.getElementById('money-val').style.color = G.money < 0 ? "var(--danger)" : "var(--success)";
        document.getElementById('lvl-val').innerText = "LVL " + G.lvl.toFixed(6);
        document.getElementById('en-text').innerText = Math.floor(G.en) + "/" + G.maxEn;
        document.getElementById('en-fill').style.width = (G.en/G.maxEn*100) + "%";
        document.getElementById('water-val').innerText = Math.floor(G.waterStock);
        document.getElementById('district-ui').innerText = "–†–∞–π–æ–Ω: " + DISTRICTS[G.district].name;
        document.getElementById('weather-ui').innerText = (weather === "–î–æ–∂–¥—å" ? "üåßÔ∏è" : "‚òÄÔ∏è");
        document.getElementById('auto-status-ui').style.display = G.autoTime > 0 ? 'block' : 'none';
        if(G.autoTime > 0) document.getElementById('auto-status-ui').innerText = `–ê–í–¢–û ${Math.floor(G.autoTime/60)}:${(G.autoTime%60<10?'0':'')+G.autoTime%60}`;
        document.getElementById('bike-status-ui').style.display = G.bikeRentTime > 0 ? 'block' : 'none';
        if(G.bikeRentTime > 0) document.getElementById('bike-status-ui').innerText = `üö≤ ${Math.floor(G.bikeRentTime/60)}:${(G.bikeRentTime%60<10?'0':'')+G.bikeRentTime%60}`;
        const buffUI = document.getElementById('buff-status-ui'); buffUI.style.display = G.buffTime > 0 ? 'block' : 'none';
        if(G.buffTime > 0) buffUI.innerText = `‚ö° ${Math.floor(G.buffTime/60)}:${(G.buffTime%60<10?'0':'')+G.buffTime%60}`;
        const invDisp = document.getElementById('inventory-display'); invDisp.innerHTML = ''; UPGRADES.forEach(up => { if(G[up.id]) { const span = document.createElement('span'); span.className = 'inv-item'; span.innerText = `${up.icon} ${up.bonus}`; invDisp.appendChild(span); } });
        const upgradeList = document.getElementById('upgrade-items'); upgradeList.innerHTML = ''; UPGRADES.forEach(up => { if(!G[up.id]) { const div = document.createElement('div'); div.className = 'card'; div.style.marginTop = '8px'; div.innerHTML = `<b>${up.icon} ${up.name}</b><br><small style="color:#aaa;">${up.desc}</small><br><button class="btn-action" style="margin-top:8px;" onclick="buyInvest('${up.id}', ${up.price})">–ö–£–ü–ò–¢–¨ (${up.price} PLN)</button>`; upgradeList.appendChild(div); } });
        const qBar = document.getElementById('quest-bar'); if (order.visible && curView === 'main') { qBar.style.display = 'block'; if (order.active) { document.getElementById('quest-actions-choice').style.display = 'none'; document.getElementById('quest-active-ui').style.display = 'block'; document.getElementById('quest-timer-ui').innerText = `${Math.floor(order.time/60)}:${(order.time%60<10?'0':'')+order.time%60}`; document.getElementById('quest-progress-bar').style.width = (order.steps / order.target * 100) + "%"; } else { document.getElementById('quest-actions-choice').style.display = 'flex'; document.getElementById('quest-active-ui').style.display = 'none'; document.getElementById('quest-timer-ui').innerText = `0:${(order.offerTimer<10?'0':'')+order.offerTimer}`; } } else { qBar.style.display = 'none'; }
        document.getElementById('buy-bike-rent').innerText = G.bikeRentTime > 0 ? "–í –ê–†–ï–ù–î–ï" : "–ê–†–ï–ù–î–û–í–ê–¢–¨ (30 PLN)";
        document.getElementById('click-rate-ui').innerText = (0.10 * Math.max(0.1, G.lvl) * DISTRICTS[G.district].mult).toFixed(2) + " PLN";
        renderBank(); renderMilestones();
    }

    function doWork() {
        if (isBroken) return;
        if (G.waterStock > 0 && G.en < (G.maxEn - 10)) { let eff = 1 + (Math.max(0.1, G.lvl) * 0.1); let drink = Math.min(G.waterStock, 50); G.en = Math.min(G.maxEn, G.en + (drink * eff)); G.waterStock -= drink; save(); }
        if (G.en < 1) return;
        if(order.active) { consumeResources(true); order.steps += (G.bikeRentTime > 0 ? 2 : 1); if (G.bikeRentTime > 0 && Math.random() < 0.002) { triggerBreakdown(); return; } if(order.steps >= order.target) finishOrder(true); updateUI(); return; }
        if(!order.visible) { if(Math.random() < (G.phone ? 0.35 : 0.18)) generateOrder(); }
        consumeResources(false);
        let gain = 0.10 * Math.max(0.1, G.lvl) * DISTRICTS[G.district].mult;
        G.money = parseFloat((G.money + gain).toFixed(2));
        G.lvl += 0.00025; G.totalClicks++; checkMilestones(); updateUI(); save();
    }

    function consumeResources(isOrder) {
        if (G.buffTime > 0) { if (isOrder || Math.random() < 0.2) G.waterStock = Math.max(0, G.waterStock - (isOrder ? 8 : 2)); return; }
        let cost = (G.scooter ? 7 : 10); if (G.bikeRentTime > 0) cost *= 0.5; if (weather === "–î–æ–∂–¥—å") cost *= 1.2; if (isOrder) cost *= 1.5; 
        G.en = Math.max(0, G.en - cost); G.waterStock = Math.max(0, G.waterStock - (isOrder ? 10 : 3));
    }

    function generateOrder() { if (order.visible || order.active) return; order.visible = true; order.offerTimer = 15; order.isCriminal = Math.random() < 0.08; let d = 0.5 + Math.random() * 3.5; let baseRew = (3.80 + d * 2.2) * Math.max(0.1, G.lvl) * DISTRICTS[G.district].mult * (G.bag ? 1.15 : 1) * (weather === "–î–æ–∂–¥—å" ? 1.5 : 1); if(order.isCriminal) baseRew *= 5; order.reward = parseFloat(baseRew.toFixed(2)); order.target = Math.floor(d * 160); order.steps = 0; order.time = Math.floor(order.target / 1.5 + 45); document.getElementById('quest-pay').innerText = order.reward.toFixed(2); updateUI(); }
    function activateAutopilot() { if(G.money >= 45 && G.lvl >= 0.15) { G.money = parseFloat((G.money - 45).toFixed(2)); G.lvl -= 0.15; G.autoTime += 600; acceptOrder(); save(); updateUI(); } }
    function acceptOrder() { order.active = true; updateUI(); }
    function finishOrder(win) { if(win) { if(order.isCriminal && Math.random() < 0.2) { G.lvl -= 1.0; G.money = parseFloat((G.money - 100).toFixed(2)); log("üöî –ü–û–õ–ò–¶–ò–Ø! –®—Ç—Ä–∞—Ñ -100", "var(--danger)"); } else { G.money = parseFloat((G.money + order.reward).toFixed(2)); G.lvl += (order.isCriminal ? 0.1 : 0.015); G.totalOrders++; if(Math.random() < 0.40) { let tip = 5 + Math.random()*15; G.money = parseFloat((G.money + tip).toFixed(2)); log(`üí∞ –ß–∞–µ–≤—ã–µ: +${tip.toFixed(2)}`, "var(--success)"); } } } order.active = false; order.visible = false; updateUI(); save(); }
    function checkMilestones() { G.activeMilestones.forEach((m, i) => { let cur = m.type === 'orders' ? G.totalOrders : m.type === 'clicks' ? G.totalClicks : G.totalBottles; if(cur >= m.goal) { G.money = parseFloat((G.money + m.reward).toFixed(2)); G.lvl += 0.01; log(`üèÜ –î–û–°–¢–ò–ñ–ï–ù–ò–ï: ${m.name}`, "var(--gold)"); G.activeMilestones[i] = { id: Date.now()+i, name: m.name, goal: cur + Math.floor(m.goal*0.6), type: m.type, reward: m.reward + 20 }; save(); } }); }
    function renderMilestones() { document.getElementById('milestones-list').innerHTML = G.activeMilestones.map(m => { let cur = m.type === 'orders' ? G.totalOrders : m.type === 'clicks' ? G.totalClicks : G.totalBottles; return `<div class="card" style="margin-top:8px;"><b>${m.name}</b><div class="career-progress"><div class="career-fill" style="width:${Math.min(100,(cur/m.goal*100))}%"></div></div><small>${cur}/${m.goal}</small></div>`; }).join(''); }
    function collectBottles() { G.money = parseFloat((G.money + 0.02).toFixed(2)); G.totalBottles++; checkMilestones(); save(); updateUI(); }
    function buyWater() { if(G.money >= 1.50) { G.money = parseFloat((G.money - 1.50).toFixed(2)); G.waterStock += 1500; save(); updateUI(); } }
    function buyDrink(type, p) { if(G.money >= p) { G.money = parseFloat((G.money - p).toFixed(2)); if(type === 'coffee') G.en = Math.min(G.maxEn, G.en + 300); else G.buffTime += 120; save(); updateUI(); } }
    function buyInvest(type, p) { if(!G[type] && G.money >= p) { G.money = parseFloat((G.money - p).toFixed(2)); G[type] = true; save(); updateUI(); } }
    function rentBike() { if (G.money >= 30) { G.money = parseFloat((G.money - 30).toFixed(2)); G.bikeRentTime += 600; save(); updateUI(); } }
    function exchangeLvl(l, m) { if(G.lvl >= l) { G.lvl -= l; G.money = parseFloat((G.money + m).toFixed(2)); save(); updateUI(); } }
    function switchTab(v, el) { curView = v; document.querySelectorAll('.view').forEach(x => x.classList.remove('active')); document.getElementById('view-'+v).classList.add('active'); document.querySelectorAll('.tab-item').forEach(x => x.classList.remove('active')); el.classList.add('active'); updateUI(); }
    function moveDistrict(id) { if (G.lvl >= DISTRICTS[id].minLvl && G.money >= DISTRICTS[id].price) { G.money = parseFloat((G.money - DISTRICTS[id].price).toFixed(2)); G.district = id; save(); updateUI(); } }
    function triggerBreakdown() { isBroken = true; log("üö≤ –ü–û–õ–û–ú–ö–ê!", "var(--danger)"); G.money = parseFloat((G.money - 7).toFixed(2)); setTimeout(() => { isBroken = false; updateUI(); }, 3000); }
    function renderBank() { const ui = document.getElementById('bank-actions-ui'); ui.innerHTML = G.debt <= 0 ? `<button class="btn-action" onclick="G.money=parseFloat((G.money+50).toFixed(2));G.debt=50;updateUI();save();">–í–ó–Ø–¢–¨ –ö–†–ï–î–ò–¢ (50 PLN)</button>` : `<button class="btn-action" style="background:var(--success)" onclick="if(G.money>=G.debt){G.money=parseFloat((G.money-G.debt).toFixed(2));G.debt=0;updateUI();save();}">–í–ï–†–ù–£–¢–¨ –î–û–õ–ì (${G.debt} PLN)</button>`; }

    setInterval(() => {
        G.tax--; if(G.tax <= 0) { G.money = parseFloat((G.money * 0.75).toFixed(2)); G.tax = 300; log("–ù–∞–ª–æ–≥ 25%"); save(); }
        G.rent--; if(G.rent <= 0) { G.money = parseFloat((G.money - DISTRICTS[G.district].rent).toFixed(2)); G.rent = 600; save(); }
        if (Math.random() < 0.015) weather = Math.random() < 0.35 ? "–î–æ–∂–¥—å" : "–Ø—Å–Ω–æ";
        if (G.bikeRentTime > 0) { G.bikeRentTime--; if (G.bikeRentTime <= 0 && G.money >= 30) { G.money = parseFloat((G.money - 30).toFixed(2)); G.bikeRentTime = 600; } }
        if (G.buffTime > 0) G.buffTime--;
        
        if (G.autoTime > 0) { 
            G.autoTime--;
            if (order.active && !isBroken) {
                // –ê–í–¢–û–ü–ò–õ–û–¢ –£–°–ö–û–†–ï–ù –í 3 –†–ê–ó–ê (–¥–µ–ª–∞–µ—Ç 10 —Ü–∏–∫–ª–æ–≤ –∑–∞ —Å–µ–∫—É–Ω–¥—É)
                for(let i=0; i<10; i++) {
                    if(!order.active || isBroken) break;
                    // –ê–≤—Ç–æ-–ø–∏—Ç—å–µ –≤–æ–¥—ã (—É—Å–∏–ª–µ–Ω–æ –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏)
                    if (G.waterStock > 0 && G.en < 600) { 
                        let eff = 1 + (Math.max(0.1, G.lvl) * 0.1); 
                        G.en = Math.min(G.maxEn, G.en + (15 * eff)); 
                        G.waterStock -= 15; 
                    }
                    if (G.en > 5) { 
                        consumeResources(true); 
                        order.steps += (G.bikeRentTime > 0 ? 3 : 2); 
                        if (order.steps >= order.target) { finishOrder(true); break; }
                    }
                }
            }
        }
        
        if(order.visible && !order.active) { order.offerTimer--; if(order.offerTimer <= 0) { order.visible = false; G.lvl -= 0.02; } }
        if(order.active) { order.time--; if(order.time <= 0) finishOrder(false); }
        document.getElementById('tax-timer').innerText = `–ù–∞–ª–æ–≥ —á–µ—Ä–µ–∑: ${Math.floor(G.tax/60)}:${G.tax%60<10?'0':''}${G.tax%60}`;
        document.getElementById('rent-timer').innerText = `–ê—Ä–µ–Ω–¥–∞ —á–µ—Ä–µ–∑: ${Math.floor(G.rent/60)}:${G.rent%60<10?'0':''}${G.rent%60}`;
        updateUI();
    }, 1000);
    window.onload = load;
</script>
</body>
</html>
