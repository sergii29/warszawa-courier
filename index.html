<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Warszawa Life Simulator</title>
    <style>
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-main: #e0e0e0;
            --text-muted: #a0a0a0;
            --accent: #bb86fc;
            --success: #03dac6;
            --danger: #cf6679;
            --warning: #ffb74d;
            --border: #333;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- Header --- */
        header {
            background-color: var(--card-bg);
            padding: 10px 15px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
        }

        .location {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .balance {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--success);
        }

        /* --- Stats Bar --- */
        #stats-bar {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 5px;
            padding: 10px;
            background-color: var(--bg-color);
        }

        .stat-item {
            background-color: var(--card-bg);
            padding: 5px;
            border-radius: 5px;
            text-align: center;
            font-size: 0.75rem;
            position: relative;
            overflow: hidden;
        }

        .stat-value {
            font-weight: bold;
            display: block;
            margin-bottom: 2px;
        }

        .stat-label {
            color: var(--text-muted);
            font-size: 0.65rem;
        }

        /* --- Main Content Area --- */
        #game-container {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            padding-bottom: 80px; /* Space for footer */
        }

        /* --- Tabs & Sections --- */
        .section {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h2 {
            margin-top: 0;
            font-size: 1.4rem;
            color: var(--accent);
            border-bottom: 1px solid var(--border);
            padding-bottom: 10px;
        }

        /* --- Cards & Interactive Elements --- */
        .card {
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            border: 1px solid var(--border);
        }

        .btn {
            background-color: var(--accent);
            color: #000;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            transition: opacity 0.2s;
            font-size: 0.95rem;
        }

        .btn:active {
            opacity: 0.8;
            transform: scale(0.98);
        }

        .btn.secondary {
            background-color: transparent;
            border: 1px solid var(--accent);
            color: var(--accent);
        }

        .btn.danger {
            background-color: var(--danger);
            color: white;
        }
        
        .btn:disabled {
            background-color: #444;
            color: #888;
            cursor: not-allowed;
            border: none;
        }

        .job-status {
            font-size: 0.9rem;
            margin-bottom: 10px;
            padding: 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 5px;
        }

        .progress-bar {
            height: 6px;
            background: #333;
            border-radius: 3px;
            margin-top: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--success);
            width: 0%;
            transition: width 0.3s;
        }

        /* --- Footer Nav --- */
        nav {
            position: fixed;
            bottom: 0;
            width: 100%;
            background-color: var(--card-bg);
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            z-index: 20;
        }

        .nav-item {
            color: var(--text-muted);
            text-decoration: none;
            font-size: 0.7rem;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 20%;
        }

        .nav-item span {
            font-size: 1.2rem;
            margin-bottom: 2px;
        }

        .nav-item.active {
            color: var(--accent);
        }

        /* Notifications */
        #notification-area {
            position: fixed;
            top: 60px;
            right: 15px;
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: none;
        }

        .toast {
            background-color: rgba(30, 30, 30, 0.95);
            border-left: 4px solid var(--accent);
            padding: 10px 15px;
            border-radius: 4px;
            color: #fff;
            font-size: 0.85rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
            animation: slideIn 0.3s ease;
            pointer-events: auto;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 50;
        }

        .modal {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
            text-align: center;
        }
        
        .item-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #333;
        }
        .item-info {
            text-align: left;
        }
        .item-name { font-weight: bold; font-size: 0.9rem; }
        .item-desc { font-size: 0.75rem; color: var(--text-muted); }

    </style>
</head>
<body>

    <header>
        <div>
            <div style="font-weight: bold; color: white;">Warszawa Life</div>
            <div class="location">üìç Warszawa, Mazowieckie</div>
        </div>
        <div class="balance" id="ui-balance">0 PLN</div>
    </header>

    <div id="stats-bar">
        <div class="stat-item">
            <span class="stat-value" id="ui-energy">100%</span>
            <span class="stat-label">–≠–Ω–µ—Ä–≥–∏—è</span>
        </div>
        <div class="stat-item">
            <span class="stat-value" id="ui-water">100%</span>
            <span class="stat-label">–í–æ–¥–∞</span>
        </div>
        <div class="stat-item">
            <span class="stat-value" id="ui-satiety">100%</span>
            <span class="stat-label">–ï–¥–∞</span>
        </div>
        <div class="stat-item">
            <span class="stat-value" id="ui-mood">100%</span>
            <span class="stat-label">–ù–∞—Å—Ç—Ä.</span>
        </div>
    </div>

    <div id="notification-area"></div>

    <div id="game-container">
        <div id="section-courier" class="section active">
            <h2>üì¶ –†–∞–±–æ—Ç–∞ –ö—É—Ä—å–µ—Ä–æ–º</h2>
            <div class="card">
                <h3>Glovo/Uber Eats</h3>
                <p class="job-status" id="courier-status">–°—Ç–∞—Ç—É—Å: –°–≤–æ–±–æ–¥–µ–Ω</p>
                
                <div id="manual-courier-panel">
                    <button class="btn" id="btn-take-order" onclick="startOrder()">–í–∑—è—Ç—å –∑–∞–∫–∞–∑</button>
                    <div id="order-progress-ui" style="display:none;">
                        <p style="font-size:0.8rem; margin-bottom:5px;">–î–æ—Å—Ç–∞–≤–∫–∞...</p>
                        <div class="progress-bar"><div class="progress-fill" id="order-bar"></div></div>
                    </div>
                </div>

                <div style="margin-top: 20px; border-top: 1px solid #333; padding-top: 10px;">
                    <h4>–ê–≤—Ç–æ-–ö—É—Ä—å–µ—Ä (–ë–æ—Ç)</h4>
                    <p style="font-size: 0.8rem; color: var(--text-muted);">
                        –¢—Ä–µ–±—É–µ—Ç: –í–µ–ª–æ—Å–∏–ø–µ–¥/–°–∫—É—Ç–µ—Ä + –õ–∏—Ü–µ–Ω–∑–∏—è.<br>
                        <span style="color: var(--warning);">–í–Ω–∏–º–∞–Ω–∏–µ: –¢—Ä–∞—Ç–∏—Ç –≤–æ–¥—É –∏ —ç–Ω–µ—Ä–≥–∏—é.</span>
                    </p>
                    <button class="btn secondary" id="btn-auto-courier" onclick="toggleAutoCourier()">–í–∫–ª—é—á–∏—Ç—å –±–æ—Ç–∞</button>
                </div>
            </div>
            
            <div class="card" id="active-boosts" style="display:none;">
                <h4>‚ö° –ê–∫—Ç–∏–≤–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã</h4>
                <div id="boost-list"></div>
            </div>
        </div>

        <div id="section-career" class="section">
            <h2>üíº –ö–∞—Ä—å–µ—Ä–∞ –∏ –ù–∞–≤—ã–∫–∏</h2>
            
            <div class="card">
                <h3>–ù–∞–≤—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
                <p>–£—Ä–æ–≤–µ–Ω—å: <span id="coding-lvl">0</span> <span style="font-size:0.8rem; color:var(--accent);">Python Dev</span></p>
                <div class="progress-bar"><div class="progress-fill" id="coding-bar" style="width: 0%"></div></div>
                <button class="btn" onclick="studyCoding()">–£—á–∏—Ç—å Python (-10 –≠–Ω–µ—Ä–≥–∏–∏)</button>
            </div>

            <div class="card">
                <h3>–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è</h3>
                <div id="daily-tasks-list">
                    </div>
            </div>
        </div>

        <div id="section-business" class="section">
            <h2>üìà –ë–∏–∑–Ω–µ—Å</h2>
            <div id="business-container">
                </div>
        </div>

        <div id="section-shop" class="section">
            <h2>üõí –ú–∞–≥–∞–∑–∏–Ω</h2>
            
            <div class="card">
                <h3>–†–∞—Å—Ö–æ–¥–Ω–∏–∫–∏</h3>
                <div id="consumables-list"></div>
            </div>

            <div class="card">
                <h3>–ò–º—É—â–µ—Å—Ç–≤–æ & –ì–∞–¥–∂–µ—Ç—ã</h3>
                <div id="inventory-shop-list"></div>
            </div>
            
             <div class="card">
                <h3>–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å (–ê—Ä–µ–Ω–¥–∞)</h3>
                <div id="real-estate-list"></div>
            </div>
        </div>

        <div id="section-settings" class="section">
            <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
            <div class="card">
                <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–π</h3>
                <p style="font-size: 0.8rem; color: var(--text-muted);">
                    –í–µ—Ä—Å–∏—è: 2.1 (Warszawa Forever)<br>
                    ID: PL-WAW-2026
                </p>
                <button class="btn danger" onclick="fullReset()">üõë –ü–û–õ–ù–´–ô –°–ë–†–û–° (RESET)</button>
                <p style="font-size: 0.75rem; color: var(--danger); margin-top: 5px;">
                    –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç –≤—Å—ë: –¥–µ–Ω—å–≥–∏, –Ω–∞–≤—ã–∫–∏, –ø–æ–∫—É–ø–∫–∏, –Ω–∞–ª–æ–≥–∏ –∏ –±–∏–∑–Ω–µ—Å.
                </p>
            </div>
            
            <div class="card">
                 <h3>–°—Ç–∞—Ç—É—Å –ì—Ä–∞–∂–¥–∞–Ω–∏–Ω–∞</h3>
                 <p>–ù–∞–ª–æ–≥ (ZUS/PIT): <span id="tax-timer">0</span> –¥–Ω. –æ—Å—Ç–∞–ª–æ—Å—å</p>
                 <button class="btn secondary" onclick="payTax()">–û–ø–ª–∞—Ç–∏—Ç—å –Ω–∞–ª–æ–≥ (500 PLN)</button>
            </div>
        </div>
    </div>

    <nav>
        <a href="#" class="nav-item active" onclick="switchTab('courier', this)">
            <span>üö≤</span> –ö—É—Ä—å–µ—Ä
        </a>
        <a href="#" class="nav-item" onclick="switchTab('career', this)">
            <span>üíº</span> –ö–∞—Ä—å–µ—Ä–∞
        </a>
        <a href="#" class="nav-item" onclick="switchTab('business', this)">
            <span>üìà</span> –ë–∏–∑–Ω–µ—Å
        </a>
        <a href="#" class="nav-item" onclick="switchTab('shop', this)">
            <span>üõí</span> –ú–∞–≥–∞–∑–∏–Ω
        </a>
        <a href="#" class="nav-item" onclick="switchTab('settings', this)">
            <span>‚öôÔ∏è</span> –ù–∞—Å—Ç—Ä.
        </a>
    </nav>

    <div id="modal" class="modal-overlay">
        <div class="modal">
            <h3 id="modal-title">–°–æ–æ–±—â–µ–Ω–∏–µ</h3>
            <p id="modal-body">–¢–µ–∫—Å—Ç...</p>
            <button class="btn" onclick="closeModal()">OK</button>
        </div>
    </div>

<script>
/**
 * WARSZAWA LIFE SIMULATOR
 * Key: WARSZAWA_FOREVER
 * Updated: 2026-01-18
 */

const SAVE_KEY = 'WARSZAWA_FOREVER';

// --- Default Configuration ---
const DEFAULTS = {
    balance: 50,
    rating: 4.5,
    energy: 100,
    water: 100,
    satiety: 100,
    mood: 100,
    
    // Skills
    codingXp: 0,
    codingLevel: 0,
    
    // Inventory & Assets
    inventory: [], // IDs of owned items
    activeBoosts: {}, // { 'energy_drink': expiryTime }
    
    // Business
    business: null, // { type: 'kebab', level: 1, lastCollection: time }
    
    // Housing
    housing: 'homeless', // 'homeless', 'hostel', 'apartment'
    rentTimer: 0, // Days until payment
    
    // Status
    taxTimer: 7, // Days until tax
    daysPlayed: 0,
    
    // Automation
    autoCourierEnabled: false,
    
    // Daily Tasks
    lastDayLogin: 0,
    dailyTasks: {
        'deliver5': { count: 0, target: 5, reward: 50, done: false, desc: '–î–æ—Å—Ç–∞–≤–∏—Ç—å 5 –∑–∞–∫–∞–∑–æ–≤ (+50 PLN)' },
        'study1': { count: 0, target: 1, reward: 20, done: false, desc: '–ü–æ—É—á–∏—Ç—å—Å—è 1 —Ä–∞–∑ (+20 PLN)' }
    }
};

// --- Game State ---
let state = JSON.parse(JSON.stringify(DEFAULTS));
let gameLoopInterval;
let autoCourierInterval;

// --- Database (Items, Business) ---
const ITEMS = {
    'water_bottle': { name: '–í–æ–¥–∞ (0.5–ª)', price: 3, type: 'consumable', effect: { water: 25 }, desc: '–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤–æ–¥—É' },
    'kebab': { name: '–ö–µ–±–∞–±', price: 18, type: 'consumable', effect: { satiety: 40, energy: 10 }, desc: '–°—ã—Ç–Ω–æ –∏ –≤–∫—É—Å–Ω–æ' },
    'energy_drink': { name: '–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫', price: 8, type: 'consumable', effect: { energy: 30, mood: 5, special: 'pause_energy' }, desc: '–≠–Ω–µ—Ä–≥–∏—è –Ω–µ —Ç—Ä–∞—Ç–∏—Ç—Å—è 2 –º–∏–Ω, –Ω–æ –≤–æ–¥–∞ —Ç—Ä–∞—Ç–∏—Ç—Å—è!' },
    
    'bicycle': { name: '–í–µ–ª–æ—Å–∏–ø–µ–¥', price: 300, type: 'gear', desc: '–û—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∞–≤—Ç–æ-–∫—É—Ä—å–µ—Ä—É (–º–µ–¥–ª–µ–Ω–Ω–æ)' },
    'scooter': { name: '–≠–ª–µ–∫—Ç—Ä–æ—Å–∫—É—Ç–µ—Ä', price: 1500, type: 'gear', desc: '–ë—ã—Å—Ç—Ä—ã–π –∞–≤—Ç–æ-–∫—É—Ä—å–µ—Ä' },
    'laptop': { name: '–ù–æ—É—Ç–±—É–∫', price: 2500, type: 'gear', desc: '–ù—É–∂–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–æ–º' },
    
    'hostel': { name: '–ö–æ–π–∫–∞ –≤ —Ö–æ—Å—Ç–µ–ª–µ', price: 50, type: 'rent', period: 1, desc: '–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏ –≤–æ —Å–Ω–µ' },
    'apartment': { name: '–ö–≤–∞—Ä—Ç–∏—Ä–∞ (–°—Ç—É–¥–∏—è)', price: 2000, type: 'rent', period: 30, desc: '–í—ã—Å–æ–∫–∏–π –∫–æ–º—Ñ–æ—Ä—Ç' }
};

const BUSINESSES = [
    { id: 'vending', name: '–í–µ–Ω–¥–∏–Ω–≥', cost: 1000, income: 100, desc: '–ê–≤—Ç–æ–º–∞—Ç —Å –±–∞—Ç–æ–Ω—á–∏–∫–∞–º–∏. –î–æ—Ö–æ–¥ 100/–¥–µ–Ω—å' },
    { id: 'kebab_spot', name: '–¢–æ—á–∫–∞ —Å –ö–µ–±–∞–±–æ–º', cost: 5000, income: 600, desc: '–ú–∞–ª—ã–π –±–∏–∑–Ω–µ—Å. –î–æ—Ö–æ–¥ 600/–¥–µ–Ω—å' },
    { id: 'software_agency', name: 'IT –ê–≥–µ–Ω—Ç—Å—Ç–≤–æ', cost: 15000, income: 2000, desc: '–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ü–û. –î–æ—Ö–æ–¥ 2000/–¥–µ–Ω—å' }
];

// --- Initialization ---

function init() {
    loadGame();
    setupUI();
    startGameLoop();
    renderAll();
    checkDailyReset();
}

function loadGame() {
    const saved = localStorage.getItem(SAVE_KEY);
    if (saved) {
        try {
            const parsed = JSON.parse(saved);
            // Merge defaults to handle version updates
            state = { ...DEFAULTS, ...parsed };
            
            // Ensure nested objects merge correctly if missing in save
            if(!state.dailyTasks) state.dailyTasks = JSON.parse(JSON.stringify(DEFAULTS.dailyTasks));
        } catch (e) {
            console.error("Save corrupted, resetting to defaults");
            state = JSON.parse(JSON.stringify(DEFAULTS));
        }
    }
}

function saveGame() {
    localStorage.setItem(SAVE_KEY, JSON.stringify(state));
}

// --- Core Mechanics ---

function startGameLoop() {
    if (gameLoopInterval) clearInterval(gameLoopInterval);
    
    gameLoopInterval = setInterval(() => {
        // Passive stat drain (every 3 seconds real time = approx 1 game "tick")
        // Stats drain slower if housing is good (logic simplified here)
        
        changeStat('satiety', -0.5);
        changeStat('water', -0.8);
        changeStat('mood', -0.2);
        
        // Energy drain check (Boost logic)
        const energyBoost = isBoostActive('pause_energy');
        if (!energyBoost) {
             // Normal drain
             changeStat('energy', -0.3);
        } else {
            // Boost active: Energy paused, but Water still drains extra as per user request
            // Logic handled in render (visual) and here
        }
        
        // Auto Courier Logic
        if (state.autoCourierEnabled) {
            processAutoCourier();
        }
        
        // Business Passive Income (simulated per tick slightly)
        // Ideally business income is collected daily, but let's make it drip
        // Implementation: Add to hidden accumulator or just daily event. 
        // For simplicity: Manual collection or daily triggers. Let's use Daily Trigger in checkDailyReset
        
        // Check Game Over
        if (state.satiety <= 0 || state.water <= 0) {
            showNotification("‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ! –ö—É–ø–∏—Ç–µ –µ–¥—É –∏–ª–∏ –≤–æ–¥—É!", "danger");
            state.health = (state.health || 100) - 5;
        }

        saveGame();
        renderStats();
        updateBoosts();
    }, 3000);
}

function changeStat(stat, val) {
    state[stat] += val;
    if (state[stat] > 100) state[stat] = 100;
    if (state[stat] < 0) state[stat] = 0;
    renderStats();
}

// --- Courier Logic ---

function startOrder() {
    if (state.energy < 10 || state.satiety < 5) {
        showNotification("–°–ª–∏—à–∫–æ–º —É—Å—Ç–∞–ª –∏–ª–∏ –≥–æ–ª–æ–¥–µ–Ω!", "danger");
        return;
    }
    
    const btn = document.getElementById('btn-take-order');
    const progressUI = document.getElementById('order-progress-ui');
    const bar = document.getElementById('order-bar');
    
    btn.style.display = 'none';
    progressUI.style.display = 'block';
    bar.style.width = '0%';
    
    let width = 0;
    const interval = setInterval(() => {
        width += 5;
        bar.style.width = width + '%';
        
        if (width >= 100) {
            clearInterval(interval);
            completeOrder();
            btn.style.display = 'block';
            progressUI.style.display = 'none';
        }
    }, 100); // 2 seconds total
}

function completeOrder() {
    const basePay = 10 + (Math.random() * 5);
    const pay = Math.floor(basePay);
    
    state.balance += pay;
    changeStat('energy', -5);
    changeStat('water', -2); // Courier works, gets thirsty
    
    updateTask('deliver5', 1);
    
    showNotification(`–ó–∞–∫–∞–∑ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω! +${pay} PLN`, "success");
    saveGame();
    renderAll();
}

function toggleAutoCourier() {
    const hasBike = state.inventory.includes('bicycle');
    const hasScooter = state.inventory.includes('scooter');
    
    if (!hasBike && !hasScooter) {
        showModal("–û—à–∏–±–∫–∞", "–î–ª—è –∞–≤—Ç–æ-–∫—É—Ä—å–µ—Ä–∞ –Ω—É–∂–µ–Ω –í–µ–ª–æ—Å–∏–ø–µ–¥ –∏–ª–∏ –°–∫—É—Ç–µ—Ä!");
        return;
    }
    
    state.autoCourierEnabled = !state.autoCourierEnabled;
    renderCourier();
}

function processAutoCourier() {
    // Costs
    if (state.energy < 5 || state.water < 5) {
        state.autoCourierEnabled = false;
        showNotification("–ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: –Ω—É–∂–Ω–∞ –≤–æ–¥–∞ –∏–ª–∏ —ç–Ω–µ—Ä–≥–∏—è", "danger");
        renderCourier();
        return;
    }
    
    // Efficiency
    const isScooter = state.inventory.includes('scooter');
    const chance = isScooter ? 0.4 : 0.2; // Chance to complete order per tick
    
    if (Math.random() < chance) {
        const pay = isScooter ? 18 : 12;
        state.balance += pay;
        updateTask('deliver5', 1);
        
        // CONSUME RESOURCES (User requirement: water and energy must be consumed)
        // Energy drink logic: if boost active, don't drain energy, but drain water
        const energyBoost = isBoostActive('pause_energy');
        
        if (!energyBoost) {
            changeStat('energy', -3);
        }
        changeStat('water', -3); // Water drains regardless
        
        showNotification(`ü§ñ –ë–æ—Ç: +${pay} PLN`, "success");
    }
}

// --- Career & Skills ---

function studyCoding() {
    if (state.energy < 10) {
        showNotification("–ù—É–∂–Ω–∞ —ç–Ω–µ—Ä–≥–∏—è!", "warning");
        return;
    }
    
    state.energy -= 10;
    state.codingXp += 10;
    
    // Level up logic
    const req = (state.codingLevel + 1) * 50;
    if (state.codingXp >= req) {
        state.codingLevel++;
        state.codingXp = 0;
        showNotification(`–£—Ä–æ–≤–µ–Ω—å –ø–æ–≤—ã—à–µ–Ω! –¢–µ–ø–µ—Ä—å LVL ${state.codingLevel}`, "accent");
    }
    
    updateTask('study1', 1);
    renderCareer();
    renderStats();
}

function updateTask(taskId, amount) {
    const task = state.dailyTasks[taskId];
    if (task && !task.done) {
        task.count += amount;
        if (task.count >= task.target) {
            task.done = true;
            state.balance += task.reward;
            showNotification(`–ó–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ! +${task.reward} PLN`, "accent");
        }
        renderCareer();
    }
}

function checkDailyReset() {
    // Simple mock for daily reset based on sessions/time could be complex
    // Here we just ensure structure exists. In a real app, compare Date.now()
}

// --- Shop & Inventory ---

function buyItem(id) {
    const item = ITEMS[id];
    if (state.balance >= item.price) {
        
        // Inventory Check
        if (item.type === 'gear' && state.inventory.includes(id)) {
            showNotification("–£ –≤–∞—Å —ç—Ç–æ —É–∂–µ –µ—Å—Ç—å!", "warning");
            return;
        }

        state.balance -= item.price;
        
        if (item.type === 'consumable') {
            applyConsumable(item);
        } else if (item.type === 'gear') {
            state.inventory.push(id);
            showNotification(`–ö—É–ø–ª–µ–Ω–æ: ${item.name}`, "success");
        } else if (item.type === 'rent') {
            // Rent logic
            state.housing = id;
            state.rentTimer = item.period; // Reset timer
            showNotification(`–ê—Ä–µ–Ω–¥–æ–≤–∞–Ω–æ: ${item.name}`, "success");
        }
        
        saveGame();
        renderAll();
    } else {
        showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤", "danger");
    }
}

function applyConsumable(item) {
    if (item.effect.water) changeStat('water', item.effect.water);
    if (item.effect.satiety) changeStat('satiety', item.effect.satiety);
    if (item.effect.energy) changeStat('energy', item.effect.energy);
    if (item.effect.mood) changeStat('mood', item.effect.mood);
    
    if (item.effect.special === 'pause_energy') {
        // 2 minutes (120000 ms) boost
        const expiry = Date.now() + 120000;
        state.activeBoosts['pause_energy'] = expiry;
        showNotification("‚ö° –≠–Ω–µ—Ä–≥–µ—Ç–∏–∫: –≠–Ω–µ—Ä–≥–∏—è –Ω–µ –ø–∞–¥–∞–µ—Ç 2 –º–∏–Ω!", "accent");
    } else {
        showNotification(`–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: ${item.name}`, "success");
    }
}

function isBoostActive(type) {
    if (!state.activeBoosts || !state.activeBoosts[type]) return false;
    if (Date.now() > state.activeBoosts[type]) {
        delete state.activeBoosts[type];
        return false;
    }
    return true;
}

function updateBoosts() {
    const list = document.getElementById('boost-list');
    const container = document.getElementById('active-boosts');
    let content = '';
    let hasBoosts = false;
    
    if (isBoostActive('pause_energy')) {
        const left = Math.ceil((state.activeBoosts['pause_energy'] - Date.now()) / 1000);
        content += `<div style="color:var(--warning); font-size:0.8rem;">‚ö° –≠–Ω–µ—Ä–≥–µ—Ç–∏–∫: ${left} —Å–µ–∫. (–¢—Ä–∞—Ç–∏—à—å —Ç–æ–ª—å–∫–æ –≤–æ–¥—É)</div>`;
        hasBoosts = true;
    }
    
    if (hasBoosts) {
        container.style.display = 'block';
        list.innerHTML = content;
    } else {
        container.style.display = 'none';
    }
}

// --- Business Logic ---

function buyBusiness(index) {
    const biz = BUSINESSES[index];
    if (state.business) {
        showNotification("–£ –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –±–∏–∑–Ω–µ—Å!", "warning");
        return;
    }
    
    if (state.balance >= biz.cost) {
        state.balance -= biz.cost;
        state.business = { id: biz.id, level: 1, name: biz.name };
        showNotification(`–ë–∏–∑–Ω–µ—Å "${biz.name}" –∫—É–ø–ª–µ–Ω!`, "success");
        saveGame();
        renderBusiness();
        renderHeader();
    } else {
        showNotification("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–µ–Ω–µ–≥", "danger");
    }
}

function collectBusinessIncome() {
    if (!state.business) return;
    
    // Find biz definition
    const def = BUSINESSES.find(b => b.id === state.business.id);
    if (def) {
        // Simple manual collection mechanic for engagement
        // Or simulation of daily income. Let's do instant small collection for gameplay flow
        // "Collect profits" action
        showNotification(`–°–æ–±—Ä–∞–Ω–∞ –ø—Ä–∏–±—ã–ª—å: ${def.income} PLN`, "success");
        state.balance += def.income;
        saveGame();
        renderHeader();
    }
}

// --- Admin / Settings / Reset ---

function fullReset() {
    if (confirm("–í–´ –£–í–ï–†–ï–ù–´? –≠—Ç–æ —É–¥–∞–ª–∏—Ç –í–ï–°–¨ –ø—Ä–æ–≥—Ä–µ—Å—Å, –ø–æ–∫—É–ø–∫–∏ –∏ –Ω–∞–≤—ã–∫–∏.")) {
        // 1. Clear Storage
        localStorage.removeItem(SAVE_KEY);
        // 2. Hard Reload to ensure all memory states are cleared
        location.reload(); 
    }
}

function payTax() {
    if (state.balance >= 500) {
        state.balance -= 500;
        state.taxTimer = 7; // Reset to week
        showNotification("–ù–∞–ª–æ–≥ –æ–ø–ª–∞—á–µ–Ω", "success");
        saveGame();
        renderHeader();
        renderSettings();
    } else {
        showNotification("–ù–µ—Ç 500 PLN –Ω–∞ –Ω–∞–ª–æ–≥", "danger");
    }
}

// --- UI Rendering ---

function renderAll() {
    renderHeader();
    renderStats();
    renderCourier();
    renderCareer();
    renderShop();
    renderBusiness();
    renderSettings();
}

function renderHeader() {
    document.getElementById('ui-balance').textContent = Math.floor(state.balance) + ' PLN';
}

function renderStats() {
    document.getElementById('ui-energy').textContent = Math.floor(state.energy) + '%';
    document.getElementById('ui-water').textContent = Math.floor(state.water) + '%';
    document.getElementById('ui-satiety').textContent = Math.floor(state.satiety) + '%';
    document.getElementById('ui-mood').textContent = Math.floor(state.mood) + '%';
    
    // Color coding
    document.getElementById('ui-energy').style.color = state.energy < 20 ? 'var(--danger)' : 'white';
    document.getElementById('ui-water').style.color = state.water < 20 ? 'var(--danger)' : 'white';
}

function renderCourier() {
    const status = document.getElementById('courier-status');
    const btnAuto = document.getElementById('btn-auto-courier');
    
    if (state.autoCourierEnabled) {
        status.innerHTML = "–°—Ç–∞—Ç—É—Å: <span style='color:var(--accent)'>ü§ñ –ê–í–¢–û-–ë–û–¢ –†–ê–ë–û–¢–ê–ï–¢</span>";
        btnAuto.textContent = "–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–æ—Ç–∞";
        btnAuto.classList.add('danger');
        btnAuto.classList.remove('secondary');
    } else {
        status.innerHTML = "–°—Ç–∞—Ç—É—Å: –°–≤–æ–±–æ–¥–µ–Ω";
        btnAuto.textContent = "–í–∫–ª—é—á–∏—Ç—å –±–æ—Ç–∞";
        btnAuto.classList.remove('danger');
        btnAuto.classList.add('secondary');
    }
}

function renderCareer() {
    // Coding
    document.getElementById('coding-lvl').textContent = state.codingLevel;
    const nextLvl = (state.codingLevel + 1) * 50;
    const pct = (state.codingXp / nextLvl) * 100;
    document.getElementById('coding-bar').style.width = pct + '%';
    
    // Tasks
    const list = document.getElementById('daily-tasks-list');
    list.innerHTML = '';
    
    for (const key in state.dailyTasks) {
        const t = state.dailyTasks[key];
        const color = t.done ? 'var(--success)' : 'white';
        const check = t.done ? '‚úÖ' : '‚¨ú';
        list.innerHTML += `
            <div style="display:flex; justify-content:space-between; margin-bottom:5px; font-size:0.9rem; color:${color}">
                <span>${t.desc}</span>
                <span>${t.count}/${t.target} ${check}</span>
            </div>
        `;
    }
}

function renderShop() {
    // Consumables
    const conList = document.getElementById('consumables-list');
    conList.innerHTML = '';
    ['water_bottle', 'kebab', 'energy_drink'].forEach(id => {
        const item = ITEMS[id];
        conList.innerHTML += `
            <div class="item-row">
                <div class="item-info">
                    <div class="item-name">${item.name}</div>
                    <div class="item-desc">${item.desc}</div>
                </div>
                <button class="btn" style="width:auto; padding:5px 10px;" onclick="buyItem('${id}')">${item.price} PLN</button>
            </div>
        `;
    });

    // Inventory / Gear
    const invList = document.getElementById('inventory-shop-list');
    invList.innerHTML = '';
    ['bicycle', 'scooter', 'laptop'].forEach(id => {
        const item = ITEMS[id];
        const owned = state.inventory.includes(id);
        const btnHtml = owned 
            ? `<button class="btn secondary" disabled style="width:auto;">–ö—É–ø–ª–µ–Ω–æ</button>`
            : `<button class="btn" style="width:auto;" onclick="buyItem('${id}')">${item.price} PLN</button>`;
            
        invList.innerHTML += `
            <div class="item-row">
                <div class="item-info">
                    <div class="item-name">${item.name}</div>
                    <div class="item-desc">${item.desc}</div>
                </div>
                ${btnHtml}
            </div>
        `;
    });
    
    // Real Estate
    const rentList = document.getElementById('real-estate-list');
    rentList.innerHTML = '';
    ['hostel', 'apartment'].forEach(id => {
        const item = ITEMS[id];
        const isCurrent = state.housing === id;
        
        const btnHtml = isCurrent
            ? `<button class="btn secondary" disabled style="width:auto;">–¢–µ–∫—É—â–µ–µ</button>`
            : `<button class="btn" style="width:auto;" onclick="buyItem('${id}')">${item.price} PLN</button>`;
            
        rentList.innerHTML += `
            <div class="item-row">
                <div class="item-info">
                    <div class="item-name">${item.name}</div>
                    <div class="item-desc">${item.desc}. –ü–µ—Ä–∏–æ–¥: ${item.period} –¥–Ω.</div>
                </div>
                ${btnHtml}
            </div>
        `;
    });
}

function renderBusiness() {
    const container = document.getElementById('business-container');
    
    if (state.business) {
        // Show active business
        container.innerHTML = `
            <div class="card" style="border-color: var(--success);">
                <h3>üè¢ ${state.business.name}</h3>
                <p>–£—Ä–æ–≤–µ–Ω—å: ${state.business.level}</p>
                <p>–°—Ç–∞—Ç—É—Å: –†–∞–±–æ—Ç–∞–µ—Ç</p>
                <button class="btn" onclick="collectBusinessIncome()">–°–æ–±—Ä–∞—Ç—å –ø—Ä–∏–±—ã–ª—å</button>
            </div>
        `;
    } else {
        // Show catalog
        let html = '';
        BUSINESSES.forEach((biz, index) => {
            html += `
                <div class="card">
                    <h3>${biz.name}</h3>
                    <p style="font-size:0.8rem; color:var(--text-muted)">${biz.desc}</p>
                    <p class="balance">–¶–µ–Ω–∞: ${biz.cost} PLN</p>
                    <button class="btn" onclick="buyBusiness(${index})">–ö—É–ø–∏—Ç—å –±–∏–∑–Ω–µ—Å</button>
                </div>
            `;
        });
        container.innerHTML = html;
    }
}

function renderSettings() {
    document.getElementById('tax-timer').textContent = state.taxTimer;
}

// --- Utility ---

function switchTab(tabId, element) {
    document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
    document.getElementById('section-' + tabId).classList.add('active');
    
    document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
    element.classList.add('active');
}

function showNotification(msg, type = 'accent') {
    const area = document.getElementById('notification-area');
    const div = document.createElement('div');
    div.className = 'toast';
    div.style.borderColor = `var(--${type})`;
    div.textContent = msg;
    
    area.appendChild(div);
    
    setTimeout(() => {
        div.style.opacity = '0';
        setTimeout(() => div.remove(), 300);
    }, 3000);
}

function showModal(title, text) {
    document.getElementById('modal-title').textContent = title;
    document.getElementById('modal-body').textContent = text;
    document.getElementById('modal').style.display = 'flex';
}

function closeModal() {
    document.getElementById('modal').style.display = 'none';
}

// Start
init();

</script>
</body>
</html>
