<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Courier Simulator Warszawa</title>
    <style>
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --primary: #3b82f6;
            --accent: #10b981;
            --text-main: #ffffff;
            --text-sec: #a0aec0;
            --danger: #ef4444;
            --warning: #f59e0b;
            --font-main: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        * {
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: var(--font-main);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- HEADER --- */
        .header {
            padding: 15px;
            background: var(--card-bg);
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
        }

        .header-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .menu-btn {
            background: none;
            border: none;
            color: var(--text-main);
            font-size: 1.5rem;
            cursor: pointer;
        }

        /* --- STATS BAR --- */
        .stats-container {
            padding: 15px;
            background: linear-gradient(180deg, var(--card-bg) 0%, var(--bg-color) 100%);
        }

        .balance-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            margin-bottom: 10px;
        }

        .balance-amount {
            font-size: 2rem;
            font-weight: 800;
            color: var(--accent);
            text-shadow: 0 0 10px rgba(16, 185, 129, 0.3);
        }

        .lvl-display {
            font-size: 0.9rem;
            color: var(--text-sec);
            font-family: monospace;
        }

        .resources-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            margin-bottom: 5px;
            color: var(--text-sec);
        }

        .res-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .energy-bar-bg {
            width: 100%;
            height: 6px;
            background: #333;
            border-radius: 3px;
            overflow: hidden;
            margin-top: 5px;
        }

        .energy-bar-fill {
            height: 100%;
            background: var(--primary);
            width: 100%;
            transition: width 0.3s ease;
        }

        .status-timers {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            font-size: 0.8rem;
            color: var(--text-sec);
        }

        .timer-badge {
            background: #2d3748;
            padding: 2px 6px;
            border-radius: 4px;
        }

        /* --- MAIN GAME AREA --- */
        .game-area {
            flex: 1;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow-y: auto;
            padding-bottom: 80px; /* Space for nav */
        }

        .big-button-container {
            position: relative;
            width: 220px;
            height: 220px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
        }

        .work-btn {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            border: none;
            background: radial-gradient(circle at 30% 30%, #3b82f6, #1d4ed8);
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.4), inset 0 0 20px rgba(255,255,255,0.2);
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.1s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2;
        }

        .work-btn:active {
            transform: scale(0.95);
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.2);
        }

        .work-btn span {
            font-size: 0.9rem;
            font-weight: normal;
            opacity: 0.8;
            margin-top: 5px;
        }

        .pulse-ring {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 2px solid var(--primary);
            animation: pulse 2s infinite;
            opacity: 0;
            z-index: 1;
        }

        @keyframes pulse {
            0% { transform: scale(0.9); opacity: 0.7; }
            100% { transform: scale(1.4); opacity: 0; }
        }

        .action-buttons {
            width: 90%;
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }

        .action-btn {
            background: var(--card-bg);
            border: 1px solid #333;
            color: white;
            padding: 15px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: background 0.2s;
        }

        .action-btn.primary { background: linear-gradient(90deg, #3b82f6, #2563eb); border: none; }
        .action-btn.secondary { background: rgba(255, 255, 255, 0.1); }
        .action-btn:active { opacity: 0.8; }

        .location-badge {
            background: rgba(255,255,255,0.05);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-bottom: 20px;
            color: var(--text-sec);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* --- BOTTOM NAV --- */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            width: 100%;
            background: var(--card-bg);
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            border-top: 1px solid #333;
            z-index: 20;
        }

        .nav-item {
            color: var(--text-sec);
            font-size: 0.75rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            background: none;
            border: none;
        }

        .nav-item.active { color: var(--primary); }
        .nav-item svg { width: 24px; height: 24px; fill: currentColor; }

        /* --- MODALS / SECTIONS --- */
        .section-view {
            display: none;
            width: 100%;
            height: 100%;
            padding: 20px;
            overflow-y: auto;
            position: absolute;
            top: 0;
            left: 0;
            background: var(--bg-color);
            z-index: 5;
            padding-bottom: 80px;
        }

        .section-view.active { display: block; }

        .section-header {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #333;
        }

        .list-item {
            background: var(--card-bg);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .upgrade-btn {
            background: var(--accent);
            border: none;
            color: #000;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: bold;
            font-size: 0.8rem;
        }
        
        .upgrade-btn:disabled {
            background: #555;
            color: #888;
        }

        /* --- ADMIN PANEL v8.0 STYLES --- */
        #admin-panel {
            z-index: 100;
            background: #000;
        }
        
        .admin-header {
            display: flex; align-items: center; gap: 10px; margin-bottom: 20px;
        }
        
        .admin-title { font-weight: bold; font-size: 1.2rem; }

        .admin-section-title {
            color: #3b82f6;
            font-weight: bold;
            margin: 20px 0 10px 0;
            border-bottom: 1px solid #333;
            padding-bottom: 5px;
            font-size: 1rem;
        }

        .input-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .input-group label {
            display: block;
            font-size: 0.75rem;
            color: #888;
            margin-bottom: 4px;
        }

        .input-dark {
            width: 100%;
            background: #222;
            border: 1px solid #333;
            padding: 10px;
            border-radius: 6px;
            color: white;
            font-size: 1rem;
            font-family: monospace;
        }

        .save-btn {
            width: 100%;
            padding: 15px;
            background: #22c55e;
            color: black;
            font-weight: 900;
            border: none;
            border-radius: 10px;
            margin-top: 30px;
            font-size: 1rem;
            text-transform: uppercase;
            box-shadow: 0 4px 15px rgba(34, 197, 94, 0.3);
            cursor: pointer;
        }

        /* Notifications */
        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(30, 30, 30, 0.95);
            padding: 10px 20px;
            border-radius: 20px;
            color: white;
            z-index: 200;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            border: 1px solid var(--primary);
        }

        .warsaw-watermark {
            text-align: center;
            margin-top: 20px;
            font-family: monospace;
            color: #333;
            font-weight: 900;
            letter-spacing: 5px;
            font-size: 1.2rem;
            text-transform: uppercase;
        }
        
        .weather-info {
            text-align: center;
            font-size: 0.8rem;
            color: var(--text-sec);
            margin-top: 5px;
            background: rgba(255,255,255,0.05);
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
        }
    </style>
</head>
<body>

    <div class="header">
        <div class="menu-btn" onclick="toggleAdmin()">‚öôÔ∏è</div>
        <div class="header-title">Courier Simulator</div>
        <div class="menu-btn">‚ãÆ</div>
    </div>

    <div class="stats-container">
        <div class="balance-row">
            <div>
                <div style="font-size: 0.8rem; color: var(--text-sec);">–ë–∞–ª–∞–Ω—Å</div>
                <div class="balance-amount" id="balanceDisplay">0.00 PLN</div>
            </div>
            <div class="lvl-display" id="lvlDisplay">LVL 1.000000</div>
        </div>
        
        <div class="resources-row">
            <div class="res-item">üëü <span id="speedDisplay">Bazuka</span></div>
            <div class="res-item">üíß <span id="waterDisplay">2000 –º–ª</span></div>
        </div>

        <div class="resources-row">
            <div class="res-item">‚ö° <span id="energyText">1000/2000</span></div>
        </div>
        <div class="energy-bar-bg">
            <div class="energy-bar-fill" id="energyBar"></div>
        </div>

        <div class="status-timers">
            <div class="timer-badge" id="taxTimer">–ù–∞–ª–æ–≥: 5:00</div>
            <div class="timer-badge" style="color:var(--danger)">–ê—Ä–µ–Ω–¥–∞ (5%): 3:40</div>
            <div class="timer-badge" style="background: #1e3a8a; display:none;" id="bikeTimer">üö¥ 8:43</div>
            <div class="timer-badge" style="background: #78350f; display:none;" id="autoTimer">ü§ñ 6:20</div>
        </div>
    </div>

    <div id="game-screen" class="game-area active">
        <div class="location-badge">üìç Praga, Warszawa</div>
        
        <div class="big-button-container">
            <div class="pulse-ring"></div>
            <button class="work-btn" id="workBtn" onclick="manualWork()">
                –†–ê–ë–û–¢–ê–¢–¨
                <span id="workBtnPrice">0.10 PLN</span>
            </button>
        </div>

        <div class="action-buttons">
            <button class="action-btn secondary" id="collectBottleBtn" onclick="collectBottles()">
                ‚ôªÔ∏è –°–ë–û–† –ë–£–¢–´–õ–û–ö (+0.05)
            </button>
            <button class="action-btn primary" onclick="showToast('–ö–∞—Ä—Ç–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')">
                üó∫Ô∏è –ö–ê–†–¢–ê –ì–û–†–û–î–ê
            </button>
        </div>

        <div class="warsaw-watermark">WARSAW</div>
        <div class="weather-info">‚òÄÔ∏è –Ø–°–ù–û</div>
    </div>

    <div id="shop-screen" class="section-view">
        <div class="section-header">–ú–∞–≥–∞–∑–∏–Ω</div>
        <div id="shopList">
            </div>
    </div>
    
    <div id="career-screen" class="section-view">
        <div class="section-header">–ö–∞—Ä—å–µ—Ä–∞</div>
        <div id="careerList">
            </div>
    </div>

    <div id="admin-panel" class="section-view">
        <div class="admin-header">
            <div style="font-size: 2rem;">üéõÔ∏è</div>
            <div>
                <div class="admin-title">–ü—É–ª—å—Ç –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è v8.0</div>
                <div style="font-size:0.8rem; color:#666;">–ò–∑–º–µ–Ω—è–π —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å –∏–≥—Ä—ã</div>
            </div>
            <div style="margin-left:auto; font-size:1.5rem; cursor:pointer;" onclick="toggleAdmin()">‚úï</div>
        </div>
        
        <div style="padding-bottom: 100px;">
            <div class="admin-section-title">üõí –ú–∞–≥–∞–∑–∏–Ω –∏ –£—Å–ª—É–≥–∏ (PLN)</div>
            <div class="input-grid">
                <div class="input-group">
                    <label>–í–æ–¥–∞ (1.5–ª)</label>
                    <input type="number" id="adm-price-water-l" class="input-dark">
                </div>
                <div class="input-group">
                    <label>–ö–æ—Ñ–µ (Energy)</label>
                    <input type="number" id="adm-price-coffee" class="input-dark">
                </div>
                <div class="input-group">
                    <label>–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫ (Buff)</label>
                    <input type="number" id="adm-price-energy" class="input-dark">
                </div>
                 <div class="input-group">
                    <label>–≠–∫—Å–ø—Ä–µ—Å—Å –†–µ–º–æ–Ω—Ç</label>
                    <input type="number" id="adm-price-repair" class="input-dark">
                </div>
                <div class="input-group">
                    <label>–ê–≤—Ç–æ–ø–∏–ª–æ—Ç (–ú–∞—Ä—à—Ä—É—Ç)</label>
                    <input type="number" id="adm-price-auto" class="input-dark">
                </div>
                <div class="input-group">
                    <label>–ê—Ä–µ–Ω–¥–∞ Bike (30–º)</label>
                    <input type="number" id="adm-price-bike" class="input-dark">
                </div>
            </div>

            <div class="admin-section-title">üè¶ –≠–∫–æ–Ω–æ–º–∏–∫–∞ –∏ –ù–∞–ª–æ–≥–∏</div>
            <div class="input-grid">
                <div class="input-group">
                    <label>–ù–∞–ª–æ–≥ —Å –¥–æ—Ö–æ–¥–∞ (%)</label>
                    <input type="number" id="adm-tax-rate" class="input-dark">
                </div>
                <div class="input-group">
                    <label>–ü–æ—Ä–æ–≥ –Ω–∞–ª–æ–≥–∞ (PLN)</label>
                    <input type="number" id="adm-tax-threshold" class="input-dark">
                </div>
                <div class="input-group">
                    <label>–ò–Ω—Ñ–ª—è—Ü–∏—è –æ—Ç LVL (%)</label>
                    <input type="number" id="adm-inflation" class="input-dark">
                </div>
                <div class="input-group">
                    <label>–ü–æ—Å–æ–±–∏–µ –ë–∞–±—É—à–∫–∏</label>
                    <input type="number" id="adm-pension" class="input-dark">
                </div>
                <div class="input-group">
                    <label>–ü—Ä–æ—Ü–µ–Ω—Ç –ë–∞–Ω–∫–∞ (%)</label>
                    <input type="number" id="adm-bank-rate" class="input-dark">
                </div>
                <div class="input-group">
                    <label>–¶–µ–Ω–∞ –±—É—Ç—ã–ª–∫–∏ (PLN)</label>
                    <input type="number" id="adm-bottle-price" class="input-dark">
                </div>
                 <div class="input-group">
                    <label>–ë–∞–∑–æ–≤–∞—è –æ–ø–ª–∞—Ç–∞ (PLN)</label>
                    <input type="number" id="adm-base-pay" class="input-dark">
                </div>
            </div>

            <div class="admin-section-title">üö¥ –ö—É—Ä—å–µ—Ä—Å–∫–∞—è –†–∞–±–æ—Ç–∞</div>
            <div class="input-grid">
                <div class="input-group">
                    <label>–û–ø–ª–∞—Ç–∞ –∑–∞ 1 –ö–ú</label>
                    <input type="number" id="adm-km-pay" class="input-dark">
                </div>
                <div class="input-group">
                    <label>–®–∞–Ω—Å —á–∞–µ–≤—ã—Ö (%)</label>
                    <input type="number" id="adm-tip-chance" class="input-dark">
                </div>
            </div>

            <button class="save-btn" onclick="applyAdminSettings()">‚è≥ –ü–†–ò–ú–ï–ù–ï–ù–ò–ï –í –ú–ò–†–ï...</button>
        </div>
    </div>

    <div class="bottom-nav">
        <button class="nav-item active" onclick="switchTab('game-screen', this)">
            <svg viewBox="0 0 24 24"><path d="M12 2L2 12h3v8h6v-6h2v6h6v-8h3L12 2z"/></svg>
            <span>–ì–æ—Ä–æ–¥</span>
        </button>
        <button class="nav-item" onclick="switchTab('career-screen', this)">
            <svg viewBox="0 0 24 24"><path d="M20 6h-4V4c0-1.1-.9-2-2-2h-4c-1.1 0-2 .9-2 2v2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-8-2h2v2h-2V4z"/></svg>
            <span>–ö–∞—Ä—å–µ—Ä–∞</span>
        </button>
        <button class="nav-item" onclick="switchTab('shop-screen', this)">
            <svg viewBox="0 0 24 24"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/></svg>
            <span>–ú–∞–≥–∞–∑–∏–Ω</span>
        </button>
        <button class="nav-item" onclick="showToast('–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã')">
            <svg viewBox="0 0 24 24"><path d="M3.5 18.49l6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z"/></svg>
            <span>–ò–Ω–≤–µ—Å—Ç</span>
        </button>
        <button class="nav-item" onclick="showToast('–ë–∞–Ω–∫ –∑–∞–∫—Ä—ã—Ç')">
            <svg viewBox="0 0 24 24"><path d="M4 10v7h3v-7H4zm6 0v7h3v-7h-3zM2 22h19v-3H2v3zm14-12v7h3v-7h-3zm-4.5-9L2 6v2h19V6l-9.5-5z"/></svg>
            <span>–ë–∞–Ω–∫</span>
        </button>
    </div>

    <div class="toast" id="toast">Message</div>

    <script>
        // --- GAME STATE ---
        const SAVE_KEY = 'WARSZAWA_FOREVER';

        let state = {
            balance: 98.30,
            lvl: 1.023250,
            energy: 937,
            maxEnergy: 2000,
            water: 22523, // ml
            speedName: 'Bazuka',
            bikeTime: 0, // seconds remaining
            autoTime: 0, // seconds remaining
            
            // Settings that can be changed via Admin
            settings: {
                basePay: 0.10,
                bottlePrice: 0.05,
                
                taxRate: 27,
                taxThreshold: 200,
                inflationPercent: 40,
                pension: 50,
                bankRate: 10,
                
                kmPay: 1.5,
                tipChance: 20,
                tipMax: 15,

                // Shop Prices (NEW)
                prices: {
                    water_l: 5.00,
                    coffee: 12.00,
                    energy: 22.00,
                    repair: 47.00,
                    auto: 55.00,
                    bike: 78.00
                }
            },

            // Items owned
            upgrades: {
                shoes: 1, 
                backpack: 1
            },

            lastSaveTime: Date.now()
        };

        // Temporary Runtime State
        let energyBoostActive = false;
        let boostTimer = null;

        // --- CAREER DATA ---
        const careerLevels = [
            { lvl: 1, title: '–ü–µ—à–∏–π –ö—É—Ä—å–µ—Ä', bonus: '–ë–∞–∑–∞', desc: '–ù–∞—á–∞–ª–æ –ø—É—Ç–∏' },
            { lvl: 2, title: '–í–µ–ª–æ-–ö—É—Ä—å–µ—Ä', bonus: '+10% –∫ –¥–æ—Ö–æ–¥—É', desc: '–î–æ—Å—Ç—É–ø –∫ –≤–µ–ª–æ-–∑–∞–∫–∞–∑–∞–º' },
            { lvl: 5, title: '–ü—Ä–æ—Ñ–∏ –î–æ—Å—Ç–∞–≤–∫–∏', bonus: '+25% –∫ –¥–æ—Ö–æ–¥—É', desc: '–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –∑–∞–∫–∞–∑—ã' },
            { lvl: 10, title: '–õ–µ–≥–µ–Ω–¥–∞ –í–∞—Ä—à–∞–≤—ã', bonus: '–ê–≤—Ç–æ-–¥–æ—Ö–æ–¥ x2', desc: '–ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥ —É–≤–µ–ª–∏—á–µ–Ω' }
        ];

        // --- INITIALIZATION ---
        function init() {
            loadGame();
            
            // Update UI loop
            setInterval(() => {
                updateTimers();
                updateUI();
                autoWorkLogic();
                saveGame();
            }, 1000);

            renderShop();
            renderCareer();
            updateUI(); // First render
        }

        // --- CORE LOGIC ---

        function manualWork() {
            if (state.energy < 10) {
                showToast("–ù–µ—Ç —ç–Ω–µ—Ä–≥–∏–∏!");
                return;
            }
            if (state.water <= 0) {
                showToast("–û–±–µ–∑–≤–æ–∂–∏–≤–∞–Ω–∏–µ! –ö—É–ø–∏—Ç–µ –≤–æ–¥—ã.");
                return;
            }

            // Energy Consumption
            if (!energyBoostActive) {
                state.energy -= 10;
            }
            // Water consumption always happens
            state.water -= 5; 

            // Calculate Pay based on settings
            let pay = state.settings.basePay;
            
            // Random Tip
            if (Math.random() * 100 < state.settings.tipChance) {
                let tip = Math.random() * state.settings.tipMax; // Simplified
                pay += tip;
                showToast(`–ß–∞–µ–≤—ã–µ! +${tip.toFixed(2)} PLN`);
            }

            addBalance(pay);
            addXP(0.00001);
            updateUI();
        }

        function collectBottles() {
            if (state.energy < 2) {
                showToast("–£—Å—Ç–∞–ª...");
                return;
            }
            if (!energyBoostActive) {
                 state.energy -= 2;
            }
            state.water -= 1;
            
            // Dynamic price
            addBalance(state.settings.bottlePrice);
            updateUI();
        }

        function addBalance(amount) {
            state.balance += amount;
        }

        function addXP(amount) {
            state.lvl += amount;
        }

        function buyItem(type) {
            const prices = state.settings.prices;
            let cost = 0;
            let action = () => {};
            let name = "";

            switch(type) {
                case 'water_l':
                    cost = prices.water_l;
                    name = "–í–æ–¥–∞ (1.5–ª)";
                    action = () => state.water += 1500;
                    break;
                case 'coffee':
                    cost = prices.coffee;
                    name = "–ö–æ—Ñ–µ (Energy)";
                    action = () => state.energy = Math.min(state.energy + 200, state.maxEnergy);
                    break;
                case 'energy':
                    cost = prices.energy;
                    name = "–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫ (Buff)";
                    action = () => activateEnergyBoost(60);
                    break;
                case 'repair':
                    cost = prices.repair;
                    name = "–≠–∫—Å–ø—Ä–µ—Å—Å –†–µ–º–æ–Ω—Ç";
                    action = () => showToast("–†–µ–º–æ–Ω—Ç –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è (–ø–æ–∫–∞)");
                    break;
                case 'auto':
                    cost = prices.auto;
                    name = "–ê–≤—Ç–æ–ø–∏–ª–æ—Ç";
                    action = () => state.autoTime += 600;
                    break;
                case 'bike':
                    cost = prices.bike;
                    name = "–ê—Ä–µ–Ω–¥–∞ Bike";
                    action = () => state.bikeTime += 1800;
                    break;
            }

            if (state.balance >= cost) {
                state.balance -= cost;
                action();
                showToast(`–ö—É–ø–ª–µ–Ω–æ: ${name}`);
                updateUI();
            } else {
                showToast("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤");
            }
        }

        function activateEnergyBoost(seconds) {
            if (energyBoostActive) clearTimeout(boostTimer);
            energyBoostActive = true;
            showToast("‚ö° –≠–ù–ï–†–ì–ï–¢–ò–ö: –≠–Ω–µ—Ä–≥–∏—è –Ω–µ —Ç—Ä–∞—Ç–∏—Ç—Å—è!");
            
            boostTimer = setTimeout(() => {
                energyBoostActive = false;
                showToast("–≠—Ñ—Ñ–µ–∫—Ç —ç–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞ –∑–∞–∫–æ–Ω—á–∏–ª—Å—è");
                updateUI();
            }, seconds * 1000);
            updateUI();
        }

        function autoWorkLogic() {
            if (state.autoTime > 0) {
                // Auto courier logic
                if (state.water > 0) {
                    state.water -= 2; 
                    if (!energyBoostActive && state.energy > 0) {
                        state.energy -= 2;
                    }
                    if (state.energy > 0 || energyBoostActive) {
                         addBalance(state.settings.basePay / 2);
                    }
                }
            }
        }

        function updateTimers() {
            if (state.bikeTime > 0) state.bikeTime--;
            if (state.autoTime > 0) state.autoTime--;
            
            // Passive Energy Regen
            if (state.energy < state.maxEnergy) {
                state.energy += 1;
            }
        }

        // --- UI UPDATES ---
        function updateUI() {
            document.getElementById('balanceDisplay').innerText = state.balance.toFixed(2) + " PLN";
            document.getElementById('lvlDisplay').innerText = "LVL " + state.lvl.toFixed(6);
            document.getElementById('waterDisplay').innerText = state.water + " –º–ª";
            
            const energyPct = (state.energy / state.maxEnergy) * 100;
            document.getElementById('energyBar').style.width = energyPct + "%";
            document.getElementById('energyText').innerText = `${Math.floor(state.energy)}/${state.maxEnergy}`;

            // Buttons Text Updates
            document.getElementById('workBtnPrice').innerText = state.settings.basePay.toFixed(2) + " PLN";
            document.getElementById('collectBottleBtn').innerText = `‚ôªÔ∏è –°–ë–û–† –ë–£–¢–´–õ–û–ö (+${state.settings.bottlePrice.toFixed(2)})`;

            // Timers visibility
            const bikeBadge = document.getElementById('bikeTimer');
            if (state.bikeTime > 0) {
                bikeBadge.style.display = 'block';
                bikeBadge.innerText = `üö¥ ${formatTime(state.bikeTime)}`;
            } else {
                bikeBadge.style.display = 'none';
            }

            const autoBadge = document.getElementById('autoTimer');
            if (state.autoTime > 0) {
                autoBadge.style.display = 'block';
                autoBadge.innerText = `ü§ñ ${formatTime(state.autoTime)}`;
            } else {
                autoBadge.style.display = 'none';
            }
            
            if (energyBoostActive) {
                document.getElementById('energyBar').style.background = "#f59e0b";
            } else {
                document.getElementById('energyBar').style.background = "#3b82f6";
            }
        }

        function formatTime(seconds) {
            const m = Math.floor(seconds / 60);
            const s = seconds % 60;
            return `${m}:${s < 10 ? '0' : ''}${s}`;
        }

        // --- ADMIN PANEL LOGIC ---
        function toggleAdmin() {
            const p = document.getElementById('admin-panel');
            const isActive = p.classList.contains('active');
            
            if (!isActive) {
                // Load settings into inputs
                const s = state.settings;
                
                // Prices
                document.getElementById('adm-price-water-l').value = s.prices.water_l;
                document.getElementById('adm-price-coffee').value = s.prices.coffee;
                document.getElementById('adm-price-energy').value = s.prices.energy;
                document.getElementById('adm-price-repair').value = s.prices.repair;
                document.getElementById('adm-price-auto').value = s.prices.auto;
                document.getElementById('adm-price-bike').value = s.prices.bike;

                // Eco
                document.getElementById('adm-tax-rate').value = s.taxRate;
                document.getElementById('adm-tax-threshold').value = s.taxThreshold;
                document.getElementById('adm-inflation').value = s.inflationPercent;
                document.getElementById('adm-pension').value = s.pension;
                document.getElementById('adm-bank-rate').value = s.bankRate;
                document.getElementById('adm-bottle-price').value = s.bottlePrice;
                document.getElementById('adm-base-pay').value = s.basePay;

                // Courier
                document.getElementById('adm-km-pay').value = s.kmPay;
                document.getElementById('adm-tip-chance').value = s.tipChance;

                p.classList.add('active');
            } else {
                p.classList.remove('active');
            }
        }

        function applyAdminSettings() {
            // Helper to get number
            const getNum = (id) => parseFloat(document.getElementById(id).value);

            // Save Shop Prices
            state.settings.prices.water_l = getNum('adm-price-water-l');
            state.settings.prices.coffee = getNum('adm-price-coffee');
            state.settings.prices.energy = getNum('adm-price-energy');
            state.settings.prices.repair = getNum('adm-price-repair');
            state.settings.prices.auto = getNum('adm-price-auto');
            state.settings.prices.bike = getNum('adm-price-bike');

            // Save Eco
            state.settings.taxRate = getNum('adm-tax-rate');
            state.settings.taxThreshold = getNum('adm-tax-threshold');
            state.settings.inflationPercent = getNum('adm-inflation');
            state.settings.pension = getNum('adm-pension');
            state.settings.bankRate = getNum('adm-bank-rate');
            state.settings.bottlePrice = getNum('adm-bottle-price');
            state.settings.basePay = getNum('adm-base-pay');

            // Save Courier
            state.settings.kmPay = getNum('adm-km-pay');
            state.settings.tipChance = getNum('adm-tip-chance');

            saveGame();
            renderShop(); // Refresh shop with new prices
            updateUI();
            
            toggleAdmin(); // Close panel
            showToast("–ù–ê–°–¢–†–û–ô–ö–ò –ú–ò–†–ê –ü–†–ò–ú–ï–ù–ï–ù–´!");
        }

        // --- SECTION RENDERING ---
        function renderShop() {
            const list = document.getElementById('shopList');
            const p = state.settings.prices;
            
            // Define items with current prices
            const shopItems = [
                { id: 'water_l', name: '–í–æ–¥–∞ (1.5–ª)', price: p.water_l, desc: '+1500 –º–ª –≤–æ–¥—ã' },
                { id: 'coffee', name: '–ö–æ—Ñ–µ (Energy)', price: p.coffee, desc: '+200 –≠–Ω–µ—Ä–≥–∏–∏' },
                { id: 'energy', name: '–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫ (Buff)', price: p.energy, desc: '–≠–Ω–µ—Ä–≥–∏—è –Ω–µ —Ç—Ä–∞—Ç–∏—Ç—Å—è 60—Å' },
                { id: 'repair', name: '–≠–∫—Å–ø—Ä–µ—Å—Å –†–µ–º–æ–Ω—Ç', price: p.repair, desc: '–ü–æ—á–∏–Ω–∫–∞ —Å–Ω–∞—Ä—è–∂–µ–Ω–∏—è' },
                { id: 'auto', name: '–ê–≤—Ç–æ–ø–∏–ª–æ—Ç (–ú–∞—Ä—à—Ä—É—Ç)', price: p.auto, desc: '10 –º–∏–Ω –∞–≤—Ç–æ-–¥–æ—Ö–æ–¥–∞' },
                { id: 'bike', name: '–ê—Ä–µ–Ω–¥–∞ Bike (30–º)', price: p.bike, desc: '–°–∫–æ—Ä–æ—Å—Ç—å x2' }
            ];

            list.innerHTML = '';
            shopItems.forEach(item => {
                const div = document.createElement('div');
                div.className = 'list-item';
                div.innerHTML = `
                    <div>
                        <div style="font-weight:bold;">${item.name}</div>
                        <div style="font-size:0.8rem; color:#888;">${item.desc}</div>
                    </div>
                    <button class="upgrade-btn" onclick="buyItem('${item.id}')">${item.price.toFixed(2)} PLN</button>
                `;
                list.appendChild(div);
            });
        }

        function renderCareer() {
            const list = document.getElementById('careerList');
            list.innerHTML = '';
            careerLevels.forEach(c => {
                const isUnlocked = state.lvl >= c.lvl;
                const div = document.createElement('div');
                div.className = 'list-item';
                div.style.opacity = isUnlocked ? '1' : '0.5';
                div.innerHTML = `
                    <div>
                        <div style="font-weight:bold; color: ${isUnlocked ? 'var(--accent)' : 'inherit'}">${c.title} (LVL ${c.lvl})</div>
                        <div style="font-size:0.8rem; color:#888;">${c.desc}</div>
                        <div style="font-size:0.75rem; color:var(--primary); margin-top:2px;">–ë–æ–Ω—É—Å: ${c.bonus}</div>
                    </div>
                    <div>${isUnlocked ? '‚úÖ' : 'üîí'}</div>
                `;
                list.appendChild(div);
            });
        }

        function switchTab(screenId, btnElement) {
            document.querySelectorAll('.section-view').forEach(el => {
                if(el.id !== 'admin-panel') el.classList.remove('active');
            });
            document.getElementById('game-screen').classList.remove('active');

            if (screenId === 'game-screen') {
                document.getElementById('game-screen').classList.add('active');
            } else {
                document.getElementById(screenId).classList.add('active');
            }

            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            btnElement.classList.add('active');
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.style.opacity = 1;
            t.style.top = '100px';
            setTimeout(() => {
                t.style.opacity = 0;
                t.style.top = '20px';
            }, 2000);
        }

        // --- SAVE SYSTEM ---
        function saveGame() {
            localStorage.setItem(SAVE_KEY, JSON.stringify(state));
        }

        function loadGame() {
            const saved = localStorage.getItem(SAVE_KEY);
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    // Deep merge to ensure prices exist
                    state = { 
                        ...state, 
                        ...parsed, 
                        settings: { 
                            ...state.settings, 
                            ...parsed.settings,
                            prices: { ...state.settings.prices, ...(parsed.settings?.prices || {}) }
                        } 
                    };
                } catch (e) {
                    console.error("Save file corrupted");
                }
            }
        }

        // Start
        init();

    </script>
</body>
</html>
