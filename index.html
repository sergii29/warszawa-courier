<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Warszawa Life</title>
    <style>
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-main: #ffffff;
            --text-muted: #b0b0b0;
            --accent: #bb86fc; 
            --accent-dark: #3700b3;
            --success: #03dac6;
            --danger: #cf6679;
            --warning: #ffb74d;
            --border: #333333;
            --nav-height: 60px;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            font-family: 'Roboto', 'Segoe UI', sans-serif;
        }

        body {
            margin: 0;
            background-color: var(--bg-color);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* HEADER */
        header {
            background-color: var(--card-bg);
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            z-index: 10;
        }

        .header-title {
            font-size: 1.1rem;
            font-weight: bold;
        }

        .header-loc {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 2px;
        }

        .balance {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--success);
            text-shadow: 0 0 10px rgba(3, 218, 198, 0.3);
        }

        /* STATS */
        #stats-bar {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            padding: 10px 15px;
            background-color: var(--bg-color);
        }

        .stat-box {
            background-color: var(--card-bg);
            padding: 8px 5px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid var(--border);
        }

        .stat-val { font-weight: bold; font-size: 0.9rem; display: block; }
        .stat-lbl { font-size: 0.7rem; color: var(--text-muted); margin-top: 2px; }

        /* CONTENT */
        #game-container {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            padding-bottom: calc(var(--nav-height) + 20px);
        }

        h2 {
            color: var(--accent);
            font-size: 1.3rem;
            margin-top: 0;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid var(--border);
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }

        .card h3 {
            margin: 0 0 10px 0;
            font-size: 1.1rem;
        }

        /* BUTTONS */
        .btn {
            background-color: var(--accent);
            color: #000;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1rem;
            width: 100%;
            cursor: pointer;
            transition: 0.2s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 10px;
        }

        .btn:active { transform: scale(0.98); opacity: 0.9; }
        
        .btn.secondary {
            background: transparent;
            border: 1px solid var(--accent);
            color: var(--accent);
        }

        .btn.danger {
            background-color: transparent;
            border: 1px solid var(--danger);
            color: var(--danger);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            filter: grayscale(100%);
        }

        /* PROGRESS BAR */
        .progress-bg {
            background: #333;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: var(--success);
            width: 0%;
            transition: width 0.3s ease;
        }

        /* NAV BAR (Fixed with SVG) */
        nav {
            position: fixed;
            bottom: 0;
            width: 100%;
            height: var(--nav-height);
            background-color: var(--card-bg);
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 100;
            padding-bottom: env(safe-area-inset-bottom);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            color: var(--text-muted);
            font-size: 0.7rem;
            width: 20%;
            height: 100%;
            transition: 0.2s;
        }

        .nav-item svg {
            width: 24px;
            height: 24px;
            margin-bottom: 4px;
            fill: var(--text-muted);
            transition: 0.2s;
        }

        .nav-item.active { color: var(--accent); }
        .nav-item.active svg { fill: var(--accent); }

        /* SECTIONS */
        .section { display: none; animation: fade 0.3s; }
        .section.active { display: block; }
        @keyframes fade { from { opacity: 0; } to { opacity: 1; } }

        /* LISTS */
        .item-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #333;
        }
        .item-row:last-child { border-bottom: none; }
        
        .item-name { font-weight: bold; margin-bottom: 4px; }
        .item-desc { font-size: 0.75rem; color: var(--text-muted); }

        /* NOTIFICATIONS */
        #notif-area {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 200;
            pointer-events: none;
        }
        .toast {
            background: rgba(30,30,30,0.95);
            border-left: 4px solid var(--accent);
            color: #fff;
            padding: 12px 20px;
            border-radius: 4px;
            margin-bottom: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            animation: slideIn 0.3s;
        }
        @keyframes slideIn { from {transform: translateX(100%);} to {transform: translateX(0);} }

        /* MODAL */
        .modal-wrap {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.8);
            display: none; justify-content: center; align-items: center;
            z-index: 1000;
        }
        .modal-box {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 15px;
            width: 85%;
            max-width: 350px;
            text-align: center;
            border: 1px solid var(--border);
        }
    </style>
</head>
<body>

    <header>
        <div>
            <div class="header-title">Warszawa Life</div>
            <div class="header-loc">üìç Warszawa, Mazowieckie</div>
        </div>
        <div class="balance" id="ui-balance">0 PLN</div>
    </header>

    <div id="stats-bar">
        <div class="stat-box">
            <span class="stat-val" id="ui-energy">100%</span>
            <span class="stat-lbl">–≠–Ω–µ—Ä–≥–∏—è</span>
        </div>
        <div class="stat-box">
            <span class="stat-val" id="ui-water">100%</span>
            <span class="stat-lbl">–í–æ–¥–∞</span>
        </div>
        <div class="stat-box">
            <span class="stat-val" id="ui-satiety">100%</span>
            <span class="stat-lbl">–ï–¥–∞</span>
        </div>
        <div class="stat-box">
            <span class="stat-val" id="ui-mood">100%</span>
            <span class="stat-lbl">–ù–∞—Å—Ç—Ä.</span>
        </div>
    </div>

    <div id="notif-area"></div>

    <div id="game-container">
        
        <div id="sec-courier" class="section active">
            <h2>üì¶ –†–∞–±–æ—Ç–∞ –ö—É—Ä—å–µ—Ä–æ–º</h2>
            
            <div class="card">
                <h3>Glovo/Uber Eats</h3>
                <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 5px; margin-bottom: 15px;">
                    <span id="courier-status">–°—Ç–∞—Ç—É—Å: –°–≤–æ–±–æ–¥–µ–Ω</span>
                </div>

                <div id="manual-panel">
                    <button class="btn" id="btn-take-order" onclick="startOrder()">–í–∑—è—Ç—å –∑–∞–∫–∞–∑</button>
                    <div id="progress-ui" style="display:none;">
                        <p style="font-size:0.8rem; margin:0 0 5px 0;">–î–æ—Å—Ç–∞–≤–∫–∞...</p>
                        <div class="progress-bg"><div class="progress-fill" id="order-bar"></div></div>
                    </div>
                </div>

                <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid var(--border);">
                    <h3>–ê–≤—Ç–æ-–ö—É—Ä—å–µ—Ä (–ë–æ—Ç)</h3>
                    <p style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 10px;">
                        –¢—Ä–µ–±—É–µ—Ç: –í–µ–ª–æ—Å–∏–ø–µ–¥/–°–∫—É—Ç–µ—Ä + –õ–∏—Ü–µ–Ω–∑–∏—è.<br>
                        <span style="color: var(--warning);">–í–Ω–∏–º–∞–Ω–∏–µ: –¢—Ä–∞—Ç–∏—Ç –≤–æ–¥—É –∏ —ç–Ω–µ—Ä–≥–∏—é.</span>
                    </p>
                    <button class="btn secondary" id="btn-auto-courier" onclick="toggleAutoCourier()">–í–∫–ª—é—á–∏—Ç—å –±–æ—Ç–∞</button>
                </div>
            </div>

            <div class="card" id="boost-card" style="display:none;">
                <h3>‚ö° –ê–∫—Ç–∏–≤–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã</h3>
                <div id="boost-list"></div>
            </div>
        </div>

        <div id="sec-career" class="section">
            <h2>üíº –ö–∞—Ä—å–µ—Ä–∞</h2>
            <div class="card">
                <h3>–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ</h3>
                <div style="display:flex; justify-content:space-between; font-size:0.9rem;">
                    <span>–£—Ä–æ–≤–µ–Ω—å: <b id="coding-lvl">0</b></span>
                    <span style="color:var(--accent)">Python Dev</span>
                </div>
                <div class="progress-bg"><div class="progress-fill" id="coding-bar"></div></div>
                <button class="btn" onclick="studyCoding()">–£—á–∏—Ç—å Python (-10 –≠–Ω)</button>
            </div>

            <div class="card">
                <h3>–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è</h3>
                <div id="tasks-list"></div>
            </div>
        </div>

        <div id="sec-business" class="section">
            <h2>üìà –ë–∏–∑–Ω–µ—Å</h2>
            <div id="business-container"></div>
        </div>

        <div id="sec-shop" class="section">
            <h2>üõí –ú–∞–≥–∞–∑–∏–Ω</h2>
            
            <div class="card">
                <h3>–ï–¥–∞ –∏ –ù–∞–ø–∏—Ç–∫–∏</h3>
                <div id="shop-consumables"></div>
            </div>
            
            <div class="card">
                <h3>–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç –∏ –¢–µ—Ö–Ω–∏–∫–∞</h3>
                <div id="shop-gear"></div>
            </div>

            <div class="card">
                <h3>–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</h3>
                <div id="shop-rent"></div>
            </div>
        </div>

        <div id="sec-settings" class="section">
            <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
            
            <div class="card">
                <h3>–°—Ç–∞—Ç—É—Å –ì—Ä–∞–∂–¥–∞–Ω–∏–Ω–∞</h3>
                <p>–ù–∞–ª–æ–≥ (ZUS/PIT): <span id="tax-timer" style="font-weight:bold; color:var(--warning)">0</span> –¥–Ω.</p>
                <button class="btn secondary" onclick="payTax()">–û–ø–ª–∞—Ç–∏—Ç—å –Ω–∞–ª–æ–≥ (500 PLN)</button>
            </div>

            <div class="card" style="border-color: var(--danger);">
                <h3 style="color:var(--danger)">–°–±—Ä–æ—Å –∏–≥—Ä—ã</h3>
                <p style="font-size:0.8rem; color:var(--text-muted)">
                    –£–¥–∞–ª—è–µ—Ç –≤–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å, –¥–µ–Ω—å–≥–∏ –∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å. –û–±—Ä–∞—Ç–Ω–æ–≥–æ –ø—É—Ç–∏ –Ω–µ—Ç.
                </p>
                <button class="btn danger" onclick="fullReset()">üõë –ü–û–õ–ù–´–ô –°–ë–†–û–° (RESET)</button>
            </div>
            <p style="text-align:center; color:var(--text-muted); font-size:0.7rem; margin-top:20px;">
                Warszawa Life v2.2 (Forever Edition)
            </p>
        </div>

    </div>

    <nav>
        <a href="#" class="nav-item active" onclick="switchTab('courier', this)">
            <svg viewBox="0 0 24 24"><path d="M15.5 5.5c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zM5 12c-2.8 0-5 2.2-5 5s2.2 5 5 5 5-2.2 5-5-2.2-5-5-5zm0 8.5c-1.9 0-3.5-1.6-3.5-3.5s1.6-3.5 3.5-3.5 3.5 1.6 3.5 3.5-1.6 3.5-3.5 3.5zm5.8-10l2.4-2.4.8.8c1.3 1.3 3 2.1 5.1 2.1V9c-1.5 0-2.7-.6-3.6-1.5l-1.9-1.9c-.5-.4-1.2-.4-1.6 0l-1.6 1.6c-.9.9-1.3 2.2-1.3 3.5V13h2V10.5h.2zM19 12c-2.8 0-5 2.2-5 5s2.2 5 5 5 5-2.2 5-5-2.2-5-5-5zm0 8.5c-1.9 0-3.5-1.6-3.5-3.5s1.6-3.5 3.5-3.5 3.5 1.6 3.5 3.5-1.6 3.5-3.5 3.5z"/></svg>
            –ö—É—Ä—å–µ—Ä
        </a>
        <a href="#" class="nav-item" onclick="switchTab('career', this)">
            <svg viewBox="0 0 24 24"><path d="M20 6h-4V4c0-1.11-.89-2-2-2h-4c-1.11 0-2 .89-2 2v2H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h18c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-6 0h-4V4h4v2z"/></svg>
            –ö–∞—Ä—å–µ—Ä–∞
        </a>
        <a href="#" class="nav-item" onclick="switchTab('business', this)">
            <svg viewBox="0 0 24 24"><path d="M3.5 18.49l6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z"/></svg>
            –ë–∏–∑–Ω–µ—Å
        </a>
        <a href="#" class="nav-item" onclick="switchTab('shop', this)">
            <svg viewBox="0 0 24 24"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/></svg>
            –ú–∞–≥–∞–∑–∏–Ω
        </a>
        <a href="#" class="nav-item" onclick="switchTab('settings', this)">
            <svg viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.58 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
            –ù–∞—Å—Ç—Ä.
        </a>
    </nav>

    <div id="modal-overlay" class="modal-wrap">
        <div class="modal-box">
            <h3 id="modal-title">Info</h3>
            <p id="modal-text">...</p>
            <button class="btn" onclick="closeModal()">OK</button>
        </div>
    </div>

<script>
/**
 * WARSZAWA LIFE SIMULATOR (FIXED)
 * Key: WARSZAWA_FOREVER
 * Design: SVG Icons restored
 */

const SAVE_KEY = 'WARSZAWA_FOREVER';

const DEFAULTS = {
    balance: 0,
    energy: 100, water: 100, satiety: 100, mood: 100,
    codingLvl: 0, codingXp: 0,
    inventory: [],
    activeBoosts: {},
    business: null,
    housing: 'homeless', rentTimer: 0,
    taxTimer: 7,
    autoCourier: false,
    dailyTasks: {
        'd1': { txt: '–î–æ—Å—Ç–∞–≤–∏—Ç—å 5 –∑–∞–∫–∞–∑–æ–≤', max: 5, cur: 0, reward: 50, done: false },
        'd2': { txt: '–£—á–∏—Ç—å Python 1 —Ä–∞–∑', max: 1, cur: 0, reward: 20, done: false }
    }
};

let state = JSON.parse(JSON.stringify(DEFAULTS));
let loopInt;

// DATA
const ITEMS = {
    'water': { name: '–í–æ–¥–∞ (0.5–ª)', price: 3, type: 'use', ef: {water:25}, desc: '+25 –í–æ–¥—ã' },
    'kebab': { name: '–ö–µ–±–∞–±', price: 18, type: 'use', ef: {satiety:40, energy:10}, desc: '+40 –ï–¥—ã, +10 –≠–Ω' },
    'monster': { name: '–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫', price: 8, type: 'use', ef: {energy:30, mood:5, sp:'no_drain'}, desc: '+30 –≠–Ω, 2 –º–∏–Ω —ç–Ω–µ—Ä–≥–∏—è –Ω–µ —Ç—Ä–∞—Ç–∏—Ç—Å—è (–≤–æ–¥–∞ —Ç—Ä–∞—Ç–∏—Ç—Å—è!)' },
    
    'bike': { name: '–í–µ–ª–æ—Å–∏–ø–µ–¥', price: 300, type: 'gear', desc: '–ù—É–∂–µ–Ω –¥–ª—è –∞–≤—Ç–æ-–∫—É—Ä—å–µ—Ä–∞' },
    'scooter': { name: '–≠–ª–µ–∫—Ç—Ä–æ—Å–∫—É—Ç–µ—Ä', price: 1500, type: 'gear', desc: '–ë—ã—Å—Ç—Ä—ã–π –∞–≤—Ç–æ-–∫—É—Ä—å–µ—Ä' },
    'laptop': { name: '–ù–æ—É—Ç–±—É–∫', price: 2500, type: 'gear', desc: '–î–ª—è IT –∫–∞—Ä—å–µ—Ä—ã' },
    
    'hostel': { name: '–•–æ—Å—Ç–µ–ª', price: 50, type: 'rent', days:1, desc: '–ö–æ–π–∫–∞ –Ω–∞ –Ω–æ—á—å' },
    'flat': { name: '–ö–≤–∞—Ä—Ç–∏—Ä–∞', price: 2000, type: 'rent', days:30, desc: '–°—Ç—É–¥–∏—è –Ω–∞ –º–µ—Å—è—Ü' }
};

const BIZ = [
    { id: 'vending', name: '–í–µ–Ω–¥–∏–Ω–≥', cost: 1000, inc: 100, desc: '–î–æ—Ö–æ–¥ 100/–¥–µ–Ω—å' },
    { id: 'kebab_spot', name: '–¢–æ—á–∫–∞ –ö–µ–±–∞–±', cost: 5000, inc: 600, desc: '–î–æ—Ö–æ–¥ 600/–¥–µ–Ω—å' },
    { id: 'agency', name: 'IT –°—Ç—É–¥–∏—è', cost: 15000, inc: 2000, desc: '–î–æ—Ö–æ–¥ 2000/–¥–µ–Ω—å' }
];

// INIT
function init() {
    let s = localStorage.getItem(SAVE_KEY);
    if(s) {
        try { state = {...DEFAULTS, ...JSON.parse(s)}; } 
        catch(e) { console.log('Save Error'); }
    }
    // Fix missing tasks structure if old save
    if(!state.dailyTasks || !state.dailyTasks.d1) state.dailyTasks = JSON.parse(JSON.stringify(DEFAULTS.dailyTasks));
    
    startLoop();
    renderAll();
}

function save() {
    localStorage.setItem(SAVE_KEY, JSON.stringify(state));
}

// GAME LOOP
function startLoop() {
    if(loopInt) clearInterval(loopInt);
    loopInt = setInterval(() => {
        // Passive Drain
        change('satiety', -0.5);
        change('water', -0.8);
        change('mood', -0.2);
        
        // Energy Logic (Check Boost)
        let noEnergyDrain = false;
        if(state.activeBoosts['no_drain'] && state.activeBoosts['no_drain'] > Date.now()) {
            noEnergyDrain = true;
        }
        
        if(!noEnergyDrain) change('energy', -0.3);
        
        // Auto Courier
        if(state.autoCourier) tickAutoCourier();

        // Checks
        if(state.satiety<=0 || state.water<=0) notify('‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ! –ì–æ–ª–æ–¥ –∏–ª–∏ –ñ–∞–∂–¥–∞!', 'danger');

        save();
        renderStats();
        renderBoosts();
    }, 3000);
}

function change(key, val) {
    state[key] += val;
    if(state[key]>100) state[key]=100;
    if(state[key]<0) state[key]=0;
}

// COURIER
function startOrder() {
    if(state.energy<10 || state.satiety<5) return notify('–ù–µ—Ç —Å–∏–ª –∏–ª–∏ –µ–¥—ã', 'warning');
    
    document.getElementById('btn-take-order').style.display='none';
    document.getElementById('progress-ui').style.display='block';
    
    let w=0;
    let t = setInterval(()=>{
        w+=10; 
        document.getElementById('order-bar').style.width=w+'%';
        if(w>=100) {
            clearInterval(t);
            finishOrder();
        }
    }, 150);
}

function finishOrder() {
    let pay = Math.floor(10 + Math.random()*5);
    state.balance += pay;
    change('energy', -5);
    change('water', -2);
    
    // Task
    let t = state.dailyTasks.d1;
    if(!t.done) {
        t.cur++;
        if(t.cur>=t.max) { t.done=true; state.balance+=t.reward; notify('–ó–∞–¥–∞–Ω–∏–µ: +'+t.reward, 'success'); }
    }
    
    notify(`–î–æ—Å—Ç–∞–≤–∫–∞: +${pay} PLN`);
    document.getElementById('btn-take-order').style.display='block';
    document.getElementById('progress-ui').style.display='none';
    renderAll();
}

function toggleAutoCourier() {
    if(!state.inventory.includes('bike') && !state.inventory.includes('scooter')) {
        return modal('–û—à–∏–±–∫–∞', '–ù—É–∂–µ–Ω —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç (–í–µ–ª–æ—Å–∏–ø–µ–¥ –∏–ª–∏ –°–∫—É—Ç–µ—Ä)');
    }
    state.autoCourier = !state.autoCourier;
    renderCourier();
}

function tickAutoCourier() {
    // Requirements
    if(state.energy<5 || state.water<5) {
        state.autoCourier=false;
        notify('–ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: –Ω–µ—Ç –≤–æ–¥—ã/—Å–∏–ª', 'danger');
        renderCourier();
        return;
    }
    
    // Logic
    let isScooter = state.inventory.includes('scooter');
    let chance = isScooter ? 0.4 : 0.2;
    
    if(Math.random() < chance) {
        let pay = isScooter ? 18 : 12;
        state.balance += pay;
        
        // CONSUMPTION
        // Energy check boost
        let noEn = (state.activeBoosts['no_drain'] && state.activeBoosts['no_drain'] > Date.now());
        if(!noEn) change('energy', -3);
        
        change('water', -3); // Water ALWAYS drains
        
        // Task
        let t = state.dailyTasks.d1;
        if(!t.done) { t.cur++; if(t.cur>=t.max){ t.done=true; state.balance+=t.reward; notify('–î–µ–π–ª–∏–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω!', 'success');}}

        notify(`ü§ñ –ë–æ—Ç: +${pay} PLN`, 'success');
        renderAll();
    }
}

// CAREER
function studyCoding() {
    if(state.energy<10) return notify('–ú–∞–ª–æ —ç–Ω–µ—Ä–≥–∏–∏', 'warning');
    state.energy -= 10;
    state.codingXp += 10;
    let req = (state.codingLvl+1)*50;
    if(state.codingXp >= req) {
        state.codingLvl++;
        state.codingXp=0;
        notify('Level Up! LVL '+state.codingLvl, 'success');
    }
    
    let t = state.dailyTasks.d2;
    if(!t.done) {
        t.cur++;
        if(t.cur>=t.max) { t.done=true; state.balance+=t.reward; notify('–£—á–µ–±–∞: +'+t.reward, 'success'); }
    }
    renderAll();
}

// SHOP & BIZ
function buy(id) {
    let it = ITEMS[id];
    if(state.balance < it.price) return notify('–ú–∞–ª–æ –¥–µ–Ω–µ–≥', 'danger');
    
    if(it.type === 'gear') {
        if(state.inventory.includes(id)) return notify('–£–∂–µ –∫—É–ø–ª–µ–Ω–æ', 'warning');
        state.balance -= it.price;
        state.inventory.push(id);
        notify('–ö—É–ø–ª–µ–Ω–æ: '+it.name);
    } 
    else if(it.type === 'use') {
        state.balance -= it.price;
        if(it.ef.water) change('water', it.ef.water);
        if(it.ef.energy) change('energy', it.ef.energy);
        if(it.ef.satiety) change('satiety', it.ef.satiety);
        if(it.sp === 'no_drain') {
            state.activeBoosts['no_drain'] = Date.now() + 120000; // 2 min
            notify('‚ö° –≠–Ω–µ—Ä–≥–µ—Ç–∏–∫ –∞–∫—Ç–∏–≤–µ–Ω!');
        }
        notify('–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: '+it.name);
    }
    else if(it.type === 'rent') {
        state.balance -= it.price;
        state.housing = id;
        state.rentTimer = it.days;
        notify('–ê—Ä–µ–Ω–¥–æ–≤–∞–Ω–æ: '+it.name);
    }
    renderAll();
    save();
}

function buyBiz(idx) {
    let b = BIZ[idx];
    if(state.balance < b.cost) return notify('–ú–∞–ª–æ –¥–µ–Ω–µ–≥', 'danger');
    if(state.business) return notify('–£–∂–µ –µ—Å—Ç—å –±–∏–∑–Ω–µ—Å', 'warning');
    
    state.balance -= b.cost;
    state.business = { id: b.id, name: b.name, lvl: 1 };
    notify('–ë–∏–∑–Ω–µ—Å –∫—É–ø–ª–µ–Ω!', 'success');
    renderAll();
    save();
}

function collectBiz() {
    if(!state.business) return;
    let b = BIZ.find(x=>x.id==state.business.id);
    state.balance += b.inc;
    notify('–ü—Ä–∏–±—ã–ª—å: '+b.inc, 'success');
    renderAll();
}

// SYSTEM
function payTax() {
    if(state.balance<500) return notify('–ù—É–∂–Ω–æ 500 PLN', 'danger');
    state.balance-=500;
    state.taxTimer=7;
    notify('–ù–∞–ª–æ–≥ –æ–ø–ª–∞—á–µ–Ω');
    renderAll();
}

function fullReset() {
    if(confirm('–¢–æ—á–Ω–æ —Å–±—Ä–æ—Å–∏—Ç—å? –í–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å –ø—Ä–æ–ø–∞–¥–µ—Ç.')) {
        localStorage.removeItem(SAVE_KEY);
        location.reload();
    }
}

// RENDER
function renderAll() {
    document.getElementById('ui-balance').innerText = Math.floor(state.balance) + ' PLN';
    renderStats();
    renderCourier();
    renderCareer();
    renderBiz();
    renderShop();
    renderSettings();
}

function renderStats() {
    ['energy','water','satiety','mood'].forEach(k => {
        let el = document.getElementById('ui-'+k);
        el.innerText = Math.floor(state[k])+'%';
        el.style.color = state[k]<20 ? 'var(--danger)' : 'white';
    });
}

function renderBoosts() {
    let d = document.getElementById('boost-card');
    let l = document.getElementById('boost-list');
    if(state.activeBoosts['no_drain'] && state.activeBoosts['no_drain'] > Date.now()) {
        d.style.display='block';
        let sec = Math.ceil((state.activeBoosts['no_drain'] - Date.now())/1000);
        l.innerHTML = `<div style="color:yellow">‚ö° –≠–Ω–µ—Ä–≥–µ—Ç–∏–∫: ${sec} —Å–µ–∫</div>`;
    } else {
        d.style.display='none';
    }
}

function renderCourier() {
    let btn = document.getElementById('btn-auto-courier');
    let stat = document.getElementById('courier-status');
    if(state.autoCourier) {
        stat.innerHTML = '<span style="color:var(--accent)">ü§ñ –ê–í–¢–û-–ë–û–¢ –†–ê–ë–û–¢–ê–ï–¢</span>';
        btn.innerText = '–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å';
        btn.className = 'btn danger';
    } else {
        stat.innerHTML = '–°—Ç–∞—Ç—É—Å: –°–≤–æ–±–æ–¥–µ–Ω';
        btn.innerText = '–í–∫–ª—é—á–∏—Ç—å –±–æ—Ç–∞';
        btn.className = 'btn secondary';
    }
}

function renderCareer() {
    document.getElementById('coding-lvl').innerText = state.codingLvl;
    let next = (state.codingLvl+1)*50;
    document.getElementById('coding-bar').style.width = ((state.codingXp/next)*100)+'%';
    
    let html = '';
    for(let k in state.dailyTasks) {
        let t = state.dailyTasks[k];
        let col = t.done ? 'var(--success)' : 'white';
        let ico = t.done ? '‚úÖ' : '‚¨ú';
        html += `<div style="display:flex; justify-content:space-between; margin-bottom:5px; color:${col}">
            <span>${t.txt}</span><span>${t.cur}/${t.max} ${ico}</span>
        </div>`;
    }
    document.getElementById('tasks-list').innerHTML = html;
}

function renderBiz() {
    let c = document.getElementById('business-container');
    if(state.business) {
        c.innerHTML = `<div class="card" style="border:1px solid var(--success)">
            <h3>${state.business.name}</h3>
            <p>–†–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ</p>
            <button class="btn" onclick="collectBiz()">–ó–∞–±—Ä–∞—Ç—å –ø—Ä–∏–±—ã–ª—å</button>
        </div>`;
    } else {
        let h = '';
        BIZ.forEach((b,i) => {
            h += `<div class="card">
                <h3>${b.name}</h3>
                <p style="font-size:0.8rem">${b.desc}</p>
                <button class="btn" onclick="buyBiz(${i})">–ö—É–ø–∏—Ç—å (${b.cost})</button>
            </div>`;
        });
        c.innerHTML = h;
    }
}

function renderShop() {
    // Consumables
    let h1 = '';
    ['water','kebab','monster'].forEach(k => {
        let i = ITEMS[k];
        h1 += `<div class="item-row">
            <div><div class="item-name">${i.name}</div><div class="item-desc">${i.desc}</div></div>
            <button class="btn" style="width:auto; padding:8px 15px;" onclick="buy('${k}')">${i.price}</button>
        </div>`;
    });
    document.getElementById('shop-consumables').innerHTML = h1;

    // Gear
    let h2 = '';
    ['bike','scooter','laptop'].forEach(k => {
        let i = ITEMS[k];
        let has = state.inventory.includes(k);
        let btn = has ? `<button class="btn secondary" disabled style="width:auto">–ö—É–ø–ª–µ–Ω–æ</button>` : `<button class="btn" style="width:auto" onclick="buy('${k}')">${i.price}</button>`;
        h2 += `<div class="item-row">
            <div><div class="item-name">${i.name}</div><div class="item-desc">${i.desc}</div></div>
            ${btn}
        </div>`;
    });
    document.getElementById('shop-gear').innerHTML = h2;
    
    // Rent
    let h3 = '';
    ['hostel','flat'].forEach(k => {
        let i = ITEMS[k];
        let isCur = state.housing === k;
        let btn = isCur ? `<button class="btn secondary" disabled style="width:auto">–¢–µ–∫—É—â–µ–µ</button>` : `<button class="btn" style="width:auto" onclick="buy('${k}')">${i.price}</button>`;
        h3 += `<div class="item-row">
            <div><div class="item-name">${i.name}</div><div class="item-desc">${i.days} –¥–Ω–µ–π</div></div>
            ${btn}
        </div>`;
    });
    document.getElementById('shop-rent').innerHTML = h3;
}

function renderSettings() {
    document.getElementById('tax-timer').innerText = state.taxTimer;
}

// UTILS
function switchTab(id, el) {
    document.querySelectorAll('.section').forEach(x=>x.classList.remove('active'));
    document.getElementById('sec-'+id).classList.add('active');
    document.querySelectorAll('.nav-item').forEach(x=>x.classList.remove('active'));
    el.classList.add('active');
}

function notify(msg, type='accent') {
    let d = document.createElement('div');
    d.className = 'toast';
    d.style.borderColor = `var(--${type})`;
    d.innerText = msg;
    document.getElementById('notif-area').appendChild(d);
    setTimeout(()=>d.remove(), 3000);
}

function modal(t, b) {
    document.getElementById('modal-title').innerText=t;
    document.getElementById('modal-text').innerText=b;
    document.getElementById('modal-overlay').style.display='flex';
}
function closeModal(){ document.getElementById('modal-overlay').style.display='none'; }

init();
</script>
</body>
</html>
