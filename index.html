<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Warszawa Courier: Pro Simulator</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        :root {
            --bg: #f4f4dc;
            --grid: #dadab9;
            --lime: #c8ff00;
            --dark: #2c2e3a;
        }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: var(--bg); font-family: 'Arial', sans-serif; }

        /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å */
        #top-bar {
            position: absolute; top: 0; width: 100%; height: 50px;
            background: white; display: flex; align-items: center; padding: 0 15px;
            box-sizing: border-box; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .menu-btn { font-size: 24px; cursor: pointer; margin-right: 20px; }
        .stat-badge { background: #f0f0f0; padding: 5px 12px; border-radius: 15px; font-size: 14px; font-weight: bold; margin-left: 10px; }

        /* –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é */
        #sidebar {
            position: fixed; left: -280px; top: 0; width: 260px; height: 100%;
            background: var(--dark); color: white; transition: 0.3s; z-index: 2000; padding: 20px;
        }
        #sidebar.active { left: 0; }
        .menu-item { padding: 15px; border-bottom: 1px solid #444; cursor: pointer; transition: 0.2s; }
        .menu-item:hover { background: #3d3f4d; color: var(--lime); }

        /* –ö–∞—Ä—Ç–∞ */
        #game-board {
            position: relative; width: 100%; height: 60vh; margin-top: 50px;
            background-image: linear-gradient(var(--grid) 1px, transparent 1px), linear-gradient(90deg, var(--grid) 1px, transparent 1px);
            background-size: 20px 20px; overflow: hidden;
        }

        /* –û–±—ä–µ–∫—Ç—ã –Ω–∞ –∫–∞—Ä—Ç–µ */
        .entity { position: absolute; width: 20px; height: 20px; transition: 0.1s; display: flex; align-items: center; justify-content: center; z-index: 10; }
        #player { background: var(--lime); border: 1.5px solid #000; border-radius: 3px; font-size: 14px; }
        .restaurant { filter: drop-shadow(0 0 5px orange); font-size: 18px; }
        .client { filter: drop-shadow(0 0 5px red); font-size: 18px; }
        .obstacle { opacity: 0.6; }

        /* –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        #ui-controls { height: 35vh; background: white; display: flex; flex-direction: column; align-items: center; padding: 10px; border-top: 2px solid #ddd; }
        .joystick { display: grid; grid-template-columns: repeat(3, 65px); gap: 8px; }
        .j-btn { height: 65px; background: #333; color: white; border: none; border-radius: 12px; font-size: 24px; }
        .j-btn:active { background: var(--lime); color: black; }

        /* –ú–∞–≥–∞–∑–∏–Ω (–º–æ–¥–∞–ª–∫–∏) */
        .modal { display: none; position: fixed; top: 10%; left: 5%; width: 90%; height: 80%; background: white; z-index: 3000; border-radius: 15px; padding: 20px; box-shadow: 0 0 50px rgba(0,0,0,0.5); overflow-y: auto; }
        .close-modal { float: right; font-size: 24px; font-weight: bold; }
        .shop-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee; }
        .buy-btn { background: var(--lime); border: none; padding: 5px 15px; border-radius: 5px; font-weight: bold; }
    </style>
</head>
<body>

<div id="top-bar">
    <div class="menu-btn" onclick="toggleSidebar()">‚ò∞</div>
    <div class="stat-badge">üí∞ <span id="cash">0.00</span></div>
    <div class="stat-badge">‚ö° <span id="energy">100</span>%</div>
    <div class="stat-badge">üòä <span id="mood">100</span>%</div>
</div>

<div id="sidebar">
    <div class="close-modal" onclick="toggleSidebar()">√ó</div>
    <h2 style="color: var(--lime)">–ú–µ–Ω—é</h2>
    <div class="menu-item" onclick="openModal('shop-food')">üçî –ú–∞–≥–∞–∑–∏–Ω (–ï–¥–∞/–≠–Ω–µ—Ä–≥–∏—è)</div>
    <div class="menu-item" onclick="openModal('shop-tech')">üö≤ –ú–∞–≥–∞–∑–∏–Ω —Ç–µ—Ö–Ω–∏–∫–∏</div>
    <div class="menu-item">üõ† –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å / –†–µ–º–æ–Ω—Ç</div>
    <div class="menu-item">üè¶ –ë–∞–Ω–∫</div>
    <br>
    <button onclick="location.reload()" style="width: 100%; padding: 10px; background: #ff4444; color: white; border: none; border-radius: 5px;">–£–π—Ç–∏ –≤ –æ—Ñ—Ñ–ª–∞–π–Ω</button>
</div>

<div id="shop-food" class="modal">
    <span class="close-modal" onclick="closeModals()">√ó</span>
    <h3>–ú–∞–≥–∞–∑–∏–Ω –ü—Ä–æ–¥—É–∫—Ç–æ–≤</h3>
    <div class="shop-item">
        <span>Red Bull (‚ö°+30%)</span>
        <span>15 PLN</span>
        <button class="buy-btn" onclick="buyItem('energy', 30, 15)">–ö—É–ø–∏—Ç—å</button>
    </div>
    <div class="shop-item">
        <span>–ü–∏—Ü—Ü–∞ (üòä+20%)</span>
        <span>25 PLN</span>
        <button class="buy-btn" onclick="buyItem('mood', 20, 25)">–ö—É–ø–∏—Ç—å</button>
    </div>
</div>

<div id="shop-tech" class="modal">
    <span class="close-modal" onclick="closeModals()">√ó</span>
    <h3>–ú–∞–≥–∞–∑–∏–Ω –¢–µ—Ö–Ω–∏–∫–∏</h3>
    <div class="shop-item">
        <span>–≠–ª–µ–∫—Ç—Ä–æ –í–µ–ª 250W</span>
        <span>1200 PLN</span>
        <button class="buy-btn" onclick="buyTech(1.5, 1200)">–ö—É–ø–∏—Ç—å</button>
    </div>
    <div class="shop-item">
        <span>–≠–ª–µ–∫—Ç—Ä–æ –í–µ–ª 500W</span>
        <span>2500 PLN</span>
        <button class="buy-btn" onclick="buyTech(2.0, 2500)">–ö—É–ø–∏—Ç—å</button>
    </div>
</div>

<div id="game-board">
    <div id="player" class="entity">üö≤</div>
    <div id="target" class="entity" style="display:none"></div>
</div>

<div id="ui-controls">
    <div id="status-text" style="margin-bottom: 10px; color: #666; font-size: 14px;">–ù–∞–∂–º–∏ "–û–Ω–ª–∞–π–Ω" –≤ –º–µ–Ω—é –∏–ª–∏ –∂–¥–∏ –∑–∞–∫–∞–∑</div>
    <div class="joystick">
        <div id="online-trigger" onclick="startWork()" style="grid-column: 1/4; background: var(--lime); padding: 15px; border-radius: 10px; text-align: center; font-weight: bold; cursor: pointer;">–í–´–ô–¢–ò –í –û–ù–õ–ê–ô–ù</div>
        
        <button class="j-btn" style="grid-column: 2" onclick="move(0, -20)">‚Üë</button>
        <button class="j-btn" style="grid-column: 1; grid-row: 3" onclick="move(-20, 0)">‚Üê</button>
        <button class="j-btn" style="grid-column: 2; grid-row: 3" onclick="move(0, 20)">‚Üì</button>
        <button class="j-btn" style="grid-column: 3; grid-row: 3" onclick="move(20, 0)">‚Üí</button>
    </div>
</div>

<script>
    // –ë–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
    let stats = { cash: 50.00, energy: 100, mood: 100, speed: 1 };
    let playerPos = { x: 100, y: 100 };
    let targetPos = { x: 0, y: 0 };
    let currentJob = null; // 'TO_REST', 'TO_CLIENT'
    const cellSize = 20;

    function toggleSidebar() { document.getElementById('sidebar').classList.toggle('active'); }
    function openModal(id) { closeModals(); document.getElementById(id).style.display = 'block'; }
    function closeModals() { document.querySelectorAll('.modal').forEach(m => m.style.display = 'none'); }

    function updateStats() {
        document.getElementById('cash').innerText = stats.cash.toFixed(2);
        document.getElementById('energy').innerText = Math.max(0, stats.energy);
        document.getElementById('mood').innerText = Math.max(0, stats.mood);
        document.getElementById('player').style.left = playerPos.x + 'px';
        document.getElementById('player').style.top = playerPos.y + 'px';
    }

    function startWork() {
        document.getElementById('online-trigger').style.display = 'none';
        newOrder();
    }

    function newOrder() {
        currentJob = 'TO_REST';
        targetPos = { 
            x: Math.floor(Math.random() * 15) * cellSize, 
            y: Math.floor(Math.random() * 15) * cellSize 
        };
        const t = document.getElementById('target');
        t.style.display = 'flex';
        t.style.left = targetPos.x + 'px';
        t.style.top = targetPos.y + 'px';
        t.className = 'entity restaurant';
        t.innerHTML = 'üçï'; // –ó–Ω–∞—á–æ–∫ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞
        document.getElementById('status-text').innerText = "–ó–∞–∫–∞–∑: Ul. Marsza≈Çkowska 10. –ï–¥—å –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω!";
    }

    function move(dx, dy) {
        if(stats.energy <= 0) { alert("–ù–µ—Ç —ç–Ω–µ—Ä–≥–∏–∏! –ö—É–ø–∏ Red Bull."); return; }
        
        playerPos.x += dx * stats.speed;
        playerPos.y += dy * stats.speed;
        
        stats.energy -= 1;
        updateStats();
        checkCollision();
    }

    function checkCollision() {
        let dist = Math.hypot(playerPos.x - targetPos.x, playerPos.y - targetPos.y);
        if(dist < 15) {
            if(currentJob === 'TO_REST') {
                document.getElementById('status-text').innerText = "–ñ–¥–µ–º –∑–∞–∫–∞–∑ (3—Å)...";
                currentJob = 'WAITING';
                setTimeout(() => {
                    currentJob = 'TO_CLIENT';
                    targetPos = { x: Math.floor(Math.random() * 15) * cellSize, y: Math.floor(Math.random() * 15) * cellSize };
                    const t = document.getElementById('target');
                    t.style.left = targetPos.x + 'px';
                    t.style.top = targetPos.y + 'px';
                    t.className = 'entity client';
                    t.innerHTML = 'üìç'; // –ó–Ω–∞—á–æ–∫ –∫–ª–∏–µ–Ω—Ç–∞
                    document.getElementById('status-text').innerText = "–í–µ–∑–∏ –∫–ª–∏–µ–Ω—Ç—É: Ul. Nowy ≈öwiat 5";
                }, 3000);
            } else if(currentJob === 'TO_CLIENT') {
                let reward = 12.50;
                stats.cash += reward;
                alert("–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ! + " + reward + " PLN");
                newOrder();
                updateStats();
            }
        }
    }

    function buyItem(type, val, price) {
        if(stats.cash >= price) {
            stats.cash -= price;
            stats[type] = Math.min(100, stats[type] + val);
            updateStats();
            alert("–£—Å–ø–µ—à–Ω–æ –∫—É–ø–ª–µ–Ω–æ!");
        } else { alert("–ú–∞–ª–æ –¥–µ–Ω–µ–≥!"); }
    }

    function buyTech(speedMult, price) {
        if(stats.cash >= price) {
            stats.cash -= price;
            stats.speed = speedMult;
            updateStats();
            alert("–ù–æ–≤—ã–π –≤–µ–ª–∏–∫! –¢–µ–ø–µ—Ä—å —Ç—ã –±—ã—Å—Ç—Ä–µ–µ.");
        } else { alert("–ú–∞–ª–æ –¥–µ–Ω–µ–≥!"); }
    }

    updateStats();
</script>

</body>
</html>
