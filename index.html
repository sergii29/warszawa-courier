<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Call App</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        body { background: #111; color: white; font-family: Arial; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .window { background: #222; padding: 30px; border-radius: 20px; border: 1px solid #444; text-align: center; width: 300px; }
        input { width: 100%; padding: 15px; margin: 20px 0; border-radius: 10px; border: none; font-size: 18px; box-sizing: border-box; }
        button { width: 100%; padding: 15px; background: #00c853; border: none; border-radius: 10px; color: white; font-size: 18px; font-weight: bold; cursor: pointer; }
        #balance { font-size: 24px; color: #00e676; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="window">
    <div id="balance">--</div>
    <div style="font-size: 12px; color: #888;">доступных минут</div>
    
    <input type="text" id="phone" placeholder="+48 XXX XXX XXX">
    
    <button onclick="callNow()">ПОЗВОНИТЬ</button>
</div>

<script>
    // 1. ВСТАВЬ СЮДА СВОИ ДАННЫЕ ИЗ FIREBASE (Settings -> Project Settings)
    const firebaseConfig = {
        apiKey: "ТВОЙ_API_KEY",
        databaseURL: "https://ТВОЙ_ПРОЕКТ.firebaseio.com",
        projectId: "ТВОЙ_ПРОЕКТ_ID",
        appId: "ТВОЙ_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // 2. ТВОЙ ID ИЗ ТЕЛЕГРАМА (@userinfobot)
    const myId = "ВСТАВЬ_СВОЙ_ID_ЦИФРАМИ"; 

    // 3. ДАННЫЕ RINGOSTAT
    const RINGO_KEY = "ZYyYpHuU39RwaWrQPN9YvQkYc64Y3R9s";
    const PROJECT_ID = "221492";

    // Авто-обновление баланса на экране
    db.ref('calls_system/' + myId + '/balance').on('value', (s) => {
        document.getElementById('balance').innerText = s.val() || 0;
    });

    async function callNow() {
        const num = document.getElementById('phone').value;
        if(!num.startsWith('+')) return alert("Номер должен быть с +");

        const ref = db.ref('calls_system/' + myId + '/balance');
        const snap = await ref.once('value');
        const bal = snap.val();

        if (bal > 0) {
            try {
                const res = await fetch(`https://api.ringostat.com/callback/make_call?key=${RINGO_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        project_id: PROJECT_ID,
                        phone: num,
                        sip: "101" // Проверь в Ringostat, какой номер SIP активен (101, 102...)
                    })
                });

                if (res.ok) {
                    alert("Жди звонка в Zoiper!");
                    ref.set(bal - 1); // Снимаем минуту
                } else {
                    alert("Ringostat отказал. Проверь баланс в Ringostat.");
                }
            } catch(e) { alert("Ошибка сети"); }
        } else {
            alert("Нет минут!");
        }
    }
</script>

</body>
</html>
