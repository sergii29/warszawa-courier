<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Warszawa Express: Underground</title>
    <style>
        :root { --yellow: #ffcc00; --bg: #0f0f0f; --card: #1e1e1e; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; text-align: center; margin: 0; user-select: none; overflow: hidden; }
        #ui { padding: 15px; display: flex; flex-direction: column; height: 100vh; justify-content: space-between; box-sizing: border-box; }
        .header { background: var(--card); border-radius: 20px; padding: 15px; border: 1px solid #333; }
        .money-text { font-size: 32px; font-weight: 800; color: var(--yellow); }
        .bar-container { background: #333; height: 10px; border-radius: 5px; margin: 10px 0; overflow: hidden; }
        .bar-fill { height: 100%; transition: width 0.2s; }
        #energy-bar { background: #4caf50; }
        #water-bar { background: #2196f3; }
        #event-log { font-size: 14px; height: 40px; color: #00ff00; display: flex; align-items: center; justify-content: center; }
        #game-core { flex-grow: 1; display: flex; align-items: center; justify-content: center; }
        #courier-btn { width: 200px; height: 200px; background: radial-gradient(circle, #333, #111); border-radius: 50%; border: 8px solid var(--yellow); display: flex; align-items: center; justify-content: center; cursor: pointer; }
        #courier-btn:active { transform: scale(0.95); }
        #emoji { font-size: 80px; }
        .shop { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding-bottom: 10px; }
        .btn { background: var(--card); border: 1px solid #444; color: white; padding: 12px 5px; border-radius: 12px; font-size: 12px; }
        .btn b { color: var(--yellow); display: block; font-size: 14px; }
        .energy-note { font-size: 10px; color: #888; display: block; margin-top: 4px; }
    </style>
</head>
<body>

<div id="ui">
    <div class="header">
        <div class="money-text" id="money">0.00 $</div>
        <div id="district" style="color: #aaa; font-weight: bold;">Praga Po≈Çudnie</div>
        <div class="bar-container"><div id="energy-bar" class="bar-fill" style="width: 100%"></div></div>
        <div class="bar-container"><div id="water-bar" class="bar-fill" style="width: 100%"></div></div>
    </div>

    <div id="event-log">–ù–∞—á–Ω–∏ —Ä–∞–±–æ—Ç—É, –∫—É—Ä—å–µ—Ä!</div>

    <div id="game-core">
        <div id="courier-btn" onclick="handleMainClick()">
            <div id="emoji">üö∂‚Äç‚ôÇÔ∏è</div>
        </div>
    </div>

    <div class="shop">
        <button class="btn" onclick="buyItem('energy')">
            <b>–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫</b> <span id="p-e">30</span>$
            <span class="energy-note">–û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞—Å—Ö–æ–¥–∞ —ç–Ω–µ—Ä–≥–∏–∏ (–í–æ–¥–∞ —Ç—Ä–∞—Ç–∏—Ç—Å—è!)</span>
        </button>
        <button class="btn" onclick="buyItem('water')"><b>–í–æ–¥–∞</b> <span id="p-w">10</span>$</button>
        <button class="btn" onclick="upgradeTransport()"><b>–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</b> <span id="p-t">150</span>$</button>
        <button class="btn" onclick="changeDistrict()"><b>–†–∞–π–æ–Ω</b> <span id="p-d">500</span>$</button>
    </div>
</div>

<script>
    const KEY = "WARSZAWA_FOREVER";
    let state = { money: 0, lvl: 1.0, energy: 100, water: 100, districtIdx: 0, inflation: 1.0, boostActive: false };
    
    const dists = [
        { name: "Praga Po≈Çudnie", mult: 1.0, color: "#aaa" },
        { name: "Wola", mult: 2.5, color: "#fff" },
        { name: "Mokot√≥w", mult: 6.0, color: "#00ff00" },
        { name: "≈ör√≥dmie≈õcie", mult: 15.0, color: "#ffcc00" }
    ];

    function handleMainClick() {
        if (state.energy <= 1 || state.water <= 1) { pushLog("–ù–µ—Ç —Å–∏–ª –∏–ª–∏ –≤–æ–¥—ã!"); return; }
        
        if (!state.boostActive) state.energy -= 0.5;
        state.water -= 0.7; // –í–æ–¥–∞ —Ç—Ä–∞—Ç–∏—Ç—Å—è –≤—Å–µ–≥–¥–∞
        
        state.money += state.lvl * dists[state.districtIdx].mult;
        updateUI();
        save();
    }

    function buyItem(type) {
        let price = (type === 'energy' ? 30 : 10) * state.inflation;
        if (state.money >= price) {
            state.money -= price;
            if (type === 'energy') {
                state.boostActive = true;
                pushLog("–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!");
                setTimeout(() => { state.boostActive = false; pushLog("–î–µ–π—Å—Ç–≤–∏–µ —ç–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞ –≤—ã—à–ª–æ"); }, 30000);
            } else {
                state.water = 100;
            }
            updateUI();
            save();
        }
    }

    function upgradeTransport() {
        let price = 150 * state.lvl * state.inflation;
        if (state.money >= price) {
            state.money -= price;
            state.lvl += 0.8;
            updateEmoji();
            updateUI();
            save();
        }
    }

    function changeDistrict() {
        if (state.districtIdx >= dists.length - 1) return;
        let price = 500 * (state.districtIdx + 1) * state.inflation;
        if (state.money >= price) {
            state.money -= price;
            state.districtIdx++;
            pushLog("–ù–æ–≤—ã–π —Ä–∞–π–æ–Ω: " + dists[state.districtIdx].name);
            updateUI();
            save();
        }
    }

    function updateEmoji() {
        const e = document.getElementById('emoji');
        if (state.lvl >= 5) e.innerText = "üöó";
        else if (state.lvl >= 3) e.innerText = "üõµ";
        else if (state.lvl >= 2) e.innerText = "üö¥‚Äç‚ôÇÔ∏è";
    }

    function pushLog(m) { document.getElementById('event-log').innerText = m; }

    function updateUI() {
        document.getElementById('money').innerText = state.money.toFixed(2) + " $";
        document.getElementById('district').innerText = dists[state.districtIdx].name;
        document.getElementById('district').style.color = dists[state.districtIdx].color;
        document.getElementById('energy-bar').style.width = state.energy + "%";
        document.getElementById('water-bar').style.width = state.water + "%";
        
        document.getElementById('p-e').innerText = Math.floor(30 * state.inflation);
        document.getElementById('p-w').innerText = Math.floor(10 * state.inflation);
        document.getElementById('p-t').innerText = Math.floor(150 * state.lvl * state.inflation);
        document.getElementById('p-d').innerText = Math.floor(500 * (state.districtIdx + 1) * state.inflation);
    }

    function save() { localStorage.setItem(KEY, JSON.stringify(state)); }

    window.onload = () => {
        const saved = localStorage.getItem(KEY);
        if (saved) { state = JSON.parse(saved); updateUI(); updateEmoji(); }
        
        // –†–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–Ω–µ—Ä–≥–∏–∏
        setInterval(() => {
            if (state.energy < 100) { state.energy += 0.3; updateUI(); }
        }, 1500);

        // –ò–Ω—Ñ–ª—è—Ü–∏—è —Ä–∞–∑ –≤ –º–∏–Ω—É—Ç—É
        setInterval(() => {
            state.inflation += 0.05;
            pushLog("–ò–Ω—Ñ–ª—è—Ü–∏—è –≤—ã—Ä–æ—Å–ª–∞ –Ω–∞ 5%!");
            save();
        }, 60000);
    };
</script>
</body>
</html>

