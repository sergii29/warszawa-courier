<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Warsaw Night Courier</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0a0a0a; color: #fff; overflow: hidden; height: 100vh; }
        
        #map { height: 100%; width: 100%; position: absolute; top: 0; left: 0; z-index: 1; }
        .leaflet-tile { filter: brightness(0.3) saturate(0.6) contrast(1.3) !important; }
        
        .ui-layer { position: absolute; z-index: 100; pointer-events: none; width: 100%; height: 100%; }
        .ui-layer > * { pointer-events: auto; }
        
        /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å –∫–æ–º–ø–∞–∫—Ç–Ω–∞—è */
        .top-panel { position: absolute; top: 0; left: 0; right: 0; padding: 10px; background: linear-gradient(to bottom, rgba(0,0,0,0.95), transparent); }
        
        .balance-box { background: rgba(0,0,0,0.8); padding: 6px 15px; border-radius: 15px; border: 1px solid #00e676; display: inline-block; margin-bottom: 8px; }
        .balance-amount { font-size: 18px; font-weight: bold; color: #00e676; }
        
        .stats-grid { display: flex; gap: 8px; justify-content: center; }
        .stat-card { background: rgba(20,20,20,0.9); padding: 8px 12px; border-radius: 12px; text-align: center; min-width: 70px; border: 2px solid; transition: all 0.3s; }
        .stat-card.energy { border-color: #ffcc00; }
        .stat-card.water { border-color: #00ccff; }
        .stat-card.mood { border-color: #d500f9; }
        .stat-card.critical { animation: pulse-red 1s infinite; border-color: #ff3d00 !important; }
        
        @keyframes pulse-red { 0%, 100% { box-shadow: 0 0 5px #ff3d00; } 50% { box-shadow: 0 0 20px #ff3d00; } }
        
        .stat-icon { font-size: 16px; margin-bottom: 2px; }
        .stat-value { font-size: 14px; font-weight: bold; }
        .stat-bar { width: 100%; height: 3px; background: #333; border-radius: 2px; margin-top: 4px; overflow: hidden; }
        .stat-fill { height: 100%; transition: width 0.3s; }
        
        /* –ö–ù–û–ü–ö–ò –°–í–ï–†–•–£ ‚Äî –°–¥–≤–∏–Ω—É—Ç—ã —á—É—Ç—å –Ω–∏–∂–µ, —á—Ç–æ–±—ã –Ω–µ –ª–∏–ø–ª–∏ –∫ —Å—Ç–∞—Ç–∞–º */
        .action-bar { 
            position: absolute; 
            top: 135px; 
            left: 10px; 
            right: 10px; 
            display: flex; 
            gap: 6px; 
            z-index: 100;
        }
        
        .action-btn-small { 
            flex: 1; 
            padding: 8px 4px; 
            border: none; 
            border-radius: 10px; 
            font-size: 10px; 
            font-weight: bold; 
            cursor: pointer; 
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
            min-height: 50px;
        }
        
        .action-btn-small:active { transform: scale(0.95); }
        
        .btn-water { background: linear-gradient(135deg, #00ccff, #0099cc); color: #000; }
        .btn-energy { background: linear-gradient(135deg, #ffcc00, #ff9900); color: #000; }
        .btn-find { background: linear-gradient(135deg, #00e676, #00c853); color: #000; }
        .btn-shop { background: linear-gradient(135deg, #e91e63, #c2185b); color: #fff; }
        .btn-stats { background: linear-gradient(135deg, #9c27b0, #7b1fa2); color: #fff; }
        
        .action-icon { font-size: 16px; }
        .action-text { font-size: 9px; }
        .action-cost { font-size: 8px; opacity: 0.9; }
        
        /* –ü–∞–Ω–µ–ª–∏ –ø–æ —Ü–µ–Ω—Ç—Ä—É */
        .center-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 400px;
            background: rgba(15,15,15,0.98);
            border-radius: 25px;
            padding: 20px;
            border: 2px solid #00e676;
            z-index: 150;
            display: none;
        }
        
        .center-panel.active { display: block; animation: popIn 0.3s; }
        
        @keyframes popIn { from { transform: translate(-50%, -50%) scale(0.8); opacity: 0; } to { transform: translate(-50%, -50%) scale(1); opacity: 1; } }
        
        .center-title { font-size: 20px; font-weight: bold; margin-bottom: 8px; text-align: center; }
        .center-subtitle { color: #888; font-size: 12px; margin-bottom: 15px; text-align: center; }
        
        /* –ü–∞–Ω–µ–ª—å –¥–æ—Å—Ç–∞–≤–∫–∏ ‚Äî –∫–æ–º–ø–∞–∫—Ç–Ω–∞—è —Å–Ω–∏–∑—É */
        .delivery-panel-compact {
            position: absolute;
            bottom: 10px;
            left: 10px;
            right: 10px;
            background: rgba(15,15,15,0.95);
            border-radius: 20px;
            padding: 15px;
            border: 1px solid #333;
            display: none;
            z-index: 100;
        }
        
        .delivery-panel-compact.active { display: block; }
        
        .delivery-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .delivery-title { font-size: 16px; font-weight: bold; }
        .delivery-status { font-size: 12px; color: #00e676; }
        
        .progress-line { height: 6px; background: #333; border-radius: 3px; overflow: hidden; margin-bottom: 10px; }
        .progress-fill-line { height: 100%; background: linear-gradient(90deg, #00e676, #00c853); width: 0%; transition: width 0.5s; }
        
        .delivery-buttons { display: flex; gap: 10px; }
        .btn-small { flex: 1; padding: 12px; border: none; border-radius: 12px; font-size: 13px; font-weight: bold; cursor: pointer; }
        
        /* –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω */
        .game-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.85);
            z-index: 200;
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        
        .game-overlay.active { display: flex; }
        
        .game-box {
            background: #1a1a1a;
            border-radius: 25px;
            padding: 25px;
            width: 90%;
            max-width: 350px;
            border: 2px solid #2979ff;
            text-align: center;
        }
        
        .game-title { font-size: 22px; font-weight: bold; margin-bottom: 15px; color: #2979ff; }
        .game-road-big { 
            width: 100%; 
            height: 200px; 
            background: linear-gradient(to bottom, #0f0f0f, #1a1a1a); 
            border-radius: 15px; 
            position: relative; 
            overflow: hidden; 
            margin-bottom: 20px;
            border: 3px solid #444;
        }
        
        .lane-big { position: absolute; width: 100%; height: 33.33%; border-bottom: 2px dashed #555; }
        .player-bike-big { position: absolute; left: 20px; top: 50%; transform: translateY(-50%); font-size: 40px; transition: top 0.1s; z-index: 10; }
        .obstacle-big { position: absolute; right: -50px; font-size: 35px; animation: moveLeftBig 2s linear; z-index: 5; }
        
        @keyframes moveLeftBig { from { right: -50px; } to { right: 110%; } }
        
        .game-hint-big { color: #888; margin-bottom: 15px; }
        .game-controls { display: flex; gap: 20px; justify-content: center; }
        .game-control-btn { 
            width: 100px; 
            height: 100px; 
            border-radius: 50%; 
            border: 3px solid; 
            background: transparent; 
            font-size: 40px; 
            cursor: pointer;
            transition: all 0.1s;
        }
        
        .game-control-btn.up { border-color: #2979ff; color: #2979ff; }
        .game-control-btn.down { border-color: #7c4dff; color: #7c4dff; }
        .game-control-btn:active { transform: scale(0.95); background: rgba(255,255,255,0.1); }
        
        /* –ü–∞–Ω–µ–ª—å –±—ã—Å—Ç—Ä–æ–π –ø–∞—É–∑—ã/–º–∞–≥–∞–∑–∏–Ω–∞ */
        .quick-rest-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: rgba(20,20,20,0.98);
            padding: 25px;
            border-radius: 25px;
            border: 2px solid #00e676;
            z-index: 300;
            width: 90%;
            max-width: 350px;
            transition: transform 0.3s;
            text-align: center;
        }
        
        .quick-rest-panel.active { transform: translate(-50%, -50%) scale(1); }
        
        .rest-title { font-size: 22px; font-weight: bold; margin-bottom: 15px; color: #00e676; }
        
        .rest-option { 
            background: rgba(40,40,40,0.9); 
            padding: 15px; 
            border-radius: 15px; 
            margin-bottom: 10px; 
            border: 2px solid #444;
            cursor: pointer;
        }
        
        .rest-option:hover { border-color: #00e676; }
        
        .overlay-backdrop {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 290;
            display: none;
        }
        
        .overlay-backdrop.active { display: block; }
        
        /* –°–æ–±—ã—Ç–∏–µ */
        .event-overlay { 
            position: fixed; 
            top: 0; left: 0; right: 0; bottom: 0; 
            background: rgba(0,0,0,0.9); 
            z-index: 250; 
            display: none; 
            align-items: center; 
            justify-content: center; 
            padding: 20px; 
        }
        
        .event-overlay.active { display: flex; }
        
        .event-card { 
            background: #1a1a1a; 
            border-radius: 25px; 
            padding: 30px; 
            max-width: 350px; 
            width: 100%; 
            border: 2px solid #ff9100; 
            text-align: center; 
        }
        
        .event-icon { font-size: 60px; margin-bottom: 15px; }
        .event-title { font-size: 24px; font-weight: bold; margin-bottom: 10px; }
        .event-text { color: #aaa; margin-bottom: 20px; line-height: 1.5; }
        .event-choices { display: flex; flex-direction: column; gap: 10px; }
        
        /* –ü–∏—Ç-—Å—Ç–æ–ø */
        .pitstop-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 220;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .pitstop-overlay.active { display: flex; }
        
        .pitstop-card {
            background: #1a1a1a;
            border-radius: 25px;
            padding: 25px;
            max-width: 350px;
            width: 100%;
            border: 2px solid #00e676;
            text-align: center;
        }
        
        .pitstop-title { font-size: 24px; font-weight: bold; margin-bottom: 20px; }
        .pitstop-items { display: flex; flex-direction: column; gap: 10px; margin-bottom: 15px; }
        .pitstop-item {
            background: rgba(40,40,40,0.9);
            padding: 15px;
            border-radius: 15px;
            border: 2px solid #444;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .pitstop-item:hover { border-color: #00e676; }
        .pitstop-item-header { display: flex; align-items: center; gap: 10px; font-size: 18px; margin-bottom: 5px; }
        .pitstop-item-desc { font-size: 12px; color: #888; }
        
        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .toast { 
            position: fixed; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            background: rgba(0,0,0,0.95); 
            padding: 20px 30px; 
            border-radius: 20px; 
            border: 2px solid #00e676; 
            color: #00e676; 
            font-weight: bold; 
            opacity: 0; 
            pointer-events: none; 
            transition: opacity 0.3s; 
            z-index: 400; 
            text-align: center; 
            max-width: 300px; 
        }
        
        .toast.show { opacity: 1; }
        .toast.error { border-color: #ff3d00; color: #ff3d00; }
        
        /* –ö–Ω–æ–ø–∫–∏ */
        .btn { width: 100%; padding: 14px; border: none; border-radius: 12px; font-size: 14px; font-weight: bold; cursor: pointer; transition: all 0.2s; margin-bottom: 8px; }
        .btn:active { transform: scale(0.97); }
        .btn-primary { background: linear-gradient(135deg, #00e676, #00c853); color: #000; }
        .btn-warning { background: linear-gradient(135deg, #ff9100, #ff6d00); color: #000; }
        .btn-danger { background: linear-gradient(135deg, #ff3d00, #dd2c00); color: #fff; }
        
        /* –ú–∞—Ä–∫–µ—Ä—ã */
        .marker-courier { background: #00e676; width: 24px; height: 24px; border-radius: 50%; border: 3px solid #fff; box-shadow: 0 0 20px #00e676; animation: pulse-green 2s infinite; }
        .marker-dest { background: #ff3d00; width: 30px; height: 30px; border-radius: 50%; border: 3px solid #fff; box-shadow: 0 0 25px #ff3d00; }
        .marker-pitstop { background: #2979ff; width: 28px; height: 28px; border-radius: 50%; border: 3px solid #fff; box-shadow: 0 0 15px #2979ff; display: flex; align-items: center; justify-content: center; font-size: 14px; }
        
        @keyframes pulse-green { 0%, 100% { box-shadow: 0 0 10px #00e676; } 50% { box-shadow: 0 0 25px #00e676; } }
        
        .route-tag { display: inline-block; padding: 2px 8px; border-radius: 10px; font-size: 10px; margin-left: 5px; }
        .tag-fast { background: #ff3d00; color: #fff; }
        .tag-safe { background: #00e676; color: #000; }
        .tag-profit { background: #ffd600; color: #000; }
    </style>
</head>
<body>
    <div id="map"></div>
    
    <div class="ui-layer">
        <div class="top-panel">
            <div class="balance-box">
                <div class="balance-amount" id="balance">50 ‚ÇΩ</div>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card energy" id="energy-card">
                    <div class="stat-icon">‚ö°</div>
                    <div class="stat-value" id="energy-val">100</div>
                    <div class="stat-bar"><div class="stat-fill" id="energy-bar" style="width: 100%; background: #ffcc00;"></div></div>
                </div>
                <div class="stat-card water" id="water-card">
                    <div class="stat-icon">üíß</div>
                    <div class="stat-value" id="water-val">100</div>
                    <div class="stat-bar"><div class="stat-fill" id="water-bar" style="width: 100%; background: #00ccff;"></div></div>
                </div>
                <div class="stat-card mood" id="mood-card">
                    <div class="stat-icon">üòé</div>
                    <div class="stat-value" id="mood-val">100</div>
                    <div class="stat-bar"><div class="stat-fill" id="mood-bar" style="width: 100%; background: #d500f9;"></div></div>
                </div>
            </div>
        </div>
        
        <div class="action-bar" id="action-bar">
            <button class="action-btn-small btn-water" onclick="quickRefill('water')">
                <span class="action-icon">üíß</span>
                <span class="action-text">–í–æ–¥–∞</span>
                <span class="action-cost">3 ‚ÇΩ</span>
            </button>
            <button class="action-btn-small btn-energy" onclick="quickRefill('energy')">
                <span class="action-icon">‚òï</span>
                <span class="action-text">–ö–æ—Ñ–µ</span>
                <span class="action-cost">5 ‚ÇΩ</span>
            </button>
            <button class="action-btn-small btn-find" onclick="findOrder()">
                <span class="action-icon">üîç</span>
                <span class="action-text">–ó–ê–ö–ê–ó</span>
            </button>
            <button class="action-btn-small btn-shop" onclick="openShop()">
                <span class="action-icon">üõí</span>
                <span class="action-text">–ú–∞–≥–∞–∑</span>
            </button>
            <button class="action-btn-small btn-stats" onclick="showStats()">
                <span class="action-icon">üìä</span>
                <span class="action-text">–°—Ç–∞—Ç</span>
            </button>
        </div>
        
        <div class="center-panel" id="route-panel">
            <div class="center-title">üó∫Ô∏è –í—ã–±–µ—Ä–∏ –º–∞—Ä—à—Ä—É—Ç</div>
            <div class="center-subtitle">–ö–∞–∂–¥—ã–π –ø—É—Ç—å –∏–º–µ–µ—Ç —Ä–∏—Å–∫–∏ –∏ –Ω–∞–≥—Ä–∞–¥—ã</div>
            <div id="route-options"></div>
        </div>
        
        <div class="delivery-panel-compact" id="delivery-panel">
            <div class="delivery-header">
                <div class="delivery-title" id="delivery-title">üçî –î–æ—Å—Ç–∞–≤–∫–∞</div>
                <div class="delivery-status" id="delivery-status">–í –ø—É—Ç–∏...</div>
            </div>
            <div class="progress-line">
                <div class="progress-fill-line" id="progress-fill"></div>
            </div>
            <div class="delivery-buttons">
                <button class="btn-small btn-primary" id="drive-btn" onclick="startDriving()" style="display:none;">üö≤ –ï—Ö–∞—Ç—å</button>
                <button class="btn-small btn-danger" onclick="cancelDelivery()">‚ùå –û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <div class="game-overlay" id="game-overlay">
        <div class="game-box">
            <div class="game-title">‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ!</div>
            <div class="game-road-big" id="game-road">
                <div class="lane-big" style="top: 0;"></div>
                <div class="lane-big" style="top: 33.33%;"></div>
                <div class="lane-big" style="top: 66.66%;"></div>
                <div class="player-bike-big" id="player">üö¥</div>
            </div>
            <div class="game-controls">
                <button class="game-control-btn up" onclick="moveBike(-1)">‚¨ÜÔ∏è</button>
                <button class="game-control-btn down" onclick="moveBike(1)">‚¨áÔ∏è</button>
            </div>
        </div>
    </div>

    <div class="overlay-backdrop" id="rest-backdrop" onclick="closeQuickRest()"></div>
    <div class="quick-rest-panel" id="quick-rest-panel">
        <div class="rest-title" id="rest-title">ü•§ –ë—ã—Å—Ç—Ä–∞—è –ø–∞—É–∑–∞</div>
        <div id="rest-options"></div>
        <button class="btn" style="background: transparent; border: 2px solid #666; color: #888;" onclick="closeQuickRest()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
    <div class="toast" id="toast"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // –í–û–ó–í–†–ê–©–ê–ï–ú –í–°–Æ –¢–í–û–Æ –õ–û–ì–ò–ö–£
        let state = { balance: 50, energy: 100, water: 100, mood: 100, stats: { totalDeliveries: 0, totalEarned: 0, accidents: 0, bestTip: 0 }, isDelivering: false };

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI (—Ç–µ–ø–µ—Ä—å —Å ‚ÇΩ)
        function updateUI() {
            document.getElementById('balance').textContent = Math.floor(state.balance) + ' ‚ÇΩ';
            document.getElementById('energy-val').textContent = Math.floor(state.energy);
            document.getElementById('energy-bar').style.width = state.energy + '%';
            document.getElementById('water-val').textContent = Math.floor(state.water);
            document.getElementById('water-bar').style.width = state.water + '%';
            document.getElementById('mood-val').textContent = Math.floor(state.mood);
            document.getElementById('mood-bar').style.width = state.mood + '%';
        }

        // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ —Ç–≤–æ–µ–≥–æ –∫–æ–¥–∞...
        function showToast(msg) {
            const t = document.getElementById('toast');
            t.textContent = msg; t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 2000);
        }

        function quickRefill(type) {
            const items = type === 'water' ? 
                [{name:'–í–æ–¥–∞', cost:3, w:40, e:0}] : 
                [{name:'–ö–æ—Ñ–µ', cost:5, w:-5, e:35}];
            
            let html = '';
            items.forEach(item => {
                html += `<div class="rest-option" onclick="buy(${item.cost},${item.e},${item.w})">
                    ${item.name} ‚Äî ${item.cost} ‚ÇΩ
                </div>`;
            });
            document.getElementById('rest-options').innerHTML = html;
            document.getElementById('quick-rest-panel').classList.add('active');
            document.getElementById('rest-backdrop').classList.add('active');
        }

        function buy(cost, e, w) {
            if(state.balance >= cost) {
                state.balance -= cost;
                state.energy = Math.min(100, state.energy + e);
                state.water = Math.min(100, state.water + w);
                updateUI(); closeQuickRest();
            } else { showToast('–ù–µ—Ç –¥–µ–Ω–µ–≥!'); }
        }

        function closeQuickRest() {
            document.getElementById('quick-rest-panel').classList.remove('active');
            document.getElementById('rest-backdrop').classList.remove('active');
        }

        function findOrder() { showToast('–ü–æ–∏—Å–∫ –∑–∞–∫–∞–∑–∞...'); /* –¢–≤–æ—è –ª–æ–≥–∏–∫–∞ */ }
        function openShop() { showToast('–ú–∞–≥–∞–∑–∏–Ω –∑–∞–∫—Ä—ã—Ç'); }
        function showStats() { showToast('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—É—Å—Ç–∞'); }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
        const map = L.map('map', { zoomControl: false }).setView([52.2297, 21.0122], 13);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);
        L.marker([52.2297, 21.0122], {icon: L.divIcon({className:'marker-courier'})}).addTo(map);

        updateUI();
    </script>
</body>
</html>
