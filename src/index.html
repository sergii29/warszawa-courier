<body>
  <h1>Warszawa Courier</h1>

  <div id="hud"></div>

  <button id="orderBtn">ğŸš´ Ğ’Ğ·ÑÑ‚ÑŒ Ğ·Ğ°ĞºĞ°Ğ·</button>
  <button id="restBtn">ğŸ› ĞÑ‚Ğ´Ğ¾Ñ…Ğ½ÑƒÑ‚ÑŒ</button>
  <button id="timeBtn">ğŸŒ— Ğ”ĞµĞ½ÑŒ / ĞĞ¾Ñ‡ÑŒ</button>

  <script type="module">
    import { state } from "./state.js";
    import { saveState, loadState } from "./save.js";

    const hud = document.getElementById("hud");
    const orderBtn = document.getElementById("orderBtn");
    const restBtn = document.getElementById("restBtn");
    const timeBtn = document.getElementById("timeBtn");

    function render() {
      let warning = "";
      if (state.energy <= 0) warning = "âš ï¸ Ğ¢Ñ‹ Ğ²Ñ‹Ğ¶Ğ°Ñ‚. ĞÑƒĞ¶Ğ½Ğ¾ Ğ¾Ñ‚Ğ´Ğ¾Ñ…Ğ½ÑƒÑ‚ÑŒ.";
      if (state.stress >= 100) warning = "ğŸš¨ ĞĞµÑ€Ğ²Ğ½Ñ‹Ğ¹ ÑÑ€Ñ‹Ğ²! Ğ¨Ñ‚Ñ€Ğ°Ñ„Ñ‹ Ñ€Ğ°ÑÑ‚ÑƒÑ‚.";

      hud.innerHTML = `
        ğŸ•’ Ğ’Ñ€ĞµĞ¼Ñ: ${state.isNight ? "ĞĞ¾Ñ‡ÑŒ ğŸŒ™" : "Ğ”ĞµĞ½ÑŒ â˜€ï¸"}<br>
        â­ Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ: ${state.level} (XP: ${state.xp})<br>
        ğŸ’° Ğ”ĞµĞ½ÑŒĞ³Ğ¸: ${state.money}<br>
        âš¡ Ğ­Ğ½ĞµÑ€Ğ³Ğ¸Ñ: ${state.energy}<br>
        ğŸ˜µ Ğ¡Ñ‚Ñ€ĞµÑÑ: ${state.stress}<br>
        <b>${warning}</b>
      `;
    }

    orderBtn.onclick = () => {
      if (state.energy <= 0) {
        alert("Ğ¢Ñ‹ Ğ²Ñ‹Ğ¶Ğ°Ñ‚. ĞÑ‚Ğ´Ñ‹Ñ…Ğ°Ğ¹.");
        return;
      }

      const roll = Math.random();
      state.energy -= state.isNight ? 15 : 10;

      if (roll < 0.6) {
        state.money += state.isNight ? 80 : 50;
      } else if (roll < 0.85) {
        state.money += state.isNight ? 180 : 120;
        alert("VIP ĞºĞ»Ğ¸ĞµĞ½Ñ‚ ğŸ’¸");
      } else {
        state.money -= state.stress >= 100 ? 80 : 40;
        state.stress += 15;
        alert("ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° Ñ Ğ·Ğ°ĞºĞ°Ğ·Ğ¾Ğ¼ ğŸ˜¡");
      }

      state.stress += 5;

      state.xp += state.isNight ? 20 : 10;
      if (state.xp >= state.level * 100) {
        state.xp = 0;
        state.level += 1;
        alert("ĞĞ¾Ğ²Ñ‹Ğ¹ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ â­");
      }

      saveState(state);
      render();
    };

    restBtn.onclick = () => {
      state.energy = Math.min(100, state.energy + 30);
      state.stress = Math.max(0, state.stress - 20);
      saveState(state);
      render();
    };

    timeBtn.onclick = () => {
      state.isNight = !state.isNight;
      saveState(state);
      render();
    };

    await loadState(state);
    render();
  </script>
</body>
