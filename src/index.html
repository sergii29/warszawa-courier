<body>
  <div class="app">

    <!-- HUD -->
    <div class="hud">
      <div class="stat money">ğŸ’° <span id="money">0</span></div>
      <div class="stat energy">âš¡ <span id="energy">0</span></div>
      <div class="stat stress">ğŸ˜µ <span id="stress">0</span></div>
    </div>

    <!-- CENTER -->
    <div class="center">
      <div id="time" class="time">Ğ”ĞµĞ½ÑŒ â˜€ï¸</div>
    </div>

    <!-- BOTTOM BAR -->
    <div class="bottom-bar">
      <button id="orderBtn" class="btn primary">ğŸš´ Ğ—Ğ°ĞºĞ°Ğ·</button>
      <button id="restBtn" class="btn">ğŸ› ĞÑ‚Ğ´Ñ‹Ñ…</button>
      <button id="timeBtn" class="btn">ğŸŒ—</button>
    </div>

  </div>

  <script type="module">
    import { state } from "./state.js";
    import { saveState, loadState } from "./save.js";

    const moneyEl = document.getElementById("money");
    const energyEl = document.getElementById("energy");
    const stressEl = document.getElementById("stress");
    const timeEl = document.getElementById("time");

    const orderBtn = document.getElementById("orderBtn");
    const restBtn = document.getElementById("restBtn");
    const timeBtn = document.getElementById("timeBtn");

    function render() {
      moneyEl.textContent = state.money;
      energyEl.textContent = state.energy;
      stressEl.textContent = state.stress;
      timeEl.textContent = state.isNight ? "ĞĞ¾Ñ‡ÑŒ ğŸŒ™" : "Ğ”ĞµĞ½ÑŒ â˜€ï¸";
    }

    orderBtn.onclick = () => {
      orderBtn.classList.add("press");
      setTimeout(() => orderBtn.classList.remove("press"), 150);

      if (state.energy <= 0) return alert("ĞÑƒĞ¶Ğ½Ğ¾ Ğ¾Ñ‚Ğ´Ğ¾Ñ…Ğ½ÑƒÑ‚ÑŒ");

      const roll = Math.random();
      state.energy -= state.isNight ? 15 : 10;

      if (roll < 0.6) state.money += state.isNight ? 80 : 50;
      else if (roll < 0.85) state.money += state.isNight ? 180 : 120;
      else {
        state.money -= 40;
        state.stress += 15;
      }

      state.stress += 5;
      saveState(state);
      render();
    };

    restBtn.onclick = () => {
      restBtn.classList.add("press");
      setTimeout(() => restBtn.classList.remove("press"), 150);

      state.energy = Math.min(100, state.energy + 30);
      state.stress = Math.max(0, state.stress - 20);
      saveState(state);
      render();
    };

    timeBtn.onclick = () => {
      state.isNight = !state.isNight;
      saveState(state);
      render();
    };

    await loadState(state);
    render();
  </script>
</body>
