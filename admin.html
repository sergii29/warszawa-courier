<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Warszawa GOD MODE ‚ö°</title>
    <style>
        :root { 
            --bg: #000000; --card-bg: #1c1c1e; --accent: #0a84ff; --green: #30d158; 
            --danger: #ff453a; --text: #ffffff; --subtext: #8e8e93; --gold: #ffd60a; --border: #38383a;
        }
        body { background: var(--bg); color: var(--text); font-family: -apple-system, sans-serif; margin: 0; padding: 15px; padding-bottom: 50px; }
        h2 { margin: 0 0 15px 0; font-size: 22px; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .stat-card { background: var(--card-bg); padding: 12px; border-radius: 12px; text-align: center; border: 1px solid var(--border); }
        .stat-val { font-size: 20px; font-weight: 800; display: block; margin-bottom: 4px; }
        .stat-label { color: var(--subtext); font-size: 10px; text-transform: uppercase; }
        .users-list { display: flex; flex-direction: column; gap: 12px; }
        .user-card { background: var(--card-bg); border-radius: 16px; padding: 16px; border: 1px solid var(--border); display: flex; flex-direction: column; gap: 12px; }
        .btn-manage { background: var(--accent); color: white; border: none; padding: 12px; border-radius: 10px; font-weight: 600; width: 100%; cursor: pointer; }
        #editor-modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(3px); z-index: 1000; align-items: flex-end; justify-content: center; opacity: 0; transition: opacity 0.3s; }
        #editor-modal.show { opacity: 1; }
        .editor-content { background: #1c1c1e; width: 100%; max-width: 600px; max-height: 85vh; overflow-y: auto; border-radius: 20px 20px 0 0; padding: 20px; }
        .form-input { background: #2c2c2e; border: 1px solid #3a3a3c; color: white; padding: 12px; border-radius: 10px; width: 100%; margin-bottom: 10px; }
        .btn-action-modal { padding: 15px; border-radius: 12px; font-weight: 600; border: none; font-size: 16px; cursor: pointer; width: 100%; margin-top: 10px; }
        .btn-save { background: var(--green); color: black; }
        .btn-ban { background: #2c2c2e; color: var(--danger); border: 1px solid var(--danger); }
        .btn-reset { background: transparent; color: var(--danger); border: 1px solid #3a3a3c; }
    </style>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>
<body>
    <h2>üöÅ Admin <span style="color:var(--accent)">PRO</span></h2>
    <div class="stats-grid">
        <div class="stat-card"><span class="stat-val" style="color:var(--green)" id="online-count">0</span><span class="stat-label">Online</span></div>
        <div class="stat-card"><span class="stat-val" id="total-count">0</span><span class="stat-label">–ò–≥—Ä–æ–∫–æ–≤</span></div>
        <div class="stat-card"><span class="stat-val" style="color:var(--gold)" id="rich-count">0</span><span class="stat-label">–ë–æ–≥–∞—á–µ–π</span></div>
    </div>
    <div id="users-container" class="users-list"></div>

    <div id="editor-modal">
        <div class="editor-content">
            <h3 id="edit-title">–ò–≥—Ä–æ–∫</h3>
            <input type="number" id="inp-money" class="form-input" placeholder="PLN">
            <input type="number" id="inp-lvl" class="form-input" placeholder="LVL">
            <input type="text" id="inp-msg" class="form-input" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ –∏–≥—Ä–æ–∫—É...">
            <button class="btn-action-modal btn-save" onclick="saveUserChanges()">üíæ –°–û–•–†–ê–ù–ò–¢–¨</button>
            <button class="btn-action-modal btn-ban" id="btn-ban" onclick="toggleBan()">‚õî –ó–ê–ë–ê–ù–ò–¢–¨</button>
            <button class="btn-action-modal btn-reset" onclick="resetUserFull()">‚ôªÔ∏è –ü–û–õ–ù–´–ô –°–ë–†–û–° (WIPE)</button>
            <button class="btn-action-modal" onclick="closeEditor()">–ó–ê–ö–†–´–¢–¨</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
          apiKey: "AIzaSyChrQMyO2soPgoEHq_f3aYs5Cs19q3sWEk",
          authDomain: "warszawa-courier.firebaseapp.com",
          databaseURL: "https://warszawa-courier-default-rtdb.europe-west1.firebasedatabase.app",
          projectId: "warszawa-courier",
          storageBucket: "warszawa-courier.firebasestorage.app",
          messagingSenderId: "295860613508",
          appId: "1:295860613508:web:86fe8364377d6875612dd1",
          measurementId: "G-TGSCHBVLX2"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let allUsers = {};
        let currentEditId = null;

        db.ref('users').on('value', (s) => { allUsers = s.val() || {}; renderCards(); });

        function renderCards() {
            const container = document.getElementById('users-container');
            container.innerHTML = '';
            Object.entries(allUsers).forEach(([id, u]) => {
                const card = document.createElement('div');
                card.className = 'user-card';
                card.innerHTML = `<b>${u.name || 'User'}</b> (LVL ${u.lvl}) - ${u.money} PLN <button class="btn-manage" onclick="openEditor('${id}')">–£–ü–†–ê–í–õ–ï–ù–ò–ï</button>`;
                container.appendChild(card);
            });
        }

        function openEditor(id) {
            currentEditId = id;
            const u = allUsers[id];
            document.getElementById('edit-title').innerText = u.name;
            document.getElementById('inp-money').value = u.money;
            document.getElementById('inp-lvl').value = u.lvl;
            const m = document.getElementById('editor-modal');
            m.style.display = 'flex'; setTimeout(() => m.classList.add('show'), 10);
        }

        function closeEditor() { const m = document.getElementById('editor-modal'); m.classList.remove('show'); setTimeout(() => m.style.display = 'none', 300); }

        function saveUserChanges() {
            const updates = { money: parseFloat(document.getElementById('inp-money').value), lvl: parseFloat(document.getElementById('inp-lvl').value), lastAdminUpdate: Date.now() };
            const msg = document.getElementById('inp-msg').value; if(msg) updates.adminMessage = msg;
            db.ref('users/' + currentEditId).update(updates).then(closeEditor);
        }

        function resetUserFull() {
            if(!confirm("–£–î–ê–õ–ò–¢–¨ –í–ï–°–¨ –ü–†–û–ì–†–ï–°–° –ò –ö–í–ê–†–¢–ò–†–´?")) return;
            const u = allUsers[currentEditId];
            const wipe = {
                name: u.name, user: u.user, lastActive: Date.now(), lastAdminUpdate: Date.now(),
                money: 10, lvl: 1.0, en: 2000, waterStock: 0, housing: { id: -1 }, // –°–ë–†–û–° –¢–£–¢
                totalOrders: 0, totalClicks: 0, totalBottles: 0, totalEarned: 0,
                shoes: { name: "Tapki", maxDur: 100, dur: 100, bonus: 0 },
                isNewPlayer: true, history: [], usedPromos: [], transportMode: 'none'
            };
            db.ref('users/' + currentEditId).set(wipe).then(closeEditor);
        }
    </script>
</body>
</html>
